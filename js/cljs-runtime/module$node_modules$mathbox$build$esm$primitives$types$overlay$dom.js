shadow$provide.module$node_modules$mathbox$build$esm$primitives$types$overlay$dom=function(global,require,module,exports){Object.defineProperty(exports,"__esModule",{value:!0});exports.DOM=void 0;global=require("module$node_modules$mathbox$build$esm$primitives$primitive");class DOM extends global.Primitive{static initClass(){this.traits="node bind object visible overlay dom attach position".split(" ")}init(){this.emitter=this.root=null;this.active={}}make(){super.make();this._helpers.bind.make([{to:"dom.html",
trait:"html"},{to:"dom.points",trait:"source"}]);if(null!=this.bind.points&&null!=this.bind.html){this.root=this._inherit("root");this._listen("root","root.update",this.update);this._listen("root","root.post",this.post);var pointDims=this.bind.points.getDimensions(),htmlDims=this.bind.html.getDimensions(),items=Math.min(pointDims.items,htmlDims.items),width=Math.min(pointDims.width,htmlDims.width),height=Math.min(pointDims.height,htmlDims.height);pointDims=Math.min(pointDims.depth,htmlDims.depth);
htmlDims=this.bind.points.sourceShader(this._shaders.shader());htmlDims=this._helpers.position.pipeline(htmlDims);var projection=this._shaders.shader({globals:["projectionMatrix"]});projection.pipe("project.readback");htmlDims.pipe(projection);projection=this._shaders.shader();this.readback=this._renderables.make("readback",{map:htmlDims,indexer:projection,items,width,height,depth:pointDims,channels:4,stpq:!0});this.dom=this._overlays.make("dom");this.dom.hint(items*width*height*pointDims*2);this.emitter=
this.callback(this.bind.html.nodes());this.readback.setCallback(this.emitter);this._helpers.visible.make()}}unmake(){null!=this.readback&&(this.readback.dispose(),this.dom.dispose(),this.emitter=this.root=this.readback=this.dom=null,this.active={});this._helpers.bind.unmake();this._helpers.visible.unmake()}update(){null!=this.readback&&this.props.visible&&(this.readback.update(null!=this.root?this.root.getCamera():void 0),this.readback.post(),this.readback.iterate())}post(){null!=this.readback&&this.dom.render(this.isVisible?
this.emitter.nodes():null)}callback(data){let strideJ,strideK;var uniforms=this._inherit("unit").getUnitUniforms();const width=uniforms.viewWidth,height=uniforms.viewHeight,attr=this.node.attributes["dom.attributes"],size=this.node.attributes["dom.size"],zoom=this.node.attributes["dom.zoom"],color=this.node.attributes["dom.color"],outline=this.node.attributes["dom.outline"],pointer=this.node.attributes["dom.pointerEvents"],opacity=this.node.attributes["overlay.opacity"],zIndex=this.node.attributes["overlay.zIndex"],
offset=this.node.attributes["attach.offset"],depth=this.node.attributes["attach.depth"],snap=this.node.attributes["attach.snap"],{el}=this.dom;let nodes=[],styles=null,className=null,strideI=strideJ=strideK=0,colorString="";uniforms=function(x,y,z,w,i,j,k,l){z=data[l+strideI*i+strideJ*j+strideK*k];i=0>w;j=1+(1/w-1)*depth.value;j=i?0:j;x=(x+1)*width.value*.5+ +offset.value.x*j;y=(y-1)*height.value*.5+ +offset.value.y*j;x/=zoom.value;y/=zoom.value;snap.value&&(x=Math.round(x),y=Math.round(y));y={className,
style:{transform:`translate3d(${x}px, ${-y}px, ${1-w}px) translate(-50%, -50%) scale(${j},${j})`,opacity:Math.min(.999,i?0:opacity.value)}};for(k in styles)w=styles[k],y.style[k]=w;x=attr.value;if(null!=x){i=x.style;for(k in x)w=x[k],["style","className"].includes(k)||(y[k]=w);if(null!=i)for(k in i)w=i[k],y.style[k]=w}y.className+=" "+(null!=(null!=x?x.className:void 0)?null!=x?x.className:void 0:"mathbox-label");return nodes.push(el("div",y,z))};uniforms.reset=()=>{nodes=[];[strideI,strideJ,strideK]=
Array.from([this.strideI,this.strideJ,this.strideK]);const c=color.value;colorString=c?`rgb(${[Math.floor(255*c.x),Math.floor(255*c.y),Math.floor(255*c.z)]})`:"";className=`mathbox-outline-${Math.round(outline.value)}`;styles={};c&&(styles.color=colorString);styles.fontSize=`${size.value}px`;1!==zoom.value&&(styles.zoom=zoom.value);0<zIndex.value&&(styles.zIndex=zIndex.value);if(pointer.value)return styles.pointerEvents="auto"};uniforms.nodes=()=>nodes;return uniforms}resize(){if(null!=this.readback){var sI=
this.bind.points.getActiveDimensions();var htmlDims=this.bind.html.getActiveDimensions();this.readback.setActive(Math.min(sI.items,htmlDims.items),Math.min(sI.width,htmlDims.width),Math.min(sI.height,htmlDims.height),Math.min(sI.depth,htmlDims.depth));this.strideI=sI=htmlDims.items;this.strideJ=sI*=htmlDims.width;this.strideK=sI*htmlDims.height}}change(changed,_touched,_init){if(changed["dom.html"]||changed["dom.points"])return this.rebuild()}}exports.DOM=DOM;DOM.initClass()}
//# sourceMappingURL=module$node_modules$mathbox$build$esm$primitives$types$overlay$dom.js.map

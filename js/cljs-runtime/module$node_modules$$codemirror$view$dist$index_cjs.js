shadow$provide.module$node_modules$$codemirror$view$dist$index_cjs=function(global,require,module,exports){function getSelection(root){return(11==root.nodeType?root.getSelection?root:root.ownerDocument:root).getSelection()}function contains(dom,node){return node?dom==node||dom.contains(1!=node.nodeType?node.parentNode:node):!1}function hasSelection(dom,selection){if(!selection.anchorNode)return!1;try{return contains(dom,selection.anchorNode)}catch(_){return!1}}function clientRectsFor(dom){return 3==
dom.nodeType?textRange(dom,0,dom.nodeValue.length).getClientRects():1==dom.nodeType?dom.getClientRects():[]}function isEquivalentPosition(node,off,targetNode,targetOff){return targetNode?scanFor(node,off,targetNode,targetOff,-1)||scanFor(node,off,targetNode,targetOff,1):!1}function domIndex(node){for(var index=0;;index++)if(node=node.previousSibling,!node)return index}function scanFor(node,off,targetNode,targetOff,dir){for(;;){if(node==targetNode&&off==targetOff)return!0;if(off==(0>dir?0:maxOffset(node))){if("DIV"==
node.nodeName)return!1;let parent=node.parentNode;if(!parent||1!=parent.nodeType)return!1;off=domIndex(node)+(0>dir?0:1);node=parent}else if(1==node.nodeType){node=node.childNodes[off+(0>dir?-1:0)];if(1==node.nodeType&&"false"==node.contentEditable)return!1;off=0>dir?maxOffset(node):0}else return!1}}function maxOffset(node){return 3==node.nodeType?node.nodeValue.length:node.childNodes.length}function flattenRect(rect,left){left=left?rect.left:rect.right;return{left,right:left,top:rect.top,bottom:rect.bottom}}
function scrollRectIntoView(dom,rect$jscomp$0,side,x,y,xMargin,yMargin,ltr){let doc=dom.ownerDocument,win=doc.defaultView;for(;dom;)if(1==dom.nodeType){let top=dom==doc.body;if(top){var JSCompiler_object_inline_left_4766=0;var JSCompiler_object_inline_right_4767=win.innerWidth;var JSCompiler_object_inline_top_4768=0;var JSCompiler_object_inline_bottom_4769=win.innerHeight}else{if(dom.scrollHeight<=dom.clientHeight&&dom.scrollWidth<=dom.clientWidth){dom=dom.assignedSlot||dom.parentNode;continue}var rect=
dom.getBoundingClientRect();JSCompiler_object_inline_left_4766=rect.left;JSCompiler_object_inline_right_4767=rect.left+dom.clientWidth;JSCompiler_object_inline_top_4768=rect.top;JSCompiler_object_inline_bottom_4769=rect.top+dom.clientHeight}var moveY=rect=0;"nearest"==y?rect$jscomp$0.top<JSCompiler_object_inline_top_4768?(moveY=-(JSCompiler_object_inline_top_4768-rect$jscomp$0.top+yMargin),0<side&&rect$jscomp$0.bottom>JSCompiler_object_inline_bottom_4769+moveY&&(moveY=rect$jscomp$0.bottom-JSCompiler_object_inline_bottom_4769+
moveY+yMargin)):rect$jscomp$0.bottom>JSCompiler_object_inline_bottom_4769&&(moveY=rect$jscomp$0.bottom-JSCompiler_object_inline_bottom_4769+yMargin,0>side&&rect$jscomp$0.top-moveY<JSCompiler_object_inline_top_4768&&(moveY=-(JSCompiler_object_inline_top_4768+moveY-rect$jscomp$0.top+yMargin))):(moveY=rect$jscomp$0.bottom-rect$jscomp$0.top,JSCompiler_object_inline_bottom_4769-=JSCompiler_object_inline_top_4768,moveY=("center"==y&&moveY<=JSCompiler_object_inline_bottom_4769?rect$jscomp$0.top+moveY/2-
JSCompiler_object_inline_bottom_4769/2:"start"==y||"center"==y&&0>side?rect$jscomp$0.top-yMargin:rect$jscomp$0.bottom-JSCompiler_object_inline_bottom_4769+yMargin)-JSCompiler_object_inline_top_4768);"nearest"==x?rect$jscomp$0.left<JSCompiler_object_inline_left_4766?(rect=-(JSCompiler_object_inline_left_4766-rect$jscomp$0.left+xMargin),0<side&&rect$jscomp$0.right>JSCompiler_object_inline_right_4767+rect&&(rect=rect$jscomp$0.right-JSCompiler_object_inline_right_4767+rect+xMargin)):rect$jscomp$0.right>
JSCompiler_object_inline_right_4767&&(rect=rect$jscomp$0.right-JSCompiler_object_inline_right_4767+xMargin,0>side&&rect$jscomp$0.left<JSCompiler_object_inline_left_4766+rect&&(rect=-(JSCompiler_object_inline_left_4766+rect-rect$jscomp$0.left+xMargin))):rect=("center"==x?rect$jscomp$0.left+(rect$jscomp$0.right-rect$jscomp$0.left)/2-(JSCompiler_object_inline_right_4767-JSCompiler_object_inline_left_4766)/2:"start"==x==ltr?rect$jscomp$0.left-xMargin:rect$jscomp$0.right-(JSCompiler_object_inline_right_4767-
JSCompiler_object_inline_left_4766)+xMargin)-JSCompiler_object_inline_left_4766;if(rect||moveY)top?win.scrollBy(rect,moveY):(JSCompiler_object_inline_right_4767=JSCompiler_object_inline_left_4766=0,moveY&&(JSCompiler_object_inline_right_4767=dom.scrollTop,dom.scrollTop+=moveY,JSCompiler_object_inline_right_4767=dom.scrollTop-JSCompiler_object_inline_right_4767),rect&&(JSCompiler_object_inline_left_4766=dom.scrollLeft,dom.scrollLeft+=rect,JSCompiler_object_inline_left_4766=dom.scrollLeft-JSCompiler_object_inline_left_4766),
rect$jscomp$0={left:rect$jscomp$0.left-JSCompiler_object_inline_left_4766,top:rect$jscomp$0.top-JSCompiler_object_inline_right_4767,right:rect$jscomp$0.right-JSCompiler_object_inline_left_4766,bottom:rect$jscomp$0.bottom-JSCompiler_object_inline_right_4767},JSCompiler_object_inline_left_4766&&1>Math.abs(JSCompiler_object_inline_left_4766-rect)&&(x="nearest"),JSCompiler_object_inline_right_4767&&1>Math.abs(JSCompiler_object_inline_right_4767-moveY)&&(y="nearest"));if(top)break;dom=dom.assignedSlot||
dom.parentNode}else if(11==dom.nodeType)dom=dom.host;else break}function focusPreventScroll(dom){if(dom.setActive)return dom.setActive();if(preventScrollSupported)return dom.focus(preventScrollSupported);let stack=[];for(var cur=dom;cur&&(stack.push(cur,cur.scrollTop,cur.scrollLeft),cur!=cur.ownerDocument);cur=cur.parentNode);dom.focus(null==preventScrollSupported?{get preventScroll(){preventScrollSupported={preventScroll:!0};return!0}}:void 0);if(!preventScrollSupported)for(preventScrollSupported=
!1,dom=0;dom<stack.length;){cur=stack[dom++];let top=stack[dom++],left=stack[dom++];cur.scrollTop!=top&&(cur.scrollTop=top);cur.scrollLeft!=left&&(cur.scrollLeft=left)}}function textRange(node,from,to=from){let range=scratchRange||(scratchRange=document.createRange());range.setEnd(node,to);range.setStart(node,from);return range}function dispatchKey(elt,name,code){code={key:name,code:name,keyCode:code,which:code,cancelable:!0};name=new KeyboardEvent("keydown",code);name.synthetic=!0;elt.dispatchEvent(name);
code=new KeyboardEvent("keyup",code);code.synthetic=!0;elt.dispatchEvent(code);return name.defaultPrevented||code.defaultPrevented}function getRoot(node){for(;node;){if(node&&(9==node.nodeType||11==node.nodeType&&node.host))return node;node=node.assignedSlot||node.parentNode}return null}function clearAttributes(node){for(;node.attributes.length;)node.removeAttributeNode(node.attributes[0])}function rm$1(dom){let next=dom.nextSibling;dom.parentNode.removeChild(dom);return next}function replaceRange(parent,
fromI,fromOff,toI,toOff,insert,breakAtStart,openStart,openEnd){let {children}=parent,before=children.length?children[fromI]:null,last=insert.length?insert[insert.length-1]:null,breakAtEnd=last?last.breakAfter:breakAtStart;if(!(fromI==toI&&before&&!breakAtStart&&!breakAtEnd&&2>insert.length&&before.merge(fromOff,toOff,insert.length?last:null,0==fromOff,openStart,openEnd))){if(toI<children.length){let after=children[toI];if(after&&toOff<after.length)fromI==toI&&(after=after.split(toOff),toOff=0),!breakAtEnd&&
last&&after.merge(0,toOff,last,!0,0,openEnd)?insert[insert.length-1]=after:(toOff&&after.merge(0,toOff,null,!1,0,openEnd),insert.push(after));else if(null===after||void 0===after?0:after.breakAfter)last?last.breakAfter=1:breakAtStart=1;toI++}before&&(before.breakAfter=breakAtStart,0<fromOff&&(!breakAtStart&&insert.length&&before.merge(fromOff,before.length,insert[0],!1,openStart,0)?before.breakAfter=insert.shift().breakAfter:(fromOff<before.length||before.children.length&&0==before.children[before.children.length-
1].length)&&before.merge(fromOff,before.length,null,!1,openStart,0),fromI++));for(;fromI<toI&&insert.length;)if(children[toI-1].become(insert[insert.length-1]))toI--,insert.pop(),openEnd=insert.length?0:openStart;else if(children[fromI].become(insert[0]))fromI++,insert.shift(),openStart=insert.length?0:openEnd;else break;!insert.length&&fromI&&toI<children.length&&!children[fromI-1].breakAfter&&children[toI].merge(0,0,children[fromI-1],!1,openStart,openEnd)&&fromI--;(fromI<toI||insert.length)&&parent.replaceChildren(fromI,
toI,insert)}}function mergeChildrenInto(parent,from,to,insert,openStart,openEnd){let cur=parent.childCursor(),{i:toI,off:toOff}=cur.findPos(to,1),{i:fromI,off:fromOff}=cur.findPos(from,-1);from-=to;for(let view of insert)from+=view.length;parent.length+=from;replaceRange(parent,fromI,fromOff,toI,toOff,insert,0,openStart,openEnd)}function textCoords(text,pos,side){let length=text.nodeValue.length;pos>length&&(pos=length);let from=pos,to=pos,flatten=0;0==pos&&0>side||pos==length&&0<=side?browser.chrome||
browser.gecko||(pos?(from--,flatten=1):to<length&&(to++,flatten=-1)):0>side?from--:to<length&&to++;text=textRange(text,from,to).getClientRects();if(!text.length)return Rect0;side=text[(flatten?0>flatten:0<=side)?0:text.length-1];browser.safari&&!flatten&&0==side.width&&(side=Array.prototype.find.call(text,r=>r.width)||side);return flatten?flattenRect(side,0>flatten):side||null}function scanCompositionTree(pos,side,view,text,enterView,fromText){if(view instanceof MarkView){for(let child=view.dom.firstChild;child;child=
child.nextSibling){let desc=ContentView.get(child);if(!desc)return fromText(pos,side);let hasComp=contains(child,text),len=desc.length+(hasComp?text.nodeValue.length:0);if(pos<len||pos==len&&0>=desc.getSide())return hasComp?scanCompositionTree(pos,side,desc,text,enterView,fromText):enterView(desc,pos,side);pos-=len}return enterView(view,view.length,-1)}return view.dom==text?fromText(pos,side):enterView(view,pos,side)}function posFromDOMInCompositionTree(node,offset,view,text){if(view instanceof MarkView)for(let child of view.children){let hasComp=
contains(child.dom,text);if(contains(child.dom,node))return 0+(hasComp?posFromDOMInCompositionTree(node,offset,child,text):child.localPosFromDOM(node,offset))}else if(view.dom==text)return Math.min(offset,text.nodeValue.length);return view.localPosFromDOM(node,offset)}function inlineDOMAtPos(parent,pos){let dom=parent.dom;({children:parent}=parent);var i=0;for(var off=0;i<parent.length;i++){let child=parent[i],end=off+child.length;if(!(end==off&&0>=child.getSide())){if(pos>off&&pos<end&&child.dom.parentNode==
dom)return child.domAtPos(pos-off);if(pos<=off)break;off=end}}for(pos=i;0<pos;pos--)if(off=parent[pos-1],off.dom.parentNode==dom)return off.domAtPos(off.length);for(;i<parent.length;i++)if(pos=parent[i],pos.dom.parentNode==dom)return pos.domAtPos(0);return new DOMPos(dom,0)}function joinInlineInto(parent,view,open){let last,{children}=parent;0<open&&view instanceof MarkView&&children.length&&(last=children[children.length-1])instanceof MarkView&&last.mark.eq(view.mark)?joinInlineInto(last,view.children[0],
open-1):(children.push(view),view.setParent(parent));parent.length+=view.length}function coordsInChildren(view,pos,side){for(let off=0,i=0;i<view.children.length;i++){let child=view.children[i],end=off+child.length,next;if((0>=side||end==view.length||0<child.getSide()?end>=pos:end>pos)&&(pos<end||i+1==view.children.length||(next=view.children[i+1]).length||0<next.getSide())){let flatten=0;if(end==off){if(0>=child.getSide())continue;flatten=side=-child.getSide()}view=child.coordsAt(Math.max(0,pos-
off),side);return flatten&&view?flattenRect(view,0>side):view}off=end}side=view.dom.lastChild;if(!side)return view.dom.getBoundingClientRect();view=clientRectsFor(side);return view[view.length-1]||null}function combineAttrs(source,target){for(let name in source)"class"==name&&target.class?target.class+=" "+source.class:"style"==name&&target.style?target.style+=";"+source.style:target[name]=source[name];return target}function attrsEq(a,b){if(a==b)return!0;if(!a||!b)return!1;let keysA=Object.keys(a),
keysB=Object.keys(b);if(keysA.length!=keysB.length)return!1;for(let key of keysA)if(-1==keysB.indexOf(key)||a[key]!==b[key])return!1;return!0}function updateAttrs(dom,prev,attrs){let changed=null;if(prev)for(let name in prev)attrs&&name in attrs||dom.removeAttribute(changed=name);if(attrs)for(let name in attrs)prev&&prev[name]==attrs[name]||dom.setAttribute(changed=name,attrs[name]);return!!changed}function getInclusive(spec,block=!1){let {inclusiveStart:start,inclusiveEnd:end}=spec;null==start&&
(start=spec.inclusive);null==end&&(end=spec.inclusive);return{start:null!==start&&void 0!==start?start:block,end:null!==end&&void 0!==end?end:block}}function addRange(from,to,ranges,margin=0){let last=ranges.length-1;0<=last&&ranges[last]+margin>=from?ranges[last]=Math.max(ranges[last],to):ranges.push(from,to)}function wrapMarks(view,active){for(let mark of active)view=new MarkView(mark,[view],view.length);return view}function logException(state,exception,context){state=state.facet(exceptionSink);
if(state.length)state[0](exception);else if(window.onerror)window.onerror(String(exception),context,void 0,void 0,exception);else context?console.error(context+":",exception):console.error(exception)}function dec(str){let result=[];for(let i=0;i<str.length;i++)result.push(1<<+str[i]);return result}function computeOrder(line,direction){let len=line.length;var outerType=direction==LTR?1:2;direction=direction==LTR?2:1;if(!line||1==outerType&&!BidiRE.test(line))return[new BidiSpan(0,len,0)];for(let i=
0,prev=outerType,prevStrong=outerType;i<len;i++){var ch$jscomp$0=line.charCodeAt(i);ch$jscomp$0=247>=ch$jscomp$0?LowTypes[ch$jscomp$0]:1424<=ch$jscomp$0&&1524>=ch$jscomp$0?2:1536<=ch$jscomp$0&&1785>=ch$jscomp$0?ArabicTypes[ch$jscomp$0-1536]:1774<=ch$jscomp$0&&2220>=ch$jscomp$0?4:8192<=ch$jscomp$0&&8203>=ch$jscomp$0?256:64336<=ch$jscomp$0&&65023>=ch$jscomp$0?4:8204==ch$jscomp$0?256:1;512==ch$jscomp$0?ch$jscomp$0=prev:8==ch$jscomp$0&&4==prevStrong&&(ch$jscomp$0=16);types[i]=4==ch$jscomp$0?2:ch$jscomp$0;
ch$jscomp$0&7&&(prevStrong=ch$jscomp$0);prev=ch$jscomp$0}for(let i=0,prev=outerType,prevStrong=outerType;i<len;i++){ch$jscomp$0=types[i];if(128==ch$jscomp$0)i<len-1&&prev==types[i+1]&&prev&24?ch$jscomp$0=types[i]=prev:types[i]=256;else if(64==ch$jscomp$0){for(var end=i+1;end<len&&64==types[end];)end++;var replace=i&&8==prev||end<len&&8==types[end]?1==prevStrong?1:8:256;for(let j=i;j<end;j++)types[j]=replace;i=end-1}else 8==ch$jscomp$0&&1==prevStrong&&(types[i]=1);prev=ch$jscomp$0;ch$jscomp$0&7&&(prevStrong=
ch$jscomp$0)}for(let i=0,sI=0,context=0,ch,br,type;i<len;i++)if(br=Brackets[ch=line.charCodeAt(i)])if(0>br)for(ch$jscomp$0=sI-3;0<=ch$jscomp$0;ch$jscomp$0-=3){if(BracketStack[ch$jscomp$0+1]==-br){end=BracketStack[ch$jscomp$0+2];(end=end&2?outerType:end&4?end&1?direction:outerType:0)&&(types[i]=types[BracketStack[ch$jscomp$0]]=end);sI=ch$jscomp$0;break}}else if(189==BracketStack.length)break;else BracketStack[sI++]=i,BracketStack[sI++]=ch,BracketStack[sI++]=context;else if(2==(type=types[i])||1==type)for(context=
(ch$jscomp$0=type==outerType)?0:1,end=sI-3;0<=end;end-=3){replace=BracketStack[end+2];if(replace&2)break;if(ch$jscomp$0)BracketStack[end+2]|=2;else{if(replace&4)break;BracketStack[end+2]|=4}}for(direction=0;direction<len;direction++)if(256==types[direction]){for(line=direction+1;line<len&&256==types[line];)line++;ch$jscomp$0=1==(direction?types[direction-1]:outerType);for(ch$jscomp$0=ch$jscomp$0==(1==(line<len?types[line]:outerType))?ch$jscomp$0?1:2:outerType;direction<line;direction++)types[direction]=
ch$jscomp$0;direction=line-1}line=[];if(1==outerType)for(outerType=0;outerType<len;){direction=outerType;for(ch$jscomp$0=1!=types[outerType++];outerType<len&&ch$jscomp$0==(1!=types[outerType]);)outerType++;if(ch$jscomp$0)for(ch$jscomp$0=outerType;ch$jscomp$0>direction;){end=ch$jscomp$0;for(replace=2!=types[--ch$jscomp$0];ch$jscomp$0>direction&&replace==(2!=types[ch$jscomp$0-1]);)ch$jscomp$0--;line.push(new BidiSpan(ch$jscomp$0,end,replace?2:1))}else line.push(new BidiSpan(direction,outerType,0))}else for(outerType=
0;outerType<len;){direction=outerType;for(ch$jscomp$0=2==types[outerType++];outerType<len&&ch$jscomp$0==(2==types[outerType]);)outerType++;line.push(new BidiSpan(direction,outerType,ch$jscomp$0?1:2))}return line}function moveVisually(line,order,dir,start,forward){var _a;let startIndex=start.head-line.from,spanI=-1;if(0==startIndex){if(!forward||!line.length)return null;order[0].level!=dir&&(startIndex=order[0].side(!1,dir),spanI=0)}else if(startIndex==line.length){if(forward)return null;var last=
order[order.length-1];last.level!=dir&&(startIndex=last.side(!0,dir),spanI=order.length-1)}0>spanI&&(spanI=BidiSpan.find(order,startIndex,null!==(_a=start.bidiLevel)&&void 0!==_a?_a:-1,start.assoc));start=order[spanI];startIndex==start.side(forward,dir)&&(start=order[spanI+=forward?1:-1],startIndex=start.side(!forward,dir));last=forward==(start.dir==dir);_a=state$jscomp$0.findClusterBreak(line.text,startIndex,last);movedOver=line.text.slice(Math.min(startIndex,_a),Math.max(startIndex,_a));return _a!=
start.side(forward,dir)?state$jscomp$0.EditorSelection.cursor(_a+line.from,last?-1:1,start.level):(order=spanI==(forward?order.length-1:0)?null:order[spanI+(forward?1:-1)])||start.level==dir?order&&order.level<start.level?state$jscomp$0.EditorSelection.cursor(order.side(!forward,dir)+line.from,forward?1:-1,order.level):state$jscomp$0.EditorSelection.cursor(_a+line.from,forward?-1:1,start.level):state$jscomp$0.EditorSelection.cursor(forward?line.to:line.from,forward?-1:1,dir)}function isBlockElement(node){return 1==
node.nodeType&&/^(DIV|P|LI|UL|OL|BLOCKQUOTE|DD|DT|H\d|SECTION|PRE)$/.test(node.nodeName)}function compositionSurroundingNode(view){var sel=view.observer.selectionRange;sel=sel.focusNode&&nearbyTextNode(sel.focusNode,sel.focusOffset,0);if(!sel)return null;view=view.docView.nearest(sel);if(!view)return null;if(view instanceof LineView){for(var topNode=sel;topNode.parentNode!=view.dom;)topNode=topNode.parentNode;let prev=topNode.previousSibling;for(;prev&&!ContentView.get(prev);)prev=prev.previousSibling;
view=prev?ContentView.get(prev).posAtEnd:view.posAtStart;return{from:view,to:view,node:topNode,text:sel}}for(;;){({parent:topNode}=view);if(!topNode)return null;if(topNode instanceof LineView)break;view=topNode}topNode=view.posAtStart;return{from:topNode,to:topNode+view.length,node:view.dom,text:sel}}function computeCompositionDeco(view,changes){var surrounding=compositionSurroundingNode(view);if(!surrounding)return Decoration.none;let {from,to,node,text:textNode}=surrounding;surrounding=changes.mapPos(from,
1);changes=Math.max(surrounding,changes.mapPos(to,-1));({state:view}=view);let text=3==node.nodeType?node.nodeValue:(new DOMReader([],view)).readRange(node.firstChild,null).text;if(changes-surrounding<text.length)if(view.doc.sliceString(surrounding,Math.min(view.doc.length,surrounding+text.length),"￿")==text)changes=surrounding+text.length;else if(view.doc.sliceString(Math.max(0,changes-text.length),changes,"￿")==text)surrounding=changes-text.length;else return Decoration.none;else if(view.doc.sliceString(surrounding,
changes,"￿")!=text)return Decoration.none;view=ContentView.get(node);view instanceof CompositionView?view=view.widget.topView:view&&(view.parent=null);return Decoration.set(Decoration.replace({widget:new CompositionWidget(node,textNode,view),inclusive:!0}).range(surrounding,changes))}function nearbyTextNode(node,offset,side){for(;;){if(3==node.nodeType)return node;if(1==node.nodeType&&0<offset&&0>=side)node=node.childNodes[offset-1],offset=maxOffset(node);else if(1==node.nodeType&&offset<node.childNodes.length&&
0<=side)node=node.childNodes[offset],offset=0;else return null}}function findChangedDeco(a,b,diff){let comp=new DecorationComparator$1;state$jscomp$0.RangeSet.compare(a,b,diff,comp);return comp.changes}function groupAt(state$1,pos,bias=1){let categorize=state$1.charCategorizer(pos);state$1=state$1.doc.lineAt(pos);var linePos=pos-state$1.from;if(0==state$1.length)return state$jscomp$0.EditorSelection.cursor(pos);0==linePos?bias=1:linePos==state$1.length&&(bias=-1);let to=pos=linePos;0>bias?pos=state$jscomp$0.findClusterBreak(state$1.text,
linePos,!1):to=state$jscomp$0.findClusterBreak(state$1.text,linePos);for(bias=categorize(state$1.text.slice(pos,to));0<pos;){linePos=state$jscomp$0.findClusterBreak(state$1.text,pos,!1);if(categorize(state$1.text.slice(linePos,pos))!=bias)break;pos=linePos}for(;to<state$1.length;){linePos=state$jscomp$0.findClusterBreak(state$1.text,to);if(categorize(state$1.text.slice(to,linePos))!=bias)break;to=linePos}return state$jscomp$0.EditorSelection.range(pos+state$1.from,to+state$1.from)}function yOverlap(a,
b){return a.top<b.bottom-1&&a.bottom>b.top+1}function upTop(rect,top){return top<rect.top?{top,left:rect.left,right:rect.right,bottom:rect.bottom}:rect}function upBot(rect,bottom){return bottom>rect.bottom?{top:rect.top,left:rect.left,right:rect.right,bottom}:rect}function domPosAtCoords(parent,x,y){let closest,closestRect;let closestY,closestOverlap=!1,above,below,aboveRect,belowRect;for(let child=parent.firstChild;child;child=child.nextSibling){let rects=clientRectsFor(child);for(let i=0;i<rects.length;i++){let rect=
rects[i];closestRect&&yOverlap(closestRect,rect)&&(rect=upTop(upBot(rect,closestRect.bottom),closestRect.top));let dx=rect.left>x?rect.left-x:Math.max(0,x-rect.right),dy=rect.top>y?rect.top-y:Math.max(0,y-rect.bottom);if(0==dx&&0==dy)return 3==child.nodeType?domPosInText(child,x,y):domPosAtCoords(child,x,y);if(!closest||closestY>dy||closestY==dy&&closestX>dx){closest=child;closestRect=rect;var closestX=dx;closestY=dy;closestOverlap=!dx||(0<dx?i<rects.length-1:0<i)}0==dx?y>rect.bottom&&(!aboveRect||
aboveRect.bottom<rect.bottom)?(above=child,aboveRect=rect):y<rect.top&&(!belowRect||belowRect.top>rect.top)&&(below=child,belowRect=rect):aboveRect&&yOverlap(aboveRect,rect)?aboveRect=upBot(aboveRect,rect.bottom):belowRect&&yOverlap(belowRect,rect)&&(belowRect=upTop(belowRect,rect.top))}}aboveRect&&aboveRect.bottom>=y?(closest=above,closestRect=aboveRect):belowRect&&belowRect.top<=y&&(closest=below,closestRect=belowRect);if(!closest)return{node:parent,offset:0};closestX=Math.max(closestRect.left,
Math.min(closestRect.right,x));if(3==closest.nodeType)return domPosInText(closest,closestX,y);if(closestOverlap&&"false"!=closest.contentEditable)return domPosAtCoords(closest,closestX,y);x=Array.prototype.indexOf.call(parent.childNodes,closest)+(x>=(closestRect.left+closestRect.right)/2?1:0);return{node:parent,offset:x}}function domPosInText(node,x,y){let len=node.nodeValue.length;var closestOffset=-1,closestDY=1E9;let generalSide=0;for(let i=0;i<len;i++){let rects=textRange(node,i,i+1).getClientRects();
for(let j=0;j<rects.length;j++){let rect=rects[j];if(rect.top==rect.bottom)continue;generalSide||(generalSide=x-rect.left);let dy=(rect.top>y?rect.top-y:y-rect.bottom)-1;if(rect.left-1<=x&&rect.right+1>=x&&dy<closestDY){closestDY=closestOffset=x>=(rect.left+rect.right)/2;(browser.chrome||browser.gecko)&&textRange(node,i).getBoundingClientRect().left==rect.right&&(closestDY=!closestOffset);if(0>=dy)return{node,offset:i+(closestDY?1:0)};closestOffset=i+(closestDY?1:0);closestDY=dy}}}return{node,offset:-1<
closestOffset?closestOffset:0<generalSide?node.nodeValue.length:0}}function posAtCoords(view,{x,y},precise,bias=-1){var _a,content=view.contentDOM.getBoundingClientRect(),docTop=content.top+view.viewState.paddingTop;let block;var {docHeight}=view.viewState;let yOffset=y-docTop;if(0>yOffset)return 0;if(yOffset>docHeight)return view.state.doc.length;for(let halfLine=view.defaultLineHeight/2,bounced=!1;;){block=view.elementAtHeight(yOffset);if(block.type==exports.BlockType.Text)break;for(;;){yOffset=
0<bias?block.bottom+halfLine:block.top-halfLine;if(0<=yOffset&&yOffset<=docHeight)break;if(bounced)return precise?null:0;bounced=!0;bias=-bias}}y=docTop+yOffset;bias=block.from;if(bias<view.viewport.from)return 0==view.viewport.from?0:precise?null:posAtCoordsImprecise(view,content,block,x,y);if(bias>view.viewport.to)return view.viewport.to==view.state.doc.length?view.state.doc.length:precise?null:posAtCoordsImprecise(view,content,block,x,y);precise=view.dom.ownerDocument;docHeight=view.root.elementFromPoint?
view.root:precise;(docTop=docHeight.elementFromPoint(x,y))&&!view.contentDOM.contains(docTop)&&(docTop=null);docTop||(x=Math.max(content.left+1,Math.min(content.right-1,x)),(docTop=docHeight.elementFromPoint(x,y))&&!view.contentDOM.contains(docTop)&&(docTop=null));var node;content=-1;if(docTop&&0!=(null===(_a=view.docView.nearest(docTop))||void 0===_a?void 0:_a.isEditable))if(precise.caretPositionFromPoint){var pos=precise.caretPositionFromPoint(x,y);pos&&({offsetNode:node,offset:content}=pos)}else if(precise.caretRangeFromPoint&&
(_a=precise.caretRangeFromPoint(x,y))){({startContainer:node,startOffset:content}=_a);if(!(_a=!view.contentDOM.contains(node))&&(_a=browser.safari))a:if(_a=x,3!=node.nodeType||content!=(pos=node.nodeValue.length))_a=!1;else{for(precise=node.nextSibling;precise;precise=precise.nextSibling)if(1!=precise.nodeType||"BR"!=precise.nodeName){_a=!1;break a}_a=textRange(node,pos-1,pos).getBoundingClientRect().left>_a}if(!(pos=_a)&&(pos=browser.chrome))a:if(_a=node,pos=x,0!=content)pos=!1;else{for(precise=
_a;;){docTop=precise.parentNode;if(!docTop||1!=docTop.nodeType||docTop.firstChild!=precise){pos=!1;break a}if(docTop.classList.contains("cm-line"))break;precise=docTop}_a=1==_a.nodeType?_a.getBoundingClientRect():textRange(_a,0,Math.max(_a.nodeValue.length,1)).getBoundingClientRect();pos=5<pos-_a.left}pos&&(node=void 0)}if(!node||!view.docView.dom.contains(node)){node=LineView.find(view.docView,bias);if(!node)return yOffset>block.top+block.height/2?block.to:block.from;({node,offset:content}=domPosAtCoords(node.dom,
x,y))}return view.docView.posFromDOM(node,content)}function posAtCoordsImprecise(view,contentRect,block,x,y){contentRect=Math.round((x-contentRect.left)*view.defaultCharacterWidth);view.lineWrapping&&block.height>1.5*view.defaultLineHeight&&(contentRect+=Math.floor((y-block.top)/view.defaultLineHeight)*view.viewState.heightOracle.lineLength);y=view.state.sliceDoc(block.from,block.to);return block.from+state$jscomp$0.findColumn(y,contentRect,view.state.tabSize)}function moveByChar(view,start,forward,
by){let line=view.state.doc.lineAt(start.head),spans=view.bidiSpans(line),direction=view.textDirectionAt(line.from);for(let cur=start,check=null;;){start=moveVisually(line,spans,direction,cur,forward);let char=movedOver;if(!start){if(line.number==(forward?view.state.doc.lines:1))return cur;char="\n";line=view.state.doc.line(line.number+(forward?1:-1));spans=view.bidiSpans(line);start=state$jscomp$0.EditorSelection.cursor(forward?line.from:line.to)}if(!check){if(!by)return start;check=by(char)}else if(!check(char))return cur;
cur=start}}function byGroup(view,pos,start){let categorize=view.state.charCategorizer(pos),cat=categorize(start);return next=>{next=categorize(next);cat==state$jscomp$0.CharCategory.Space&&(cat=next);return cat==next}}function skipAtoms(view,oldPos,pos){let atoms=view.state.facet(atomicRanges).map(f=>f(view));for(;;){let moved=!1;for(let set of atoms)set.between(pos.from-1,pos.from+1,(from,to,value)=>{pos.from>from&&pos.from<to&&(pos=oldPos.head>pos.from?state$jscomp$0.EditorSelection.cursor(from,
1):state$jscomp$0.EditorSelection.cursor(to,-1),moved=!0)});if(!moved)return pos}}function isInPrimarySelection(view,event){var {main}=view.state.selection;if(main.empty)return!1;view=getSelection(view.root);if(!view||0==view.rangeCount)return!0;view=view.getRangeAt(0).getClientRects();for(main=0;main<view.length;main++){let rect=view[main];if(rect.left<=event.clientX&&rect.right>=event.clientX&&rect.top<=event.clientY&&rect.bottom>=event.clientY)return!0}return!1}function eventBelongsToEditor(view,
event){if(!event.bubbles)return!0;if(event.defaultPrevented)return!1;for(let node=event.target,cView;node!=view.contentDOM;node=node.parentNode)if(!node||11==node.nodeType||(cView=ContentView.get(node))&&cView.ignoreEvent(event))return!1;return!0}function capturePaste(view){let parent=view.dom.parentNode;if(parent){var target=parent.appendChild(document.createElement("textarea"));target.style.cssText="position: fixed; left: -10000px; top: 10px";target.focus();setTimeout(()=>{view.focus();target.remove();
doPaste(view,target.value)},50)}}function doPaste(view,input){let {state:state$1}=view,changes,i=1,text=state$1.toText(input),byLine=text.lines==state$1.selection.ranges.length;if(null!=lastLinewiseCopy&&state$1.selection.ranges.every(r=>r.empty)&&lastLinewiseCopy==text.toString()){let lastLine=-1;changes=state$1.changeByRange(range=>{let line=state$1.doc.lineAt(range.from);if(line.from==lastLine)return{range};lastLine=line.from;let insert=state$1.toText((byLine?text.line(i++).text:input)+state$1.lineBreak);
return{changes:{from:line.from,insert},range:state$jscomp$0.EditorSelection.cursor(range.from+insert.length)}})}else changes=byLine?state$1.changeByRange(range=>{let line=text.line(i++);return{changes:{from:range.from,to:range.to,insert:line.text},range:state$jscomp$0.EditorSelection.cursor(range.from+line.length)}}):state$1.replaceSelection(text);view.dispatch(changes,{userEvent:"input.paste",scrollIntoView:!0})}function rangeForClick(view,pos,bias,type){if(1==type)return state$jscomp$0.EditorSelection.cursor(pos,
bias);if(2==type)return groupAt(view.state,pos,bias);bias=LineView.find(view.docView,pos);pos=view.state.doc.lineAt(bias?bias.posAtEnd:pos);type=bias?bias.posAtStart:pos.from;bias=bias?bias.posAtEnd:pos.to;bias<view.state.doc.length&&bias==pos.to&&bias++;return state$jscomp$0.EditorSelection.range(type,bias)}function queryPos(view,event){let pos=view.posAtCoords({x:event.clientX,y:event.clientY},!1);{var JSCompiler_inline_result=event.clientX;event=event.clientY;let line=LineView.find(view.docView,
pos);if(line){var off=pos-line.posAtStart;if(0==off)JSCompiler_inline_result=1;else if(off==line.length)JSCompiler_inline_result=-1;else{view=line.coordsAt(off,-1);var JSCompiler_temp;if(JSCompiler_temp=view)JSCompiler_temp=event>=view.top&&event<=view.bottom&&JSCompiler_inline_result>=view.left&&JSCompiler_inline_result<=view.right;if(JSCompiler_temp)JSCompiler_inline_result=-1;else{if(JSCompiler_temp=off=line.coordsAt(off,1))JSCompiler_temp=event>=off.top&&event<=off.bottom&&JSCompiler_inline_result>=
off.left&&JSCompiler_inline_result<=off.right;JSCompiler_inline_result=JSCompiler_temp?1:view&&event>=view.top&&event<=view.bottom?-1:1}}}else JSCompiler_inline_result=1}return{pos,bias:JSCompiler_inline_result}}function getClickType(event){if(!BadMouseDetail)return event.detail;let last=lastMouseDown,lastTime=lastMouseDownTime;lastMouseDown=event;lastMouseDownTime=Date.now();return lastMouseDownCount=!last||lastTime>Date.now()-400&&2>Math.abs(last.clientX-event.clientX)&&2>Math.abs(last.clientY-
event.clientY)?(lastMouseDownCount+1)%3:1}function basicMouseSelection(view,event$jscomp$0){let start=queryPos(view,event$jscomp$0),type=getClickType(event$jscomp$0),startSel=view.state.selection,last=start,lastEvent=event$jscomp$0;return{update(update){update.docChanged&&(start.pos=update.changes.mapPos(start.pos),startSel=startSel.map(update.changes),lastEvent=null)},get(event,extend,multiple){if(lastEvent&&event.clientX==lastEvent.clientX&&event.clientY==lastEvent.clientY)var cur=last;else cur=
last=queryPos(view,event),lastEvent=event;let range=rangeForClick(view,cur.pos,cur.bias,type);start.pos==cur.pos||extend||(cur=rangeForClick(view,start.pos,start.bias,type),event=Math.min(cur.from,range.from),cur=Math.max(cur.to,range.to),range=event<range.from?state$jscomp$0.EditorSelection.range(event,cur):state$jscomp$0.EditorSelection.range(cur,event));return extend?startSel.replaceRange(startSel.main.extend(range.from,range.to)):multiple&&1<startSel.ranges.length&&startSel.ranges.some(r=>r.eq(range))?
removeRange(startSel,range):multiple?startSel.addRange(range):state$jscomp$0.EditorSelection.create([range])}}}function removeRange(sel,range){for(let i=0;;i++)if(sel.ranges[i].eq(range))return state$jscomp$0.EditorSelection.create(sel.ranges.slice(0,i).concat(sel.ranges.slice(i+1)),sel.mainIndex==i?0:sel.mainIndex-(sel.mainIndex>i?1:0))}function dropText(view,event,text,direct){if(text){var dropPos=view.posAtCoords({x:event.clientX,y:event.clientY},!1);event.preventDefault();({mouseSelection:event}=
view.inputState);direct=direct&&event&&event.dragging&&event.dragMove?{from:event.dragging.from,to:event.dragging.to}:null;text={from:dropPos,insert:text};text=view.state.changes(direct?[direct,text]:text);view.focus();view.dispatch({changes:text,selection:{anchor:text.mapPos(dropPos,-1),head:text.mapPos(dropPos,1)},userEvent:direct?"move.drop":"input.drop"})}}function captureCopy(view,text){let parent=view.dom.parentNode;if(parent){var target=parent.appendChild(document.createElement("textarea"));
target.style.cssText="position: fixed; left: -10000px; top: 10px";target.value=text;target.focus();target.selectionEnd=text.length;target.selectionStart=0;setTimeout(()=>{target.remove();view.focus()},50)}}function updateForFocusChange(view){setTimeout(()=>{view.hasFocus!=view.inputState.notifiedFocused&&view.update([])},10)}function mergeGaps(nodes,around){let before,after;null==nodes[around]&&(before=nodes[around-1])instanceof HeightMapGap&&(after=nodes[around+1])instanceof HeightMapGap&&nodes.splice(around-
1,3,new HeightMapGap(before.length+1+after.length))}function heightRelevantDecoChanges(a,b,diff){let comp=new DecorationComparator;state$jscomp$0.RangeSet.compare(a,b,diff,comp,0);return comp.changes}function visiblePixelRange(dom,paddingTop){let rect=dom.getBoundingClientRect(),doc=dom.ownerDocument;var win=doc.defaultView;let left=Math.max(0,rect.left),right=Math.min(win.innerWidth,rect.right),top=Math.max(0,rect.top);win=Math.min(win.innerHeight,rect.bottom);for(let parent=dom.parentNode;parent&&
parent!=doc.body;)if(1==parent.nodeType){let elt=parent,style=window.getComputedStyle(elt);if((elt.scrollHeight>elt.clientHeight||elt.scrollWidth>elt.clientWidth)&&"visible"!=style.overflow){let parentRect=elt.getBoundingClientRect();left=Math.max(left,parentRect.left);right=Math.min(right,parentRect.right);top=Math.max(top,parentRect.top);win=parent==dom.parentNode?parentRect.bottom:Math.min(win,parentRect.bottom)}parent="absolute"==style.position||"fixed"==style.position?elt.offsetParent:elt.parentNode}else if(11==
parent.nodeType)parent=parent.host;else break;return{left:left-rect.left,right:Math.max(left,right)-rect.left,top:top-(rect.top+paddingTop),bottom:Math.max(top,win)-(rect.top+paddingTop)}}function fullPixelRange(dom,paddingTop){dom=dom.getBoundingClientRect();return{left:0,right:dom.right-dom.left,top:paddingTop,bottom:dom.bottom-(dom.top+paddingTop)}}function lineStructure(from$jscomp$0,to$jscomp$0,stateDeco){let ranges=[],pos=from$jscomp$0,total=0;state$jscomp$0.RangeSet.spans(stateDeco,from$jscomp$0,
to$jscomp$0,{span(){},point(from,to){from>pos&&(ranges.push({from:pos,to:from}),total+=from-pos);pos=to}},20);pos<to$jscomp$0&&(ranges.push({from:pos,to:to$jscomp$0}),total+=to$jscomp$0-pos);return{total,ranges}}function findPosition({total,ranges},ratio){if(0>=ratio)return ranges[0].from;if(1<=ratio)return ranges[ranges.length-1].to;total=Math.floor(total*ratio);for(ratio=0;;ratio++){let {from,to}=ranges[ratio],size=to-from;if(total<=size)return from+total;total-=size}}function findFraction(structure,
pos){let counted=0;for(let {from,to}of structure.ranges){if(pos<=to){counted+=pos-from;break}counted+=to-from}return counted/structure.total}function cutRange(ranges,from,to){for(let i=0;i<ranges.length;i++){let r=ranges[i];if(r.from<to&&r.to>from){let pieces=[];r.from<from&&pieces.push({from:r.from,to:from});r.to>to&&pieces.push({from:to,to:r.to});ranges.splice(i,1,...pieces);i+=pieces.length-1}}}function find(array,f){for(let val of array)if(f(val))return val}function scaleBlock(block,scaler){if(1==
scaler.scale)return block;let bTop=scaler.toDOM(block.top),bBottom=scaler.toDOM(block.bottom);return new BlockInfo(block.from,block.length,bTop,bBottom-bTop,Array.isArray(block.type)?block.type.map(b=>scaleBlock(b,scaler)):block.type)}function buildTheme(main,spec,scopes){return new styleMod.StyleModule(spec,{finish(sel){return/&/.test(sel)?sel.replace(/&\w*/,m=>{if("\x26"==m)return main;if(!scopes||!scopes[m])throw new RangeError(`Unsupported selector: ${m}`);return scopes[m]}):main+" "+sel}})}function findChild(cView,
dom,dir){for(;dom;){var curView=ContentView.get(dom);if(curView&&curView.parent==cView)return curView;curView=dom.parentNode;dom=curView!=cView.dom?curView:0<dir?dom.nextSibling:dom.previousSibling}return null}function safariSelectionRangeHack(view){function read(event){event.preventDefault();event.stopImmediatePropagation();found=event.getTargetRanges()[0]}let found=null;view.contentDOM.addEventListener("beforeinput",read,!0);view.dom.ownerDocument.execCommand("indent");view.contentDOM.removeEventListener("beforeinput",
read,!0);if(!found)return null;let anchorNode=found.startContainer,anchorOffset=found.startOffset,focusNode=found.endContainer,focusOffset=found.endOffset;view=view.docView.domAtPos(view.state.selection.main.anchor);isEquivalentPosition(view.node,view.offset,focusNode,focusOffset)&&([anchorNode,anchorOffset,focusNode,focusOffset]=[focusNode,focusOffset,anchorNode,anchorOffset]);return{anchorNode,anchorOffset,focusNode,focusOffset}}function applyDOMChange(view,start,end,typeOver){let change;let sel=
view.state.selection.main;if(-1<start){end=view.docView.domBoundsAround(start,end,0);if(!end||view.state.readOnly)return!1;let {from,to}=end;var newSel=view.docView.impreciseHead||view.docView.impreciseAnchor?[]:selectionPoints(view);start=new DOMReader(newSel,view.state);start.readRange(end.startDOM,end.endDOM);end=sel.from;let preferredSide=null;if(8===view.inputState.lastKeyCode&&view.inputState.lastKeyTime>Date.now()-100||browser.android&&start.text.length<to-from)end=sel.to,preferredSide="end";
if(end=findDiff(view.state.doc.sliceString(from,to,"￿"),start.text,end-from,preferredSide))browser.chrome&&13==view.inputState.lastKeyCode&&end.toB==end.from+2&&"￿￿"==start.text.slice(end.from,end.toB)&&end.toB--,change={from:from+end.from,to:from+end.toA,insert:state$jscomp$0.Text.of(start.text.slice(end.from,end.toB).split("￿"))};newSel=selectionFromPoints(newSel,from)}else if(view.hasFocus||!view.state.facet(editable)){end=view.observer.selectionRange;let {impreciseHead:iHead,impreciseAnchor:iAnchor}=
view.docView;start=iHead&&iHead.node==end.focusNode&&iHead.offset==end.focusOffset||!contains(view.contentDOM,end.focusNode)?view.state.selection.main.head:view.docView.posFromDOM(end.focusNode,end.focusOffset);end=iAnchor&&iAnchor.node==end.anchorNode&&iAnchor.offset==end.anchorOffset||!contains(view.contentDOM,end.anchorNode)?view.state.selection.main.anchor:view.docView.posFromDOM(end.anchorNode,end.anchorOffset);if(start!=sel.head||end!=sel.anchor)newSel=state$jscomp$0.EditorSelection.single(end,
start)}if(!change&&!newSel)return!1;!change&&typeOver&&!sel.empty&&newSel&&newSel.main.empty?change={from:sel.from,to:sel.to,insert:view.state.doc.slice(sel.from,sel.to)}:change&&change.from>=sel.from&&change.to<=sel.to&&(change.from!=sel.from||change.to!=sel.to)&&4>=sel.to-sel.from-(change.to-change.from)?change={from:sel.from,to:sel.to,insert:view.state.doc.slice(sel.from,change.from).append(change.insert).append(view.state.doc.slice(change.to,sel.to))}:(browser.mac||browser.android)&&change&&change.from==
change.to&&change.from==sel.head-1&&"."==change.insert.toString()&&(change={from:sel.from,to:sel.to,insert:state$jscomp$0.Text.of([" "])});if(change){let startState=view.state;if(browser.ios&&view.inputState.flushIOSKey(view)||browser.android&&(change.from==sel.from&&change.to==sel.to&&1==change.insert.length&&2==change.insert.lines&&dispatchKey(view.contentDOM,"Enter",13)||change.from==sel.from-1&&change.to==sel.to&&0==change.insert.length&&dispatchKey(view.contentDOM,"Backspace",8)||change.from==
sel.from&&change.to==sel.to+1&&0==change.insert.length&&dispatchKey(view.contentDOM,"Delete",46)))return!0;let text=change.insert.toString();if(view.state.facet(inputHandler).some(h=>h(view,change.from,change.to,text)))return!0;0<=view.inputState.composing&&view.inputState.composing++;if(change.from>=sel.from&&change.to<=sel.to&&change.to-change.from>=(sel.to-sel.from)/3&&(!newSel||newSel.main.empty&&newSel.main.from==change.from+change.insert.length)&&0>view.inputState.composing)typeOver=sel.from<
change.from?startState.sliceDoc(sel.from,change.from):"",newSel=sel.to>change.to?startState.sliceDoc(change.to,sel.to):"",typeOver=startState.replaceSelection(view.state.toText(typeOver+change.insert.sliceString(0,void 0,view.state.lineBreak)+newSel));else{let changes=startState.changes(change),mainSel=newSel&&!startState.selection.main.eq(newSel.main)&&newSel.main.to<=changes.newLength?newSel.main:void 0;if(1<startState.selection.ranges.length&&0<=view.inputState.composing&&change.to<=sel.to&&change.to>=
sel.to-10){let replaced=view.state.sliceDoc(change.from,change.to),compositionRange=compositionSurroundingNode(view)||view.state.doc.lineAt(sel.head),offset=sel.to-change.to,size=sel.to-sel.from;typeOver=startState.changeByRange(range=>{if(range.from==sel.from&&range.to==sel.to)return{changes,range:mainSel||range.map(changes)};var to=range.to-offset,from=to-replaced.length;if(range.to-range.from!=size||view.state.sliceDoc(from,to)!=replaced||compositionRange&&range.to>=compositionRange.from&&range.from<=
compositionRange.to)return{range};to=startState.changes({from,to,insert:change.insert});from=range.to-sel.to;return{changes:to,range:mainSel?state$jscomp$0.EditorSelection.range(Math.max(0,mainSel.anchor+from),Math.max(0,mainSel.head+from)):range.map(to)}})}else typeOver={changes,selection:mainSel&&startState.selection.replaceRange(mainSel)}}newSel="input.type";view.composing&&(newSel+=".compose",view.inputState.compositionFirstChange&&(newSel+=".start",view.inputState.compositionFirstChange=!1));
view.dispatch(typeOver,{scrollIntoView:!0,userEvent:newSel});return!0}return newSel&&!newSel.main.eq(sel)?(typeOver=!1,start="select",view.inputState.lastSelectionTime>Date.now()-50&&("select"==view.inputState.lastSelectionOrigin&&(typeOver=!0),start=view.inputState.lastSelectionOrigin),view.dispatch({selection:newSel,scrollIntoView:typeOver,userEvent:start}),!0):!1}function findDiff(a,b,preferredPos,preferredSide){var minLen=Math.min(a.length,b.length);let from=0;for(;from<minLen&&a.charCodeAt(from)==
b.charCodeAt(from);)from++;if(from==minLen&&a.length==b.length)return null;minLen=a.length;let toB=b.length;for(;0<minLen&&0<toB&&a.charCodeAt(minLen-1)==b.charCodeAt(toB-1);)minLen--,toB--;"end"==preferredSide&&(preferredPos-=minLen+Math.max(0,from-Math.min(minLen,toB))-from);minLen<from&&a.length<b.length?(from-=preferredPos<=from&&preferredPos>=minLen?from-preferredPos:0,toB=from+(toB-minLen),minLen=from):toB<from&&(from-=preferredPos<=from&&preferredPos>=toB?from-preferredPos:0,minLen=from+(minLen-
toB),toB=from);return{from,toA:minLen,toB}}function selectionPoints(view){let result=[];if(view.root.activeElement!=view.contentDOM)return result;let {anchorNode,anchorOffset,focusNode,focusOffset}=view.observer.selectionRange;anchorNode&&(result.push(new DOMPoint(anchorNode,anchorOffset)),focusNode==anchorNode&&focusOffset==anchorOffset||result.push(new DOMPoint(focusNode,focusOffset)));return result}function selectionFromPoints(points,base){if(0==points.length)return null;let anchor=points[0].pos;
points=2==points.length?points[1].pos:anchor;return-1<anchor&&-1<points?state$jscomp$0.EditorSelection.single(anchor+base,points+base):null}function attrsFromFacet(view,facet,base){for(let sources=view.state.facet(facet),i=sources.length-1;0<=i;i--)facet=sources[i],(facet="function"==typeof facet?facet(view):facet)&&combineAttrs(facet,base);return base}function modifiers(name,event,shift){event.altKey&&(name="Alt-"+name);event.ctrlKey&&(name="Ctrl-"+name);event.metaKey&&(name="Meta-"+name);!1!==shift&&
event.shiftKey&&(name="Shift-"+name);return name}function getKeymap(state){state=state.facet(keymap);let map=Keymaps.get(state);map||Keymaps.set(state,map=buildKeymap(state.reduce((a,b)=>a.concat(b),[])));return map}function buildKeymap(bindings,platform=currentPlatform){let bound=Object.create(null),isPrefix=Object.create(null),checkPrefix=(name,is)=>{let current=isPrefix[name];if(null==current)isPrefix[name]=is;else if(current!=is)throw Error("Key binding "+name+" is used both as a regular binding and as a multi-stroke prefix");
},add=(scope,key,command,preventDefault)=>{var scopeObj=bound[scope]||(bound[scope]=Object.create(null));key=key.split(/ (?!$)/).map(k=>{k=k.split(/-(?!$)/);let result=k[k.length-1];"Space"==result&&(result=" ");let alt,ctrl,shift,meta;for(let i=0;i<k.length-1;++i){const mod=k[i];if(/^(cmd|meta|m)$/i.test(mod))meta=!0;else if(/^a(lt)?$/i.test(mod))alt=!0;else if(/^(c|ctrl|control)$/i.test(mod))ctrl=!0;else if(/^s(hift)?$/i.test(mod))shift=!0;else if(/^mod$/i.test(mod))"mac"==platform?meta=!0:ctrl=
!0;else throw Error("Unrecognized modifier name: "+mod);}alt&&(result="Alt-"+result);ctrl&&(result="Ctrl-"+result);meta&&(result="Meta-"+result);shift&&(result="Shift-"+result);return result});for(let i=1;i<key.length;i++){let prefix=key.slice(0,i).join(" ");checkPrefix(prefix,!0);scopeObj[prefix]||(scopeObj[prefix]={preventDefault:!0,commands:[view=>{let ourObj=storedPrefix={view,prefix,scope};setTimeout(()=>{storedPrefix==ourObj&&(storedPrefix=null)},4E3);return!0}]})}key=key.join(" ");checkPrefix(key,
!1);scopeObj=scopeObj[key]||(scopeObj[key]={preventDefault:!1,commands:[]});scopeObj.commands.push(command);preventDefault&&(scopeObj.preventDefault=!0)};for(let b of bindings)if(bindings=b[platform]||b.key)for(let scope of b.scope?b.scope.split(" "):["editor"])add(scope,bindings,b.run,b.preventDefault),b.shift&&add(scope,"Shift-"+bindings,b.shift,b.preventDefault);return bound}function runHandlers(map,event,view,scope){let name=w3cKeyname.keyName(event),charCode=state$jscomp$0.codePointAt(name,0),
isChar=state$jscomp$0.codePointSize(charCode)==name.length&&" "!=name,prefix="",fallthrough=!1;storedPrefix&&storedPrefix.view==view&&storedPrefix.scope==scope&&(prefix=storedPrefix.prefix+" ",fallthrough=0>modifierCodes.indexOf(event.keyCode))&&(storedPrefix=null);let runFor=binding=>{if(binding){for(let cmd of binding.commands)if(cmd(view))return!0;binding.preventDefault&&(fallthrough=!0)}return!1};map=map[scope];let baseName,shiftName;if(map){if(runFor(map[prefix+modifiers(name,event,!isChar)]))return!0;
if(isChar&&(event.shiftKey||event.altKey||event.metaKey||127<charCode)&&(baseName=w3cKeyname.base[event.keyCode])&&baseName!=name){if(runFor(map[prefix+modifiers(baseName,event,!0)])||event.shiftKey&&(shiftName=w3cKeyname.shift[event.keyCode])!=name&&shiftName!=baseName&&runFor(map[prefix+modifiers(shiftName,event,!1)]))return!0}else if(isChar&&event.shiftKey&&runFor(map[prefix+modifiers(name,event,!0)]))return!0}return fallthrough}function getBase(view){let rect=view.scrollDOM.getBoundingClientRect();
return{left:(view.textDirection==exports.Direction.LTR?rect.left:rect.right-view.scrollDOM.clientWidth)-view.scrollDOM.scrollLeft,top:rect.top-view.scrollDOM.scrollTop}}function wrappedLine(view,pos,inside){pos=state$jscomp$0.EditorSelection.cursor(pos);return{from:Math.max(inside.from,view.moveToLineBoundary(pos,!1,!0).from),to:Math.min(inside.to,view.moveToLineBoundary(pos,!0,!0).from),type:exports.BlockType.Text}}function blockAt(view,pos){view=view.lineBlockAt(pos);if(Array.isArray(view.type))for(let l of view.type)if(l.to>
pos||l.to==pos&&(l.to==view.to||l.type==exports.BlockType.Text))return l;return view}function measureRange(view,range){function piece(left,top,right,bottom){return new Piece(left-base.left,top-base.top-.01,right-left,bottom-top+.01,"cm-selectionBackground")}function pieces$jscomp$0({top,bottom,horizontal}){let pieces=[];for(let i=0;i<horizontal.length;i+=2)pieces.push(piece(horizontal[i],top,horizontal[i+1],bottom));return pieces}function drawForLine(from$jscomp$0,to$jscomp$0,line){function addSpan(from,
fromOpen,to,toOpen,dir){from=view.coordsAtPos(from,from==line.to?-2:2);to=view.coordsAtPos(to,to==line.from?2:-2);top=Math.min(from.top,to.top,top);bottom=Math.max(from.bottom,to.bottom,bottom);dir==exports.Direction.LTR?horizontal.push(ltr&&fromOpen?leftSide:from.left,ltr&&toOpen?rightSide:to.right):horizontal.push(!ltr&&toOpen?leftSide:to.left,!ltr&&fromOpen?rightSide:from.right)}let top=1E9,bottom=-1E9,horizontal=[],start=null!==from$jscomp$0&&void 0!==from$jscomp$0?from$jscomp$0:line.from,end=
null!==to$jscomp$0&&void 0!==to$jscomp$0?to$jscomp$0:line.to;for(let r of view.visibleRanges)if(r.to>start&&r.from<end)for(let pos=Math.max(r.from,start),endPos=Math.min(r.to,end);;){let docLine=view.state.doc.lineAt(pos);for(let span of view.bidiSpans(docLine)){let spanFrom=span.from+docLine.from,spanTo=span.to+docLine.from;if(spanFrom>=endPos)break;spanTo>pos&&addSpan(Math.max(spanFrom,pos),null==from$jscomp$0&&spanFrom<=start,Math.min(spanTo,endPos),null==to$jscomp$0&&spanTo>=end,span.dir)}pos=
docLine.to+1;if(pos>=endPos)break}0==horizontal.length&&addSpan(start,null==from$jscomp$0,end,null==to$jscomp$0,view.textDirection);return{top,bottom,horizontal}}function drawForWidget(block,top){block=contentRect.top+(top?block.top:block.bottom);return{top:block,bottom:block,horizontal:[]}}if(range.to<=view.viewport.from||range.from>=view.viewport.to)return[];var from$jscomp$1=Math.max(range.from,view.viewport.from),to$jscomp$1=Math.min(range.to,view.viewport.to);let ltr=view.textDirection==exports.Direction.LTR;
var content=view.contentDOM;let contentRect=content.getBoundingClientRect(),base=getBase(view);content=window.getComputedStyle(content.firstChild);let leftSide=contentRect.left+parseInt(content.paddingLeft)+Math.min(0,parseInt(content.textIndent)),rightSide=contentRect.right-parseInt(content.paddingRight);content=blockAt(view,from$jscomp$1);let endBlock=blockAt(view,to$jscomp$1),visualStart=content.type==exports.BlockType.Text?content:null,visualEnd=endBlock.type==exports.BlockType.Text?endBlock:
null;view.lineWrapping&&(visualStart&&(visualStart=wrappedLine(view,from$jscomp$1,visualStart)),visualEnd&&(visualEnd=wrappedLine(view,to$jscomp$1,visualEnd)));if(visualStart&&visualEnd&&visualStart.from==visualEnd.from)return pieces$jscomp$0(drawForLine(range.from,range.to,visualStart));from$jscomp$1=visualStart?drawForLine(range.from,null,visualStart):drawForWidget(content,!1);range=visualEnd?drawForLine(null,range.to,visualEnd):drawForWidget(endBlock,!0);to$jscomp$1=[];(visualStart||content).to<
(visualEnd||endBlock).from-1?to$jscomp$1.push(piece(leftSide,from$jscomp$1.bottom,rightSide,range.top)):from$jscomp$1.bottom<range.top&&view.elementAtHeight((from$jscomp$1.bottom+range.top)/2).type==exports.BlockType.Text&&(from$jscomp$1.bottom=range.top=(from$jscomp$1.bottom+range.top)/2);return pieces$jscomp$0(from$jscomp$1).concat(to$jscomp$1).concat(pieces$jscomp$0(range))}function measureCursor(view,cursor,primary){cursor=view.coordsAtPos(cursor.head,cursor.assoc||1);if(!cursor)return null;view=
getBase(view);return new Piece(cursor.left-view.left,cursor.top-view.top,-1,cursor.bottom-cursor.top,primary?"cm-cursor cm-cursor-primary":"cm-cursor cm-cursor-secondary")}function iterMatches(doc,re,from,to,f){re.lastIndex=0;for(let cursor=doc.iterRange(from,to),pos=from,m;!cursor.next().done;pos+=cursor.value.length)if(!cursor.lineBreak)for(;m=re.exec(cursor.value);)f(pos+m.index,m)}function matchRanges(view,maxLength){let visible=view.visibleRanges;if(1==visible.length&&visible[0].from==view.viewport.from&&
visible[0].to==view.viewport.to)return visible;let result=[];for(let {from,to}of visible)from=Math.max(view.state.doc.lineAt(from).from,from-maxLength),to=Math.min(view.state.doc.lineAt(to).to,to+maxLength),result.length&&result[result.length-1].to>=from?result[result.length-1].to=to:result.push({from,to});return result}function specialCharPlugin(){return _plugin||(_plugin=ViewPlugin.fromClass(class{constructor(view){this.view=view;this.decorations=Decoration.none;this.decorationCache=Object.create(null);
this.decorator=this.makeDecorator(view.state.facet(specialCharConfig));this.decorations=this.decorator.createDeco(view)}makeDecorator(conf){return new MatchDecorator({regexp:conf.specialChars,decoration:(m,view,pos)=>{var {doc}=view.state;m=state$jscomp$0.codePointAt(m[0],0);return 9==m?(doc=doc.lineAt(pos),view=view.state.tabSize,pos=state$jscomp$0.countColumn(doc.text,view,pos-doc.from),Decoration.replace({widget:new TabWidget((view-pos%view)*this.view.defaultCharacterWidth)})):this.decorationCache[m]||
(this.decorationCache[m]=Decoration.replace({widget:new SpecialCharWidget(conf,m)}))},boundary:conf.replaceTabs?void 0:/[^]/})}update(update){let conf=update.state.facet(specialCharConfig);update.startState.facet(specialCharConfig)!=conf?(this.decorator=this.makeDecorator(conf),this.decorations=this.decorator.createDeco(update.view)):this.decorations=this.decorator.updateDeco(update,this.decorations)}},{decorations:v=>v.decorations}))}function getPos(view,event){var offset=view.posAtCoords({x:event.clientX,
y:event.clientY},!1);let line=view.state.doc.lineAt(offset),off=offset-line.from;2E3<off?view=-1:off==line.length?(event=event.clientX,view=(offset=view.coordsAtPos(view.viewport.from))?Math.round(Math.abs((offset.left-event)/view.defaultCharacterWidth)):-1):view=state$jscomp$0.countColumn(line.text,view.state.tabSize,offset-line.from);return{line:line.number,col:view,off}}function rectangleSelectionStyle(view,event$jscomp$0){let start$jscomp$0=getPos(view,event$jscomp$0),startSel=view.state.selection;
return start$jscomp$0?{update(update){if(update.docChanged){var newStart=update.changes.mapPos(update.startState.doc.line(start$jscomp$0.line).from);newStart=update.state.doc.lineAt(newStart);start$jscomp$0={line:newStart.number,col:start$jscomp$0.col,off:Math.min(start$jscomp$0.off,newStart.length)};startSel=startSel.map(update.changes)}},get(event,_extend,multiple){var cur=getPos(view,event);if(!cur)return startSel;event=view.state;var a=start$jscomp$0,startLine=Math.min(a.line,cur.line);_extend=
Math.max(a.line,cur.line);let ranges=[];if(2E3<a.off||2E3<cur.off||0>a.col||0>cur.col){var startOff=Math.min(a.off,cur.off);for(cur=Math.max(a.off,cur.off);startLine<=_extend;startLine++)a=event.doc.line(startLine),a.length<=cur&&ranges.push(state$jscomp$0.EditorSelection.range(a.from+startOff,a.to+cur))}else for(startOff=Math.min(a.col,cur.col),cur=Math.max(a.col,cur.col);startLine<=_extend;startLine++){a=event.doc.line(startLine);let start=state$jscomp$0.findColumn(a.text,startOff,event.tabSize,
!0);if(-1<start){let end=state$jscomp$0.findColumn(a.text,cur,event.tabSize);ranges.push(state$jscomp$0.EditorSelection.range(a.from+start,a.from+end))}}return ranges.length?multiple?state$jscomp$0.EditorSelection.create(ranges.concat(startSel.ranges)):state$jscomp$0.EditorSelection.create(ranges):startSel}}:null}function windowSpace(view){({win:view}=view);return{top:0,left:0,bottom:view.innerHeight,right:view.innerWidth}}function rm(node){let next=node.nextSibling;node.remove();return next}function gutters(config){let result=
[gutterView];config&&!1===config.fixed&&result.push(unfixGutters.of(!0));return result}function asArray(val){return Array.isArray(val)?val:[val]}function advanceCursor(cursor,collect,pos){for(;cursor.value&&cursor.from<=pos;)cursor.from==pos&&collect.push(cursor.value),cursor.next()}function formatNumber(view,number){return view.state.facet(lineNumberConfig).formatNumber(number,view.state)}function maxLineNumber(lines){let last=9;for(;last<lines;)last=10*last+9;return last}Object.defineProperty(exports,
"__esModule",{value:!0});var state$jscomp$0=require("module$node_modules$$codemirror$state$dist$index_cjs"),styleMod=require("module$node_modules$style_mod$dist$style_mod_cjs"),w3cKeyname=require("module$node_modules$w3c_keyname$index_cjs");const Rect0={left:0,right:0,top:0,bottom:0};class DOMSelectionState{constructor(){this.anchorNode=null;this.anchorOffset=0;this.focusNode=null;this.focusOffset=0}eq(domSel){return this.anchorNode==domSel.anchorNode&&this.anchorOffset==domSel.anchorOffset&&this.focusNode==
domSel.focusNode&&this.focusOffset==domSel.focusOffset}setRange(range){this.set(range.anchorNode,range.anchorOffset,range.focusNode,range.focusOffset)}set(anchorNode,anchorOffset,focusNode,focusOffset){this.anchorNode=anchorNode;this.anchorOffset=anchorOffset;this.focusNode=focusNode;this.focusOffset=focusOffset}}let preventScrollSupported=null,scratchRange;class DOMPos{constructor(node,offset,precise=!0){this.node=node;this.offset=offset;this.precise=precise}static before(dom,precise){return new DOMPos(dom.parentNode,
domIndex(dom),precise)}static after(dom,precise){return new DOMPos(dom.parentNode,domIndex(dom)+1,precise)}}const noChildren=[];class ContentView{constructor(){this.dom=this.parent=null;this.dirty=2}get editorView(){if(!this.parent)throw Error("Accessing view in orphan content view");return this.parent.editorView}get overrideDOMText(){return null}get posAtStart(){return this.parent?this.parent.posBefore(this):0}get posAtEnd(){return this.posAtStart+this.length}posBefore(view){let pos=this.posAtStart;
for(let child of this.children){if(child==view)return pos;pos+=child.length+child.breakAfter}throw new RangeError("Invalid child in posBefore");}posAfter(view){return this.posBefore(view)+view.length}coordsAt(_pos,_side){return null}sync(track){if(this.dirty&2){var parent=this.dom;let prev=null,next;for(let child of this.children){if(child.dirty){if(!child.dom&&(next=prev?prev.nextSibling:parent.firstChild)){let contentView=ContentView.get(next);contentView&&(contentView.parent||contentView.constructor!=
child.constructor)||child.reuseDOM(next)}child.sync(track);child.dirty=0}next=prev?prev.nextSibling:parent.firstChild;track&&!track.written&&track.node==parent&&next!=child.dom&&(track.written=!0);if(child.dom.parentNode==parent)for(;next&&next!=child.dom;)next=rm$1(next);else parent.insertBefore(child.dom,next);prev=child.dom}(next=prev?prev.nextSibling:parent.firstChild)&&track&&track.node==parent&&(track.written=!0);for(;next;)next=rm$1(next)}else if(this.dirty&1)for(parent of this.children)parent.dirty&&
(parent.sync(track),parent.dirty=0)}reuseDOM(_dom){}localPosFromDOM(node,offset){if(node==this.dom)node=this.dom.childNodes[offset];else{for(offset=0==maxOffset(node)?0:0==offset?-1:1;;){let parent=node.parentNode;if(parent==this.dom)break;0==offset&&parent.firstChild!=parent.lastChild&&(offset=node==parent.firstChild?-1:1);node=parent}node=0>offset?node:node.nextSibling}if(node==this.dom.firstChild)return 0;for(;node&&!ContentView.get(node);)node=node.nextSibling;if(!node)return this.length;for(let i=
0,pos=0;;i++){offset=this.children[i];if(offset.dom==node)return pos;pos+=offset.length+offset.breakAfter}}domBoundsAround(from,to,offset=0){let fromI=-1,fromStart=-1,toI=-1,toEnd=-1;for(let i=0,pos=offset,prevEnd=offset;i<this.children.length;i++){let child=this.children[i],end=pos+child.length;if(pos<from&&end>to)return child.domBoundsAround(from,to,pos);end>=from&&-1==fromI&&(fromI=i,fromStart=pos);if(pos>to&&child.dom.parentNode==this.dom){toI=i;toEnd=prevEnd;break}prevEnd=end;pos=end+child.breakAfter}return{from:fromStart,
to:0>toEnd?offset+this.length:toEnd,startDOM:(fromI?this.children[fromI-1].dom.nextSibling:null)||this.dom.firstChild,endDOM:toI<this.children.length&&0<=toI?this.children[toI].dom:null}}markDirty(andParent=!1){this.dirty|=2;this.markParentsDirty(andParent)}markParentsDirty(childList){for(let parent=this.parent;parent;parent=parent.parent){childList&&(parent.dirty|=2);if(parent.dirty&1)break;parent.dirty|=1;childList=!1}}setParent(parent){this.parent!=parent&&(this.parent=parent,this.dirty&&this.markParentsDirty(!0))}setDOM(dom){this.dom&&
(this.dom.cmView=null);this.dom=dom;dom.cmView=this}get rootView(){for(let v=this;;){let parent=v.parent;if(!parent)return v;v=parent}}replaceChildren(from,to,children=noChildren){this.markDirty();for(let i=from;i<to;i++){let child=this.children[i];child.parent==this&&child.destroy()}this.children.splice(from,to-from,...children);for(from=0;from<children.length;from++)children[from].setParent(this)}ignoreMutation(_rec){return!1}ignoreEvent(_event){return!1}childCursor(pos=this.length){return new ChildCursor(this.children,
pos,this.children.length)}childPos(pos,bias=1){return this.childCursor().findPos(pos,bias)}toString(){let name=this.constructor.name.replace("View","");return name+(this.children.length?"("+this.children.join()+")":this.length?"["+("Text"==name?this.text:this.length)+"]":"")+(this.breakAfter?"#":"")}static get(node){return node.cmView}get isEditable(){return!0}merge(from,to,source,hasStart,openStart,openEnd){return!1}become(other){return!1}getSide(){return 0}destroy(){this.parent=null}}ContentView.prototype.breakAfter=
0;class ChildCursor{constructor(children,pos,i){this.children=children;this.pos=pos;this.i=i;this.off=0}findPos(pos,bias=1){for(;;){if(pos>this.pos||pos==this.pos&&(0<bias||0==this.i||this.children[this.i-1].breakAfter))return this.off=pos-this.pos,this;let next=this.children[--this.i];this.pos-=next.length+next.breakAfter}}}let nav="undefined"!=typeof navigator?navigator:{userAgent:"",vendor:"",platform:""},doc$jscomp$0="undefined"!=typeof document?document:{documentElement:{style:{}}};const ie_edge=
/Edge\/(\d+)/.exec(nav.userAgent),ie_upto10=/MSIE \d/.test(nav.userAgent),ie_11up=/Trident\/(?:[7-9]|\d{2,})\..*rv:(\d+)/.exec(nav.userAgent),ie=!!(ie_upto10||ie_11up||ie_edge),gecko=!ie&&/gecko\/(\d+)/i.test(nav.userAgent),chrome=!ie&&/Chrome\/(\d+)/.exec(nav.userAgent),webkit="webkitFontSmoothing"in doc$jscomp$0.documentElement.style,safari=!ie&&/Apple Computer/.test(nav.vendor),ios=safari&&(/Mobile\/\w+/.test(nav.userAgent)||2<nav.maxTouchPoints);var browser={mac:ios||/Mac/.test(nav.platform),
windows:/Win/.test(nav.platform),linux:/Linux|X11/.test(nav.platform),ie,ie_version:ie_upto10?doc$jscomp$0.documentMode||6:ie_11up?+ie_11up[1]:ie_edge?+ie_edge[1]:0,gecko,gecko_version:gecko?+(/Firefox\/(\d+)/.exec(nav.userAgent)||[0,0])[1]:0,chrome:!!chrome,chrome_version:chrome?+chrome[1]:0,ios,android:/Android\b/.test(nav.userAgent),webkit,safari,webkit_version:webkit?+(/\bAppleWebKit\/(\d+)/.exec(navigator.userAgent)||[0,0])[1]:0,tabSize:null!=doc$jscomp$0.documentElement.style.tabSize?"tab-size":
"-moz-tab-size"};class TextView extends ContentView{constructor(text){super();this.text=text}get length(){return this.text.length}createDOM(textDOM){this.setDOM(textDOM||document.createTextNode(this.text))}sync(track){this.dom||this.createDOM();this.dom.nodeValue!=this.text&&(track&&track.node==this.dom&&(track.written=!0),this.dom.nodeValue=this.text)}reuseDOM(dom){3==dom.nodeType&&this.createDOM(dom)}merge(from,to,source){if(source&&(!(source instanceof TextView)||256<this.length-(to-from)+source.length))return!1;
this.text=this.text.slice(0,from)+(source?source.text:"")+this.text.slice(to);this.markDirty();return!0}split(from){let result=new TextView(this.text.slice(from));this.text=this.text.slice(0,from);this.markDirty();return result}localPosFromDOM(node,offset){return node==this.dom?offset:offset?this.text.length:0}domAtPos(pos){return new DOMPos(this.dom,pos)}domBoundsAround(_from,_to,offset){return{from:offset,to:offset+this.length,startDOM:this.dom,endDOM:this.dom.nextSibling}}coordsAt(pos,side){return textCoords(this.dom,
pos,side)}}class MarkView extends ContentView{constructor(mark,children=[],length=0){super();this.mark=mark;this.children=children;this.length=length;for(let ch of children)ch.setParent(this)}setAttrs(dom){clearAttributes(dom);this.mark.class&&(dom.className=this.mark.class);if(this.mark.attrs)for(let name in this.mark.attrs)dom.setAttribute(name,this.mark.attrs[name]);return dom}reuseDOM(node){node.nodeName==this.mark.tagName.toUpperCase()&&(this.setDOM(node),this.dirty|=6)}sync(track){this.dom?
this.dirty&4&&this.setAttrs(this.dom):this.setDOM(this.setAttrs(document.createElement(this.mark.tagName)));super.sync(track)}merge(from,to,source,_hasStart,openStart,openEnd){if(source&&(!(source instanceof MarkView&&source.mark.eq(this.mark))||from&&0>=openStart||to<this.length&&0>=openEnd))return!1;mergeChildrenInto(this,from,to,source?source.children:[],openStart-1,openEnd-1);this.markDirty();return!0}split(from){let result=[];var off=0;let detachFrom=-1,i=0;for(let elt of this.children){let end=
off+elt.length;end>from&&result.push(off<from?elt.split(from-off):elt);0>detachFrom&&off>=from&&(detachFrom=i);off=end;i++}off=this.length-from;this.length=from;-1<detachFrom&&(this.children.length=detachFrom,this.markDirty());return new MarkView(this.mark,result,off)}domAtPos(pos){return inlineDOMAtPos(this,pos)}coordsAt(pos,side){return coordsInChildren(this,pos,side)}}class WidgetView extends ContentView{constructor(widget,length,side){super();this.widget=widget;this.length=length;this.side=side;
this.prevWidget=null}static create(widget,length,side){return new (widget.customView||WidgetView)(widget,length,side)}split(from){let result=WidgetView.create(this.widget,this.length-from,this.side);this.length-=from;return result}sync(){this.dom&&this.widget.updateDOM(this.dom)||(this.dom&&this.prevWidget&&this.prevWidget.destroy(this.dom),this.prevWidget=null,this.setDOM(this.widget.toDOM(this.editorView)),this.dom.contentEditable="false")}getSide(){return this.side}merge(from,to,source,hasStart,
openStart,openEnd){if(source&&(!(source instanceof WidgetView&&this.widget.compare(source.widget))||0<from&&0>=openStart||to<this.length&&0>=openEnd))return!1;this.length=from+(source?source.length:0)+(this.length-to);return!0}become(other){return other.length==this.length&&other instanceof WidgetView&&other.side==this.side&&this.widget.constructor==other.widget.constructor?(this.widget.eq(other.widget)||this.markDirty(!0),this.dom&&!this.prevWidget&&(this.prevWidget=this.widget),this.widget=other.widget,
!0):!1}ignoreMutation(){return!0}ignoreEvent(event){return this.widget.ignoreEvent(event)}get overrideDOMText(){if(0==this.length)return state$jscomp$0.Text.empty;for(var top=this;top.parent;)top=top.parent;top=(top=top.editorView)&&top.state.doc;let start=this.posAtStart;return top?top.slice(start,start+this.length):state$jscomp$0.Text.empty}domAtPos(pos){return 0==pos?DOMPos.before(this.dom):DOMPos.after(this.dom,pos==this.length)}domBoundsAround(){return null}coordsAt(pos,side){let rects=this.dom.getClientRects(),
rect;if(!rects.length)return Rect0;for(let i=0<pos?rects.length-1:0;!(rect=rects[i],0<pos?0==i:i==rects.length-1||rect.top<rect.bottom);i+=0<pos?-1:1);return 0==pos&&0<side||pos==this.length&&0>=side?rect:flattenRect(rect,0==pos)}get isEditable(){return!1}destroy(){super.destroy();this.dom&&this.widget.destroy(this.dom)}}class CompositionView extends WidgetView{domAtPos(pos){let {topView,text}=this.widget;return topView?scanCompositionTree(pos,0,topView,text,(v,p)=>v.domAtPos(p),p=>new DOMPos(text,
Math.min(p,text.nodeValue.length))):new DOMPos(text,Math.min(pos,text.nodeValue.length))}sync(){this.setDOM(this.widget.toDOM())}localPosFromDOM(node,offset){let {topView,text}=this.widget;return topView?posFromDOMInCompositionTree(node,offset,topView,text):Math.min(offset,this.length)}ignoreMutation(){return!1}get overrideDOMText(){return null}coordsAt(pos$jscomp$0,side$jscomp$0){let {topView,text}=this.widget;return topView?scanCompositionTree(pos$jscomp$0,side$jscomp$0,topView,text,(v,pos,side)=>
v.coordsAt(pos,side),(pos,side)=>textCoords(text,pos,side)):textCoords(text,pos$jscomp$0,side$jscomp$0)}destroy(){var _a;super.destroy();null===(_a=this.widget.topView)||void 0===_a?void 0:_a.destroy()}get isEditable(){return!0}}class WidgetBufferView extends ContentView{constructor(side){super();this.side=side}get length(){return 0}merge(){return!1}become(other){return other instanceof WidgetBufferView&&other.side==this.side}split(){return new WidgetBufferView(this.side)}sync(){if(!this.dom){let dom=
document.createElement("img");dom.className="cm-widgetBuffer";dom.setAttribute("aria-hidden","true");this.setDOM(dom)}}getSide(){return this.side}domAtPos(pos){return DOMPos.before(this.dom)}localPosFromDOM(){return 0}domBoundsAround(){return null}coordsAt(pos){pos=this.dom.getBoundingClientRect();a:{var JSCompiler_inline_result=0<this.side?-1:1;let parent=this.parent,index=parent?parent.children.indexOf(this):-1;for(;parent&&0<=index;)if(0>JSCompiler_inline_result?0<index:index<parent.children.length){var next=
parent.children[index+JSCompiler_inline_result];if(next instanceof TextView&&(next=next.coordsAt(0>JSCompiler_inline_result?next.length:0,JSCompiler_inline_result))){JSCompiler_inline_result=next;break a}index+=JSCompiler_inline_result}else if(parent instanceof MarkView&&parent.parent)index=parent.parent.children.indexOf(parent)+(0>JSCompiler_inline_result?0:1),parent=parent.parent;else{if((JSCompiler_inline_result=parent.dom.lastChild)&&"BR"==JSCompiler_inline_result.nodeName){JSCompiler_inline_result=
JSCompiler_inline_result.getClientRects()[0];break a}break}JSCompiler_inline_result=void 0}return JSCompiler_inline_result&&JSCompiler_inline_result.top<pos.bottom&&JSCompiler_inline_result.bottom>pos.top?{left:pos.left,right:pos.right,top:JSCompiler_inline_result.top,bottom:JSCompiler_inline_result.bottom}:pos}get overrideDOMText(){return state$jscomp$0.Text.empty}}TextView.prototype.children=WidgetView.prototype.children=WidgetBufferView.prototype.children=noChildren;class WidgetType{eq(widget){return!1}updateDOM(dom){return!1}compare(other){return this==
other||this.constructor==other.constructor&&this.eq(other)}get estimatedHeight(){return-1}ignoreEvent(event){return!0}get customView(){return null}destroy(dom){}}exports.BlockType=void 0;(function(BlockType){BlockType[BlockType.Text=0]="Text";BlockType[BlockType.WidgetBefore=1]="WidgetBefore";BlockType[BlockType.WidgetAfter=2]="WidgetAfter";BlockType[BlockType.WidgetRange=3]="WidgetRange"})(exports.BlockType||(exports.BlockType={}));class Decoration extends state$jscomp$0.RangeValue{constructor(startSide,
endSide,widget,spec){super();this.startSide=startSide;this.endSide=endSide;this.widget=widget;this.spec=spec}get heightRelevant(){return!1}static mark(spec){return new MarkDecoration(spec)}static widget(spec){let side=spec.side||0,block=!!spec.block;side+=block?0<side?3E8:-4E8:0<side?1E8:-1E8;return new PointDecoration(spec,side,side,block,spec.widget||null,!1)}static replace(spec){let block=!!spec.block,startSide,endSide;if(spec.isBlockGap)startSide=-5E8,endSide=4E8;else{let {start,end}=getInclusive(spec,
block);startSide=(start?block?-3E8:-1:5E8)-1;endSide=(end?block?2E8:1:-6E8)+1}return new PointDecoration(spec,startSide,endSide,block,spec.widget||null,!0)}static line(spec){return new LineDecoration(spec)}static set(of,sort=!1){return state$jscomp$0.RangeSet.of(of,sort)}hasHeight(){return this.widget?-1<this.widget.estimatedHeight:!1}}Decoration.none=state$jscomp$0.RangeSet.empty;class MarkDecoration extends Decoration{constructor(spec){let {start,end}=getInclusive(spec);super(start?-1:5E8,end?1:
-6E8,null,spec);this.tagName=spec.tagName||"span";this.class=spec.class||"";this.attrs=spec.attributes||null}eq(other){return this==other||other instanceof MarkDecoration&&this.tagName==other.tagName&&this.class==other.class&&attrsEq(this.attrs,other.attrs)}range(from,to=from){if(from>=to)throw new RangeError("Mark decorations may not be empty");return super.range(from,to)}}MarkDecoration.prototype.point=!1;class LineDecoration extends Decoration{constructor(spec){super(-2E8,-2E8,null,spec)}eq(other){return other instanceof
LineDecoration&&attrsEq(this.spec.attributes,other.spec.attributes)}range(from,to=from){if(to!=from)throw new RangeError("Line decoration ranges must be zero-length");return super.range(from,to)}}LineDecoration.prototype.mapMode=state$jscomp$0.MapMode.TrackBefore;LineDecoration.prototype.point=!0;class PointDecoration extends Decoration{constructor(spec,startSide,endSide,block,widget,isReplace){super(startSide,endSide,widget,spec);this.block=block;this.isReplace=isReplace;this.mapMode=block?0>=startSide?
state$jscomp$0.MapMode.TrackBefore:state$jscomp$0.MapMode.TrackAfter:state$jscomp$0.MapMode.TrackDel}get type(){return this.startSide<this.endSide?exports.BlockType.WidgetRange:0>=this.startSide?exports.BlockType.WidgetBefore:exports.BlockType.WidgetAfter}get heightRelevant(){return this.block||!!this.widget&&5<=this.widget.estimatedHeight}eq(other){var JSCompiler_temp;if(JSCompiler_temp=other instanceof PointDecoration){JSCompiler_temp=this.widget;var b=other.widget;JSCompiler_temp=JSCompiler_temp==
b||!!(JSCompiler_temp&&b&&JSCompiler_temp.compare(b))}return JSCompiler_temp&&this.block==other.block&&this.startSide==other.startSide&&this.endSide==other.endSide}range(from,to=from){if(this.isReplace&&(from>to||from==to&&0<this.startSide&&0>=this.endSide))throw new RangeError("Invalid range for replacement decoration");if(!this.isReplace&&to!=from)throw new RangeError("Widget decorations can only have zero-length ranges");return super.range(from,to)}}PointDecoration.prototype.point=!0;class LineView extends ContentView{constructor(){super(...arguments);
this.children=[];this.length=0;this.prevAttrs=void 0;this.attrs=null;this.breakAfter=0}merge(from,to,source,hasStart,openStart,openEnd){if(source){if(!(source instanceof LineView))return!1;this.dom||source.transferDOM(this)}hasStart&&this.setDeco(source?source.attrs:null);mergeChildrenInto(this,from,to,source?source.children:[],openStart,openEnd);return!0}split(at){let end=new LineView;end.breakAfter=this.breakAfter;if(0==this.length)return end;let {i,off}=this.childPos(at);off&&(end.append(this.children[i].split(off),
0),this.children[i].merge(off,this.children[i].length,null,!1,0,0),i++);for(let j=i;j<this.children.length;j++)end.append(this.children[j],0);for(;0<i&&0==this.children[i-1].length;)this.children[--i].destroy();this.children.length=i;this.markDirty();this.length=at;return end}transferDOM(other){this.dom&&(this.markDirty(),other.setDOM(this.dom),other.prevAttrs=void 0===this.prevAttrs?this.attrs:this.prevAttrs,this.prevAttrs=void 0,this.dom=null)}setDeco(attrs){attrsEq(this.attrs,attrs)||(this.dom&&
(this.prevAttrs=this.attrs,this.markDirty()),this.attrs=attrs)}append(child,openStart){joinInlineInto(this,child,openStart)}addLineDeco(deco){let attrs=deco.spec.attributes;deco=deco.spec.class;attrs&&(this.attrs=combineAttrs(attrs,this.attrs||{}));deco&&(this.attrs=combineAttrs({class:deco},this.attrs||{}))}domAtPos(pos){return inlineDOMAtPos(this,pos)}reuseDOM(node){"DIV"==node.nodeName&&(this.setDOM(node),this.dirty|=6)}sync(track){var _a;this.dom?this.dirty&4&&(clearAttributes(this.dom),this.dom.className=
"cm-line",this.prevAttrs=this.attrs?null:void 0):(this.setDOM(document.createElement("div")),this.dom.className="cm-line",this.prevAttrs=this.attrs?null:void 0);void 0!==this.prevAttrs&&(updateAttrs(this.dom,this.prevAttrs,this.attrs),this.dom.classList.add("cm-line"),this.prevAttrs=void 0);super.sync(track);for(track=this.dom.lastChild;track&&ContentView.get(track)instanceof MarkView;)track=track.lastChild;track&&this.length&&("BR"==track.nodeName||0!=(null===(_a=ContentView.get(track))||void 0===
_a?void 0:_a.isEditable)||browser.ios&&this.children.some(ch=>ch instanceof TextView))||(_a=document.createElement("BR"),_a.cmIgnore=!0,this.dom.appendChild(_a))}measureTextSize(){if(0==this.children.length||20<this.length)return null;let totalWidth=0;for(let child of this.children){if(!(child instanceof TextView)||/[^ -~]/.test(child.text))return null;let rects=clientRectsFor(child.dom);if(1!=rects.length)return null;totalWidth+=rects[0].width}return totalWidth?{lineHeight:this.dom.getBoundingClientRect().height,
charWidth:totalWidth/this.length}:null}coordsAt(pos,side){return coordsInChildren(this,pos,side)}become(_other){return!1}get type(){return exports.BlockType.Text}static find(docView,pos){for(let i=0,off=0;i<docView.children.length;i++){let block=docView.children[i],end=off+block.length;if(end>=pos){if(block instanceof LineView)return block;if(end>pos)break}off=end+block.breakAfter}return null}}class BlockWidgetView extends ContentView{constructor(widget,length,type){super();this.widget=widget;this.length=
length;this.type=type;this.breakAfter=0;this.prevWidget=null}merge(from,to,source,_takeDeco,openStart,openEnd){if(source&&(!(source instanceof BlockWidgetView&&this.widget.compare(source.widget))||0<from&&0>=openStart||to<this.length&&0>=openEnd))return!1;this.length=from+(source?source.length:0)+(this.length-to);return!0}domAtPos(pos){return 0==pos?DOMPos.before(this.dom):DOMPos.after(this.dom,pos==this.length)}split(at){let len=this.length-at;this.length=at;at=new BlockWidgetView(this.widget,len,
this.type);at.breakAfter=this.breakAfter;return at}get children(){return noChildren}sync(){this.dom&&this.widget.updateDOM(this.dom)||(this.dom&&this.prevWidget&&this.prevWidget.destroy(this.dom),this.prevWidget=null,this.setDOM(this.widget.toDOM(this.editorView)),this.dom.contentEditable="false")}get overrideDOMText(){return this.parent?this.parent.view.state.doc.slice(this.posAtStart,this.posAtEnd):state$jscomp$0.Text.empty}domBoundsAround(){return null}become(other){return other instanceof BlockWidgetView&&
other.type==this.type&&other.widget.constructor==this.widget.constructor?(other.widget.eq(this.widget)||this.markDirty(!0),this.dom&&!this.prevWidget&&(this.prevWidget=this.widget),this.widget=other.widget,this.length=other.length,this.breakAfter=other.breakAfter,!0):!1}ignoreMutation(){return!0}ignoreEvent(event){return this.widget.ignoreEvent(event)}destroy(){super.destroy();this.dom&&this.widget.destroy(this.dom)}}class ContentBuilder{constructor(doc,pos,end,disallowBlockEffectsFor){this.doc=doc;
this.pos=pos;this.end=end;this.disallowBlockEffectsFor=disallowBlockEffectsFor;this.content=[];this.curLine=null;this.pendingBuffer=this.breakAtStart=0;this.atCursorPos=!0;this.openEnd=this.openStart=-1;this.text="";this.textOff=0;this.cursor=doc.iter();this.skip=pos}posCovered(){if(0==this.content.length)return!this.breakAtStart&&this.doc.lineAt(this.pos).from!=this.pos;let last=this.content[this.content.length-1];return!last.breakAfter&&!(last instanceof BlockWidgetView&&last.type==exports.BlockType.WidgetBefore)}getLine(){this.curLine||
(this.content.push(this.curLine=new LineView),this.atCursorPos=!0);return this.curLine}flushBuffer(active){this.pendingBuffer&&(this.curLine.append(wrapMarks(new WidgetBufferView(-1),active),active.length),this.pendingBuffer=0)}addBlockWidget(view){this.flushBuffer([]);this.curLine=null;this.content.push(view)}finish(openEnd){openEnd?this.pendingBuffer=0:this.flushBuffer([]);this.posCovered()||this.getLine()}buildText(length,active,openStart){for(;0<length;){if(this.textOff==this.text.length){let {value,
lineBreak,done}=this.cursor.next(this.skip);this.skip=0;if(done)throw Error("Ran out of text content when drawing inline views");if(lineBreak){this.posCovered()||this.getLine();this.content.length?this.content[this.content.length-1].breakAfter=1:this.breakAtStart=1;this.flushBuffer([]);this.curLine=null;length--;continue}else this.text=value,this.textOff=0}let take=Math.min(this.text.length-this.textOff,length,512);this.flushBuffer(active.slice(0,openStart));this.getLine().append(wrapMarks(new TextView(this.text.slice(this.textOff,
this.textOff+take)),active),openStart);this.atCursorPos=!0;this.textOff+=take;length-=take;openStart=0}}span(from,to,active,openStart){this.buildText(to-from,active,openStart);this.pos=to;0>this.openStart&&(this.openStart=openStart)}point(from,to,deco,active,openStart,index){if(this.disallowBlockEffectsFor[index]&&deco instanceof PointDecoration){if(deco.block)throw new RangeError("Block decorations may not be specified via plugins");if(to>this.doc.lineAt(this.pos).to)throw new RangeError("Decorations that replace line breaks may not be specified via plugins");
}index=to-from;if(deco instanceof PointDecoration)if(deco.block)({type:from}=deco),from!=exports.BlockType.WidgetAfter||this.posCovered()||this.getLine(),this.addBlockWidget(new BlockWidgetView(deco.widget||new NullWidget("div"),index,from));else{let view=WidgetView.create(deco.widget||new NullWidget("span"),index,deco.startSide),cursorBefore=this.atCursorPos&&!view.isEditable&&openStart<=active.length&&(from<to||0<deco.startSide);deco=!view.isEditable&&(from<to||0>=deco.startSide);let line=this.getLine();
2!=this.pendingBuffer||cursorBefore||(this.pendingBuffer=0);this.flushBuffer(active);cursorBefore&&(line.append(wrapMarks(new WidgetBufferView(1),active),openStart),openStart=active.length+Math.max(0,openStart-active.length));line.append(wrapMarks(view,active),openStart);this.pendingBuffer=(this.atCursorPos=deco)?from<to?1:2:0}else this.doc.lineAt(this.pos).from==this.pos&&this.getLine().addLineDeco(deco);index&&(this.textOff+index<=this.text.length?this.textOff+=index:(this.skip+=index-(this.text.length-
this.textOff),this.text="",this.textOff=0),this.pos=to);0>this.openStart&&(this.openStart=openStart)}static build(text,from,to,decorations,dynamicDecorationMap){text=new ContentBuilder(text,from,to,dynamicDecorationMap);text.openEnd=state$jscomp$0.RangeSet.spans(decorations,from,to,text);0>text.openStart&&(text.openStart=text.openEnd);text.finish(text.openEnd);return text}}class NullWidget extends WidgetType{constructor(tag){super();this.tag=tag}eq(other){return other.tag==this.tag}toDOM(){return document.createElement(this.tag)}updateDOM(elt){return elt.nodeName.toLowerCase()==
this.tag}}const clickAddsSelectionRange=state$jscomp$0.Facet.define(),dragMovesSelection$1=state$jscomp$0.Facet.define(),mouseSelectionStyle=state$jscomp$0.Facet.define(),exceptionSink=state$jscomp$0.Facet.define(),updateListener=state$jscomp$0.Facet.define(),inputHandler=state$jscomp$0.Facet.define(),perLineTextDirection=state$jscomp$0.Facet.define({combine:values=>values.some(x=>x)});class ScrollTarget{constructor(range,y="nearest",x="nearest",yMargin=5,xMargin=5){this.range=range;this.y=y;this.x=
x;this.yMargin=yMargin;this.xMargin=xMargin}map(changes){return changes.empty?this:new ScrollTarget(this.range.map(changes),this.y,this.x,this.yMargin,this.xMargin)}}const scrollIntoView=state$jscomp$0.StateEffect.define({map:(t,ch)=>t.map(ch)}),editable=state$jscomp$0.Facet.define({combine:values=>values.length?values[0]:!0});let nextPluginID=0;const viewPlugin=state$jscomp$0.Facet.define();class ViewPlugin{constructor(id,create,domEventHandlers,buildExtensions){this.id=id;this.create=create;this.domEventHandlers=
domEventHandlers;this.extension=buildExtensions(this)}static define(create,spec){const {eventHandlers,provide,decorations:deco}=spec||{};return new ViewPlugin(nextPluginID++,create,eventHandlers,plugin=>{let ext=[viewPlugin.of(plugin)];deco&&ext.push(decorations.of(view=>(view=view.plugin(plugin))?deco(view):Decoration.none));provide&&ext.push(provide(plugin));return ext})}static fromClass(cls,spec){return ViewPlugin.define(view=>new cls(view),spec)}}class PluginInstance{constructor(spec){this.spec=
spec;this.value=this.mustUpdate=null}update(view){if(!this.value){if(this.spec)try{this.value=this.spec.create(view)}catch(e){logException(view.state,e,"CodeMirror plugin crashed"),this.deactivate()}}else if(this.mustUpdate&&(view=this.mustUpdate,this.mustUpdate=null,this.value.update))try{this.value.update(view)}catch(e){logException(view.state,e,"CodeMirror plugin crashed");if(this.value.destroy)try{this.value.destroy()}catch(_){}this.deactivate()}return this}destroy(view){var _a;if(null===(_a=
this.value)||void 0===_a?0:_a.destroy)try{this.value.destroy()}catch(e){logException(view.state,e,"CodeMirror plugin crashed")}}deactivate(){this.spec=this.value=null}}const editorAttributes=state$jscomp$0.Facet.define(),contentAttributes=state$jscomp$0.Facet.define(),decorations=state$jscomp$0.Facet.define(),atomicRanges=state$jscomp$0.Facet.define(),scrollMargins=state$jscomp$0.Facet.define(),styleModule=state$jscomp$0.Facet.define();class ChangedRange{constructor(fromA,toA,fromB,toB){this.fromA=
fromA;this.toA=toA;this.fromB=fromB;this.toB=toB}join(other){return new ChangedRange(Math.min(this.fromA,other.fromA),Math.max(this.toA,other.toA),Math.min(this.fromB,other.fromB),Math.max(this.toB,other.toB))}addToSet(set){let i=set.length,me=this;for(;0<i;i--){let range=set[i-1];if(!(range.fromA>me.toA)){if(range.toA<me.fromA)break;me=me.join(range);set.splice(i-1,1)}}set.splice(i,0,me);return set}static extendWithRanges(diff,ranges){if(0==ranges.length)return diff;let result=[];for(let dI=0,rI=
0,posA=0,posB=0;;dI++){let next=dI==diff.length?null:diff[dI],off=posA-posB,end=next?next.fromB:1E9;for(;rI<ranges.length&&ranges[rI]<end;){let to=ranges[rI+1],fromB=Math.max(posB,ranges[rI]),toB=Math.min(end,to);fromB<=toB&&(new ChangedRange(fromB+off,toB+off,fromB,toB)).addToSet(result);if(to>end)break;else rI+=2}if(!next)return result;(new ChangedRange(next.fromA,next.toA,next.fromB,next.toB)).addToSet(result);posA=next.toA;posB=next.toB}}}class ViewUpdate{constructor(view,state$1,transactions){this.view=
view;this.state=state$1;this.transactions=transactions;this.flags=0;this.startState=view.state;this.changes=state$jscomp$0.ChangeSet.empty(this.startState.doc.length);for(let tr of transactions)this.changes=this.changes.compose(tr.changes);let changedRanges=[];this.changes.iterChangedRanges((fromA,toA,fromB,toB)=>changedRanges.push(new ChangedRange(fromA,toA,fromB,toB)));this.changedRanges=changedRanges;state$1=view.hasFocus;state$1!=view.inputState.notifiedFocused&&(view.inputState.notifiedFocused=
state$1,this.flags|=1)}static create(view,state,transactions){return new ViewUpdate(view,state,transactions)}get viewportChanged(){return 0<(this.flags&4)}get heightChanged(){return 0<(this.flags&2)}get geometryChanged(){return this.docChanged||0<(this.flags&10)}get focusChanged(){return 0<(this.flags&1)}get docChanged(){return!this.changes.empty}get selectionSet(){return this.transactions.some(tr=>tr.selection)}get empty(){return 0==this.flags&&0==this.transactions.length}}exports.Direction=void 0;
(function(Direction){Direction[Direction.LTR=0]="LTR";Direction[Direction.RTL=1]="RTL"})(exports.Direction||(exports.Direction={}));const LTR=exports.Direction.LTR,RTL=exports.Direction.RTL,LowTypes=dec("88888888888888888888888888888888888666888888787833333333337888888000000000000000000000000008888880000000000000000000000000088888888888888888888888888888888888887866668888088888663380888308888800000000000000000000000800000000000000000000000000000008"),ArabicTypes=dec("4444448826627288999999999992222222222222222222222222222222222222222222222229999999999999999999994444444444644222822222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222999999949999999229989999223333333333"),
Brackets=Object.create(null),BracketStack=[];for(let p of["()","[]","{}"]){let l=p.charCodeAt(0),r=p.charCodeAt(1);Brackets[l]=r;Brackets[r]=-l}const BidiRE=/[\u0590-\u05f4\u0600-\u06ff\u0700-\u08ac\ufb50-\ufdff]/;class BidiSpan{constructor(from,to,level){this.from=from;this.to=to;this.level=level}get dir(){return this.level%2?RTL:LTR}side(end,dir){return this.dir==dir==end?this.to:this.from}static find(order,index,level,assoc){let maybe=-1;for(let i=0;i<order.length;i++){let span=order[i];if(span.from<=
index&&span.to>=index){if(span.level==level)return i;if(0>maybe||(0!=assoc?0>assoc?span.from<index:span.to>index:order[maybe].level>span.level))maybe=i}}if(0>maybe)throw new RangeError("Index out of range");return maybe}}const types=[];let movedOver="";class DOMReader{constructor(points,state$1){this.points=points;this.text="";this.lineSeparator=state$1.facet(state$jscomp$0.EditorState.lineSeparator)}append(text){this.text+=text}lineBreak(){this.text+="￿"}readRange(start,end){if(!start)return this;
let parent=start.parentNode;for(;;){this.findPointBefore(parent,start);this.readNode(start);let next=start.nextSibling;if(next==end)break;let view=ContentView.get(start),nextView=ContentView.get(next);(view&&nextView?view.breakAfter:(view?view.breakAfter:isBlockElement(start))||isBlockElement(next)&&("BR"!=start.nodeName||start.cmIgnore))&&this.lineBreak();start=next}this.findPointBefore(parent,end);return this}readTextNode(node){let text=node.nodeValue;for(var point$jscomp$0 of this.points)point$jscomp$0.node==
node&&(point$jscomp$0.pos=this.text.length+Math.min(point$jscomp$0.offset,text.length));for(let off=0,re=this.lineSeparator?null:/\r\n?|\n/g;;){point$jscomp$0=-1;let breakSize=1,m;if(this.lineSeparator)point$jscomp$0=text.indexOf(this.lineSeparator,off),breakSize=this.lineSeparator.length;else if(m=re.exec(text))point$jscomp$0=m.index,breakSize=m[0].length;this.append(text.slice(off,0>point$jscomp$0?text.length:point$jscomp$0));if(0>point$jscomp$0)break;this.lineBreak();if(1<breakSize)for(let point of this.points)point.node==
node&&point.pos>this.text.length&&(point.pos-=breakSize-1);off=point$jscomp$0+breakSize}}readNode(node){if(!node.cmIgnore){var view=ContentView.get(node);view=view&&view.overrideDOMText;if(null!=view)for(this.findPointInside(node,view.length),node=view.iter();!node.next().done;)node.lineBreak?this.lineBreak():this.append(node.value);else 3==node.nodeType?this.readTextNode(node):"BR"==node.nodeName?node.nextSibling&&this.lineBreak():1==node.nodeType&&this.readRange(node.firstChild,null)}}findPointBefore(node,
next){for(let point of this.points)point.node==node&&node.childNodes[point.offset]==next&&(point.pos=this.text.length)}findPointInside(node,maxLen){for(let point of this.points)if(3==node.nodeType?point.node==node:node.contains(point.node))point.pos=this.text.length+Math.min(maxLen,point.offset)}}class DOMPoint{constructor(node,offset){this.node=node;this.offset=offset;this.pos=-1}}class DocView extends ContentView{constructor(view){super();this.view=view;this.compositionDeco=Decoration.none;this.decorations=
[];this.dynamicDecorationMap=[];this.minWidthTo=this.minWidthFrom=this.minWidth=0;this.impreciseHead=this.impreciseAnchor=null;this.forceSelection=!1;this.lastUpdate=Date.now();this.setDOM(view.contentDOM);this.children=[new LineView];this.children[0].setParent(this);this.updateDeco();this.updateInner([new ChangedRange(0,0,0,view.state.doc.length)],0)}get editorView(){return this.view}get length(){return this.view.state.doc.length}update(update){let changedRanges=update.changedRanges;0<this.minWidth&&
changedRanges.length&&(changedRanges.every(({fromA,toA})=>toA<this.minWidthFrom||fromA>this.minWidthTo)?(this.minWidthFrom=update.changes.mapPos(this.minWidthFrom,1),this.minWidthTo=update.changes.mapPos(this.minWidthTo,1)):this.minWidth=this.minWidthFrom=this.minWidthTo=0);if(0>this.view.inputState.composing)this.compositionDeco=Decoration.none;else if(update.transactions.length||this.dirty)this.compositionDeco=computeCompositionDeco(this.view,update.changes);(browser.ie||browser.chrome)&&!this.compositionDeco.size&&
update&&update.state.doc.lines!=update.startState.doc.lines&&(this.forceSelection=!0);var prevDeco=this.decorations;let deco=this.updateDeco();prevDeco=findChangedDeco(prevDeco,deco,update.changes);changedRanges=ChangedRange.extendWithRanges(changedRanges,prevDeco);if(0==this.dirty&&0==changedRanges.length)return!1;this.updateInner(changedRanges,update.startState.doc.length);update.transactions.length&&(this.lastUpdate=Date.now());return!0}updateInner(changes,oldLength){this.view.viewState.mustMeasureContent=
!0;this.updateChildren(changes,oldLength);let {observer}=this.view;observer.ignore(()=>{this.dom.style.height=this.view.viewState.contentHeight+"px";this.dom.style.flexBasis=this.minWidth?this.minWidth+"px":"";let track=browser.chrome||browser.ios?{node:observer.selectionRange.focusNode,written:!1}:void 0;this.sync(track);this.dirty=0;track&&(track.written||observer.selectionRange.focusNode!=track.node)&&(this.forceSelection=!0);this.dom.style.height=""});changes=[];if(this.view.viewport.from||this.view.viewport.to<
this.view.state.doc.length)for(let child of this.children)child instanceof BlockWidgetView&&child.widget instanceof BlockGapWidget&&changes.push(child.dom);observer.updateGaps(changes)}updateChildren(changes,oldLength){oldLength=this.childCursor(oldLength);for(let i=changes.length-1;;i--){let next=0<=i?changes[i]:null;if(!next)break;let {fromA,toA,fromB,toB}=next,{content,breakAtStart,openStart,openEnd}=ContentBuilder.build(this.view.state.doc,fromB,toB,this.decorations,this.dynamicDecorationMap),
{i:toI,off:toOff}=oldLength.findPos(toA,1),{i:fromI,off:fromOff}=oldLength.findPos(fromA,-1);replaceRange(this,fromI,fromOff,toI,toOff,content,breakAtStart,openStart,openEnd)}}updateSelection(mustRead=!1,fromPointer=!1){!mustRead&&this.view.observer.selectionRange.focusNode||this.view.observer.readSelectionRange();if(fromPointer||this.mayControlSelection()){mustRead=this.forceSelection;this.forceSelection=!1;var main=this.view.state.selection.main,anchor=this.domAtPos(main.anchor),head=main.empty?
anchor:this.domAtPos(main.head);if(browser.gecko&&main.empty&&1==anchor.node.nodeType&&anchor.node.firstChild&&(0==anchor.offset||"false"==anchor.node.childNodes[anchor.offset-1].contentEditable)&&(anchor.offset==anchor.node.childNodes.length||"false"==anchor.node.childNodes[anchor.offset].contentEditable)){let dummy=document.createTextNode("");this.view.observer.ignore(()=>anchor.node.insertBefore(dummy,anchor.node.childNodes[anchor.offset]||null));anchor=head=new DOMPos(dummy,0);mustRead=!0}var domSel=
this.view.observer.selectionRange;!mustRead&&domSel.focusNode&&isEquivalentPosition(anchor.node,anchor.offset,domSel.anchorNode,domSel.anchorOffset)&&isEquivalentPosition(head.node,head.offset,domSel.focusNode,domSel.focusOffset)||(this.view.observer.ignore(()=>{var JSCompiler_temp;if(JSCompiler_temp=browser.android&&browser.chrome&&this.dom.contains(domSel.focusNode))a:{for(JSCompiler_temp=domSel.focusNode;JSCompiler_temp&&JSCompiler_temp!=this.dom;JSCompiler_temp=JSCompiler_temp.assignedSlot||JSCompiler_temp.parentNode)if(1==
JSCompiler_temp.nodeType&&"false"==JSCompiler_temp.contentEditable){JSCompiler_temp=!0;break a}JSCompiler_temp=!1}JSCompiler_temp&&(this.dom.blur(),this.dom.focus({preventScroll:!0}));if(JSCompiler_temp=getSelection(this.view.root))if(main.empty){if(browser.gecko){var JSCompiler_inline_result=anchor.node;var offset=anchor.offset;JSCompiler_inline_result=1!=JSCompiler_inline_result.nodeType?0:(offset&&"false"==JSCompiler_inline_result.childNodes[offset-1].contentEditable?1:0)|(offset<JSCompiler_inline_result.childNodes.length&&
"false"==JSCompiler_inline_result.childNodes[offset].contentEditable?2:0);JSCompiler_inline_result&&3!=JSCompiler_inline_result&&(offset=nearbyTextNode(anchor.node,anchor.offset,1==JSCompiler_inline_result?1:-1))&&(anchor=new DOMPos(offset,1==JSCompiler_inline_result?0:offset.nodeValue.length))}JSCompiler_temp.collapse(anchor.node,anchor.offset);null!=main.bidiLevel&&null!=domSel.cursorBidiLevel&&(domSel.cursorBidiLevel=main.bidiLevel)}else JSCompiler_temp.extend?(JSCompiler_temp.collapse(anchor.node,
anchor.offset),JSCompiler_temp.extend(head.node,head.offset)):(JSCompiler_inline_result=document.createRange(),main.anchor>main.head&&([anchor,head]=[head,anchor]),JSCompiler_inline_result.setEnd(head.node,head.offset),JSCompiler_inline_result.setStart(anchor.node,anchor.offset),JSCompiler_temp.removeAllRanges(),JSCompiler_temp.addRange(JSCompiler_inline_result))}),this.view.observer.setSelectionRange(anchor,head));this.impreciseAnchor=anchor.precise?null:new DOMPos(domSel.anchorNode,domSel.anchorOffset);
this.impreciseHead=head.precise?null:new DOMPos(domSel.focusNode,domSel.focusOffset)}}enforceCursorAssoc(){if(!this.compositionDeco.size){var cursor=this.view.state.selection.main,sel=getSelection(this.view.root);if(sel&&cursor.empty&&cursor.assoc&&sel.modify){var line=LineView.find(this,cursor.head);if(line){var lineStart=line.posAtStart;cursor.head!=lineStart&&cursor.head!=lineStart+line.length&&(line=this.coordsAt(cursor.head,-1),lineStart=this.coordsAt(cursor.head,1),!line||!lineStart||line.bottom>
lineStart.top||(line=this.domAtPos(cursor.head+cursor.assoc),sel.collapse(line.node,line.offset),sel.modify("move",0>cursor.assoc?"forward":"backward","lineboundary")))}}}}mayControlSelection(){let active=this.view.root.activeElement;return active==this.dom||hasSelection(this.dom,this.view.observer.selectionRange)&&!(active&&this.dom.contains(active))}nearest(dom){for(;dom;){let domView=ContentView.get(dom);if(domView&&domView.rootView==this)return domView;dom=dom.parentNode}return null}posFromDOM(node,
offset){let view=this.nearest(node);if(!view)throw new RangeError("Trying to find position for a DOM position outside of the document");return view.localPosFromDOM(node,offset)+view.posAtStart}domAtPos(pos){let {i,off}=this.childCursor().findPos(pos,-1);for(;i<this.children.length-1;){pos=this.children[i];if(off<pos.length||pos instanceof LineView)break;i++;off=0}return this.children[i].domAtPos(off)}coordsAt(pos,side){for(let off=this.length,i=this.children.length-1;;i--){let child=this.children[i],
start=off-child.breakAfter-child.length;if(pos>start||pos==start&&child.type!=exports.BlockType.WidgetBefore&&child.type!=exports.BlockType.WidgetAfter&&(!i||2==side||this.children[i-1].breakAfter||this.children[i-1].type==exports.BlockType.WidgetBefore&&-2<side))return child.coordsAt(pos-start,side);off=start}}measureVisibleLineHeights(viewport){let result=[],{from,to}=viewport;viewport=this.view.contentDOM.clientWidth;let isWider=viewport>Math.max(this.view.scrollDOM.clientWidth,this.minWidth)+
1,widest=-1,ltr=this.view.textDirection==exports.Direction.LTR;for(let pos=0,i=0;i<this.children.length;i++){let child=this.children[i],end=pos+child.length;if(end>to)break;if(pos>=from){var childRect=child.dom.getBoundingClientRect();result.push(childRect.height);if(isWider){var last=child.dom.lastChild;last=last?clientRectsFor(last):[];last.length&&(last=last[last.length-1],childRect=ltr?last.right-childRect.left:childRect.right-last.left,childRect>widest&&(widest=childRect,this.minWidth=viewport,
this.minWidthFrom=pos,this.minWidthTo=end))}}pos=end+child.breakAfter}return result}textDirectionAt(pos){({i:pos}=this.childPos(pos,1));return"rtl"==getComputedStyle(this.children[pos].dom).direction?exports.Direction.RTL:exports.Direction.LTR}measureTextSize(){for(let child of this.children)if(child instanceof LineView){let measure=child.measureTextSize();if(measure)return measure}let dummy=document.createElement("div"),lineHeight,charWidth;dummy.className="cm-line";dummy.style.width="99999px";dummy.textContent=
"abc def ghi jkl mno pqr stu";this.view.observer.ignore(()=>{this.dom.appendChild(dummy);let rect=clientRectsFor(dummy.firstChild)[0];lineHeight=dummy.getBoundingClientRect().height;charWidth=rect?rect.width/27:7;dummy.remove()});return{lineHeight,charWidth}}childCursor(pos=this.length){let i=this.children.length;i&&(pos-=this.children[--i].length);return new ChildCursor(this.children,pos,i)}computeBlockGapDeco(){let deco=[],vs=this.view.viewState;for(let pos=0,i=0;;i++){let next=i==vs.viewports.length?
null:vs.viewports[i],end=next?next.from-1:this.length;if(end>pos){let height=vs.lineBlockAt(end).bottom-vs.lineBlockAt(pos).top;deco.push(Decoration.replace({widget:new BlockGapWidget(height),block:!0,inclusive:!0,isBlockGap:!0}).range(pos,end))}if(!next)break;pos=next.to+1}return Decoration.set(deco)}updateDeco(){let allDeco=this.view.state.facet(decorations).map((d,i)=>(this.dynamicDecorationMap[i]="function"==typeof d)?d(this.view):d);for(let i=allDeco.length;i<allDeco.length+3;i++)this.dynamicDecorationMap[i]=
!1;return this.decorations=[...allDeco,this.compositionDeco,this.computeBlockGapDeco(),this.view.viewState.lineGapDeco]}scrollIntoView(target){let {range}=target,rect=this.coordsAt(range.head,range.empty?range.assoc:range.head>range.anchor?-1:1);var other;if(rect){!range.empty&&(other=this.coordsAt(range.anchor,range.anchor>range.head?-1:1))&&(rect={left:Math.min(rect.left,other.left),top:Math.min(rect.top,other.top),right:Math.max(rect.right,other.right),bottom:Math.max(rect.bottom,other.bottom)});
var mRight=other=0,mTop=0,mBottom=0;for(let margins of this.view.state.facet(scrollMargins).map(f=>f(this.view)))if(margins){let {left,right,top,bottom}=margins;null!=left&&(other=Math.max(other,left));null!=right&&(mRight=Math.max(mRight,right));null!=top&&(mTop=Math.max(mTop,top));null!=bottom&&(mBottom=Math.max(mBottom,bottom))}scrollRectIntoView(this.view.scrollDOM,{left:rect.left-other,top:rect.top-mTop,right:rect.right+mRight,bottom:rect.bottom+mBottom},range.head<range.anchor?-1:1,target.x,
target.y,target.xMargin,target.yMargin,this.view.textDirection==exports.Direction.LTR)}}}class BlockGapWidget extends WidgetType{constructor(height){super();this.height=height}toDOM(){let elt=document.createElement("div");this.updateDOM(elt);return elt}eq(other){return other.height==this.height}updateDOM(elt){elt.style.height=this.height+"px";return!0}get estimatedHeight(){return this.height}}class CompositionWidget extends WidgetType{constructor(top,text,topView){super();this.top=top;this.text=text;
this.topView=topView}eq(other){return this.top==other.top&&this.text==other.text}toDOM(){return this.top}ignoreEvent(){return!1}get customView(){return CompositionView}}class DecorationComparator$1{constructor(){this.changes=[]}compareRange(from,to){addRange(from,to,this.changes)}comparePoint(from,to){addRange(from,to,this.changes)}}class InputState{constructor(view){this.lastScrollLeft=this.lastScrollTop=this.lastFocusTime=this.lastTouchTime=this.lastKeyTime=this.lastKeyCode=0;this.chromeScrollHack=
-1;this.pendingIOSKey=void 0;this.lastSelectionOrigin=null;this.lastContextMenu=this.lastEscPress=this.lastSelectionTime=0;this.scrollHandlers=[];this.registeredEvents=[];this.customHandlers=[];this.composing=-1;this.compositionFirstChange=null;this.compositionEndedAt=0;this.mouseSelection=null;for(let type in handlers$jscomp$0){let handler=handlers$jscomp$0[type];view.contentDOM.addEventListener(type,event=>{!eventBelongsToEditor(view,event)||this.ignoreDuringComposition(event)||"keydown"==type&&
this.keydown(view,event)||(this.mustFlushObserver(event)&&view.observer.forceFlush(),this.runCustomHandlers(type,view,event)?event.preventDefault():handler(view,event))},handlerOptions[type]);this.registeredEvents.push(type)}browser.chrome&&102==browser.chrome_version&&view.scrollDOM.addEventListener("wheel",()=>{0>this.chromeScrollHack?view.contentDOM.style.pointerEvents="none":window.clearTimeout(this.chromeScrollHack);this.chromeScrollHack=setTimeout(()=>{this.chromeScrollHack=-1;view.contentDOM.style.pointerEvents=
""},100)},{passive:!0});this.notifiedFocused=view.hasFocus;browser.safari&&view.contentDOM.addEventListener("input",()=>null)}setSelectionOrigin(origin){this.lastSelectionOrigin=origin;this.lastSelectionTime=Date.now()}ensureHandlers(view,plugins){var _a;this.customHandlers=[];for(let plugin of plugins)if(plugins=null===(_a=plugin.update(view).spec)||void 0===_a?void 0:_a.domEventHandlers){this.customHandlers.push({plugin:plugin.value,handlers:plugins});for(let type in plugins)0>this.registeredEvents.indexOf(type)&&
"scroll"!=type&&(this.registeredEvents.push(type),view.contentDOM.addEventListener(type,event=>{eventBelongsToEditor(view,event)&&this.runCustomHandlers(type,view,event)&&event.preventDefault()}))}}runCustomHandlers(type,view,event){for(let set of this.customHandlers){let handler=set.handlers[type];if(handler)try{if(handler.call(set.plugin,event,view)||event.defaultPrevented)return!0}catch(e){logException(view.state,e)}}return!1}runScrollHandlers(view,event){this.lastScrollTop=view.scrollDOM.scrollTop;
this.lastScrollLeft=view.scrollDOM.scrollLeft;for(let set of this.customHandlers){let handler=set.handlers.scroll;if(handler)try{handler.call(set.plugin,event,view)}catch(e){logException(view.state,e)}}}keydown(view,event){this.lastKeyCode=event.keyCode;this.lastKeyTime=Date.now();if(9==event.keyCode&&Date.now()<this.lastEscPress+2E3)return!0;if(browser.android&&browser.chrome&&!event.synthetic&&(13==event.keyCode||8==event.keyCode))return view.observer.delayAndroidKey(event.key,event.keyCode),!0;
let pending;return!browser.ios||event.synthetic||event.altKey||event.metaKey||!((pending=PendingKeys.find(key=>key.keyCode==event.keyCode))&&!event.ctrlKey||-1<"dthko".indexOf(event.key)&&event.ctrlKey&&!event.shiftKey)?!1:(this.pendingIOSKey=pending||event,setTimeout(()=>this.flushIOSKey(view),250),!0)}flushIOSKey(view){let key=this.pendingIOSKey;if(!key)return!1;this.pendingIOSKey=void 0;return dispatchKey(view.contentDOM,key.key,key.keyCode)}ignoreDuringComposition(event){return/^key/.test(event.type)?
0<this.composing?!0:browser.safari&&!browser.ios&&100>Date.now()-this.compositionEndedAt?(this.compositionEndedAt=0,!0):!1:!1}mustFlushObserver(event){return"keydown"==event.type&&229!=event.keyCode}startMouseSelection(mouseSelection){this.mouseSelection&&this.mouseSelection.destroy();this.mouseSelection=mouseSelection}update(update){this.mouseSelection&&this.mouseSelection.update(update);update.transactions.length&&(this.lastKeyCode=this.lastSelectionTime=0)}destroy(){this.mouseSelection&&this.mouseSelection.destroy()}}
const PendingKeys=[{key:"Backspace",keyCode:8,inputType:"deleteContentBackward"},{key:"Enter",keyCode:13,inputType:"insertParagraph"},{key:"Delete",keyCode:46,inputType:"deleteContentForward"}],modifierCodes=[16,17,18,20,91,92,224,225];class MouseSelection{constructor(view,startEvent,style,mustSelect){this.view=view;this.style=style;this.mustSelect=mustSelect;this.lastEvent=startEvent;style=view.contentDOM.ownerDocument;style.addEventListener("mousemove",this.move=this.move.bind(this));style.addEventListener("mouseup",
this.up=this.up.bind(this));this.extend=startEvent.shiftKey;if(style=view.state.facet(state$jscomp$0.EditorState.allowMultipleSelections))style=view.state.facet(clickAddsSelectionRange),style=style.length?style[0](startEvent):browser.mac?startEvent.metaKey:startEvent.ctrlKey;this.multiple=style;style=view.state.facet(dragMovesSelection$1);this.dragMove=style.length?style[0](startEvent):browser.mac?!startEvent.altKey:!startEvent.ctrlKey;this.dragging=isInPrimarySelection(view,startEvent)&&1==getClickType(startEvent)?
null:!1;!1===this.dragging&&(startEvent.preventDefault(),this.select(startEvent))}move(event){if(0==event.buttons)return this.destroy();!1===this.dragging&&this.select(this.lastEvent=event)}up(event){null==this.dragging&&this.select(this.lastEvent);this.dragging||event.preventDefault();this.destroy()}destroy(){let doc=this.view.contentDOM.ownerDocument;doc.removeEventListener("mousemove",this.move);doc.removeEventListener("mouseup",this.up);this.view.inputState.mouseSelection=null}select(event){event=
this.style.get(event,this.extend,this.multiple);!this.mustSelect&&event.eq(this.view.state.selection)&&event.main.assoc==this.view.state.selection.main.assoc||this.view.dispatch({selection:event,userEvent:"select.pointer",scrollIntoView:!0});this.mustSelect=!1}update(update){update.docChanged&&this.dragging&&(this.dragging=this.dragging.map(update.changes));this.style.update(update)&&setTimeout(()=>this.select(this.lastEvent),20)}}const handlers$jscomp$0=Object.create(null),handlerOptions=Object.create(null),
brokenClipboardAPI=browser.ie&&15>browser.ie_version||browser.ios&&604>browser.webkit_version;handlers$jscomp$0.keydown=(view,event)=>{view.inputState.setSelectionOrigin("select");27==event.keyCode?view.inputState.lastEscPress=Date.now():0>modifierCodes.indexOf(event.keyCode)&&(view.inputState.lastEscPress=0)};handlers$jscomp$0.touchstart=(view,e)=>{view.inputState.lastTouchTime=Date.now();view.inputState.setSelectionOrigin("select.pointer")};handlers$jscomp$0.touchmove=view=>{view.inputState.setSelectionOrigin("select.pointer")};
handlerOptions.touchstart=handlerOptions.touchmove={passive:!0};handlers$jscomp$0.mousedown=(view,event)=>{view.observer.flush();if(!(view.inputState.lastTouchTime>Date.now()-2E3&&1==getClickType(event))){var style=null;for(var makeStyle of view.state.facet(mouseSelectionStyle))if(style=makeStyle(view,event))break;style||0!=event.button||(style=basicMouseSelection(view,event));style&&((makeStyle=view.root.activeElement!=view.contentDOM)&&view.observer.ignore(()=>focusPreventScroll(view.contentDOM)),
view.inputState.startMouseSelection(new MouseSelection(view,event,style,makeStyle)))}};const BadMouseDetail=browser.ie&&11>=browser.ie_version;let lastMouseDown=null,lastMouseDownCount=0,lastMouseDownTime=0;handlers$jscomp$0.dragstart=(view,event)=>{let {selection:{main}}=view.state,{mouseSelection}=view.inputState;mouseSelection&&(mouseSelection.dragging=main);event.dataTransfer&&(event.dataTransfer.setData("Text",view.state.sliceDoc(main.from,main.to)),event.dataTransfer.effectAllowed="copyMove")};
handlers$jscomp$0.drop=(view,event)=>{if(event.dataTransfer){if(view.state.readOnly)return event.preventDefault();var files=event.dataTransfer.files;if(files&&files.length){event.preventDefault();let text=Array(files.length),read=0,finishFile=()=>{++read==files.length&&dropText(view,event,text.filter(s=>null!=s).join(view.state.lineBreak),!1)};for(let i=0;i<files.length;i++){let reader=new FileReader;reader.onerror=finishFile;reader.onload=()=>{/[\x00-\x08\x0e-\x1f]{2}/.test(reader.result)||(text[i]=
reader.result);finishFile()};reader.readAsText(files[i])}}else dropText(view,event,event.dataTransfer.getData("Text"),!0)}};handlers$jscomp$0.paste=(view,event)=>{if(view.state.readOnly)return event.preventDefault();view.observer.flush();let data=brokenClipboardAPI?null:event.clipboardData;data?(doPaste(view,data.getData("text/plain")),event.preventDefault()):capturePaste(view)};let lastLinewiseCopy=null;handlers$jscomp$0.copy=handlers$jscomp$0.cut=(view,event)=>{var JSCompiler_inline_result=view.state;
let content=[],ranges=[];var linewise=!1;for(var range of JSCompiler_inline_result.selection.ranges)range.empty||(content.push(JSCompiler_inline_result.sliceDoc(range.from,range.to)),ranges.push(range));if(!content.length){linewise=-1;for(let {from}of JSCompiler_inline_result.selection.ranges)range=JSCompiler_inline_result.doc.lineAt(from),range.number>linewise&&(content.push(range.text),ranges.push({from:range.from,to:Math.min(JSCompiler_inline_result.doc.length,range.to+1)})),linewise=range.number;
linewise=!0}JSCompiler_inline_result={text:content.join(JSCompiler_inline_result.lineBreak),ranges,linewise};let {text,ranges:ranges$jscomp$0,linewise:linewise$jscomp$0}=JSCompiler_inline_result;if(text||linewise$jscomp$0)lastLinewiseCopy=linewise$jscomp$0?text:null,(JSCompiler_inline_result=brokenClipboardAPI?null:event.clipboardData)?(event.preventDefault(),JSCompiler_inline_result.clearData(),JSCompiler_inline_result.setData("text/plain",text)):captureCopy(view,text),"cut"!=event.type||view.state.readOnly||
view.dispatch({changes:ranges$jscomp$0,scrollIntoView:!0,userEvent:"delete.cut"})};handlers$jscomp$0.focus=view=>{view.inputState.lastFocusTime=Date.now();view.scrollDOM.scrollTop||!view.inputState.lastScrollTop&&!view.inputState.lastScrollLeft||(view.scrollDOM.scrollTop=view.inputState.lastScrollTop,view.scrollDOM.scrollLeft=view.inputState.lastScrollLeft);updateForFocusChange(view)};handlers$jscomp$0.blur=view=>{view.observer.clearSelectionRange();updateForFocusChange(view)};handlers$jscomp$0.compositionstart=
handlers$jscomp$0.compositionupdate=view=>{null==view.inputState.compositionFirstChange&&(view.inputState.compositionFirstChange=!0);0>view.inputState.composing&&(view.inputState.composing=0)};handlers$jscomp$0.compositionend=view=>{view.inputState.composing=-1;view.inputState.compositionEndedAt=Date.now();view.inputState.compositionFirstChange=null;browser.chrome&&browser.android&&view.observer.flushSoon();setTimeout(()=>{0>view.inputState.composing&&view.docView.compositionDeco.size&&view.update([])},
50)};handlers$jscomp$0.contextmenu=view=>{view.inputState.lastContextMenu=Date.now()};handlers$jscomp$0.beforeinput=(view,event)=>{var _a$jscomp$0;let pending;if(browser.chrome&&browser.android&&(pending=PendingKeys.find(key=>key.inputType==event.inputType))&&(view.observer.delayAndroidKey(pending.key,pending.keyCode),"Backspace"==pending.key||"Delete"==pending.key)){let startViewHeight=(null===(_a$jscomp$0=window.visualViewport)||void 0===_a$jscomp$0?void 0:_a$jscomp$0.height)||0;setTimeout(()=>
{var _a;((null===(_a=window.visualViewport)||void 0===_a?void 0:_a.height)||0)>startViewHeight+10&&view.hasFocus&&(view.contentDOM.blur(),view.focus())},100)}};const wrappingWhiteSpace=["pre-wrap","normal","pre-line","break-spaces"];class HeightOracle{constructor(){this.doc=state$jscomp$0.Text.empty;this.lineWrapping=!1;this.heightSamples={};this.lineHeight=14;this.charWidth=7;this.lineLength=30;this.heightChanged=!1}heightForGap(from,to){let lines=this.doc.lineAt(to).number-this.doc.lineAt(from).number+
1;this.lineWrapping&&(lines+=Math.ceil((to-from-lines*this.lineLength*.5)/this.lineLength));return this.lineHeight*lines}heightForLine(length){return this.lineWrapping?(1+Math.max(0,Math.ceil((length-this.lineLength)/(this.lineLength-5))))*this.lineHeight:this.lineHeight}setDoc(doc){this.doc=doc;return this}mustRefreshForWrapping(whiteSpace){return-1<wrappingWhiteSpace.indexOf(whiteSpace)!=this.lineWrapping}mustRefreshForHeights(lineHeights){let newHeight=!1;for(let i=0;i<lineHeights.length;i++){let h=
lineHeights[i];0>h?i++:this.heightSamples[Math.floor(10*h)]||(newHeight=!0,this.heightSamples[Math.floor(10*h)]=!0)}return newHeight}refresh(whiteSpace,lineHeight,charWidth,lineLength,knownHeights){let lineWrapping=-1<wrappingWhiteSpace.indexOf(whiteSpace);whiteSpace=Math.round(lineHeight)!=Math.round(this.lineHeight)||this.lineWrapping!=lineWrapping;this.lineWrapping=lineWrapping;this.lineHeight=lineHeight;this.charWidth=charWidth;this.lineLength=lineLength;if(whiteSpace)for(this.heightSamples={},
lineHeight=0;lineHeight<knownHeights.length;lineHeight++)charWidth=knownHeights[lineHeight],0>charWidth?lineHeight++:this.heightSamples[Math.floor(10*charWidth)]=!0;return whiteSpace}}class MeasuredHeights{constructor(from,heights){this.from=from;this.heights=heights;this.index=0}get more(){return this.index<this.heights.length}}class BlockInfo{constructor(from,length,top,height,type){this.from=from;this.length=length;this.top=top;this.height=height;this.type=type}get to(){return this.from+this.length}get bottom(){return this.top+
this.height}join(other){let detail=(Array.isArray(this.type)?this.type:[this]).concat(Array.isArray(other.type)?other.type:[other]);return new BlockInfo(this.from,this.length+other.length,this.top,this.height+other.height,detail)}}var QueryType;(function(QueryType){QueryType[QueryType.ByPos=0]="ByPos";QueryType[QueryType.ByHeight=1]="ByHeight";QueryType[QueryType.ByPosNoHeight=2]="ByPosNoHeight"})(QueryType||(QueryType={}));class HeightMap{constructor(length,height,flags=2){this.length=length;this.height=
height;this.flags=flags}get outdated(){return 0<(this.flags&2)}set outdated(value){this.flags=(value?2:0)|this.flags&-3}setHeight(oracle,height){this.height!=height&&(.001<Math.abs(this.height-height)&&(oracle.heightChanged=!0),this.height=height)}replace(_from,_to,nodes){return HeightMap.of(nodes)}decomposeLeft(_to,result){result.push(this)}decomposeRight(_from,result){result.push(this)}applyChanges(decorations,oldDoc,oracle,changes){let me=this;for(let i=changes.length-1;0<=i;i--){let {fromA,toA,
fromB,toB}=changes[i];var start=me.lineAt(fromA,QueryType.ByPosNoHeight,oldDoc,0,0);let end=start.to>=toA?start:me.lineAt(toA,QueryType.ByPosNoHeight,oldDoc,0,0);toB+=end.to-toA;for(toA=end.to;0<i&&start.from<=changes[i-1].toA;)fromA=changes[i-1].fromA,fromB=changes[i-1].fromB,i--,fromA<start.from&&(start=me.lineAt(fromA,QueryType.ByPosNoHeight,oldDoc,0,0));fromB+=start.from-fromA;fromA=start.from;start=NodeBuilder.build(oracle,decorations,fromB,toB);me=me.replace(fromA,toA,start)}return me.updateHeight(oracle,
0)}static empty(){return new HeightMapText(0,0)}static of(nodes){if(1==nodes.length)return nodes[0];let i=0,j=nodes.length;var before=0;let after=0;for(;;)if(i==j)if(before>2*after){var split=nodes[i-1];split.break?nodes.splice(--i,1,split.left,null,split.right):nodes.splice(--i,1,split.left,split.right);j+=1+split.break;before-=split.size}else if(after>2*before)split=nodes[j],split.break?nodes.splice(j,1,split.left,null,split.right):nodes.splice(j,1,split.left,split.right),j+=2+split.break,after-=
split.size;else break;else before<after?(split=nodes[i++])&&(before+=split.size):(split=nodes[--j])&&(after+=split.size);before=0;null==nodes[i-1]?(before=1,i--):null==nodes[i]&&(before=1,j++);return new HeightMapBranch(HeightMap.of(nodes.slice(0,i)),before,HeightMap.of(nodes.slice(j)))}}HeightMap.prototype.size=1;class HeightMapBlock extends HeightMap{constructor(length,height,type){super(length,height);this.type=type}blockAt(_height,_doc,top,offset){return new BlockInfo(offset,this.length,top,this.height,
this.type)}lineAt(_value,_type,doc,top,offset){return this.blockAt(0,doc,top,offset)}forEachLine(from,to,doc,top,offset,f){from<=offset+this.length&&to>=offset&&f(this.blockAt(0,doc,top,offset))}updateHeight(oracle,offset=0,_force,measured){measured&&measured.from<=offset&&measured.more&&this.setHeight(oracle,measured.heights[measured.index++]);this.outdated=!1;return this}toString(){return`block(${this.length})`}}class HeightMapText extends HeightMapBlock{constructor(length,height){super(length,
height,exports.BlockType.Text);this.widgetHeight=this.collapsed=0}replace(_from,_to,nodes){_from=nodes[0];return 1==nodes.length&&(_from instanceof HeightMapText||_from instanceof HeightMapGap&&_from.flags&4)&&10>Math.abs(this.length-_from.length)?(_from instanceof HeightMapGap?_from=new HeightMapText(_from.length,this.height):_from.height=this.height,this.outdated||(_from.outdated=!1),_from):HeightMap.of(nodes)}updateHeight(oracle,offset=0,force=!1,measured){measured&&measured.from<=offset&&measured.more?
this.setHeight(oracle,measured.heights[measured.index++]):(force||this.outdated)&&this.setHeight(oracle,Math.max(this.widgetHeight,oracle.heightForLine(this.length-this.collapsed)));this.outdated=!1;return this}toString(){return`line(${this.length}${this.collapsed?-this.collapsed:""}${this.widgetHeight?":"+this.widgetHeight:""})`}}class HeightMapGap extends HeightMap{constructor(length){super(length,0)}lines(doc,offset){let firstLine=doc.lineAt(offset).number;doc=doc.lineAt(offset+this.length).number;
return{firstLine,lastLine:doc,lineHeight:this.height/(doc-firstLine+1)}}blockAt(height,doc,top,offset){let {firstLine,lastLine,lineHeight}=this.lines(doc,offset);height=Math.max(0,Math.min(lastLine-firstLine,Math.floor((height-top)/lineHeight)));let {from,length}=doc.line(firstLine+height);return new BlockInfo(from,length,top+lineHeight*height,lineHeight,exports.BlockType.Text)}lineAt(value,type,doc,top,offset){if(type==QueryType.ByHeight)return this.blockAt(value,doc,top,offset);if(type==QueryType.ByPosNoHeight){let {from,
to}=doc.lineAt(value);return new BlockInfo(from,to-from,0,0,exports.BlockType.Text)}let {firstLine,lineHeight}=this.lines(doc,offset),{from:from$jscomp$0,length,number}=doc.lineAt(value);return new BlockInfo(from$jscomp$0,length,top+lineHeight*(number-firstLine),lineHeight,exports.BlockType.Text)}forEachLine(from,to,doc,top,offset,f){let {firstLine,lineHeight}=this.lines(doc,offset);for(let pos=Math.max(from,offset),end=Math.min(offset+this.length,to);pos<=end;)to=doc.lineAt(pos),pos==from&&(top+=
lineHeight*(to.number-firstLine)),f(new BlockInfo(to.from,to.length,top,lineHeight,exports.BlockType.Text)),top+=lineHeight,pos=to.to+1}replace(from,to,nodes){to=this.length-to;if(0<to){let last=nodes[nodes.length-1];last instanceof HeightMapGap?nodes[nodes.length-1]=new HeightMapGap(last.length+to):nodes.push(null,new HeightMapGap(to-1))}0<from&&(to=nodes[0],to instanceof HeightMapGap?nodes[0]=new HeightMapGap(from+to.length):nodes.unshift(new HeightMapGap(from-1),null));return HeightMap.of(nodes)}decomposeLeft(to,
result){result.push(new HeightMapGap(to-1),null)}decomposeRight(from,result){result.push(null,new HeightMapGap(this.length-from-1))}updateHeight(oracle,offset=0,force=!1,measured){let end=offset+this.length;if(measured&&measured.from<=offset+this.length&&measured.more){let nodes=[],pos=Math.max(offset,measured.from);force=-1;let wasChanged=oracle.heightChanged;for(measured.from>offset&&nodes.push((new HeightMapGap(measured.from-offset-1)).updateHeight(oracle,offset));pos<=end&&measured.more;){let len=
oracle.doc.lineAt(pos).length;nodes.length&&nodes.push(null);var height=measured.heights[measured.index++];-1==force?force=height:.001<=Math.abs(height-force)&&(force=-2);height=new HeightMapText(len,height);height.outdated=!1;nodes.push(height);pos+=len+1}pos<=end&&nodes.push(null,(new HeightMapGap(end-pos)).updateHeight(oracle,pos));measured=HeightMap.of(nodes);oracle.heightChanged=wasChanged||0>force||.001<=Math.abs(measured.height-this.height)||.001<=Math.abs(force-this.lines(oracle.doc,offset).lineHeight);
return measured}if(force||this.outdated)this.setHeight(oracle,oracle.heightForGap(offset,offset+this.length)),this.outdated=!1;return this}toString(){return`gap(${this.length})`}}class HeightMapBranch extends HeightMap{constructor(left,brk,right){super(left.length+brk+right.length,left.height+right.height,brk|(left.outdated||right.outdated?2:0));this.left=left;this.right=right;this.size=left.size+right.size}get break(){return this.flags&1}blockAt(height,doc,top,offset){let mid=top+this.left.height;
return height<mid?this.left.blockAt(height,doc,top,offset):this.right.blockAt(height,doc,mid,offset+this.left.length+this.break)}lineAt(value,type,doc,top,offset){let rightTop=top+this.left.height,rightOffset=offset+this.left.length+this.break,left=type==QueryType.ByHeight?value<rightTop:value<rightOffset;value=left?this.left.lineAt(value,type,doc,top,offset):this.right.lineAt(value,type,doc,rightTop,rightOffset);if(this.break||(left?value.to<rightOffset:value.from>rightOffset))return value;type=
type==QueryType.ByPosNoHeight?QueryType.ByPosNoHeight:QueryType.ByPos;return left?value.join(this.right.lineAt(rightOffset,type,doc,rightTop,rightOffset)):this.left.lineAt(rightOffset,type,doc,top,offset).join(value)}forEachLine(from,to,doc,top,offset,f){let rightTop=top+this.left.height,rightOffset=offset+this.left.length+this.break;if(this.break)from<rightOffset&&this.left.forEachLine(from,to,doc,top,offset,f),to>=rightOffset&&this.right.forEachLine(from,to,doc,rightTop,rightOffset,f);else{let mid=
this.lineAt(rightOffset,QueryType.ByPos,doc,top,offset);from<mid.from&&this.left.forEachLine(from,mid.from-1,doc,top,offset,f);mid.to>=from&&mid.from<=to&&f(mid);to>mid.to&&this.right.forEachLine(mid.to+1,to,doc,rightTop,rightOffset,f)}}replace(from,to,nodes){var rightStart=this.left.length+this.break;if(to<rightStart)return this.balanced(this.left.replace(from,to,nodes),this.right);if(from>this.left.length)return this.balanced(this.left,this.right.replace(from-rightStart,to-rightStart,nodes));rightStart=
[];0<from&&this.decomposeLeft(from,rightStart);let left=rightStart.length;for(let node of nodes)rightStart.push(node);0<from&&mergeGaps(rightStart,left-1);to<this.length&&(from=rightStart.length,this.decomposeRight(to,rightStart),mergeGaps(rightStart,from));return HeightMap.of(rightStart)}decomposeLeft(to,result){let left=this.left.length;if(to<=left)return this.left.decomposeLeft(to,result);result.push(this.left);this.break&&(left++,to>=left&&result.push(null));to>left&&this.right.decomposeLeft(to-
left,result)}decomposeRight(from,result){let left=this.left.length,right=left+this.break;if(from>=right)return this.right.decomposeRight(from-right,result);from<left&&this.left.decomposeRight(from,result);this.break&&from<right&&result.push(null);result.push(this.right)}balanced(left,right){if(left.size>2*right.size||right.size>2*left.size)return HeightMap.of(this.break?[left,null,right]:[left,right]);this.left=left;this.right=right;this.height=left.height+right.height;this.outdated=left.outdated||
right.outdated;this.size=left.size+right.size;this.length=left.length+this.break+right.length;return this}updateHeight(oracle,offset=0,force=!1,measured){let {left,right}=this,rightStart=offset+left.length+this.break,rebalance=null;measured&&measured.from<=offset+left.length&&measured.more?rebalance=left=left.updateHeight(oracle,offset,force,measured):left.updateHeight(oracle,offset,force);measured&&measured.from<=rightStart+right.length&&measured.more?rebalance=right=right.updateHeight(oracle,rightStart,
force,measured):right.updateHeight(oracle,rightStart,force);if(rebalance)return this.balanced(left,right);this.height=this.left.height+this.right.height;this.outdated=!1;return this}toString(){return this.left+(this.break?" ":"-")+this.right}}class NodeBuilder{constructor(pos,oracle){this.pos=pos;this.oracle=oracle;this.nodes=[];this.lineEnd=this.lineStart=-1;this.covering=null;this.writtenTo=pos}get isCovered(){return this.covering&&this.nodes[this.nodes.length-1]==this.covering}span(_from,to){if(-1<
this.lineStart){_from=Math.min(to,this.lineEnd);let last=this.nodes[this.nodes.length-1];last instanceof HeightMapText?last.length+=_from-this.pos:(_from>this.pos||!this.isCovered)&&this.nodes.push(new HeightMapText(_from-this.pos,-1));this.writtenTo=_from;to>_from&&(this.nodes.push(null),this.writtenTo++,this.lineStart=-1)}this.pos=to}point(from,to,deco){if(from<to||deco.heightRelevant){let height=deco.widget?deco.widget.estimatedHeight:0;0>height&&(height=this.oracle.lineHeight);from=to-from;deco.block?
this.addBlock(new HeightMapBlock(from,height,deco.type)):(from||5<=height)&&this.addLineDeco(height,from)}else to>from&&this.span(from,to);-1<this.lineEnd&&this.lineEnd<this.pos&&(this.lineEnd=this.oracle.doc.lineAt(this.pos).to)}enterLine(){if(!(-1<this.lineStart)){var {from,to}=this.oracle.doc.lineAt(this.pos);this.lineStart=from;this.lineEnd=to;this.writtenTo<from&&((this.writtenTo<from-1||null==this.nodes[this.nodes.length-1])&&this.nodes.push(this.blankContent(this.writtenTo,from-1)),this.nodes.push(null));
this.pos>from&&this.nodes.push(new HeightMapText(this.pos-from,-1));this.writtenTo=this.pos}}blankContent(from,to){let gap=new HeightMapGap(to-from);this.oracle.doc.lineAt(from).to==to&&(gap.flags|=4);return gap}ensureLine(){this.enterLine();var last=this.nodes.length?this.nodes[this.nodes.length-1]:null;if(last instanceof HeightMapText)return last;last=new HeightMapText(0,-1);this.nodes.push(last);return last}addBlock(block){this.enterLine();block.type!=exports.BlockType.WidgetAfter||this.isCovered||
this.ensureLine();this.nodes.push(block);this.writtenTo=this.pos+=block.length;block.type!=exports.BlockType.WidgetBefore&&(this.covering=block)}addLineDeco(height,length){let line=this.ensureLine();line.length+=length;line.collapsed+=length;line.widgetHeight=Math.max(line.widgetHeight,height);this.writtenTo=this.pos+=length}finish(from){let last=0==this.nodes.length?null:this.nodes[this.nodes.length-1];!(-1<this.lineStart)||last instanceof HeightMapText||this.isCovered?(this.writtenTo<this.pos||
null==last)&&this.nodes.push(this.blankContent(this.writtenTo,this.pos)):this.nodes.push(new HeightMapText(0,-1));for(let node of this.nodes)node instanceof HeightMapText&&node.updateHeight(this.oracle,from),from+=node?node.length:1;return this.nodes}static build(oracle,decorations,from,to){oracle=new NodeBuilder(from,oracle);state$jscomp$0.RangeSet.spans(decorations,from,to,oracle,0);return oracle.finish(from)}}class DecorationComparator{constructor(){this.changes=[]}compareRange(){}comparePoint(from,
to,a,b){(from<to||a&&a.heightRelevant||b&&b.heightRelevant)&&addRange(from,to,this.changes,5)}}class LineGap{constructor(from,to,size){this.from=from;this.to=to;this.size=size}static same(a,b){if(a.length!=b.length)return!1;for(let i=0;i<a.length;i++){let gA=a[i],gB=b[i];if(gA.from!=gB.from||gA.to!=gB.to||gA.size!=gB.size)return!1}return!0}draw(wrapping){return Decoration.replace({widget:new LineGapWidget(this.size,wrapping)}).range(this.from,this.to)}}class LineGapWidget extends WidgetType{constructor(size,
vertical){super();this.size=size;this.vertical=vertical}eq(other){return other.size==this.size&&other.vertical==this.vertical}toDOM(){let elt=document.createElement("div");this.vertical?elt.style.height=this.size+"px":(elt.style.width=this.size+"px",elt.style.height="2px",elt.style.display="inline-block");return elt}get estimatedHeight(){return this.vertical?this.size:-1}}class ViewState{constructor(state$1){this.state=state$1;this.pixelViewport={left:0,right:window.innerWidth,top:0,bottom:0};this.inView=
!0;this.editorWidth=this.editorHeight=this.contentDOMHeight=this.contentDOMWidth=this.paddingBottom=this.paddingTop=0;this.heightOracle=new HeightOracle;this.scaler=IdScaler;this.scrollTarget=null;this.printing=!1;this.mustMeasureContent=!0;this.defaultTextDirection=exports.Direction.RTL;this.visibleRanges=[];this.mustEnforceCursorAssoc=!1;this.stateDeco=state$1.facet(decorations).filter(d=>"function"!=typeof d);this.heightMap=HeightMap.empty().applyChanges(this.stateDeco,state$jscomp$0.Text.empty,
this.heightOracle.setDoc(state$1.doc),[new ChangedRange(0,0,0,state$1.doc.length)]);this.viewport=this.getViewport(0,null);this.updateViewportLines();this.updateForViewport();this.lineGaps=this.ensureLineGaps([]);this.lineGapDeco=Decoration.set(this.lineGaps.map(gap=>gap.draw(!1)));this.computeVisibleRanges()}updateForViewport(){let viewports=[this.viewport],{main}=this.state.selection;for(let i=0;1>=i;i++){let pos=i?main.head:main.anchor;if(!viewports.some(({from,to})=>pos>=from&&pos<=to)){let {from,
to}=this.lineBlockAt(pos);viewports.push(new Viewport(from,to))}}this.viewports=viewports.sort((a,b)=>a.from-b.from);this.scaler=7E6>=this.heightMap.height?IdScaler:new BigScaler(this.heightOracle.doc,this.heightMap,this.viewports)}updateViewportLines(){this.viewportLines=[];this.heightMap.forEachLine(this.viewport.from,this.viewport.to,this.state.doc,0,0,block=>{this.viewportLines.push(1==this.scaler.scale?block:scaleBlock(block,this.scaler))})}update(update,scrollTarget=null){this.state=update.state;
var prevDeco=this.stateDeco;this.stateDeco=this.state.facet(decorations).filter(d=>"function"!=typeof d);prevDeco=ChangedRange.extendWithRanges(update.changedRanges,heightRelevantDecoChanges(prevDeco,this.stateDeco,update?update.changes:state$jscomp$0.ChangeSet.empty(this.state.doc.length)));var prevHeight=this.heightMap.height;this.heightMap=this.heightMap.applyChanges(this.stateDeco,update.startState.doc,this.heightOracle.setDoc(this.state.doc),prevDeco);this.heightMap.height!=prevHeight&&(update.flags|=
2);prevDeco=prevDeco.length?this.mapViewport(this.viewport,update.changes):this.viewport;if(scrollTarget&&(scrollTarget.range.head<prevDeco.from||scrollTarget.range.head>prevDeco.to)||!this.viewportIsAppropriate(prevDeco))prevDeco=this.getViewport(0,scrollTarget);prevHeight=!update.changes.empty||update.flags&2||prevDeco.from!=this.viewport.from||prevDeco.to!=this.viewport.to;this.viewport=prevDeco;this.updateForViewport();prevHeight&&this.updateViewportLines();(this.lineGaps.length||4E3<this.viewport.to-
this.viewport.from)&&this.updateLineGaps(this.ensureLineGaps(this.mapLineGaps(this.lineGaps,update.changes)));update.flags|=this.computeVisibleRanges();scrollTarget&&(this.scrollTarget=scrollTarget);!this.mustEnforceCursorAssoc&&update.selectionSet&&update.view.lineWrapping&&update.state.selection.main.empty&&update.state.selection.main.assoc&&(this.mustEnforceCursorAssoc=!0)}measure(view){var dom=view.contentDOM,style=window.getComputedStyle(dom),oracle=this.heightOracle,whiteSpace=style.whiteSpace;
this.defaultTextDirection="rtl"==style.direction?exports.Direction.RTL:exports.Direction.LTR;let refresh=this.heightOracle.mustRefreshForWrapping(whiteSpace);var measureContent=refresh||this.mustMeasureContent||this.contentDOMHeight!=dom.clientHeight;this.contentDOMHeight=dom.clientHeight;this.mustMeasureContent=!1;let result=0,bias=0;var paddingTop=parseInt(style.paddingTop)||0;style=parseInt(style.paddingBottom)||0;if(this.paddingTop!=paddingTop||this.paddingBottom!=style)this.paddingTop=paddingTop,
this.paddingBottom=style,result|=10;this.editorWidth!=view.scrollDOM.clientWidth&&(oracle.lineWrapping&&(measureContent=!0),this.editorWidth=view.scrollDOM.clientWidth,result|=8);var pixelViewport=(this.printing?fullPixelRange:visiblePixelRange)(dom,this.paddingTop);paddingTop=pixelViewport.top-this.pixelViewport.top;style=pixelViewport.bottom-this.pixelViewport.bottom;this.pixelViewport=pixelViewport;pixelViewport=this.pixelViewport.bottom>this.pixelViewport.top&&this.pixelViewport.right>this.pixelViewport.left;
pixelViewport!=this.inView&&(this.inView=pixelViewport)&&(measureContent=!0);if(!this.inView&&!this.scrollTarget)return 0;dom=dom.clientWidth;if(this.contentDOMWidth!=dom||this.editorHeight!=view.scrollDOM.clientHeight)this.contentDOMWidth=dom,this.editorHeight=view.scrollDOM.clientHeight,result|=8;if(measureContent){measureContent=view.docView.measureVisibleLineHeights(this.viewport);oracle.mustRefreshForHeights(measureContent)&&(refresh=!0);if(refresh||oracle.lineWrapping&&Math.abs(dom-this.contentDOMWidth)>
oracle.charWidth){let {lineHeight,charWidth}=view.docView.measureTextSize();if(refresh=oracle.refresh(whiteSpace,lineHeight,charWidth,dom/charWidth,measureContent))view.docView.minWidth=0,result|=8}0<paddingTop&&0<style?bias=Math.max(paddingTop,style):0>paddingTop&&0>style&&(bias=Math.min(paddingTop,style));oracle.heightChanged=!1;for(let vp of this.viewports)whiteSpace=vp.from==this.viewport.from?measureContent:view.docView.measureVisibleLineHeights(vp),this.heightMap=this.heightMap.updateHeight(oracle,
0,refresh,new MeasuredHeights(vp.from,whiteSpace));oracle.heightChanged&&(result|=2)}if(oracle=!this.viewportIsAppropriate(this.viewport,bias)||this.scrollTarget&&(this.scrollTarget.range.head<this.viewport.from||this.scrollTarget.range.head>this.viewport.to))this.viewport=this.getViewport(bias,this.scrollTarget);this.updateForViewport();(result&2||oracle)&&this.updateViewportLines();(this.lineGaps.length||4E3<this.viewport.to-this.viewport.from)&&this.updateLineGaps(this.ensureLineGaps(refresh?[]:
this.lineGaps));result|=this.computeVisibleRanges();this.mustEnforceCursorAssoc&&(this.mustEnforceCursorAssoc=!1,view.docView.enforceCursorAssoc());return result}get visibleTop(){return this.scaler.fromDOM(this.pixelViewport.top)}get visibleBottom(){return this.scaler.fromDOM(this.pixelViewport.bottom)}getViewport(bias,scrollTarget){var marginTop=.5-Math.max(-.5,Math.min(.5,bias/1E3/2));bias=this.heightMap;let doc=this.state.doc,{visibleTop,visibleBottom}=this,viewport=new Viewport(bias.lineAt(visibleTop-
1E3*marginTop,QueryType.ByHeight,doc,0,0).from,bias.lineAt(visibleBottom+1E3*(1-marginTop),QueryType.ByHeight,doc,0,0).to);if(scrollTarget){let {head}=scrollTarget.range;if(head<viewport.from||head>viewport.to){marginTop=Math.min(this.editorHeight,this.pixelViewport.bottom-this.pixelViewport.top);let block=bias.lineAt(head,QueryType.ByPos,doc,0,0);scrollTarget="center"==scrollTarget.y?(block.top+block.bottom)/2-marginTop/2:"start"==scrollTarget.y||"nearest"==scrollTarget.y&&head<viewport.from?block.top:
block.bottom-marginTop;viewport=new Viewport(bias.lineAt(scrollTarget-500,QueryType.ByHeight,doc,0,0).from,bias.lineAt(scrollTarget+marginTop+500,QueryType.ByHeight,doc,0,0).to)}}return viewport}mapViewport(viewport,changes){let from=changes.mapPos(viewport.from,-1);viewport=changes.mapPos(viewport.to,1);return new Viewport(this.heightMap.lineAt(from,QueryType.ByPos,this.state.doc,0,0).from,this.heightMap.lineAt(viewport,QueryType.ByPos,this.state.doc,0,0).to)}viewportIsAppropriate({from,to},bias=
0){if(!this.inView)return!0;let {top}=this.heightMap.lineAt(from,QueryType.ByPos,this.state.doc,0,0),{bottom}=this.heightMap.lineAt(to,QueryType.ByPos,this.state.doc,0,0),{visibleTop,visibleBottom}=this;return(0==from||top<=visibleTop-Math.max(10,Math.min(-bias,250)))&&(to==this.state.doc.length||bottom>=visibleBottom+Math.max(10,Math.min(bias,250)))&&top>visibleTop-2E3&&bottom<visibleBottom+2E3}mapLineGaps(gaps,changes){if(!gaps.length||changes.empty)return gaps;let mapped=[];for(let gap of gaps)changes.touchesRange(gap.from,
gap.to)||mapped.push(new LineGap(changes.mapPos(gap.from),changes.mapPos(gap.to),gap.size));return mapped}ensureLineGaps(current){let gaps=[];if(this.defaultTextDirection!=exports.Direction.LTR)return gaps;for(let line of this.viewportLines){if(4E3>line.length)continue;let structure=lineStructure(line.from,line.to,this.stateDeco);if(!(4E3>structure.total)){var viewFrom=void 0,viewTo=void 0;if(this.heightOracle.lineWrapping){var marginHeight=2E3/this.heightOracle.lineLength*this.heightOracle.lineHeight;
viewFrom=findPosition(structure,(this.visibleTop-line.top-marginHeight)/line.height);viewTo=findPosition(structure,(this.visibleBottom-line.top+marginHeight)/line.height)}else marginHeight=structure.total*this.heightOracle.charWidth,viewTo=2E3*this.heightOracle.charWidth,viewFrom=findPosition(structure,(this.pixelViewport.left-viewTo)/marginHeight),viewTo=findPosition(structure,(this.pixelViewport.right+viewTo)/marginHeight);marginHeight=[];viewFrom>line.from&&marginHeight.push({from:line.from,to:viewFrom});
viewTo<line.to&&marginHeight.push({from:viewTo,to:line.to});viewFrom=this.state.selection.main;viewFrom.from>=line.from&&viewFrom.from<=line.to&&cutRange(marginHeight,viewFrom.from-10,viewFrom.from+10);!viewFrom.empty&&viewFrom.to>=line.from&&viewFrom.to<=line.to&&cutRange(marginHeight,viewFrom.to-10,viewFrom.to+10);for(let {from,to}of marginHeight)1E3<to-from&&gaps.push(find(current,gap=>gap.from>=line.from&&gap.to<=line.to&&1E3>Math.abs(gap.from-from)&&1E3>Math.abs(gap.to-to))||new LineGap(from,
to,this.gapSize(line,from,to,structure)))}}return gaps}gapSize(line,from,to,structure){from=findFraction(structure,to)-findFraction(structure,from);return this.heightOracle.lineWrapping?line.height*from:structure.total*this.heightOracle.charWidth*from}updateLineGaps(gaps){LineGap.same(gaps,this.lineGaps)||(this.lineGaps=gaps,this.lineGapDeco=Decoration.set(gaps.map(gap=>gap.draw(this.heightOracle.lineWrapping))))}computeVisibleRanges(){var deco=this.stateDeco;this.lineGaps.length&&(deco=deco.concat(this.lineGapDeco));
let ranges=[];state$jscomp$0.RangeSet.spans(deco,this.viewport.from,this.viewport.to,{span(from,to){ranges.push({from,to})},point(){}},20);deco=ranges.length!=this.visibleRanges.length||this.visibleRanges.some((r,i)=>r.from!=ranges[i].from||r.to!=ranges[i].to);this.visibleRanges=ranges;return deco?4:0}lineBlockAt(pos){return pos>=this.viewport.from&&pos<=this.viewport.to&&this.viewportLines.find(b=>b.from<=pos&&b.to>=pos)||scaleBlock(this.heightMap.lineAt(pos,QueryType.ByPos,this.state.doc,0,0),this.scaler)}lineBlockAtHeight(height){return scaleBlock(this.heightMap.lineAt(this.scaler.fromDOM(height),
QueryType.ByHeight,this.state.doc,0,0),this.scaler)}elementAtHeight(height){return scaleBlock(this.heightMap.blockAt(this.scaler.fromDOM(height),this.state.doc,0,0),this.scaler)}get docHeight(){return this.scaler.toDOM(this.heightMap.height)}get contentHeight(){return this.docHeight+this.paddingTop+this.paddingBottom}}class Viewport{constructor(from,to){this.from=from;this.to=to}}const IdScaler={toDOM(n){return n},fromDOM(n){return n},scale:1};class BigScaler{constructor(doc,heightMap,viewports){let vpHeight=
0,base=0,domBase=0;this.viewports=viewports.map(({from,to})=>{let top=heightMap.lineAt(from,QueryType.ByPos,doc,0,0).top,bottom=heightMap.lineAt(to,QueryType.ByPos,doc,0,0).bottom;vpHeight+=bottom-top;return{from,to,top,bottom,domTop:0,domBottom:0}});this.scale=(7E6-vpHeight)/(heightMap.height-vpHeight);for(let obj of this.viewports)obj.domTop=domBase+(obj.top-base)*this.scale,domBase=obj.domBottom=obj.domTop+(obj.bottom-obj.top),base=obj.bottom}toDOM(n){for(let i=0,base=0,domBase=0;;i++){let vp=
i<this.viewports.length?this.viewports[i]:null;if(!vp||n<vp.top)return domBase+(n-base)*this.scale;if(n<=vp.bottom)return vp.domTop+(n-vp.top);base=vp.bottom;domBase=vp.domBottom}}fromDOM(n){for(let i=0,base=0,domBase=0;;i++){let vp=i<this.viewports.length?this.viewports[i]:null;if(!vp||n<vp.domTop)return base+(n-domBase)/this.scale;if(n<=vp.domBottom)return vp.top+(n-vp.domTop);base=vp.bottom;domBase=vp.domBottom}}}const theme=state$jscomp$0.Facet.define({combine:strs=>strs.join(" ")}),darkTheme=
state$jscomp$0.Facet.define({combine:values=>-1<values.indexOf(!0)}),baseThemeID=styleMod.StyleModule.newName(),baseLightID=styleMod.StyleModule.newName(),baseDarkID=styleMod.StyleModule.newName(),lightDarkIDs={"\x26light":"."+baseLightID,"\x26dark":"."+baseDarkID},baseTheme$1=buildTheme("."+baseThemeID,{"\x26.cm-editor":{position:"relative !important",boxSizing:"border-box","\x26.cm-focused":{outline:"1px dotted #212121"},display:"flex !important",flexDirection:"column"},".cm-scroller":{display:"flex !important",
alignItems:"flex-start !important",fontFamily:"monospace",lineHeight:1.4,height:"100%",overflowX:"auto",position:"relative",zIndex:0},".cm-content":{margin:0,flexGrow:2,flexShrink:0,minHeight:"100%",display:"block",whiteSpace:"pre",wordWrap:"normal",boxSizing:"border-box",padding:"4px 0",outline:"none","\x26[contenteditable\x3dtrue]":{WebkitUserModify:"read-write-plaintext-only"}},".cm-lineWrapping":{whiteSpace_fallback:"pre-wrap",whiteSpace:"break-spaces",wordBreak:"break-word",overflowWrap:"anywhere",
flexShrink:1},"\x26light .cm-content":{caretColor:"black"},"\x26dark .cm-content":{caretColor:"white"},".cm-line":{display:"block",padding:"0 2px 0 4px"},".cm-selectionLayer":{zIndex:-1,contain:"size style"},".cm-selectionBackground":{position:"absolute"},"\x26light .cm-selectionBackground":{background:"#d9d9d9"},"\x26dark .cm-selectionBackground":{background:"#222"},"\x26light.cm-focused .cm-selectionBackground":{background:"#d7d4f0"},"\x26dark.cm-focused .cm-selectionBackground":{background:"#233"},
".cm-cursorLayer":{zIndex:100,contain:"size style",pointerEvents:"none"},"\x26.cm-focused .cm-cursorLayer":{animation:"steps(1) cm-blink 1.2s infinite"},"@keyframes cm-blink":{"0%":{},"50%":{opacity:0},"100%":{}},"@keyframes cm-blink2":{"0%":{},"50%":{opacity:0},"100%":{}},".cm-cursor, .cm-dropCursor":{position:"absolute",borderLeft:"1.2px solid black",marginLeft:"-0.6px",pointerEvents:"none"},".cm-cursor":{display:"none"},"\x26dark .cm-cursor":{borderLeftColor:"#444"},"\x26.cm-focused .cm-cursor":{display:"block"},
"\x26light .cm-activeLine":{backgroundColor:"#cceeff44"},"\x26dark .cm-activeLine":{backgroundColor:"#99eeff33"},"\x26light .cm-specialChar":{color:"red"},"\x26dark .cm-specialChar":{color:"#f78"},".cm-gutters":{flexShrink:0,display:"flex",height:"100%",boxSizing:"border-box",left:0,zIndex:200},"\x26light .cm-gutters":{backgroundColor:"#f5f5f5",color:"#6c6c6c",borderRight:"1px solid #ddd"},"\x26dark .cm-gutters":{backgroundColor:"#333338",color:"#ccc"},".cm-gutter":{display:"flex !important",flexDirection:"column",
flexShrink:0,boxSizing:"border-box",minHeight:"100%",overflow:"hidden"},".cm-gutterElement":{boxSizing:"border-box"},".cm-lineNumbers .cm-gutterElement":{padding:"0 3px 0 5px",minWidth:"20px",textAlign:"right",whiteSpace:"nowrap"},"\x26light .cm-activeLineGutter":{backgroundColor:"#e2f2ff"},"\x26dark .cm-activeLineGutter":{backgroundColor:"#222227"},".cm-panels":{boxSizing:"border-box",position:"sticky",left:0,right:0},"\x26light .cm-panels":{backgroundColor:"#f5f5f5",color:"black"},"\x26light .cm-panels-top":{borderBottom:"1px solid #ddd"},
"\x26light .cm-panels-bottom":{borderTop:"1px solid #ddd"},"\x26dark .cm-panels":{backgroundColor:"#333338",color:"white"},".cm-tab":{display:"inline-block",overflow:"hidden",verticalAlign:"bottom"},".cm-widgetBuffer":{verticalAlign:"text-top",height:"1em",width:0,display:"inline"},".cm-placeholder":{color:"#888",display:"inline-block",verticalAlign:"top"},".cm-button":{verticalAlign:"middle",color:"inherit",fontSize:"70%",padding:".2em 1em",borderRadius:"1px"},"\x26light .cm-button":{backgroundImage:"linear-gradient(#eff1f5, #d9d9df)",
border:"1px solid #888","\x26:active":{backgroundImage:"linear-gradient(#b4b4b4, #d0d3d6)"}},"\x26dark .cm-button":{backgroundImage:"linear-gradient(#393939, #111)",border:"1px solid #888","\x26:active":{backgroundImage:"linear-gradient(#111, #333)"}},".cm-textfield":{verticalAlign:"middle",color:"inherit",fontSize:"70%",border:"1px solid silver",padding:".2em .5em"},"\x26light .cm-textfield":{backgroundColor:"white"},"\x26dark .cm-textfield":{border:"1px solid #555",backgroundColor:"inherit"}},lightDarkIDs),
observeOptions={childList:!0,characterData:!0,subtree:!0,attributes:!0,characterDataOldValue:!0},useCharData=browser.ie&&11>=browser.ie_version;class DOMObserver{constructor(view,onChange,onScrollChanged){this.view=view;this.onChange=onChange;this.onScrollChanged=onScrollChanged;this.active=!1;this.selectionRange=new DOMSelectionState;this.selectionChanged=!1;this.resizeTimeout=this.delayedFlush=-1;this.queue=[];this.delayedAndroidKey=null;this.lastChange=0;this.scrollTargets=[];this.resize=this.intersection=
null;this.intersecting=!1;this.gapIntersection=null;this.gaps=[];this.parentCheck=-1;this.dom=view.contentDOM;this.observer=new MutationObserver(mutations=>{for(let mut of mutations)this.queue.push(mut);(browser.ie&&11>=browser.ie_version||browser.ios&&view.composing)&&mutations.some(m=>"childList"==m.type&&m.removedNodes.length||"characterData"==m.type&&m.oldValue.length>m.target.nodeValue.length)?this.flushSoon():this.flush()});useCharData&&(this.onCharData=event=>{this.queue.push({target:event.target,
type:"characterData",oldValue:event.prevValue});this.flushSoon()});this.onSelectionChange=this.onSelectionChange.bind(this);this.onResize=this.onResize.bind(this);this.onPrint=this.onPrint.bind(this);this.onScroll=this.onScroll.bind(this);"function"==typeof ResizeObserver&&(this.resize=new ResizeObserver(()=>{if(this.view.docView.lastUpdate<Date.now()-75)this.onResize()}),this.resize.observe(view.scrollDOM));this.addWindowListeners(this.win=view.win);this.start();"function"==typeof IntersectionObserver&&
(this.intersection=new IntersectionObserver(entries=>{0>this.parentCheck&&(this.parentCheck=setTimeout(this.listenForScroll.bind(this),1E3));if(0<entries.length&&0<entries[entries.length-1].intersectionRatio!=this.intersecting&&(this.intersecting=!this.intersecting,this.intersecting!=this.view.inView))this.onScrollChanged(document.createEvent("Event"))},{}),this.intersection.observe(this.dom),this.gapIntersection=new IntersectionObserver(entries=>{if(0<entries.length&&0<entries[entries.length-1].intersectionRatio)this.onScrollChanged(document.createEvent("Event"))},
{}));this.listenForScroll();this.readSelectionRange()}onScroll(e){this.intersecting&&this.flush(!1);this.onScrollChanged(e)}onResize(){0>this.resizeTimeout&&(this.resizeTimeout=setTimeout(()=>{this.resizeTimeout=-1;this.view.requestMeasure()},50))}onPrint(){this.view.viewState.printing=!0;this.view.measure();setTimeout(()=>{this.view.viewState.printing=!1;this.view.requestMeasure()},500)}updateGaps(gaps){if(this.gapIntersection&&(gaps.length!=this.gaps.length||this.gaps.some((g,i)=>g!=gaps[i]))){this.gapIntersection.disconnect();
for(let gap of gaps)this.gapIntersection.observe(gap);this.gaps=gaps}}onSelectionChange(event){let wasChanged=this.selectionChanged;if(this.readSelectionRange()&&!this.delayedAndroidKey){var {view}=this,sel=this.selectionRange;if(view.state.facet(editable)?view.root.activeElement==this.dom:hasSelection(view.dom,sel)){var context=sel.anchorNode&&view.docView.nearest(sel.anchorNode);context&&context.ignoreEvent(event)?wasChanged||(this.selectionChanged=!1):(browser.ie&&11>=browser.ie_version||browser.android&&
browser.chrome)&&!view.state.selection.main.empty&&sel.focusNode&&isEquivalentPosition(sel.focusNode,sel.focusOffset,sel.anchorNode,sel.anchorOffset)?this.flushSoon():this.flush(!1)}}}readSelectionRange(){let {view}=this;var JSCompiler_temp;if(JSCompiler_temp=browser.safari&&11==view.root.nodeType){for(JSCompiler_temp=this.dom.ownerDocument.activeElement;JSCompiler_temp&&JSCompiler_temp.shadowRoot;)JSCompiler_temp=JSCompiler_temp.shadowRoot.activeElement;JSCompiler_temp=JSCompiler_temp==this.dom}JSCompiler_temp=
JSCompiler_temp&&safariSelectionRangeHack(this.view)||getSelection(view.root);if(!JSCompiler_temp||this.selectionRange.eq(JSCompiler_temp))return!1;let local=hasSelection(this.dom,JSCompiler_temp);var JSCompiler_temp$jscomp$0;if(JSCompiler_temp$jscomp$0=local&&!this.selectionChanged&&view.inputState.lastFocusTime>Date.now()-200&&view.inputState.lastTouchTime<Date.now()-300)a:{JSCompiler_temp$jscomp$0=this.dom;let node=JSCompiler_temp.focusNode,offset=JSCompiler_temp.focusOffset;if(node&&JSCompiler_temp.anchorNode==
node&&JSCompiler_temp.anchorOffset==offset)for(;;)if(offset){if(1!=node.nodeType){JSCompiler_temp$jscomp$0=!1;break a}let prev=node.childNodes[offset-1];"false"==prev.contentEditable?offset--:(node=prev,offset=maxOffset(node))}else if(node==JSCompiler_temp$jscomp$0){JSCompiler_temp$jscomp$0=!0;break a}else offset=domIndex(node),node=node.parentNode;else JSCompiler_temp$jscomp$0=!1}if(JSCompiler_temp$jscomp$0)return this.view.inputState.lastFocusTime=0,view.docView.updateSelection(),!1;this.selectionRange.setRange(JSCompiler_temp);
local&&(this.selectionChanged=!0);return!0}setSelectionRange(anchor,head){this.selectionRange.set(anchor.node,anchor.offset,head.node,head.offset);this.selectionChanged=!1}clearSelectionRange(){this.selectionRange.set(null,0,null,0)}listenForScroll(){this.parentCheck=-1;let i=0,changed=null;for(let dom=this.dom;dom;)if(1==dom.nodeType)!changed&&i<this.scrollTargets.length&&this.scrollTargets[i]==dom?i++:changed||(changed=this.scrollTargets.slice(0,i)),changed&&changed.push(dom),dom=dom.assignedSlot||
dom.parentNode;else if(11==dom.nodeType)dom=dom.host;else break;i<this.scrollTargets.length&&!changed&&(changed=this.scrollTargets.slice(0,i));if(changed){for(let dom of this.scrollTargets)dom.removeEventListener("scroll",this.onScroll);for(let dom of this.scrollTargets=changed)dom.addEventListener("scroll",this.onScroll)}}ignore(f){if(!this.active)return f();try{return this.stop(),f()}finally{this.start(),this.clear()}}start(){this.active||(this.observer.observe(this.dom,observeOptions),useCharData&&
this.dom.addEventListener("DOMCharacterDataModified",this.onCharData),this.active=!0)}stop(){this.active&&(this.active=!1,this.observer.disconnect(),useCharData&&this.dom.removeEventListener("DOMCharacterDataModified",this.onCharData))}clear(){this.processRecords();this.queue.length=0;this.selectionChanged=!1}delayAndroidKey(key$jscomp$0,keyCode){var _a;this.delayedAndroidKey||this.view.win.requestAnimationFrame(()=>{let key=this.delayedAndroidKey;this.delayedAndroidKey=null;this.delayedFlush=-1;
!this.flush()&&key.force&&dispatchKey(this.dom,key.key,key.keyCode)});this.delayedAndroidKey&&"Enter"!=key$jscomp$0||(this.delayedAndroidKey={key:key$jscomp$0,keyCode,force:this.lastChange<Date.now()-50||!(null===(_a=this.delayedAndroidKey)||void 0===_a||!_a.force)})}flushSoon(){0>this.delayedFlush&&(this.delayedFlush=this.view.win.requestAnimationFrame(()=>{this.delayedFlush=-1;this.flush()}))}forceFlush(){0<=this.delayedFlush&&(this.view.win.cancelAnimationFrame(this.delayedFlush),this.delayedFlush=
-1);this.flush()}processRecords(){var records=this.queue;for(var mut of this.observer.takeRecords())records.push(mut);records.length&&(this.queue=[]);let to=mut=-1,typeOver=!1;for(let record of records)if(records=this.readMutation(record))records.typeOver&&(typeOver=!0),-1==mut?{from:mut,to}=records:(mut=Math.min(records.from,mut),to=Math.max(records.to,to));return{from:mut,to,typeOver}}flush(readSelection=!0){if(0<=this.delayedFlush||this.delayedAndroidKey)return!1;readSelection&&this.readSelectionRange();
let {from,to,typeOver}=this.processRecords();readSelection=this.selectionChanged&&hasSelection(this.dom,this.selectionRange);if(0>from&&!readSelection)return!1;-1<from&&(this.lastChange=Date.now());this.view.inputState.lastFocusTime=0;this.selectionChanged=!1;readSelection=this.view.state;let handled=this.onChange(from,to,typeOver);this.view.state==readSelection&&this.view.update([]);return handled}readMutation(rec){let cView=this.view.docView.nearest(rec.target);if(!cView||cView.ignoreMutation(rec))return null;
cView.markDirty("attributes"==rec.type);"attributes"==rec.type&&(cView.dirty|=4);if("childList"==rec.type){let childBefore=findChild(cView,rec.previousSibling||rec.target.previousSibling,-1);rec=findChild(cView,rec.nextSibling||rec.target.nextSibling,1);return{from:childBefore?cView.posAfter(childBefore):cView.posAtStart,to:rec?cView.posBefore(rec):cView.posAtEnd,typeOver:!1}}return"characterData"==rec.type?{from:cView.posAtStart,to:cView.posAtEnd,typeOver:rec.target.nodeValue==rec.oldValue}:null}setWindow(win){win!=
this.win&&(this.removeWindowListeners(this.win),this.win=win,this.addWindowListeners(this.win))}addWindowListeners(win){win.addEventListener("resize",this.onResize);win.addEventListener("beforeprint",this.onPrint);win.addEventListener("scroll",this.onScroll);win.document.addEventListener("selectionchange",this.onSelectionChange)}removeWindowListeners(win){win.removeEventListener("scroll",this.onScroll);win.removeEventListener("resize",this.onResize);win.removeEventListener("beforeprint",this.onPrint);
win.document.removeEventListener("selectionchange",this.onSelectionChange)}destroy(){var _a,_b,_c;this.stop();null===(_a=this.intersection)||void 0===_a?void 0:_a.disconnect();null===(_b=this.gapIntersection)||void 0===_b?void 0:_b.disconnect();null===(_c=this.resize)||void 0===_c?void 0:_c.disconnect();for(let dom of this.scrollTargets)dom.removeEventListener("scroll",this.onScroll);this.removeWindowListeners(this.win);clearTimeout(this.parentCheck);clearTimeout(this.resizeTimeout)}}class EditorView{constructor(config=
{}){this.plugins=[];this.pluginMap=new Map;this.editorAttrs={};this.contentAttrs={};this.bidiCache=[];this.destroyed=!1;this.updateState=2;this.measureScheduled=-1;this.measureRequests=[];this.contentDOM=document.createElement("div");this.scrollDOM=document.createElement("div");this.scrollDOM.tabIndex=-1;this.scrollDOM.className="cm-scroller";this.scrollDOM.appendChild(this.contentDOM);this.announceDOM=document.createElement("div");this.announceDOM.style.cssText="position: absolute; top: -10000px";
this.announceDOM.setAttribute("aria-live","polite");this.dom=document.createElement("div");this.dom.appendChild(this.announceDOM);this.dom.appendChild(this.scrollDOM);this._dispatch=config.dispatch||(tr=>this.update([tr]));this.dispatch=this.dispatch.bind(this);this._root=config.root||getRoot(config.parent)||document;this.viewState=new ViewState(config.state||state$jscomp$0.EditorState.create(config));this.plugins=this.state.facet(viewPlugin).map(spec=>new PluginInstance(spec));for(let plugin of this.plugins)plugin.update(this);
this.observer=new DOMObserver(this,(from,to,typeOver)=>applyDOMChange(this,from,to,typeOver),event=>{this.inputState.runScrollHandlers(this,event);this.observer.intersecting&&this.measure()});this.inputState=new InputState(this);this.inputState.ensureHandlers(this,this.plugins);this.docView=new DocView(this);this.mountStyles();this.updateAttrs();this.updateState=0;this.requestMeasure();config.parent&&config.parent.appendChild(this.dom)}get state(){return this.viewState.state}get viewport(){return this.viewState.viewport}get visibleRanges(){return this.viewState.visibleRanges}get inView(){return this.viewState.inView}get composing(){return 0<
this.inputState.composing}get compositionStarted(){return 0<=this.inputState.composing}get root(){return this._root}get win(){return this.dom.ownerDocument.defaultView||window}dispatch(...input){this._dispatch(1==input.length&&input[0]instanceof state$jscomp$0.Transaction?input[0]:this.state.update(...input))}update(transactions){if(0!=this.updateState)throw Error("Calls to EditorView.update are not allowed while an update is in progress");let redrawn=!1,attrsChanged=!1;var update=this.state;for(var tr$jscomp$0 of transactions){if(tr$jscomp$0.startState!=
update)throw new RangeError("Trying to update state with a transaction that doesn't start from the previous state.");update=tr$jscomp$0.state}if(this.destroyed)this.viewState.state=update;else{this.observer.clear();if(update.facet(state$jscomp$0.EditorState.phrases)!=this.state.facet(state$jscomp$0.EditorState.phrases))return this.setState(update);update=ViewUpdate.create(this,update,transactions);tr$jscomp$0=this.viewState.scrollTarget;try{this.updateState=2;for(let tr of transactions){tr$jscomp$0&&
(tr$jscomp$0=tr$jscomp$0.map(tr.changes));if(tr.scrollIntoView){let {main}=tr.state.selection;tr$jscomp$0=new ScrollTarget(main.empty?main:state$jscomp$0.EditorSelection.cursor(main.head,main.head>main.anchor?-1:1))}for(let e of tr.effects)e.is(scrollIntoView)&&(tr$jscomp$0=e.value)}this.viewState.update(update,tr$jscomp$0);this.bidiCache=CachedOrder.update(this.bidiCache,update.changes);update.empty||(this.updatePlugins(update),this.inputState.update(update));redrawn=this.docView.update(update);
this.state.facet(styleModule)!=this.styleModules&&this.mountStyles();attrsChanged=this.updateAttrs();this.showAnnouncements(transactions);this.docView.updateSelection(redrawn,transactions.some(tr=>tr.isUserEvent("select.pointer")))}finally{this.updateState=0}update.startState.facet(theme)!=update.state.facet(theme)&&(this.viewState.mustMeasureContent=!0);(redrawn||attrsChanged||tr$jscomp$0||this.viewState.mustEnforceCursorAssoc||this.viewState.mustMeasureContent)&&this.requestMeasure();if(!update.empty)for(let listener of this.state.facet(updateListener))listener(update)}}setState(newState){if(0!=
this.updateState)throw Error("Calls to EditorView.setState are not allowed while an update is in progress");if(this.destroyed)this.viewState.state=newState;else{this.updateState=2;var hadFocus=this.hasFocus;try{for(let plugin of this.plugins)plugin.destroy(this);this.viewState=new ViewState(newState);this.plugins=newState.facet(viewPlugin).map(spec=>new PluginInstance(spec));this.pluginMap.clear();for(let plugin of this.plugins)plugin.update(this);this.docView=new DocView(this);this.inputState.ensureHandlers(this,
this.plugins);this.mountStyles();this.updateAttrs();this.bidiCache=[]}finally{this.updateState=0}hadFocus&&this.focus();this.requestMeasure()}}updatePlugins(update){let prevSpecs=update.startState.facet(viewPlugin);var specs=update.state.facet(viewPlugin);if(prevSpecs!=specs){var newPlugins=[];for(let spec of specs)specs=prevSpecs.indexOf(spec),0>specs?newPlugins.push(new PluginInstance(spec)):(specs=this.plugins[specs],specs.mustUpdate=update,newPlugins.push(specs));for(let plugin of this.plugins)plugin.mustUpdate!=
update&&plugin.destroy(this);this.plugins=newPlugins;this.pluginMap.clear();this.inputState.ensureHandlers(this,this.plugins)}else for(newPlugins of this.plugins)newPlugins.mustUpdate=update;for(update=0;update<this.plugins.length;update++)this.plugins[update].update(this)}measure(flush=!0){if(!this.destroyed){-1<this.measureScheduled&&cancelAnimationFrame(this.measureScheduled);this.measureScheduled=0;flush&&this.observer.forceFlush();flush=null;var {scrollHeight,scrollTop,clientHeight}=this.scrollDOM,
refHeight=scrollTop>scrollHeight-clientHeight-4?scrollHeight:scrollTop;try{for(let i$jscomp$0=0;;i$jscomp$0++){this.updateState=1;let oldViewport=this.viewport,refBlock=this.viewState.lineBlockAtHeight(refHeight),changed=this.viewState.measure(this);if(!changed&&!this.measureRequests.length&&null==this.viewState.scrollTarget)break;if(5<i$jscomp$0){console.warn(this.measureRequests.length?"Measure loop restarted more than 5 times":"Viewport failed to stabilize");break}let measuring=[];changed&4||([this.measureRequests,
measuring]=[measuring,this.measureRequests]);let measured=measuring.map(m=>{try{return m.read(this)}catch(e){return logException(this.state,e),BadMeasure}}),update=ViewUpdate.create(this,this.state,[]),redrawn=!1,scrolled=!1;update.flags|=changed;flush?flush.flags|=changed:flush=update;this.updateState=2;update.empty||(this.updatePlugins(update),this.inputState.update(update),this.updateAttrs(),redrawn=this.docView.update(update));for(let i=0;i<measuring.length;i++)if(measured[i]!=BadMeasure)try{let m=
measuring[i];m.write&&m.write(measured[i],this)}catch(e){logException(this.state,e)}if(this.viewState.scrollTarget)this.docView.scrollIntoView(this.viewState.scrollTarget),this.viewState.scrollTarget=null,scrolled=!0;else{let diff=this.viewState.lineBlockAt(refBlock.from).top-refBlock.top;if(1<diff||-1>diff)this.scrollDOM.scrollTop+=diff,scrolled=!0}redrawn&&this.docView.updateSelection(!0);if(this.viewport.from==oldViewport.from&&this.viewport.to==oldViewport.to&&!scrolled&&0==this.measureRequests.length)break}}finally{this.updateState=
0,this.measureScheduled=-1}if(flush&&!flush.empty)for(let listener of this.state.facet(updateListener))listener(flush)}}get themeClasses(){return baseThemeID+" "+(this.state.facet(darkTheme)?baseDarkID:baseLightID)+" "+this.state.facet(theme)}updateAttrs(){let editorAttrs=attrsFromFacet(this,editorAttributes,{class:"cm-editor"+(this.hasFocus?" cm-focused ":" ")+this.themeClasses}),contentAttrs={spellcheck:"false",autocorrect:"off",autocapitalize:"off",translate:"no",contenteditable:this.state.facet(editable)?
"true":"false",class:"cm-content",style:`${browser.tabSize}: ${this.state.tabSize}`,role:"textbox","aria-multiline":"true"};this.state.readOnly&&(contentAttrs["aria-readonly"]="true");attrsFromFacet(this,contentAttributes,contentAttrs);let changed=this.observer.ignore(()=>{let changedContent=updateAttrs(this.contentDOM,this.contentAttrs,contentAttrs),changedEditor=updateAttrs(this.dom,this.editorAttrs,editorAttrs);return changedContent||changedEditor});this.editorAttrs=editorAttrs;this.contentAttrs=
contentAttrs;return changed}showAnnouncements(trs){let first=!0;for(let tr of trs)for(let effect of tr.effects)effect.is(EditorView.announce)&&(first&&(this.announceDOM.textContent=""),first=!1,this.announceDOM.appendChild(document.createElement("div")).textContent=effect.value)}mountStyles(){this.styleModules=this.state.facet(styleModule);styleMod.StyleModule.mount(this.root,this.styleModules.concat(baseTheme$1).reverse())}readMeasured(){if(2==this.updateState)throw Error("Reading the editor layout isn't allowed during an update");
0==this.updateState&&-1<this.measureScheduled&&this.measure(!1)}requestMeasure(request){0>this.measureScheduled&&(this.measureScheduled=this.win.requestAnimationFrame(()=>this.measure()));if(request){if(null!=request.key)for(let i=0;i<this.measureRequests.length;i++)if(this.measureRequests[i].key===request.key){this.measureRequests[i]=request;return}this.measureRequests.push(request)}}plugin(plugin){let known=this.pluginMap.get(plugin);(void 0===known||known&&known.spec!=plugin)&&this.pluginMap.set(plugin,
known=this.plugins.find(p=>p.spec==plugin)||null);return known&&known.update(this).value}get documentTop(){return this.contentDOM.getBoundingClientRect().top+this.viewState.paddingTop}get documentPadding(){return{top:this.viewState.paddingTop,bottom:this.viewState.paddingBottom}}elementAtHeight(height){this.readMeasured();return this.viewState.elementAtHeight(height)}lineBlockAtHeight(height){this.readMeasured();return this.viewState.lineBlockAtHeight(height)}get viewportLineBlocks(){return this.viewState.viewportLines}lineBlockAt(pos){return this.viewState.lineBlockAt(pos)}get contentHeight(){return this.viewState.contentHeight}moveByChar(start,
forward,by){return skipAtoms(this,start,moveByChar(this,start,forward,by))}moveByGroup(start,forward){return skipAtoms(this,start,moveByChar(this,start,forward,initial=>byGroup(this,start.head,initial)))}moveToLineBoundary(start,forward,includeWrap=!0){a:{let line=this.state.doc.lineAt(start.head);if(includeWrap=includeWrap&&this.lineWrapping?this.coordsAtPos(0>start.assoc&&start.head>line.from?start.head-1:start.head):null){let editorRect=this.dom.getBoundingClientRect(),direction=this.textDirectionAt(line.from);
includeWrap=this.posAtCoords({x:forward==(direction==exports.Direction.LTR)?editorRect.right-1:editorRect.left+1,y:(includeWrap.top+includeWrap.bottom)/2});if(null!=includeWrap){forward=state$jscomp$0.EditorSelection.cursor(includeWrap,forward?-1:1);break a}}start=LineView.find(this.docView,start.head);forward=state$jscomp$0.EditorSelection.cursor(start?forward?start.posAtEnd:start.posAtStart:forward?line.to:line.from,forward?-1:1)}return forward}moveVertically(start,forward,distance){a:{var JSCompiler_inline_result=
start.head;let dir=forward?1:-1;if(JSCompiler_inline_result==(forward?this.state.doc.length:0))JSCompiler_inline_result=state$jscomp$0.EditorSelection.cursor(JSCompiler_inline_result,start.assoc);else{forward=start.goalColumn;var rect=this.contentDOM.getBoundingClientRect(),startCoords=this.coordsAtPos(JSCompiler_inline_result);var startY=this.documentTop;startCoords?(null==forward&&(forward=startCoords.left-rect.left),startY=0>dir?startCoords.top:startCoords.bottom):(startCoords=this.viewState.lineBlockAt(JSCompiler_inline_result),
null==forward&&(forward=Math.min(rect.right-rect.left,this.defaultCharacterWidth*(JSCompiler_inline_result-startCoords.from))),startY=(0>dir?startCoords.top:startCoords.bottom)+startY);startCoords=rect.left+forward;distance=null!==distance&&void 0!==distance?distance:this.defaultLineHeight>>1;for(let extra=0;;extra+=10){let curY=startY+(distance+extra)*dir,pos=posAtCoords(this,{x:startCoords,y:curY},!1,dir);if(curY<rect.top||curY>rect.bottom||(0>dir?pos<JSCompiler_inline_result:pos>JSCompiler_inline_result)){JSCompiler_inline_result=
state$jscomp$0.EditorSelection.cursor(pos,start.assoc,void 0,forward);break a}}}}return skipAtoms(this,start,JSCompiler_inline_result)}domAtPos(pos){return this.docView.domAtPos(pos)}posAtDOM(node,offset=0){return this.docView.posFromDOM(node,offset)}posAtCoords(coords,precise=!0){this.readMeasured();return posAtCoords(this,coords,precise)}coordsAtPos(pos,side=1){this.readMeasured();let rect=this.docView.coordsAt(pos,side);if(!rect||rect.left==rect.right)return rect;let line=this.state.doc.lineAt(pos),
order=this.bidiSpans(line);pos=order[BidiSpan.find(order,pos-line.from,-1,side)];return flattenRect(rect,pos.dir==exports.Direction.LTR==0<side)}get defaultCharacterWidth(){return this.viewState.heightOracle.charWidth}get defaultLineHeight(){return this.viewState.heightOracle.lineHeight}get textDirection(){return this.viewState.defaultTextDirection}textDirectionAt(pos){if(!this.state.facet(perLineTextDirection)||pos<this.viewport.from||pos>this.viewport.to)return this.textDirection;this.readMeasured();
return this.docView.textDirectionAt(pos)}get lineWrapping(){return this.viewState.heightOracle.lineWrapping}bidiSpans(line){if(4096<line.length)return[new BidiSpan(0,line.length,0)];let dir=this.textDirectionAt(line.from);for(var entry of this.bidiCache)if(entry.from==line.from&&entry.dir==dir)return entry.order;entry=computeOrder(line.text,dir);this.bidiCache.push(new CachedOrder(line.from,line.to,dir,entry));return entry}get hasFocus(){var _a;return(this.dom.ownerDocument.hasFocus()||browser.safari&&
(null===(_a=this.inputState)||void 0===_a?void 0:_a.lastContextMenu)>Date.now()-3E4)&&this.root.activeElement==this.contentDOM}focus(){this.observer.ignore(()=>{focusPreventScroll(this.contentDOM);this.docView.updateSelection()})}setRoot(root){this._root!=root&&(this._root=root,this.observer.setWindow((9==root.nodeType?root:root.ownerDocument).defaultView),this.mountStyles())}destroy(){for(let plugin of this.plugins)plugin.destroy(this);this.plugins=[];this.inputState.destroy();this.dom.remove();
this.observer.destroy();-1<this.measureScheduled&&cancelAnimationFrame(this.measureScheduled);this.destroyed=!0}static scrollIntoView(pos,options={}){return scrollIntoView.of(new ScrollTarget("number"==typeof pos?state$jscomp$0.EditorSelection.cursor(pos):pos,options.y,options.x,options.yMargin,options.xMargin))}static domEventHandlers(handlers){return ViewPlugin.define(()=>({}),{eventHandlers:handlers})}static theme(spec,options){let prefix=styleMod.StyleModule.newName();spec=[theme.of(prefix),styleModule.of(buildTheme(`.${prefix}`,
spec))];options&&options.dark&&spec.push(darkTheme.of(!0));return spec}static baseTheme(spec){return state$jscomp$0.Prec.lowest(styleModule.of(buildTheme("."+baseThemeID,spec,lightDarkIDs)))}static findFromDOM(dom){var _a;let content=dom.querySelector(".cm-content");dom=content&&ContentView.get(content)||ContentView.get(dom);return(null===(_a=null===dom||void 0===dom?void 0:dom.rootView)||void 0===_a?void 0:_a.view)||null}}EditorView.styleModule=styleModule;EditorView.inputHandler=inputHandler;EditorView.perLineTextDirection=
perLineTextDirection;EditorView.exceptionSink=exceptionSink;EditorView.updateListener=updateListener;EditorView.editable=editable;EditorView.mouseSelectionStyle=mouseSelectionStyle;EditorView.dragMovesSelection=dragMovesSelection$1;EditorView.clickAddsSelectionRange=clickAddsSelectionRange;EditorView.decorations=decorations;EditorView.atomicRanges=atomicRanges;EditorView.scrollMargins=scrollMargins;EditorView.darkTheme=darkTheme;EditorView.contentAttributes=contentAttributes;EditorView.editorAttributes=
editorAttributes;EditorView.lineWrapping=EditorView.contentAttributes.of({"class":"cm-lineWrapping"});EditorView.announce=state$jscomp$0.StateEffect.define();const BadMeasure={};class CachedOrder{constructor(from,to,dir,order){this.from=from;this.to=to;this.dir=dir;this.order=order}static update(cache,changes){if(changes.empty)return cache;let result=[],lastDir=cache.length?cache[cache.length-1].dir:exports.Direction.LTR;for(let i=Math.max(0,cache.length-10);i<cache.length;i++){let entry=cache[i];
entry.dir!=lastDir||changes.touchesRange(entry.from,entry.to)||result.push(new CachedOrder(changes.mapPos(entry.from,1),changes.mapPos(entry.to,-1),entry.dir,entry.order))}return result}}const currentPlatform=browser.mac?"mac":browser.windows?"win":browser.linux?"linux":"key",handleKeyEvents=state$jscomp$0.Prec.default(EditorView.domEventHandlers({keydown(event,view){return runHandlers(getKeymap(view.state),event,view,"editor")}})),keymap=state$jscomp$0.Facet.define({enables:handleKeyEvents}),Keymaps=
new WeakMap;let storedPrefix=null;const CanHidePrimary=!browser.ios,selectionConfig=state$jscomp$0.Facet.define({combine(configs){return state$jscomp$0.combineConfig(configs,{cursorBlinkRate:1200,drawRangeCursor:!0},{cursorBlinkRate:(a,b)=>Math.min(a,b),drawRangeCursor:(a,b)=>a||b})}});class Piece{constructor(left,top,width,height,className){this.left=left;this.top=top;this.width=width;this.height=height;this.className=className}draw(){let elt=document.createElement("div");elt.className=this.className;
this.adjust(elt);return elt}adjust(elt){elt.style.left=this.left+"px";elt.style.top=this.top+"px";0<=this.width&&(elt.style.width=this.width+"px");elt.style.height=this.height+"px"}eq(p){return this.left==p.left&&this.top==p.top&&this.width==p.width&&this.height==p.height&&this.className==p.className}}const drawSelectionPlugin=ViewPlugin.fromClass(class{constructor(view){this.view=view;this.rangePieces=[];this.cursors=[];this.measureReq={read:this.readPos.bind(this),write:this.drawSel.bind(this)};
this.selectionLayer=view.scrollDOM.appendChild(document.createElement("div"));this.selectionLayer.className="cm-selectionLayer";this.selectionLayer.setAttribute("aria-hidden","true");this.cursorLayer=view.scrollDOM.appendChild(document.createElement("div"));this.cursorLayer.className="cm-cursorLayer";this.cursorLayer.setAttribute("aria-hidden","true");view.requestMeasure(this.measureReq);this.setBlinkRate()}setBlinkRate(){this.cursorLayer.style.animationDuration=this.view.state.facet(selectionConfig).cursorBlinkRate+
"ms"}update(update){let confChanged=update.startState.facet(selectionConfig)!=update.state.facet(selectionConfig);(confChanged||update.selectionSet||update.geometryChanged||update.viewportChanged)&&this.view.requestMeasure(this.measureReq);update.transactions.some(tr=>tr.scrollIntoView)&&(this.cursorLayer.style.animationName="cm-blink"==this.cursorLayer.style.animationName?"cm-blink2":"cm-blink");confChanged&&this.setBlinkRate()}readPos(){let {state}=this.view,conf=state.facet(selectionConfig),rangePieces=
state.selection.ranges.map(r=>r.empty?[]:measureRange(this.view,r)).reduce((a,b)=>a.concat(b)),cursors=[];for(let r of state.selection.ranges){var prim=r==state.selection.main;(r.empty?!prim||CanHidePrimary:conf.drawRangeCursor)&&(prim=measureCursor(this.view,r,prim))&&cursors.push(prim)}return{rangePieces,cursors}}drawSel({rangePieces,cursors}){if(rangePieces.length!=this.rangePieces.length||rangePieces.some((p,i)=>!p.eq(this.rangePieces[i]))){this.selectionLayer.textContent="";for(let p of rangePieces)this.selectionLayer.appendChild(p.draw());
this.rangePieces=rangePieces}if(cursors.length!=this.cursors.length||cursors.some((c,i)=>!c.eq(this.cursors[i]))){let oldCursors=this.cursorLayer.children;if(oldCursors.length!==cursors.length){this.cursorLayer.textContent="";for(const c of cursors)this.cursorLayer.appendChild(c.draw())}else cursors.forEach((c,idx)=>c.adjust(oldCursors[idx]));this.cursors=cursors}}destroy(){this.selectionLayer.remove();this.cursorLayer.remove()}}),themeSpec={".cm-line":{"\x26 ::selection":{backgroundColor:"transparent !important"},
"\x26::selection":{backgroundColor:"transparent !important"}}};CanHidePrimary&&(themeSpec[".cm-line"].caretColor="transparent !important");const hideNativeSelection=state$jscomp$0.Prec.highest(EditorView.theme(themeSpec)),setDropCursorPos=state$jscomp$0.StateEffect.define({map(pos,mapping){return null==pos?null:mapping.mapPos(pos)}}),dropCursorPos=state$jscomp$0.StateField.define({create(){return null},update(pos$jscomp$0,tr){null!=pos$jscomp$0&&(pos$jscomp$0=tr.changes.mapPos(pos$jscomp$0));return tr.effects.reduce((pos,
e)=>e.is(setDropCursorPos)?e.value:pos,pos$jscomp$0)}}),drawDropCursor=ViewPlugin.fromClass(class{constructor(view){this.view=view;this.cursor=null;this.measureReq={read:this.readPos.bind(this),write:this.drawCursor.bind(this)}}update(update){var _a;let cursorPos=update.state.field(dropCursorPos);null==cursorPos?null!=this.cursor&&(null===(_a=this.cursor)||void 0===_a?void 0:_a.remove(),this.cursor=null):(this.cursor||(this.cursor=this.view.scrollDOM.appendChild(document.createElement("div")),this.cursor.className=
"cm-dropCursor"),(update.startState.field(dropCursorPos)!=cursorPos||update.docChanged||update.geometryChanged)&&this.view.requestMeasure(this.measureReq))}readPos(){var pos=this.view.state.field(dropCursorPos);pos=null!=pos&&this.view.coordsAtPos(pos);if(!pos)return null;let outer=this.view.scrollDOM.getBoundingClientRect();return{left:pos.left-outer.left+this.view.scrollDOM.scrollLeft,top:pos.top-outer.top+this.view.scrollDOM.scrollTop,height:pos.bottom-pos.top}}drawCursor(pos){this.cursor&&(pos?
(this.cursor.style.left=pos.left+"px",this.cursor.style.top=pos.top+"px",this.cursor.style.height=pos.height+"px"):this.cursor.style.left="-100000px")}destroy(){this.cursor&&this.cursor.remove()}setDropPos(pos){this.view.state.field(dropCursorPos)!=pos&&this.view.dispatch({effects:setDropCursorPos.of(pos)})}},{eventHandlers:{dragover(event){this.setDropPos(this.view.posAtCoords({x:event.clientX,y:event.clientY}))},dragleave(event){event.target!=this.view.contentDOM&&this.view.contentDOM.contains(event.relatedTarget)||
this.setDropPos(null)},dragend(){this.setDropPos(null)},drop(){this.setDropPos(null)}}});class MatchDecorator{constructor(config){const {regexp,decoration,decorate,boundary,maxLength=1E3}=config;if(!regexp.global)throw new RangeError("The regular expression given to MatchDecorator should have its 'g' flag set");this.regexp=regexp;if(decorate)this.addMatch=(match,view,from,add)=>decorate(add,from,from+match[0].length,match,view);else if("function"==typeof decoration)this.addMatch=(match,view,from,
add)=>{(view=decoration(match,view,from))&&add(from,from+match[0].length,view)};else if(decoration)this.addMatch=(match,_view,from,add)=>add(from,from+match[0].length,decoration);else throw new RangeError("Either 'decorate' or 'decoration' should be provided to MatchDecorator");this.boundary=boundary;this.maxLength=maxLength}createDeco(view){let build=new state$jscomp$0.RangeSetBuilder,add=build.add.bind(build);for(let {from:from$jscomp$0,to}of matchRanges(view,this.maxLength))iterMatches(view.state.doc,
this.regexp,from$jscomp$0,to,(from,m)=>this.addMatch(m,view,from,add));return build.finish()}updateDeco(update,deco){let changeFrom=1E9,changeTo=-1;update.docChanged&&update.changes.iterChanges((_f,_t,from,to)=>{to>update.view.viewport.from&&from<update.view.viewport.to&&(changeFrom=Math.min(from,changeFrom),changeTo=Math.max(to,changeTo))});return update.viewportChanged||1E3<changeTo-changeFrom?this.createDeco(update.view):-1<changeTo?this.updateRange(update.view,deco.map(update.changes),changeFrom,
changeTo):deco}updateRange(view,deco$jscomp$0,updateFrom,updateTo){for(let r of view.visibleRanges){let from$jscomp$0=Math.max(r.from,updateFrom),to$jscomp$0=Math.min(r.to,updateTo);if(to$jscomp$0>from$jscomp$0){let fromLine=view.state.doc.lineAt(from$jscomp$0),toLine=fromLine.to<to$jscomp$0?view.state.doc.lineAt(to$jscomp$0):fromLine,start=Math.max(r.from,fromLine.from),end=Math.min(r.to,toLine.to);if(this.boundary){for(;from$jscomp$0>fromLine.from;from$jscomp$0--)if(this.boundary.test(fromLine.text[from$jscomp$0-
1-fromLine.from])){start=from$jscomp$0;break}for(;to$jscomp$0<toLine.to;to$jscomp$0++)if(this.boundary.test(toLine.text[to$jscomp$0-toLine.from])){end=to$jscomp$0;break}}let ranges=[],m$jscomp$0,add=(from,to,deco)=>ranges.push(deco.range(from,to));if(fromLine==toLine)for(this.regexp.lastIndex=start-fromLine.from;(m$jscomp$0=this.regexp.exec(fromLine.text))&&m$jscomp$0.index<end-fromLine.from;)this.addMatch(m$jscomp$0,view,m$jscomp$0.index+fromLine.from,add);else iterMatches(view.state.doc,this.regexp,
start,end,(from,m)=>this.addMatch(m,view,from,add));deco$jscomp$0=deco$jscomp$0.update({filterFrom:start,filterTo:end,filter:(from,to)=>from<start||to>end,add:ranges})}}return deco$jscomp$0}}const UnicodeRegexpSupport=null!=/x/.unicode?"gu":"g",Specials=RegExp("[\x00-\b\n--­؜​‎‏\u2028\u2029‭‮⁦⁧⁩﻿￹-￼]",UnicodeRegexpSupport),Names={0:"null",7:"bell",8:"backspace",10:"newline",11:"vertical tab",13:"carriage return",27:"escape",8203:"zero width space",8204:"zero width non-joiner",8205:"zero width joiner",
8206:"left-to-right mark",8207:"right-to-left mark",8232:"line separator",8237:"left-to-right override",8238:"right-to-left override",8294:"left-to-right isolate",8295:"right-to-left isolate",8297:"pop directional isolate",8233:"paragraph separator",65279:"zero width no-break space",65532:"object replacement"};let _supportsTabSize=null;const specialCharConfig=state$jscomp$0.Facet.define({combine(configs){configs=state$jscomp$0.combineConfig(configs,{render:null,specialChars:Specials,addSpecialChars:null});
var _a;if(null==_supportsTabSize&&"undefined"!=typeof document&&document.body){let styles=document.body.style;_supportsTabSize=null!=(null!==(_a=styles.tabSize)&&void 0!==_a?_a:styles.MozTabSize)}if(configs.replaceTabs=!_supportsTabSize)configs.specialChars=new RegExp("\t|"+configs.specialChars.source,UnicodeRegexpSupport);configs.addSpecialChars&&(configs.specialChars=new RegExp(configs.specialChars.source+"|"+configs.addSpecialChars.source,UnicodeRegexpSupport));return configs}});let _plugin=null;
class SpecialCharWidget extends WidgetType{constructor(options,code){super();this.options=options;this.code=code}eq(other){return other.code==this.code}toDOM(view){var JSCompiler_inline_result=this.code;JSCompiler_inline_result=32<=JSCompiler_inline_result?"•":10==JSCompiler_inline_result?"␤":String.fromCharCode(9216+JSCompiler_inline_result);view=view.state.phrase("Control character")+" "+(Names[this.code]||"0x"+this.code.toString(16));var custom=this.options.render&&this.options.render(this.code,
view,JSCompiler_inline_result);if(custom)return custom;custom=document.createElement("span");custom.textContent=JSCompiler_inline_result;custom.title=view;custom.setAttribute("aria-label",view);custom.className="cm-specialChar";return custom}ignoreEvent(){return!1}}class TabWidget extends WidgetType{constructor(width){super();this.width=width}eq(other){return other.width==this.width}toDOM(){let span=document.createElement("span");span.textContent="\t";span.className="cm-tab";span.style.width=this.width+
"px";return span}ignoreEvent(){return!1}}const plugin$jscomp$0=ViewPlugin.fromClass(class{constructor(){this.height=1E3;this.attrs={style:"padding-bottom: 1000px"}}update(update){update=update.view.viewState.editorHeight-update.view.defaultLineHeight;update!=this.height&&(this.height=update,this.attrs={style:`padding-bottom: ${update}px`})}}),lineDeco=Decoration.line({class:"cm-activeLine"}),activeLineHighlighter=ViewPlugin.fromClass(class{constructor(view){this.decorations=this.getDeco(view)}update(update){if(update.docChanged||
update.selectionSet)this.decorations=this.getDeco(update.view)}getDeco(view){let lastLineStart=-1,deco=[];for(let r of view.state.selection.ranges){let line=view.lineBlockAt(r.head);line.from>lastLineStart&&(deco.push(lineDeco.range(line.from)),lastLineStart=line.from)}return Decoration.set(deco)}},{decorations:v=>v.decorations});class Placeholder extends WidgetType{constructor(content){super();this.content=content}toDOM(){let wrap=document.createElement("span");wrap.className="cm-placeholder";wrap.style.pointerEvents=
"none";wrap.appendChild("string"==typeof this.content?document.createTextNode(this.content):this.content);"string"==typeof this.content?wrap.setAttribute("aria-label","placeholder "+this.content):wrap.setAttribute("aria-hidden","true");return wrap}ignoreEvent(){return!1}}const keys={Alt:[18,e=>e.altKey],Control:[17,e=>e.ctrlKey],Shift:[16,e=>e.shiftKey],Meta:[91,e=>e.metaKey]},showCrosshair={style:"cursor: crosshair"};class TooltipViewManager{constructor(view,facet,createTooltipView){this.facet=facet;
this.createTooltipView=createTooltipView;this.input=view.state.facet(facet);this.tooltips=this.input.filter(t=>t);this.tooltipViews=this.tooltips.map(createTooltipView)}update(update){let input=update.state.facet(this.facet),tooltips=input.filter(x=>x);if(input===this.input){for(var t$jscomp$0 of this.tooltipViews)t$jscomp$0.update&&t$jscomp$0.update(update);return!1}t$jscomp$0=[];for(let i$jscomp$0=0;i$jscomp$0<tooltips.length;i$jscomp$0++){var tip=tooltips[i$jscomp$0];let known=-1;if(tip){for(let i=
0;i<this.tooltips.length;i++){let other=this.tooltips[i];other&&other.create==tip.create&&(known=i)}0>known?t$jscomp$0[i$jscomp$0]=this.createTooltipView(tip):(tip=t$jscomp$0[i$jscomp$0]=this.tooltipViews[known],tip.update&&tip.update(update))}}for(let t of this.tooltipViews)0>t$jscomp$0.indexOf(t)&&t.dom.remove();this.input=input;this.tooltips=tooltips;this.tooltipViews=t$jscomp$0;return!0}}const tooltipConfig=state$jscomp$0.Facet.define({combine:values=>{var _a,_b,_c;return{position:browser.ios?
"absolute":(null===(_a=values.find(conf=>conf.position))||void 0===_a?void 0:_a.position)||"fixed",parent:(null===(_b=values.find(conf=>conf.parent))||void 0===_b?void 0:_b.parent)||null,tooltipSpace:(null===(_c=values.find(conf=>conf.tooltipSpace))||void 0===_c?void 0:_c.tooltipSpace)||windowSpace}}}),tooltipPlugin=ViewPlugin.fromClass(class{constructor(view){this.view=view;this.inView=!0;this.lastTransaction=0;this.measureTimeout=-1;let config=view.state.facet(tooltipConfig);this.position=config.position;
this.parent=config.parent;this.classes=view.themeClasses;this.createContainer();this.measureReq={read:this.readMeasure.bind(this),write:this.writeMeasure.bind(this),key:this};this.manager=new TooltipViewManager(view,showTooltip,t=>this.createTooltip(t));this.intersectionObserver="function"==typeof IntersectionObserver?new IntersectionObserver(entries=>{Date.now()>this.lastTransaction-50&&0<entries.length&&1>entries[entries.length-1].intersectionRatio&&this.measureSoon()},{threshold:[1]}):null;this.observeIntersection();
view.win.addEventListener("resize",this.measureSoon=this.measureSoon.bind(this));this.maybeMeasure()}createContainer(){this.parent?(this.container=document.createElement("div"),this.container.style.position="relative",this.container.className=this.view.themeClasses,this.parent.appendChild(this.container)):this.container=this.view.dom}observeIntersection(){if(this.intersectionObserver){this.intersectionObserver.disconnect();for(let tooltip of this.manager.tooltipViews)this.intersectionObserver.observe(tooltip.dom)}}measureSoon(){0>
this.measureTimeout&&(this.measureTimeout=setTimeout(()=>{this.measureTimeout=-1;this.maybeMeasure()},50))}update(update){update.transactions.length&&(this.lastTransaction=Date.now());var updated=this.manager.update(update);updated&&this.observeIntersection();updated=updated||update.geometryChanged;update=update.state.facet(tooltipConfig);if(update.position!=this.position){this.position=update.position;for(let t of this.manager.tooltipViews)t.dom.style.position=this.position;updated=!0}if(update.parent!=
this.parent){this.parent&&this.container.remove();this.parent=update.parent;this.createContainer();for(let t of this.manager.tooltipViews)this.container.appendChild(t.dom);updated=!0}else this.parent&&this.view.themeClasses!=this.classes&&(this.classes=this.container.className=this.view.themeClasses);updated&&this.maybeMeasure()}createTooltip(tooltip){let tooltipView=tooltip.create(this.view);tooltipView.dom.classList.add("cm-tooltip");tooltip.arrow&&!tooltipView.dom.querySelector(".cm-tooltip \x3e .cm-tooltip-arrow")&&
(tooltip=document.createElement("div"),tooltip.className="cm-tooltip-arrow",tooltipView.dom.appendChild(tooltip));tooltipView.dom.style.position=this.position;tooltipView.dom.style.top="-10000px";this.container.appendChild(tooltipView.dom);tooltipView.mount&&tooltipView.mount(this.view);return tooltipView}destroy(){var _a;this.view.win.removeEventListener("resize",this.measureSoon);for(let {dom}of this.manager.tooltipViews)dom.remove();null===(_a=this.intersectionObserver)||void 0===_a?void 0:_a.disconnect();
clearTimeout(this.measureTimeout)}readMeasure(){let editor=this.view.dom.getBoundingClientRect();return{editor,parent:this.parent?this.container.getBoundingClientRect():editor,pos:this.manager.tooltips.map((t,i)=>{i=this.manager.tooltipViews[i];return i.getCoords?i.getCoords(t.pos):this.view.coordsAtPos(t.pos)}),size:this.manager.tooltipViews.map(({dom})=>dom.getBoundingClientRect()),space:this.view.state.facet(tooltipConfig).tooltipSpace(this.view)}}writeMeasure(measured){let {editor,space}=measured,
others=[];for(let i=0;i<this.manager.tooltips.length;i++){var tooltip=this.manager.tooltips[i];let tView=this.manager.tooltipViews[i],{dom}=tView,pos=measured.pos[i],size=measured.size[i];if(!pos||pos.bottom<=Math.max(editor.top,space.top)||pos.top>=Math.min(editor.bottom,space.bottom)||pos.right<Math.max(editor.left,space.left)-.1||pos.left>Math.min(editor.right,space.right)+.1){dom.style.top="-10000px";continue}let arrow=tooltip.arrow?tView.dom.querySelector(".cm-tooltip-arrow"):null,arrowHeight=
arrow?7:0;var width=size.right-size.left;let height=size.bottom-size.top,offset=tView.offset||noOffset,ltr=this.view.textDirection==exports.Direction.LTR,left=size.width>space.right-space.left?ltr?space.left:space.right-size.width:ltr?Math.min(pos.left-(arrow?14:0)+offset.x,space.right-width):Math.max(space.left,pos.left-width+(arrow?14:0)-offset.x),above=!!tooltip.above;!tooltip.strictSide&&(above?pos.top-(size.bottom-size.top)-offset.y<space.top:pos.bottom+(size.bottom-size.top)+offset.y>space.bottom)&&
above==space.bottom-pos.bottom>pos.top-space.top&&(above=!above);tooltip=above?pos.top-height-arrowHeight-offset.y:pos.bottom+arrowHeight+offset.y;width=left+width;if(!0!==tView.overlap)for(let r of others)r.left<width&&r.right>left&&r.top<tooltip+height&&r.bottom>tooltip&&(tooltip=above?r.top-height-2-arrowHeight:r.bottom+arrowHeight+2);"absolute"==this.position?(dom.style.top=tooltip-measured.parent.top+"px",dom.style.left=left-measured.parent.left+"px"):(dom.style.top=tooltip+"px",dom.style.left=
left+"px");arrow&&(arrow.style.left=`${pos.left+(ltr?offset.x:-offset.x)-(left+14-7)}px`);!0!==tView.overlap&&others.push({left,top:tooltip,right:width,bottom:tooltip+height});dom.classList.toggle("cm-tooltip-above",above);dom.classList.toggle("cm-tooltip-below",!above);tView.positioned&&tView.positioned()}}maybeMeasure(){if(this.manager.tooltips.length&&(this.view.inView&&this.view.requestMeasure(this.measureReq),this.inView!=this.view.inView&&(this.inView=this.view.inView,!this.inView)))for(let tv of this.manager.tooltipViews)tv.dom.style.top=
"-10000px"}},{eventHandlers:{scroll(){this.maybeMeasure()}}}),baseTheme=EditorView.baseTheme({".cm-tooltip":{zIndex:100},"\x26light .cm-tooltip":{border:"1px solid #bbb",backgroundColor:"#f5f5f5"},"\x26light .cm-tooltip-section:not(:first-child)":{borderTop:"1px solid #bbb"},"\x26dark .cm-tooltip":{backgroundColor:"#333338",color:"white"},".cm-tooltip-arrow":{height:"7px",width:"14px",position:"absolute",zIndex:-1,overflow:"hidden","\x26:before, \x26:after":{content:"''",position:"absolute",width:0,
height:0,borderLeft:"7px solid transparent",borderRight:"7px solid transparent"},".cm-tooltip-above \x26":{bottom:"-7px","\x26:before":{borderTop:"7px solid #bbb"},"\x26:after":{borderTop:"7px solid #f5f5f5",bottom:"1px"}},".cm-tooltip-below \x26":{top:"-7px","\x26:before":{borderBottom:"7px solid #bbb"},"\x26:after":{borderBottom:"7px solid #f5f5f5",top:"1px"}}},"\x26dark .cm-tooltip .cm-tooltip-arrow":{"\x26:before":{borderTopColor:"#333338",borderBottomColor:"#333338"},"\x26:after":{borderTopColor:"transparent",
borderBottomColor:"transparent"}}}),noOffset={x:0,y:0},showTooltip=state$jscomp$0.Facet.define({enables:[tooltipPlugin,baseTheme]}),showHoverTooltip=state$jscomp$0.Facet.define();class HoverTooltipHost{constructor(view){this.view=view;this.mounted=!1;this.dom=document.createElement("div");this.dom.classList.add("cm-tooltip-hover");this.manager=new TooltipViewManager(view,showHoverTooltip,t=>this.createHostedView(t))}static create(view){return new HoverTooltipHost(view)}createHostedView(tooltip){tooltip=
tooltip.create(this.view);tooltip.dom.classList.add("cm-tooltip-section");this.dom.appendChild(tooltip.dom);this.mounted&&tooltip.mount&&tooltip.mount(this.view);return tooltip}mount(view){for(let hostedView of this.manager.tooltipViews)hostedView.mount&&hostedView.mount(view);this.mounted=!0}positioned(){for(let hostedView of this.manager.tooltipViews)hostedView.positioned&&hostedView.positioned()}update(update){this.manager.update(update)}}const showHoverTooltipHost=showTooltip.compute([showHoverTooltip],
state=>{state=state.facet(showHoverTooltip).filter(t=>t);return 0===state.length?null:{pos:Math.min(...state.map(t=>t.pos)),end:Math.max(...state.filter(t=>null!=t.end).map(t=>t.end)),create:HoverTooltipHost.create,above:state[0].above,arrow:state.some(t=>t.arrow)}});class HoverPlugin{constructor(view,source,field,setHover,hoverTime){this.view=view;this.source=source;this.field=field;this.setHover=setHover;this.hoverTime=hoverTime;this.restartTimeout=this.hoverTimeout=-1;this.pending=null;this.lastMove=
{x:0,y:0,target:view.dom,time:0};this.checkHover=this.checkHover.bind(this);view.dom.addEventListener("mouseleave",this.mouseleave=this.mouseleave.bind(this));view.dom.addEventListener("mousemove",this.mousemove=this.mousemove.bind(this))}update(){this.pending&&(this.pending=null,clearTimeout(this.restartTimeout),this.restartTimeout=setTimeout(()=>this.startHover(),20))}get active(){return this.view.state.field(this.field)}checkHover(){this.hoverTimeout=-1;if(!this.active){var hovered=Date.now()-
this.lastMove.time;hovered<this.hoverTime?this.hoverTimeout=setTimeout(this.checkHover,this.hoverTime-hovered):this.startHover()}}startHover(){clearTimeout(this.restartTimeout);var {lastMove}=this;let pos=this.view.contentDOM.contains(lastMove.target)?this.view.posAtCoords(lastMove):null;if(null!=pos){var posCoords=this.view.coordsAtPos(pos);if(!(null==posCoords||lastMove.y<posCoords.top||lastMove.y>posCoords.bottom||lastMove.x<posCoords.left-this.view.defaultCharacterWidth||lastMove.x>posCoords.right+
this.view.defaultCharacterWidth)){var bidi=this.view.bidiSpans(this.view.state.doc.lineAt(pos)).find(s=>s.from<=pos&&s.to>=pos);bidi=bidi&&bidi.dir==exports.Direction.RTL?-1:1;lastMove=this.source(this.view,pos,lastMove.x<posCoords.left?-bidi:bidi);if(null===lastMove||void 0===lastMove?0:lastMove.then){let pending=this.pending={pos};lastMove.then(result=>{this.pending==pending&&(this.pending=null,result&&this.view.dispatch({effects:this.setHover.of(result)}))},e=>logException(this.view.state,e,"hover tooltip"))}else lastMove&&
this.view.dispatch({effects:this.setHover.of(lastMove)})}}}mousemove(event){var _a;this.lastMove={x:event.clientX,y:event.clientY,target:event.target,time:Date.now()};0>this.hoverTimeout&&(this.hoverTimeout=setTimeout(this.checkHover,this.hoverTime));var tooltip=this.active,JSCompiler_temp;if(JSCompiler_temp=tooltip){a:{for(JSCompiler_temp=this.lastMove.target;JSCompiler_temp;JSCompiler_temp=JSCompiler_temp.parentNode)if(1==JSCompiler_temp.nodeType&&JSCompiler_temp.classList.contains("cm-tooltip")){JSCompiler_temp=
!0;break a}JSCompiler_temp=!1}JSCompiler_temp=!JSCompiler_temp}if(JSCompiler_temp||this.pending){({pos:JSCompiler_temp}=tooltip||this.pending);var end=null!==(_a=null===tooltip||void 0===tooltip?void 0:tooltip.end)&&void 0!==_a?_a:JSCompiler_temp;if(JSCompiler_temp==end)event=this.view.posAtCoords(this.lastMove)!=JSCompiler_temp;else{a:{tooltip=this.view;var from=JSCompiler_temp;_a=event.clientX;event=event.clientY;JSCompiler_temp=document.createRange();from=tooltip.domAtPos(from);tooltip=tooltip.domAtPos(end);
JSCompiler_temp.setEnd(tooltip.node,tooltip.offset);JSCompiler_temp.setStart(from.node,from.offset);tooltip=JSCompiler_temp.getClientRects();JSCompiler_temp.detach();for(JSCompiler_temp=0;JSCompiler_temp<tooltip.length;JSCompiler_temp++)if(from=tooltip[JSCompiler_temp],6>=Math.max(from.top-event,event-from.bottom,from.left-_a,_a-from.right)){event=!0;break a}event=!1}event=!event}event&&(this.view.dispatch({effects:this.setHover.of(null)}),this.pending=null)}}mouseleave(){clearTimeout(this.hoverTimeout);
this.hoverTimeout=-1;this.active&&this.view.dispatch({effects:this.setHover.of(null)})}destroy(){clearTimeout(this.hoverTimeout);this.view.dom.removeEventListener("mouseleave",this.mouseleave);this.view.dom.removeEventListener("mousemove",this.mousemove)}}const closeHoverTooltipEffect=state$jscomp$0.StateEffect.define(),closeHoverTooltips=closeHoverTooltipEffect.of(null),panelConfig=state$jscomp$0.Facet.define({combine(configs){let topContainer,bottomContainer;for(let c of configs)topContainer=topContainer||
c.topContainer,bottomContainer=bottomContainer||c.bottomContainer;return{topContainer,bottomContainer}}}),panelPlugin=ViewPlugin.fromClass(class{constructor(view){this.input=view.state.facet(showPanel);this.specs=this.input.filter(s=>s);this.panels=this.specs.map(spec=>spec(view));let conf=view.state.facet(panelConfig);this.top=new PanelGroup(view,!0,conf.topContainer);this.bottom=new PanelGroup(view,!1,conf.bottomContainer);this.top.sync(this.panels.filter(p=>p.top));this.bottom.sync(this.panels.filter(p=>
!p.top));for(let p of this.panels)p.dom.classList.add("cm-panel"),p.mount&&p.mount()}update(update){var conf=update.state.facet(panelConfig);this.top.container!=conf.topContainer&&(this.top.sync([]),this.top=new PanelGroup(update.view,!0,conf.topContainer));this.bottom.container!=conf.bottomContainer&&(this.bottom.sync([]),this.bottom=new PanelGroup(update.view,!1,conf.bottomContainer));this.top.syncClasses();this.bottom.syncClasses();conf=update.state.facet(showPanel);if(conf!=this.input){var specs=
conf.filter(x=>x);conf=[];let top=[],bottom=[],mount=[];for(let spec of specs){var known=this.specs.indexOf(spec);0>known?(known=spec(update.view),mount.push(known)):(known=this.panels[known],known.update&&known.update(update));conf.push(known);(known.top?top:bottom).push(known)}this.specs=specs;this.panels=conf;this.top.sync(top);this.bottom.sync(bottom);for(let p of mount)p.dom.classList.add("cm-panel"),p.mount&&p.mount()}else for(specs of this.panels)specs.update&&specs.update(update)}destroy(){this.top.sync([]);
this.bottom.sync([])}},{provide:plugin=>EditorView.scrollMargins.of(view=>(view=view.plugin(plugin))&&{top:view.top.scrollMargin(),bottom:view.bottom.scrollMargin()})});class PanelGroup{constructor(view,top,container){this.view=view;this.top=top;this.container=container;this.dom=void 0;this.classes="";this.panels=[];this.syncClasses()}sync(panels){for(let p of this.panels)p.destroy&&0>panels.indexOf(p)&&p.destroy();this.panels=panels;this.syncDOM()}syncDOM(){if(0==this.panels.length)this.dom&&(this.dom.remove(),
this.dom=void 0);else{if(!this.dom){this.dom=document.createElement("div");this.dom.className=this.top?"cm-panels cm-panels-top":"cm-panels cm-panels-bottom";this.dom.style[this.top?"top":"bottom"]="0";var parent=this.container||this.view.dom;parent.insertBefore(this.dom,this.top?parent.firstChild:null)}parent=this.dom.firstChild;for(let panel of this.panels)if(panel.dom.parentNode==this.dom){for(;parent!=panel.dom;)parent=rm(parent);parent=parent.nextSibling}else this.dom.insertBefore(panel.dom,
parent);for(;parent;)parent=rm(parent)}}scrollMargin(){return!this.dom||this.container?0:Math.max(0,this.top?this.dom.getBoundingClientRect().bottom-Math.max(0,this.view.scrollDOM.getBoundingClientRect().top):Math.min(innerHeight,this.view.scrollDOM.getBoundingClientRect().bottom)-this.dom.getBoundingClientRect().top)}syncClasses(){if(this.container&&this.classes!=this.view.themeClasses){for(let cls of this.classes.split(" "))cls&&this.container.classList.remove(cls);for(let cls of(this.classes=this.view.themeClasses).split(" "))cls&&
this.container.classList.add(cls)}}}const showPanel=state$jscomp$0.Facet.define({enables:panelPlugin});class GutterMarker extends state$jscomp$0.RangeValue{compare(other){return this==other||this.constructor==other.constructor&&this.eq(other)}eq(other){return!1}destroy(dom){}}GutterMarker.prototype.elementClass="";GutterMarker.prototype.toDOM=void 0;GutterMarker.prototype.mapMode=state$jscomp$0.MapMode.TrackBefore;GutterMarker.prototype.startSide=GutterMarker.prototype.endSide=-1;GutterMarker.prototype.point=
!0;const gutterLineClass=state$jscomp$0.Facet.define(),defaults={class:"",renderEmptyElements:!1,elementStyle:"",markers:()=>state$jscomp$0.RangeSet.empty,lineMarker:()=>null,lineMarkerChange:null,initialSpacer:null,updateSpacer:null,domEventHandlers:{}},activeGutters=state$jscomp$0.Facet.define(),unfixGutters=state$jscomp$0.Facet.define({combine:values=>values.some(x=>x)}),gutterView=ViewPlugin.fromClass(class{constructor(view){this.view=view;this.prevViewport=view.viewport;this.dom=document.createElement("div");
this.dom.className="cm-gutters";this.dom.setAttribute("aria-hidden","true");this.dom.style.minHeight=this.view.contentHeight+"px";this.gutters=view.state.facet(activeGutters).map(conf=>new SingleGutterView(view,conf));for(let gutter of this.gutters)this.dom.appendChild(gutter.dom);if(this.fixed=!view.state.facet(unfixGutters))this.dom.style.position="sticky";this.syncGutters(!1);view.scrollDOM.insertBefore(this.dom,view.contentDOM)}update(update){if(this.updateGutters(update)){let vpA=this.prevViewport,
vpB=update.view.viewport;this.syncGutters(Math.min(vpA.to,vpB.to)-Math.max(vpA.from,vpB.from)<.8*(vpB.to-vpB.from))}update.geometryChanged&&(this.dom.style.minHeight=this.view.contentHeight+"px");this.view.state.facet(unfixGutters)!=!this.fixed&&(this.fixed=!this.fixed,this.dom.style.position=this.fixed?"sticky":"");this.prevViewport=update.view.viewport}syncGutters(detach){let after=this.dom.nextSibling;detach&&this.dom.remove();let lineClasses=state$jscomp$0.RangeSet.iter(this.view.state.facet(gutterLineClass),
this.view.viewport.from),classSet=[],contexts=this.gutters.map(gutter=>new UpdateContext(gutter,this.view.viewport,-this.view.documentPadding.top));for(let line of this.view.viewportLineBlocks){let text;if(Array.isArray(line.type))for(let b of line.type){if(b.type==exports.BlockType.Text){text=b;break}}else text=line.type==exports.BlockType.Text?line:void 0;if(text){classSet.length&&(classSet=[]);advanceCursor(lineClasses,classSet,line.from);for(let cx of contexts)cx.line(this.view,text,classSet)}}for(let cx of contexts)cx.finish();
detach&&this.view.scrollDOM.insertBefore(this.dom,after)}updateGutters(update){let prev=update.startState.facet(activeGutters);var cur=update.state.facet(activeGutters);let change=update.docChanged||update.heightChanged||update.viewportChanged||!state$jscomp$0.RangeSet.eq(update.startState.facet(gutterLineClass),update.state.facet(gutterLineClass),update.view.viewport.from,update.view.viewport.to);if(prev==cur)for(var gutter of this.gutters)gutter.update(update)&&(change=!0);else{change=!0;gutter=
[];for(let conf of cur)cur=prev.indexOf(conf),0>cur?gutter.push(new SingleGutterView(this.view,conf)):(this.gutters[cur].update(update),gutter.push(this.gutters[cur]));for(let g of this.gutters)g.dom.remove(),0>gutter.indexOf(g)&&g.destroy();for(let g of gutter)this.dom.appendChild(g.dom);this.gutters=gutter}return change}destroy(){for(let view of this.gutters)view.destroy();this.dom.remove()}},{provide:plugin=>EditorView.scrollMargins.of(view=>{let value=view.plugin(plugin);return value&&0!=value.gutters.length&&
value.fixed?view.textDirection==exports.Direction.LTR?{left:value.dom.offsetWidth}:{right:value.dom.offsetWidth}:null})});class UpdateContext{constructor(gutter,viewport,height){this.gutter=gutter;this.height=height;this.localMarkers=[];this.i=0;this.cursor=state$jscomp$0.RangeSet.iter(gutter.markers,viewport.from)}line(view,line,extraMarkers){this.localMarkers.length&&(this.localMarkers=[]);advanceCursor(this.cursor,this.localMarkers,line.from);extraMarkers=extraMarkers.length?this.localMarkers.concat(extraMarkers):
this.localMarkers;var forLine=this.gutter.config.lineMarker(view,line,extraMarkers);forLine&&extraMarkers.unshift(forLine);forLine=this.gutter;if(0!=extraMarkers.length||forLine.config.renderEmptyElements){var above=line.top-this.height;this.i==forLine.elements.length?(view=new GutterElement(view,line.height,above,extraMarkers),forLine.elements.push(view),forLine.dom.appendChild(view.dom)):forLine.elements[this.i].update(view,line.height,above,extraMarkers);this.height=line.bottom;this.i++}}finish(){let gutter=
this.gutter;for(;gutter.elements.length>this.i;){let last=gutter.elements.pop();gutter.dom.removeChild(last.dom);last.destroy()}}}class SingleGutterView{constructor(view,config){this.view=view;this.config=config;this.elements=[];this.spacer=null;this.dom=document.createElement("div");this.dom.className="cm-gutter"+(this.config.class?" "+this.config.class:"");for(let prop in config.domEventHandlers)this.dom.addEventListener(prop,event=>{let line=view.lineBlockAtHeight(event.clientY-view.documentTop);
config.domEventHandlers[prop](view,line,event)&&event.preventDefault()});this.markers=asArray(config.markers(view));config.initialSpacer&&(this.spacer=new GutterElement(view,0,0,[config.initialSpacer(view)]),this.dom.appendChild(this.spacer.dom),this.spacer.dom.style.cssText+="visibility: hidden; pointer-events: none")}update(update){let prevMarkers=this.markers;this.markers=asArray(this.config.markers(update.view));if(this.spacer&&this.config.updateSpacer){var updated=this.config.updateSpacer(this.spacer.markers[0],
update);updated!=this.spacer.markers[0]&&this.spacer.update(update.view,0,0,[updated])}updated=update.view.viewport;return!state$jscomp$0.RangeSet.eq(this.markers,prevMarkers,updated.from,updated.to)||(this.config.lineMarkerChange?this.config.lineMarkerChange(update):!1)}destroy(){for(let elt of this.elements)elt.destroy()}}class GutterElement{constructor(view,height,above,markers){this.height=-1;this.above=0;this.markers=[];this.dom=document.createElement("div");this.dom.className="cm-gutterElement";
this.update(view,height,above,markers)}update(view,height,above,markers){this.height!=height&&(this.dom.style.height=(this.height=height)+"px");this.above!=above&&(this.dom.style.marginTop=(this.above=above)?above+"px":"");a:if(height=this.markers,height.length!=markers.length)height=!1;else{for(above=0;above<height.length;above++)if(!height[above].compare(markers[above])){height=!1;break a}height=!0}height||this.setMarkers(view,markers)}setMarkers(view,markers){let cls="cm-gutterElement",domPos=
this.dom.firstChild;for(let iNew=0,iOld=0;;){let skipTo=iOld,marker=iNew<markers.length?markers[iNew++]:null,matched=!1;if(marker){var c=marker.elementClass;c&&(cls+=" "+c);for(c=iOld;c<this.markers.length;c++)if(this.markers[c].compare(marker)){skipTo=c;matched=!0;break}}else skipTo=this.markers.length;for(;iOld<skipTo;)c=this.markers[iOld++],c.toDOM&&(c.destroy(domPos),c=domPos.nextSibling,domPos.remove(),domPos=c);if(!marker)break;marker.toDOM&&(matched?domPos=domPos.nextSibling:this.dom.insertBefore(marker.toDOM(view),
domPos));matched&&iOld++}this.dom.className=cls;this.markers=markers}destroy(){this.setMarkers(null,[])}}const lineNumberMarkers=state$jscomp$0.Facet.define(),lineNumberConfig=state$jscomp$0.Facet.define({combine(values){return state$jscomp$0.combineConfig(values,{formatNumber:String,domEventHandlers:{}},{domEventHandlers(a,b){a=Object.assign({},a);for(let event$jscomp$0 in b){let exists=a[event$jscomp$0],add=b[event$jscomp$0];a[event$jscomp$0]=exists?(view,line,event)=>exists(view,line,event)||add(view,
line,event):add}return a}})}});class NumberMarker extends GutterMarker{constructor(number){super();this.number=number}eq(other){return this.number==other.number}toDOM(){return document.createTextNode(this.number)}}const lineNumberGutter=activeGutters.compute([lineNumberConfig],state=>({class:"cm-lineNumbers",renderEmptyElements:!1,markers(view){return view.state.facet(lineNumberMarkers)},lineMarker(view,line,others){return others.some(m=>m.toDOM)?null:new NumberMarker(formatNumber(view,view.state.doc.lineAt(line.from).number))},
lineMarkerChange:update=>update.startState.facet(lineNumberConfig)!=update.state.facet(lineNumberConfig),initialSpacer(view){return new NumberMarker(formatNumber(view,maxLineNumber(view.state.doc.lines)))},updateSpacer(spacer,update){update=formatNumber(update.view,maxLineNumber(update.view.state.doc.lines));return update==spacer.number?spacer:new NumberMarker(update)},domEventHandlers:state.facet(lineNumberConfig).domEventHandlers})),activeLineGutterMarker=new class extends GutterMarker{constructor(){super(...arguments);
this.elementClass="cm-activeLineGutter"}},activeLineGutterHighlighter=gutterLineClass.compute(["selection"],state$1=>{let marks=[],last=-1;for(let range of state$1.selection.ranges){let linePos=state$1.doc.lineAt(range.head).from;linePos>last&&(last=linePos,marks.push(activeLineGutterMarker.range(linePos)))}return state$jscomp$0.RangeSet.of(marks)}),__test={HeightMap,HeightOracle,MeasuredHeights,QueryType,ChangedRange,computeOrder,moveVisually};exports.BidiSpan=BidiSpan;exports.BlockInfo=BlockInfo;
exports.Decoration=Decoration;exports.EditorView=EditorView;exports.GutterMarker=GutterMarker;exports.MatchDecorator=MatchDecorator;exports.ViewPlugin=ViewPlugin;exports.ViewUpdate=ViewUpdate;exports.WidgetType=WidgetType;exports.__test=__test;exports.closeHoverTooltips=closeHoverTooltips;exports.crosshairCursor=function(options={}){let [code,getter]=keys[options.key||"Alt"],plugin=ViewPlugin.fromClass(class{constructor(view){this.view=view;this.isDown=!1}set(isDown){this.isDown!=isDown&&(this.isDown=
isDown,this.view.update([]))}},{eventHandlers:{keydown(e){this.set(e.keyCode==code||getter(e))},keyup(e){e.keyCode!=code&&getter(e)||this.set(!1)}}});return[plugin,EditorView.contentAttributes.of(view=>{var _a;return(null===(_a=view.plugin(plugin))||void 0===_a?0:_a.isDown)?showCrosshair:null})]};exports.drawSelection=function(config={}){return[selectionConfig.of(config),drawSelectionPlugin,hideNativeSelection]};exports.dropCursor=function(){return[dropCursorPos,drawDropCursor]};exports.getPanel=
function(view,panel){panel=(view=view.plugin(panelPlugin))?view.specs.indexOf(panel):-1;return-1<panel?view.panels[panel]:null};exports.getTooltip=function(view,tooltip){view=view.plugin(tooltipPlugin);if(!view)return null;tooltip=view.manager.tooltips.indexOf(tooltip);return 0>tooltip?null:view.manager.tooltipViews[tooltip]};exports.gutter=function(config){return[gutters(),activeGutters.of(Object.assign(Object.assign({},defaults),config))]};exports.gutterLineClass=gutterLineClass;exports.gutters=
gutters;exports.hasHoverTooltips=function(state){return state.facet(showHoverTooltip).some(x=>x)};exports.highlightActiveLine=function(){return activeLineHighlighter};exports.highlightActiveLineGutter=function(){return activeLineGutterHighlighter};exports.highlightSpecialChars=function(config={}){return[specialCharConfig.of(config),specialCharPlugin()]};exports.hoverTooltip=function(source,options={}){let setHover=state$jscomp$0.StateEffect.define(),hoverState=state$jscomp$0.StateField.define({create(){return null},
update(value,tr){if(value&&(options.hideOnChange&&(tr.docChanged||tr.selection)||options.hideOn&&options.hideOn(tr,value)))return null;if(value&&tr.docChanged){let newPos=tr.changes.mapPos(value.pos,-1,state$jscomp$0.MapMode.TrackDel);if(null==newPos)return null;let copy=Object.assign(Object.create(null),value);copy.pos=newPos;null!=value.end&&(copy.end=tr.changes.mapPos(value.end));value=copy}for(let effect of tr.effects)effect.is(setHover)&&(value=effect.value),effect.is(closeHoverTooltipEffect)&&
(value=null);return value},provide:f=>showHoverTooltip.from(f)});return[hoverState,ViewPlugin.define(view=>new HoverPlugin(view,source,hoverState,setHover,options.hoverTime||300)),showHoverTooltipHost]};exports.keymap=keymap;exports.lineNumberMarkers=lineNumberMarkers;exports.lineNumbers=function(config={}){return[lineNumberConfig.of(config),gutters(),lineNumberGutter]};exports.logException=logException;exports.panels=function(config){return config?[panelConfig.of(config)]:[]};exports.placeholder=
function(content){return ViewPlugin.fromClass(class{constructor(view){this.view=view;this.placeholder=Decoration.set([Decoration.widget({widget:new Placeholder(content),side:1}).range(0)])}get decorations(){return this.view.state.doc.length?Decoration.none:this.placeholder}},{decorations:v=>v.decorations})};exports.rectangularSelection=function(options){let filter=(null===options||void 0===options?void 0:options.eventFilter)||(e=>e.altKey&&0==e.button);return EditorView.mouseSelectionStyle.of((view,
event)=>filter(event)?rectangleSelectionStyle(view,event):null)};exports.repositionTooltips=function(view){var _a;null===(_a=view.plugin(tooltipPlugin))||void 0===_a?void 0:_a.maybeMeasure()};exports.runScopeHandlers=function(view,event,scope){return runHandlers(getKeymap(view.state),event,view,scope)};exports.scrollPastEnd=function(){return[plugin$jscomp$0,contentAttributes.of(view=>{var _a;return(null===(_a=view.plugin(plugin$jscomp$0))||void 0===_a?void 0:_a.attrs)||null})]};exports.showPanel=
showPanel;exports.showTooltip=showTooltip;exports.tooltips=function(config={}){return tooltipConfig.of(config)}}
//# sourceMappingURL=module$node_modules$$codemirror$view$dist$index_cjs.js.map

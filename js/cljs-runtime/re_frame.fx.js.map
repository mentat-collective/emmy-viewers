{"version":3,"sources":["re_frame/fx.cljc"],"mappings":"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","names":["re-frame.fx/kind","js/Error","re-frame.registry/kinds","p__87513","map__87514","cljs.core/--destructure-map","cljs.core.get","re-frame.fx/register-built-in!","registry","reg-fx","cljs.core.partial","re-frame.registry/register-handler","p__87516","map__87517","value","event-queue","seq__87519","cljs.core/seq","chunk__87520","count__87521","i__87522","map__87530","temp__5753__auto__","cljs.core/chunked-seq?","c__4679__auto__","cljs.core/chunk-first","cljs.core/chunk-rest","cljs.core/count","map__87531","cljs.core/first","cljs.core/next","ms","dispatch","effect","cljs.core.remove","cljs.core/nil?","cljs.core/empty?","re_frame.loggers.console","re-frame.interop/set-timeout!","re-frame.router/dispatch","p__87533","map__87534","cljs.core/vector?","p__87535","map__87536","cljs.core/sequential?","seq__87537","chunk__87538","count__87539","i__87540","event","p__87542","map__87543","clear-event","re-frame.registry/clear-handlers","re-frame.events/kind","seq__87546","chunk__87547","count__87548","i__87549","p__87551","map__87552","app-db","cljs.core/deref","cljs.core/reset!","re-frame.fx/do-fx","re_frame.interceptor.__GT_interceptor","context","re-frame.trace/is-trace-enabled?","*current-trace*-orig-val__87557","re-frame.trace/*current-trace*","*current-trace*-temp-val__87558","re-frame.trace/start-trace","end__87216__auto__","re-frame.interop/now","duration__87217__auto__","cljs.core.swap_BANG_","re-frame.trace/traces","cljs.core/conj","cljs.core.assoc","re-frame.trace/run-tracing-callbacks!","seq__87567","chunk__87568","count__87569","i__87570","vec__87581","cljs.core.nth","vec__87586","seq__87591","chunk__87592","count__87593","i__87594","vec__87605","vec__87610","effect-key","effect-value","temp__5751__auto__","effect-fn","re-frame.registry/get-handler","G__87584","G__87585","G__87589","G__87590","G__87608","G__87609","G__87613","G__87614","lambdaisland.glogi.log","cljs.core/identity"],"sourcesContent":["(ns re-frame.fx\n  (:require [re-frame.router :as router]\n            [re-frame.interceptor :refer [->interceptor]]\n            [re-frame.interop :refer [set-timeout!]]\n            [re-frame.events :as events]\n            [re-frame.registry :as reg]\n            [re-frame.loggers :refer [console]]\n            [re-frame.trace :as trace :include-macros true]\n            [lambdaisland.glogi :as log]))\n\n;; -- Registration ------------------------------------------------------------\n\n(def kind :fx)\n(assert (re-frame.registry/kinds kind))\n\n;; -- Interceptor -------------------------------------------------------------\n\n(defn register-built-in!\n  [{:keys [registry]}]\n  (let [reg-fx (partial reg/register-handler registry kind)]\n\n    ;; :dispatch-later\n    ;;\n    ;; `dispatch` one or more events after given delays. Expects a collection\n    ;; of maps with two keys:  :`ms` and `:dispatch`\n    ;;\n    ;; usage:\n    ;;\n    ;;    {:dispatch-later [{:ms 200 :dispatch [:event-id \"param\"]}    ;;  in 200ms do this: (dispatch [:event-id \"param\"])\n    ;;                      {:ms 100 :dispatch [:also :this :in :100ms]}]}\n    ;;\n    ;; Note: nil entries in the collection are ignored which means events can be added\n    ;; conditionally:\n    ;;    {:dispatch-later [ (when (> 3 5) {:ms 200 :dispatch [:conditioned-out]})\n    ;;                       {:ms 100 :dispatch [:another-one]}]}\n    ;;\n    (reg-fx\n     :dispatch-later\n     (fn [value {:keys [event-queue]}]\n       (doseq [{:keys [ms dispatch] :as effect} (remove nil? value)]\n         (if (or (empty? dispatch) (not (number? ms)))\n           (console :error \"re-frame: ignoring bad :dispatch-later value:\" effect)\n           (set-timeout! #(router/dispatch event-queue dispatch) ms)))))\n\n\n    ;; :dispatch\n    ;;\n    ;; `dispatch` one event. Expects a single vector.\n    ;;\n    ;; usage:\n    ;;   {:dispatch [:event-id \"param\"] }\n\n    (reg-fx\n     :dispatch\n     (fn [value {:keys [event-queue]}]\n       (if-not (vector? value)\n         (console :error \"re-frame: ignoring bad :dispatch value. Expected a vector, but got:\" value)\n         (router/dispatch event-queue value))))\n\n\n    ;; :dispatch-n\n    ;;\n    ;; `dispatch` more than one event. Expects a list or vector of events. Something for which\n    ;; sequential? returns true.\n    ;;\n    ;; usage:\n    ;;   {:dispatch-n (list [:do :all] [:three :of] [:these])}\n    ;;\n    ;; Note: nil events are ignored which means events can be added\n    ;; conditionally:\n    ;;    {:dispatch-n (list (when (> 3 5) [:conditioned-out])\n    ;;                       [:another-one])}\n    ;;\n    (reg-fx\n     :dispatch-n\n     (fn [value {:keys [event-queue]}]\n       (if-not (sequential? value)\n         (console :error \"re-frame: ignoring bad :dispatch-n value. Expected a collection, but got:\" value)\n         (doseq [event (remove nil? value)] (router/dispatch event-queue event)))))\n\n\n    ;; :deregister-event-handler\n    ;;\n    ;; removes a previously registered event handler. Expects either a single id (\n    ;; typically a namespaced keyword), or a seq of ids.\n    ;;\n    ;; usage:\n    ;;   {:deregister-event-handler :my-id)}\n    ;; or:\n    ;;   {:deregister-event-handler [:one-id :another-id]}\n    ;;\n    (reg-fx\n     :deregister-event-handler\n     (fn [value {:keys [registry]}]\n       (let [clear-event (partial reg/clear-handlers registry events/kind)]\n         (if (sequential? value)\n           (doseq [event value] (clear-event event))\n           (clear-event value)))))\n\n\n    ;; :db\n    ;;\n    ;; reset! app-db with a new value. `value` is expected to be a map.\n    ;;\n    ;; usage:\n    ;;   {:db  {:key1 value1 key2 value2}}\n    ;;\n    (reg-fx\n     :db\n     (fn [value {:keys [app-db]}]\n       (when-not (identical? @app-db value)\n         (reset! app-db value))))))\n\n;; -- Builtin Effect Handlers  ------------------------------------------------\n\n(defn do-fx\n  \"An interceptor whose `:after` actions the contents of `:effects`. As a result\n  this interceptor is Domino 3.\n\n  This interceptor is silently added (by reg-event-db etc) to the front of\n  interceptor chains for all events.\n\n  For each key in `:effects` (a map), it calls the registered `effects handler`\n  (see `reg-fx` for registration of effect handlers).\n\n  So, if `:effects` was:\n      {:dispatch  [:hello 42]\n       :db        {...}\n       :undo      \\\"set flag\\\"}\n\n  it will call the registered effect handlers for each of the map's keys:\n  `:dispatch`, `:undo` and `:db`. When calling each handler, provides the map\n  value for that key - so in the example above the effect handler for :dispatch\n  will be given one arg `[:hello 42]`.\n\n  You cannot rely on the ordering in which effects are executed.\"\n  [registry]\n  (->interceptor\n   :id :do-fx\n   :after (fn do-fx-after\n            [context]\n            {:pre [(:frame context)]}\n            (trace/with-trace\n              {:op-type :event/do-fx}\n              (doseq [[effect-key effect-value] (:effects context)]\n                (if-let [effect-fn (reg/get-handler registry kind effect-key)]\n                  (effect-fn effect-value (:frame context))\n                  (log/error :missing-fx-handler {:effect-key effect-key})))))))\n"]}
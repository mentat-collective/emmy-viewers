shadow$provide.module$node_modules$$mentatcollective$jsxgraph$src$math$metapost=function(global,require,module,exports){function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}Object.defineProperty(exports,"__esModule",{value:!0});exports.default=void 0;var _type=_interopRequireDefault(require("module$node_modules$$mentatcollective$jsxgraph$src$utils$type"));global=_interopRequireDefault(require("module$node_modules$$mentatcollective$jsxgraph$src$math$math"));global.default.Metapost=
{MP_ENDPOINT:0,MP_EXPLICIT:1,MP_GIVEN:2,MP_CURL:3,MP_OPEN:4,MP_END_CYCLE:5,UNITY:1,FRACTION_ONE:1,FRACTION_THREE:3,ONE_EIGHTY_DEG:Math.PI,THREE_SIXTY_DEG:2*Math.PI,EPS_SQ:1E-5*1E-5,make_choices:function(knots){var h,psi;var p=knots[0];do{if(!p)break;var q=p.next;p.rtype>this.MP_EXPLICIT&&(p.x-q.x)*(p.x-q.x)+(p.y-q.y)*(p.y-q.y)<this.EPS_SQ&&(p.rtype=this.MP_EXPLICIT,p.ltype===this.MP_OPEN&&(p.ltype=this.MP_CURL,p.set_left_curl(this.UNITY)),q.ltype=this.MP_EXPLICIT,q.rtype===this.MP_OPEN&&(q.rtype=
this.MP_CURL,q.set_right_curl(this.UNITY)),p.rx=p.x,q.lx=p.x,p.ry=p.y,q.ly=p.y);p=q}while(p!==knots[0]);for(h=knots[0];h.ltype===this.MP_OPEN&&h.rtype===this.MP_OPEN;)if(h=h.next,h===knots[0]){h.ltype=this.MP_END_CYCLE;break}for(p=h;p;){q=p.next;if(p.rtype>=this.MP_GIVEN){for(;q.ltype===this.MP_OPEN&&q.rtype===this.MP_OPEN;)q=q.next;var dely=0;var s=p;var n=knots.length;var delta_x=[];var delta_y=[];var delta=[];for(psi=[null];;){var delx=s.next;delta_x.push(delx.x-s.x);delta_y.push(delx.y-s.y);delta.push(this.mp_pyth_add(delta_x[dely],
delta_y[dely]));if(0<dely){var sine=delta_y[dely-1]/delta[dely-1];s=delta_x[dely-1]/delta[dely-1];psi.push(Math.atan2(delta_y[dely]*s-delta_x[dely]*sine,delta_x[dely]*s+delta_y[dely]*sine))}dely++;s=delx;s===q&&(n=dely);if(dely>=n&&s.ltype!==this.MP_END_CYCLE)break}dely===n?psi.push(0):psi.push(psi[1]);q.ltype===this.MP_OPEN&&(delx=q.rx-q.x,dely=q.ry-q.y,delx*delx+dely*dely<this.EPS_SQ?(q.ltype=this.MP_CURL,q.set_left_curl(this.UNITY)):(q.ltype=this.MP_GIVEN,q.set_left_given(Math.atan2(dely,delx))));
p.rtype===this.MP_OPEN&&p.ltype===this.MP_EXPLICIT&&(delx=p.x-p.lx,dely=p.y-p.ly,delx*delx+dely*dely<this.EPS_SQ?(p.rtype=this.MP_CURL,p.set_right_curl(this.UNITY)):(p.rtype=this.MP_GIVEN,p.set_right_given(Math.atan2(dely,delx))));this.mp_solve_choices(p,q,n,delta_x,delta_y,delta,psi)}else p.rtype===this.MP_ENDPOINT&&(p.rx=p.x,p.ry=p.y,q.lx=q.x,q.ly=q.y);p=q;if(p===h)break}},mp_solve_choices:function(p,q,n,delta_x,delta_y,delta,psi){var s,r;var ldelta=delta.length+1;var uu=Array(ldelta);var ww=Array(ldelta);
var vv=Array(ldelta);var theta=Array(ldelta);for(s=0;s<ldelta;s++)theta[s]=vv[s]=ww[s]=uu[s]=0;ldelta=0;s=p;for(r=0;;){var t=s.next;if(0===ldelta)if(s.rtype===this.MP_GIVEN){if(t.ltype===this.MP_GIVEN){var aa=Math.atan2(delta_y[0],delta_x[0]);ww=this.mp_n_sin_cos(p.right_given()-aa);vv=ww[0];ww=ww[1];uu=this.mp_n_sin_cos(q.left_given()-aa);aa=uu[0];uu=uu[1];this.mp_set_controls(p,q,delta_x[0],delta_y[0],ww,vv,-uu,aa);return}vv[0]=s.right_given()-Math.atan2(delta_y[0],delta_x[0]);vv[0]=this.reduce_angle(vv[0]);
uu[0]=0;ww[0]=0}else if(s.rtype===this.MP_CURL){if(t.ltype===this.MP_CURL){p.rtype=this.MP_EXPLICIT;q.ltype=this.MP_EXPLICIT;var lt=Math.abs(q.left_tension());var rt=Math.abs(p.right_tension());var ee=this.UNITY/(3*rt);p.rx=p.x+delta_x[0]*ee;p.ry=p.y+delta_y[0]*ee;ee=this.UNITY/(3*lt);q.lx=q.x-delta_x[0]*ee;q.ly=q.y-delta_y[0]*ee;return}var cc=s.right_curl();lt=Math.abs(t.left_tension());rt=Math.abs(s.right_tension());uu[0]=this.mp_curl_ratio(cc,rt,lt);vv[0]=-psi[1]*uu[0];ww[0]=0}else s.rtype===this.MP_OPEN&&
(uu[0]=0,vv[0]=0,ww[0]=this.FRACTION_ONE);else if(s.ltype===this.MP_END_CYCLE||s.ltype===this.MP_OPEN){aa=this.UNITY/(3*Math.abs(r.right_tension())-this.UNITY);var dd=delta[ldelta]*(this.FRACTION_THREE-this.UNITY/Math.abs(r.right_tension()));var acc=this.UNITY/(3*Math.abs(t.left_tension())-this.UNITY);ee=delta[ldelta-1]*(this.FRACTION_THREE-this.UNITY/Math.abs(t.left_tension()));cc=this.FRACTION_ONE-uu[ldelta-1]*aa;dd*=cc;lt=Math.abs(s.left_tension());rt=Math.abs(s.right_tension());lt<rt?dd*=Math.pow(lt/
rt,2):lt>rt&&(ee*=Math.pow(rt/lt,2));ee/=ee+dd;uu[ldelta]=ee*acc;acc=-psi[ldelta+1]*uu[ldelta];r.rtype===this.MP_CURL?(ww[ldelta]=0,vv[ldelta]=acc-psi[1]*(this.FRACTION_ONE-ee)):(ee=(this.FRACTION_ONE-ee)/cc,acc-=psi[ldelta]*ee,ee*=aa,vv[ldelta]=acc-vv[ldelta-1]*ee,ww[ldelta]=-ww[ldelta-1]*ee);if(s.ltype===this.MP_END_CYCLE){aa=0;for(acc=this.FRACTION_ONE;--ldelta,0===ldelta&&(ldelta=n),aa=vv[ldelta]-aa*uu[ldelta],acc=ww[ldelta]-acc*uu[ldelta],ldelta!==n;);aa/=this.FRACTION_ONE-acc;theta[n]=aa;vv[0]=
aa;for(q=1;q<n;q++)vv[q]+=aa*ww[q];break}}else{if(s.ltype===this.MP_CURL){cc=s.left_curl();lt=Math.abs(s.left_tension());rt=Math.abs(r.right_tension());ee=this.mp_curl_ratio(cc,lt,rt);theta[n]=-(vv[n-1]*ee)/(this.FRACTION_ONE-ee*uu[n-1]);break}if(s.ltype===this.MP_GIVEN){theta[n]=s.left_given()-Math.atan2(delta_y[n-1],delta_x[n-1]);theta[n]=this.reduce_angle(theta[n]);break}}r=s;s=t;ldelta+=1}for(ldelta=n-1;-1<ldelta;ldelta--)theta[ldelta]=vv[ldelta]-theta[ldelta+1]*uu[ldelta];s=p;for(ldelta=0;t=
s.next,ww=this.mp_n_sin_cos(theta[ldelta]),vv=ww[0],ww=ww[1],uu=this.mp_n_sin_cos(-psi[ldelta+1]-theta[ldelta+1]),aa=uu[0],uu=uu[1],this.mp_set_controls(s,t,delta_x[ldelta],delta_y[ldelta],ww,vv,uu,aa),ldelta++,s=t,ldelta!==n;);},mp_n_sin_cos:function(z){return[Math.cos(z),Math.sin(z)]},mp_set_controls:function(p,q,delta_x,delta_y,st,ct,sf,cf){var ss=Math.abs(q.left_tension());var rt=Math.abs(p.right_tension());rt=this.mp_velocity(st,ct,sf,cf,rt);ss=this.mp_velocity(sf,cf,st,ct,ss);if(0>p.right_tension()||
0>q.left_tension())if(0<=st&&0<=sf||0>=st&&0>=sf){var sine=Math.abs(st)*cf+Math.abs(sf)*ct;0<sine&&(sine*=1.00024414062,0>p.right_tension()&&0>this.mp_ab_vs_cd(Math.abs(sf),this.FRACTION_ONE,rt,sine)&&(rt=Math.abs(sf)/sine),0>q.left_tension()&&0>this.mp_ab_vs_cd(Math.abs(st),this.FRACTION_ONE,ss,sine)&&(ss=Math.abs(st)/sine))}p.rx=p.x+(delta_x*ct-delta_y*st)*rt;p.ry=p.y+(delta_y*ct+delta_x*st)*rt;q.lx=q.x-(delta_x*cf+delta_y*sf)*ss;q.ly=q.y-(delta_y*cf-delta_x*sf)*ss;p.rtype=this.MP_EXPLICIT;q.ltype=
this.MP_EXPLICIT},mp_pyth_add:function(a,b){return Math.sqrt(a*a+b*b)},mp_curl_ratio:function(gamma,a_tension,b_tension){a_tension=1/a_tension;b_tension=1/b_tension;return Math.min(4,((3-a_tension)*a_tension*a_tension*gamma+b_tension*b_tension*b_tension)/(a_tension*a_tension*a_tension*gamma+(3-b_tension)*b_tension*b_tension))},mp_ab_vs_cd:function(a,b,c,d){return a*b===c*d?0:a*b>c*d?1:-1},mp_velocity:function(st,ct,sf,cf,t){return Math.min(4,(2+Math.sqrt(2)*(st-sf/16)*(sf-st/16)*(ct-cf))/(1.5*t*(2+
(Math.sqrt(5)-1)*ct+(3-Math.sqrt(5))*cf)))},reduce_angle:function(A){Math.abs(A)>this.ONE_EIGHTY_DEG&&(A=0<A?A-this.THREE_SIXTY_DEG:A+this.THREE_SIXTY_DEG);return A},makeknots:function(p,tension,cycle){var i,knots=[];tension=tension||1;var len=p.length;for(i=0;i<len;i++)knots.push({x:p[i][0],y:p[i][1],ltype:this.MP_OPEN,rtype:this.MP_OPEN,ly:tension,ry:tension,lx:tension,rx:tension,left_curl:function(){return this.lx||0},right_curl:function(){return this.rx||0},left_tension:function(){this.ly||(this.ly=
1);return this.ly},right_tension:function(){this.ry||(this.ry=1);return this.ry},set_right_curl:function(x){this.rx=x||0},set_left_curl:function(x){this.lx=x||0}});len=knots.length;for(i=0;i<len;i++)knots[i].next=knots[i+1]||knots[i],knots[i].set_right_given=knots[i].set_right_curl,knots[i].set_left_given=knots[i].set_left_curl,knots[i].right_given=knots[i].right_curl,knots[i].left_given=knots[i].left_curl;knots[len-1].next=knots[0];cycle||(knots[len-1].rtype=this.MP_ENDPOINT,knots[len-1].ltype=this.MP_CURL,
knots[0].rtype=this.MP_CURL);return knots},curve:function(point_list,controls){var i,x=[],y=[];controls=controls||{tension:1,direction:{},curl:{},isClosed:!1};point_list=this.makeknots(point_list,_type.default.evaluate(controls.tension),controls.isClosed);var len=point_list.length;for(i in controls.direction)if(controls.direction.hasOwnProperty(i)){var val=_type.default.evaluate(controls.direction[i]);_type.default.isArray(val)?(!1!==val[0]&&(point_list[i].lx=val[0]*Math.PI/180,point_list[i].ltype=
this.MP_GIVEN),!1!==val[1]&&(point_list[i].rx=val[1]*Math.PI/180,point_list[i].rtype=this.MP_GIVEN)):(point_list[i].lx=val*Math.PI/180,point_list[i].rx=val*Math.PI/180,point_list[i].ltype=point_list[i].rtype=this.MP_GIVEN)}for(i in controls.curl)controls.curl.hasOwnProperty(i)&&(val=_type.default.evaluate(controls.curl[i]),0===parseInt(i,10)?(point_list[i].rtype=this.MP_CURL,point_list[i].set_right_curl(val)):parseInt(i,10)===len-1&&(point_list[i].ltype=this.MP_CURL,point_list[i].set_left_curl(val)));
this.make_choices(point_list);for(i=0;i<len-1;i++)x.push(point_list[i].x),x.push(point_list[i].rx),x.push(point_list[i+1].lx),y.push(point_list[i].y),y.push(point_list[i].ry),y.push(point_list[i+1].ly);x.push(point_list[len-1].x);y.push(point_list[len-1].y);controls.isClosed&&(x.push(point_list[len-1].rx),y.push(point_list[len-1].ry),x.push(point_list[0].lx),y.push(point_list[0].ly),x.push(point_list[0].x),y.push(point_list[0].y));return[x,y]}};exports.default=global.default.Metapost}
//# sourceMappingURL=module$node_modules$$mentatcollective$jsxgraph$src$math$metapost.js.map

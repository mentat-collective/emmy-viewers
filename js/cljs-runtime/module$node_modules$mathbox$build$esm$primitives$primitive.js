shadow$provide.module$node_modules$mathbox$build$esm$primitives$primitive=function(global,require,module,exports){function _getRequireWildcardCache(nodeInterop$jscomp$0){if("function"!==typeof WeakMap)return null;var cacheBabelInterop=new WeakMap,cacheNodeInterop=new WeakMap;return(_getRequireWildcardCache=function(nodeInterop){return nodeInterop?cacheNodeInterop:cacheBabelInterop})(nodeInterop$jscomp$0)}Object.defineProperty(exports,"__esModule",{value:!0});exports.Primitive=void 0;var Model=function(obj,
nodeInterop){if(!nodeInterop&&obj&&obj.__esModule)return obj;if(null===obj||"object"!==typeof obj&&"function"!==typeof obj)return{default:obj};if((nodeInterop=_getRequireWildcardCache(nodeInterop))&&nodeInterop.has(obj))return nodeInterop.get(obj);var newObj={},hasPropertyDescriptor=Object.defineProperty&&Object.getOwnPropertyDescriptor,key;for(key in obj)if("default"!==key&&Object.prototype.hasOwnProperty.call(obj,key)){var desc=hasPropertyDescriptor?Object.getOwnPropertyDescriptor(obj,key):null;
desc&&(desc.get||desc.set)?Object.defineProperty(newObj,key,desc):newObj[key]=obj[key]}newObj.default=obj;nodeInterop&&nodeInterop.set(obj,newObj);return newObj}(require("module$node_modules$mathbox$build$esm$model$index"));global=require("module$node_modules$threestrap$src$binder");class Primitive{static initClass(){this.Node=Model.Node;this.Group=Model.Group;this.model=this.Node;this.finals=this.props=this.traits=this.defaults=null;this.freeform=!1}constructor(node,_context,helpers){this.node=node;
this._context=_context;this._renderables=this._context.renderables;this._attributes=this._context.attributes;this._shaders=this._context.shaders;this._overlays=this._context.overlays;this._animator=this._context.animator;this._types=this._attributes.types;this.node.controller=this;this.node.on("added",_event=>this._added());this.node.on("removed",_event=>this._removed());this.node.on("change",event=>{if(this._root)return this.change(event.changed,event.touched)});this.reconfigure();this._get=this.node.get.bind(this.node);
this._helpers=helpers(this,this.node.traits);this._handlers={inherit:{},listen:[],watch:[],compute:[]};this._root=this._parent=null;this.init()}is(trait){return this.traits.hash[trait]}init(){}make(){}made(){}unmake(_rebuild){}unmade(){}change(_changed,_touched,_init){}refresh(){return this.change({},{},!0)}rebuild(){if(this._root)return this._removed(!0),this._added()}reconfigure(config){null!=config&&this.node.configure(config,this._attributes);this.traits=this.node.traits;return this.props=this.node.props}_added(){let e,
left;this._parent=null!=this.node.parent?this.node.parent.controller:void 0;this._root=null!=this.node.root?this.node.root.controller:void 0;this.node.clock=null!=(left=this._inherit("clock"))?left:this._root;try{try{return this.make(),this.refresh(),this.made()}catch(error){throw e=error,this.node.print("warn"),console.error(e),e;}}catch(error1){try{return this._removed()}catch(error2){}}}_removed(rebuild){null==rebuild&&(rebuild=!1);this.unmake(rebuild);this._unlisten();this._unattach();this._uncompute();
this._parent=this._root=null;return this.unmade(rebuild)}_listen(object,type,method,self){null==self&&(self=this);if(object instanceof Array)for(const o of Array.from(object))return this.__listen(o,type,method,self);return this.__listen(object,type,method,self)}__listen(object,type,method,self){null==self&&(self=this);"string"===typeof object&&(object=this._inherit(object));null!=object&&(method=method.bind(self),method.node=this.node,object.on(type,method),this._handlers.listen.push([object,type,
method]));return object}_unlisten(){if(this._handlers.listen.length){for(const [object,type,handler]of Array.from(this._handlers.listen))object.off(type,handler);return this._handlers.listen=[]}}_inherit(trait){const cached=this._handlers.inherit[trait];return void 0!==cached?cached:this._handlers.inherit[trait]=null!=this._parent?this._parent._find(null!=trait?trait:null):void 0}_find(trait){return this.is(trait)?this:null!=this._parent?this._parent._find(trait):void 0}_uninherit(){return this._handlers.inherit=
{}}_attach(selector$jscomp$0,trait,method,self,start,optional,multiple){null==self&&(self=this);null==start&&(start=this);null==optional&&(optional=!1);null==multiple&&(multiple=!1);const filter=function(node){if(null!=node&&Array.from(node.traits).includes(trait))return node},map=node=>null!=node?node.controller:void 0,flatten=function(list){if(null==list)return list;let out=[];for(const sub of Array.from(list))sub instanceof Array?out=out.concat(sub):out.push(sub);return out},resolve=selector=>
{let nodes;if("object"===typeof selector){var node=selector;if(null!=node&&node._up)return selector=multiple?node._targets:[node[0]];if(node instanceof Array)return selector=multiple?flatten(node.map(resolve)):resolve(node[0]);if(node instanceof Model.Node)return[node]}else if("string"===typeof selector&&"\x3c"===selector[0]){var discard=0;if(node=selector.match(/^<([0-9])+$/))discard=+node[1]-1;selector.match(/^<+$/)&&(discard=+selector.length-1);nodes=[];let previous=start.node;for(;previous;){({parent:node}=
previous);if(!node)break;(previous=node.children[previous.index-1])||nodes.length||(previous=node);node=null;filter(previous)&&(node=previous);null!=node&&0>=discard--&&nodes.push(node);if(!multiple&&nodes.length)return nodes}if(multiple&&nodes.length)return nodes}else if("string"===typeof selector)if(discard=method.bind(self),this._handlers.watch.push(discard),discard=this._root.watch(selector,discard),multiple){if(nodes=discard.filter(filter),nodes.length)return nodes}else if(filter(discard[0])&&
(node=discard[0]),null!=node)return[node];if(!optional)throw console.warn(this.node.toMarkup()),Error(`${this.node.toString()} - Could not find ${trait} \`${selector}\``);return multiple?[]:null};selector$jscomp$0=flatten(resolve(selector$jscomp$0));return multiple?null!=selector$jscomp$0?selector$jscomp$0.map(map):null:null!=selector$jscomp$0?map(selector$jscomp$0[0]):null}_unattach(){if(this._handlers.watch.length){for(const watcher of Array.from(this._handlers.watch))null!=watcher&&watcher.unwatch();
return this._handlers.watch=[]}}_compute(key,expr){this._handlers.compute.push(key);return this.node.bind(key,expr,!0)}_uncompute(){if(this._handlers.compute.length){for(const key of Array.from(this._handlers.compute))this.node.unbind(key,!0);return this._handlers.compute=[]}}}exports.Primitive=Primitive;Primitive.initClass();global.Binder.apply(Primitive.prototype)}
//# sourceMappingURL=module$node_modules$mathbox$build$esm$primitives$primitive.js.map

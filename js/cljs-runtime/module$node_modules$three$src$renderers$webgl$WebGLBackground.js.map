{
"version":3,
"file":"module$node_modules$three$src$renderers$webgl$WebGLBackground.js",
"lineCount":9,
"mappings":"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",
"sources":["node_modules/three/src/renderers/webgl/WebGLBackground.js"],
"sourcesContent":["shadow$provide[\"module$node_modules$three$src$renderers$webgl$WebGLBackground\"] = function(global,require,module,exports) {\n\"use strict\";\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.WebGLBackground = WebGLBackground;\n\nvar _constants = require(\"../../constants.js\");\n\nvar _BoxGeometry = require(\"../../geometries/BoxGeometry.js\");\n\nvar _PlaneGeometry = require(\"../../geometries/PlaneGeometry.js\");\n\nvar _ShaderMaterial = require(\"../../materials/ShaderMaterial.js\");\n\nvar _Color = require(\"../../math/Color.js\");\n\nvar _Mesh = require(\"../../objects/Mesh.js\");\n\nvar _ShaderLib = require(\"../shaders/ShaderLib.js\");\n\nvar _UniformsUtils = require(\"../shaders/UniformsUtils.js\");\n\nfunction WebGLBackground(renderer, cubemaps, state, objects, alpha, premultipliedAlpha) {\n  const clearColor = new _Color.Color(0x000000);\n  let clearAlpha = alpha === true ? 0 : 1;\n  let planeMesh;\n  let boxMesh;\n  let currentBackground = null;\n  let currentBackgroundVersion = 0;\n  let currentTonemapping = null;\n\n  function render(renderList, scene) {\n    let forceClear = false;\n    let background = scene.isScene === true ? scene.background : null;\n\n    if (background && background.isTexture) {\n      background = cubemaps.get(background);\n    } // Ignore background in AR\n    // TODO: Reconsider this.\n\n\n    const xr = renderer.xr;\n    const session = xr.getSession && xr.getSession();\n\n    if (session && session.environmentBlendMode === 'additive') {\n      background = null;\n    }\n\n    if (background === null) {\n      setClear(clearColor, clearAlpha);\n    } else if (background && background.isColor) {\n      setClear(background, 1);\n      forceClear = true;\n    }\n\n    if (renderer.autoClear || forceClear) {\n      renderer.clear(renderer.autoClearColor, renderer.autoClearDepth, renderer.autoClearStencil);\n    }\n\n    if (background && (background.isCubeTexture || background.mapping === _constants.CubeUVReflectionMapping)) {\n      if (boxMesh === undefined) {\n        boxMesh = new _Mesh.Mesh(new _BoxGeometry.BoxGeometry(1, 1, 1), new _ShaderMaterial.ShaderMaterial({\n          name: 'BackgroundCubeMaterial',\n          uniforms: (0, _UniformsUtils.cloneUniforms)(_ShaderLib.ShaderLib.cube.uniforms),\n          vertexShader: _ShaderLib.ShaderLib.cube.vertexShader,\n          fragmentShader: _ShaderLib.ShaderLib.cube.fragmentShader,\n          side: _constants.BackSide,\n          depthTest: false,\n          depthWrite: false,\n          fog: false\n        }));\n        boxMesh.geometry.deleteAttribute('normal');\n        boxMesh.geometry.deleteAttribute('uv');\n\n        boxMesh.onBeforeRender = function (renderer, scene, camera) {\n          this.matrixWorld.copyPosition(camera.matrixWorld);\n        }; // enable code injection for non-built-in material\n\n\n        Object.defineProperty(boxMesh.material, 'envMap', {\n          get: function () {\n            return this.uniforms.envMap.value;\n          }\n        });\n        objects.update(boxMesh);\n      }\n\n      boxMesh.material.uniforms.envMap.value = background;\n      boxMesh.material.uniforms.flipEnvMap.value = background.isCubeTexture && background.isRenderTargetTexture === false ? -1 : 1;\n\n      if (currentBackground !== background || currentBackgroundVersion !== background.version || currentTonemapping !== renderer.toneMapping) {\n        boxMesh.material.needsUpdate = true;\n        currentBackground = background;\n        currentBackgroundVersion = background.version;\n        currentTonemapping = renderer.toneMapping;\n      } // push to the pre-sorted opaque render list\n\n\n      renderList.unshift(boxMesh, boxMesh.geometry, boxMesh.material, 0, 0, null);\n    } else if (background && background.isTexture) {\n      if (planeMesh === undefined) {\n        planeMesh = new _Mesh.Mesh(new _PlaneGeometry.PlaneGeometry(2, 2), new _ShaderMaterial.ShaderMaterial({\n          name: 'BackgroundMaterial',\n          uniforms: (0, _UniformsUtils.cloneUniforms)(_ShaderLib.ShaderLib.background.uniforms),\n          vertexShader: _ShaderLib.ShaderLib.background.vertexShader,\n          fragmentShader: _ShaderLib.ShaderLib.background.fragmentShader,\n          side: _constants.FrontSide,\n          depthTest: false,\n          depthWrite: false,\n          fog: false\n        }));\n        planeMesh.geometry.deleteAttribute('normal'); // enable code injection for non-built-in material\n\n        Object.defineProperty(planeMesh.material, 'map', {\n          get: function () {\n            return this.uniforms.t2D.value;\n          }\n        });\n        objects.update(planeMesh);\n      }\n\n      planeMesh.material.uniforms.t2D.value = background;\n\n      if (background.matrixAutoUpdate === true) {\n        background.updateMatrix();\n      }\n\n      planeMesh.material.uniforms.uvTransform.value.copy(background.matrix);\n\n      if (currentBackground !== background || currentBackgroundVersion !== background.version || currentTonemapping !== renderer.toneMapping) {\n        planeMesh.material.needsUpdate = true;\n        currentBackground = background;\n        currentBackgroundVersion = background.version;\n        currentTonemapping = renderer.toneMapping;\n      } // push to the pre-sorted opaque render list\n\n\n      renderList.unshift(planeMesh, planeMesh.geometry, planeMesh.material, 0, 0, null);\n    }\n  }\n\n  function setClear(color, alpha) {\n    state.buffers.color.setClear(color.r, color.g, color.b, alpha, premultipliedAlpha);\n  }\n\n  return {\n    getClearColor: function () {\n      return clearColor;\n    },\n    setClearColor: function (color, alpha = 1) {\n      clearColor.set(color);\n      clearAlpha = alpha;\n      setClear(clearColor, clearAlpha);\n    },\n    getClearAlpha: function () {\n      return clearAlpha;\n    },\n    setClearAlpha: function (alpha) {\n      clearAlpha = alpha;\n      setClear(clearColor, clearAlpha);\n    },\n    render: render\n  };\n}\n};"],
"names":["shadow$provide","global","require","module","exports","Object","defineProperty","value","WebGLBackground","renderer","cubemaps","state","objects","alpha","premultipliedAlpha","setClear","color","buffers","r","g","b","clearColor","_Color","Color","clearAlpha","planeMesh","boxMesh","currentBackground","currentBackgroundVersion","currentTonemapping","getClearColor","setClearColor","set","getClearAlpha","setClearAlpha","render","renderList","scene","forceClear","background","isScene","isTexture","get","xr","session","getSession","environmentBlendMode","isColor","autoClear","clear","autoClearColor","autoClearDepth","autoClearStencil","isCubeTexture","mapping","_constants","CubeUVReflectionMapping","undefined","_Mesh","Mesh","_BoxGeometry","BoxGeometry","_ShaderMaterial","ShaderMaterial","name","uniforms","_UniformsUtils","cloneUniforms","_ShaderLib","ShaderLib","cube","vertexShader","fragmentShader","side","BackSide","depthTest","depthWrite","fog","geometry","deleteAttribute","onBeforeRender","boxMesh.onBeforeRender","camera","matrixWorld","copyPosition","material","envMap","update","flipEnvMap","isRenderTargetTexture","version","toneMapping","needsUpdate","unshift","_PlaneGeometry","PlaneGeometry","FrontSide","t2D","matrixAutoUpdate","updateMatrix","uvTransform","copy","matrix"]
}

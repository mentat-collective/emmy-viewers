{"version":3,"sources":["sicmutils/calculus/form_field.cljc"],"mappings":"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","names":["cljs.core.derive","sicmutils.calculus.form-field/ff:zero","_","sicmutils.calculus.manifold/zero-manifold-function","sicmutils.calculus.form-field/get-rank","f","sicmutils.operator/operator?","or__4253__auto__","sicmutils.operator/context","sicmutils.util/illegal","sicmutils.function/function?","sicmutils.calculus.form-field/form-field?","ff","and__4251__auto__","subtype","cljs.core.isa_QMARK_","sicmutils.calculus.form-field/nform-field?","n","cljs.core._EQ_","sicmutils.calculus.form-field/oneform-field?","js/Error","sicmutils.calculus.form-field/ff:zero-like","op","sicmutils.operator.make_operator","sicmutils.calculus.form-field/ff:zero?","sicmutils.operator/procedure","sicmutils.util/unsupported","defaults","one-like","identity?","id-like","sicmutils.calculus.form-field/ff-context","m","cljs.core.merge","var_args","G__101398","sicmutils.calculus.form-field/procedure->nform-field","sicmutils.calculus.form_field.procedure__GT_nform_field","name","args","cljs.core.into","cljs.core.repeat","G__101400","sicmutils.calculus.form-field/procedure->oneform-field","sicmutils.calculus.form_field.procedure__GT_oneform_field","sicmutils.calculus.form-field/oneform-field-procedure","components","coordinate-system","vf-components","sicmutils.structure.mapr","vf","sicmutils.calculus.vector-field/vector-field?","sicmutils.function$.compose","sicmutils.generic._STAR_","sicmutils.calculus.vector-field/vector-field->components","sicmutils.calculus.manifold/chart","G__101402","sicmutils.calculus.form-field/components->oneform-field","cljs.core.sequence","cljs.core/seq","cljs.core.concat","cljs.core/List","sicmutils.value/freeze","sicmutils.calculus.form_field.components__GT_oneform_field","sicmutils.calculus.form-field/oneform-field->components","form","basis","sicmutils.calculus.vector-field/coordinate-system->vector-basis","sicmutils.calculus.manifold/point","sicmutils.calculus.form-field/literal-oneform-field","sicmutils.calculus.manifold/manifold","domain","sicmutils.structure/up*","range","sicmutils.structure/down*","sicmutils.abstract$.function$.literal_function","args__4870__auto__","len__4864__auto__","i__4865__auto__","argseq__4871__auto__","cljs.core/IndexedSeq","sicmutils.calculus.form-field/coordinate-basis-oneform-field-procedure","seq101403","G__101404","cljs.core/first","cljs.core/next","self__4851__auto__","indices","vf-structure","G__101406","cljs.core.apply","sicmutils.structure/component","internal","sicmutils.calculus.form-field/coordinate-basis-oneform-field","seq101407","G__101408","G__101409","ofp","sicmutils.function/memoize","cljs.core.comp","sicmutils.calculus.form-field/coordinate-name->ff-name","cljs.core.symbol","sicmutils.calculus.form-field/coordinate-system->oneform-basis","sicmutils.structure/map-chain","c-name","chain","ff-name","sicmutils.calculus.manifold/coordinate-prototype","sicmutils.calculus.form-field/basis-components->oneform-field","oneform-basis","sicmutils.calculus.form-field/oneform-field->basis-components","w","vector-basis","sicmutils.calculus.form-field/function->oneform-field","fexpr__101410","sicmutils.calculus.form-field/differential-of-function","G__101412","sicmutils.calculus.form-field/wedge2","form1","form2","n1","n2","k","sicmutils.special.factorial/factorial","cljs.core/count","sicmutils.generic/+","cljs.core.map","permutation","parity","vec__101413","cljs.core.nth","a1","a2","cljs.core/split-at","sicmutils.util.permute/permutation-sequence","cljs.core/cycle","G__101419","sicmutils.calculus.form-field/wedge","args-arr__4885__auto__","argseq__4886__auto__","seq101417","G__101418","cljs.core/constantly","fs","cljs.core.reduce","r","l","sicmutils.calculus.form_field.wedge2","cljs.core/reverse","cljs.core/cons","sicmutils.generic/mul","a","b","sicmutils.calculus.form-field/Alt","G__101421","sicmutils.util.aggregate/generic-sum","alternation","G__101423","sicmutils.calculus.form-field/tensor-product2","t1","t2","tp","vec__101424","G__101428","sicmutils.calculus.form-field/w2","sicmutils.calculus.form_field.tensor_product2","sicmutils.calculus.form-field/alt-wedge","seq101429","self__4852__auto__","sicmutils.calculus.form-field/exterior-derivative-procedure","kform","p1__101430#","p2__101431#","without","cljs.core.take","cljs.core.drop","k+1form","vectors","point","sicmutils.calculus.manifold/point->manifold","G__101432","G__101433","G__101434","i","rest","sicmutils.generic._PLUS_","cljs.core/even?","fexpr__101437","G__101439","fexpr__101438","G__101440","G__101441","G__101442","j","fexpr__101443","sicmutils.operator/commutator","sicmutils.calculus.form-field/exterior-derivative","sicmutils.calculus.form-field/d"],"sourcesContent":["#_\"SPDX-License-Identifier: GPL-3.0\"\n\n(ns sicmutils.calculus.form-field\n  \"This namespace implements a form field operator and a number of functions for\n  creating and working with form fields.\n\n  A form-field of rank n is an operator that takes n vector fields to a\n  real-valued function on the manifold. A one-form field takes a single vector\n  field.\n\n  The namespace also contains two definitions of the [[wedge]]\n  product ([[alt-wedge]] is the second), plus the [[exterior-derivative]].\"\n  (:require [sicmutils.abstract.function :as af]\n            [sicmutils.calculus.manifold :as m]\n            [sicmutils.calculus.vector-field :as vf]\n            [sicmutils.function :as f]\n            [sicmutils.generic :as g]\n            [sicmutils.operator :as o]\n            [sicmutils.special.factorial :refer [factorial]]\n            [sicmutils.structure :as s]\n            [sicmutils.util :as u]\n            [sicmutils.util.aggregate :as ua]\n            [sicmutils.util.permute :as permute]\n            [sicmutils.value :as v]))\n\n;; ## Form fields\n;;\n;; A form-field of rank n is an operator that takes n vector fields to a\n;; real-valued function on the manifold. A one-form field takes a single vector\n;; field.\n\n(derive ::oneform-field ::form-field)\n(derive ::form-field ::o/operator)\n\n(defn ff:zero\n  \"Returns a form field that returns, for any supplied vector field `vf`, a\n  manifold function [[manifold/zero-manifold-function]] that maps every input\n  manifold `point` to the scalar value 0.\"\n  [_]\n  m/zero-manifold-function)\n\n(defn get-rank\n  \"Returns the rank of the supplied differential form `f`. Functions are treated\n  as differential forms of rank 0.\n\n  Throws for any non differential form supplied.\"\n  [f]\n  (cond (o/operator? f)\n        (or (:rank (o/context f))\n            (u/illegal\n             (str \"operator, but not a differential form: \" f)))\n\n        (f/function? f) 0\n        :else (u/illegal\n               (str \"not a differential form: \" f))))\n\n(defn form-field?\n  \"Returns true if the supplied `f` is a form field operator, false otherwise.\"\n  [ff]\n  (and (o/operator? ff)\n       (let [subtype (:subtype\n                      (o/context ff))]\n         (isa? subtype ::form-field))))\n\n(defn nform-field?\n  \"Returns true if the supplied `f` is an [form field of rank\n  n](https://en.wikipedia.org/wiki/Differential_form), false otherwise.\n\n  A form-field of rank n is an operator that takes n vector fields to a\n  real-valued function on the manifold.\"\n  [f n]\n  (and (form-field? f)\n       (= n (get-rank f))))\n\n(defn oneform-field?\n  \"Returns true if the supplied `f` is\n  a [One-form](https://en.wikipedia.org/wiki/One-form), false\n  otherwise.\n\n  A [One-form](https://en.wikipedia.org/wiki/One-form) takes a single vector\n  field to a real-valued function on the manifold.\"\n  [f]\n  (nform-field? f 1))\n\n(defn- ff:zero-like\n  \"Given some form field `op`, returns a form field with the same context and\n  its procedure replaced by `ff:zero`.\n\n  The returned form field responds `true` to `v/zero?`.\"\n  [op]\n  {:pre [(form-field? op)]}\n  (o/make-operator ff:zero\n                   'ff:zero\n                   (o/context op)))\n\n(defn- ff:zero?\n  \"Returns true if the supplied form field `op` is a form field with a procedure\n  equal to `ff:zero`, false otherwise.\"\n  [op]\n  (and (form-field? op)\n       (= (o/procedure op) ff:zero)))\n\n(letfn [(one-like [_]\n          (u/unsupported\n           \"form fields don't have an identity.\"))\n        (id-like [_]\n          (u/unsupported\n           \"form fields don't have a multiplicative identity.\"))\n        (identity? [_] false)]\n  (let [defaults {:zero? ff:zero?\n                  :zero-like ff:zero-like\n                  :one-like one-like\n                  :identity? identity?\n                  :identity-like id-like}]\n    (defn- ff-context [m]\n      (merge defaults m))))\n\n(defn ^:no-doc procedure->nform-field\n  \"Accepts a function `f` and an optional symbolic `name`, and returns an n-form\n  field, ie, a subtype of [[sicmutils.operator/Operator]].\n\n  `f` should be a function from n vector field arguments to a smooth real-valued\n  function `g` of a manifold.\n\n  If `n` is 0, the function will be called immediately and its return value\n  returned.\"\n  ([f n]\n   (procedure->nform-field f n 'unnamed-nform-field))\n  ([f n name]\n   (if (= n 0)\n     (f)\n     (let [args (into [] (repeat n ::vf/vector-field))]\n       (o/make-operator f name\n                        (ff-context\n                         {:subtype ::form-field\n                          :arity [:exactly n]\n                          :rank n\n                          :arguments args}))))))\n\n(defn ^:no-doc procedure->oneform-field\n  \"Accepts a function `f` and an optional symbolic `name`, and returns a one-form\n  field, ie, a subtype of [[sicmutils.operator/Operator]].\n\n  `f` should be a function from a vector field to a smooth real-valued function\n  `g` of a manifold.\"\n  ([f]\n   (let [name 'unnamed-1form-field]\n     (procedure->oneform-field f name)))\n  ([f name]\n   (o/make-operator f name\n                    (ff-context\n                     {:subtype ::oneform-field\n                      :arity [:exactly 1]\n                      :rank 1\n                      :arguments [::vf/vector-field]}))))\n\n(defn ^:no-doc oneform-field-procedure\n  \"Takes:\n\n  - a `down` tuple of `components` of the one-form field relative to\n    `coordinate-system`\n  - the `coordinate-system`\n\n  And returns a procedure (not yet an operator!) that takes a structure of vector fields\n  and produces a new structure of functions of manifold points.\"\n  [components coordinate-system]\n  (fn [vf-components]\n    (s/mapr (fn [vf]\n              {:pre [(vf/vector-field? vf)]}\n              (f/compose\n               (g/* components\n                    (vf/vector-field->components vf coordinate-system))\n               (m/chart coordinate-system)))\n            vf-components)))\n\n(defn components->oneform-field\n  \"Takes:\n\n  - a `down` tuple of `components` of the one-form field relative to\n    `coordinate-system`\n  - the `coordinate-system`\n\n  And returns a full one-form field.\n\n  A one-field field is an operator that takes a vector field to a real-valued\n  function on the manifold.\"\n  ([components coordinate-system]\n   (let [name `(~'oneform-field\n                ~(v/freeze components))]\n     (components->oneform-field\n      components coordinate-system name)))\n  ([components coordinate-system name]\n   (-> (oneform-field-procedure components coordinate-system)\n       (procedure->oneform-field name))))\n\n;; We can extract the components function for a form, given a\n;; coordinate system.\n\n(defn oneform-field->components\n  \"Given a one-form field `form` and a `coordinate-system`, returns a function\n  from the coordinate representation of a manifold point to a coordinate\n  representation of the coordinatized components of the form field at that\n  point.\n\n  For example:\n\n  ```clojure\n  (let-coordinates [[x y] R2-rect]\n    (let [f (literal-oneform-field 'f R2-rect)]\n      ((oneform-field->components f R2-rect)\n       (up 'x0 'y0))))\n\n  ;;=> (down (f_0 (up x0 y0))\n  ;;         (f_1 (up x0 y0)))\n  ```\"\n  [form coordinate-system]\n  {:pre [(form-field? form)]}\n  (let [basis (vf/coordinate-system->vector-basis coordinate-system)]\n    (f/compose (form basis)\n               (m/point coordinate-system))))\n\n;; ### API\n\n(defn literal-oneform-field\n  \"Given a symbolic name `sym` and a `coordinate-system`, returns a one-form field\n  consisting of literal real-valued functions from the coordinate system's\n  dimension for each coordinate component.\n\n  These functions are passed to [[components->oneform-field]], along with the\n  supplied `coordinate-system` and symbolic name `sym`.\n\n  For coordinate systems of dimension 1, `literal-form-field`'s component\n  functions will accept a single non-structural argument.\"\n  [name coordinate-system]\n  (let [n (:dimension (m/manifold coordinate-system))\n        domain (if (= n 1) 0 (s/up* (repeat n 0)))\n        range  (s/down* (repeat n 0))]\n    (-> (af/literal-function name domain range)\n        (components->oneform-field coordinate-system name))))\n\n;; To get the elements of a coordinate basis for the 1-form fields:\n\n(defn- coordinate-basis-oneform-field-procedure\n  [coordinate-system & indices]\n  (fn [vf-structure]\n    (letfn [(internal [vf]\n              {:pre [(vf/vector-field? vf)]}\n              (vf\n               (f/compose (apply s/component indices)\n                          (m/chart coordinate-system))))]\n      (s/mapr internal vf-structure))))\n\n(defn coordinate-basis-oneform-field\n  \"Given some `coordinate-system`, a symbolic `name` and a sequence of indices\n  into the structure of the coordinate system's representation, returns a\n  one-form field.\n\n  The returned one-form field at each structural spot takes a vector field and\n  returns a function that takes the directional derivative in that coordinate's\n  direction using the vector field.\"\n  [coordinate-system name & indices]\n  (let [ofp (apply coordinate-basis-oneform-field-procedure\n                   coordinate-system indices)]\n    (-> (f/memoize\n         (comp f/memoize ofp))\n        (procedure->oneform-field name))))\n\n(defn ^:no-doc coordinate-name->ff-name\n  \"From the name of a coordinate, produce the name of the coordinate basis\n  one-form field (as a symbol)\"\n  [n]\n  (symbol (str \\d n)))\n\n(defn coordinate-system->oneform-basis\n  \"Given some `coordinate-system`, returns a structure of\n  `coordinate-basis-oneform-field` instances.\n\n  The one-form field at each structural spot takes a vector field and returns a\n  function that takes the directional derivative in that coordinate's direction\n  using the vector field.\n\n  When applied as a function, the structure behaves equivalently to\n\n  ```clojure\n  (coordinate-basis-oneform-field <coordinate-system> 'ignored-name)\n  ```\n\n  With no indices supplied.\"\n  [coordinate-system]\n  (s/map-chain\n   (fn [c-name chain _]\n     (let [ff-name (coordinate-name->ff-name c-name)]\n       (apply coordinate-basis-oneform-field\n              coordinate-system ff-name chain)))\n   (m/coordinate-prototype coordinate-system)))\n\n;; Given component functions defined on manifold points and a 1-form basis, to\n;; produce the 1-form field as a linear combination.\n\n(defn basis-components->oneform-field\n  \"Given a structure of `components` functions defined on manifold points and and\n  a matching `oneform-basis` (of identical structure),\n\n  Returns a new one-form field that\n\n  - passes its vector-field argument to `oneform-basis`, returning a new\n    equivalent structure with each slot populated by functions from a manifold\n    point to the directional derivative (using the vector field) in that\n    coordinate direction\n\n  - contracts the result of that operation with the result of applying each\n    component in `components` to the manifold point.\n\n  NOTE:\n  - This is for any basis, not just a coordinate basis\n  - The `components` are evaluated at a manifold point, not its coordinates\n  - Given a dual basis, you can retrieve the original components\n    with [[oneform-field->basis-components]]\"\n  [components oneform-basis]\n  (procedure->oneform-field\n   (fn [vf]\n     (g/* components (oneform-basis vf)))))\n\n(defn oneform-field->basis-components\n  \"Given a structure `w` of and a vector field basis `vector-basis`, returns a new\n  structure generated by applying the full vector basis to each element of `w`.\n\n  Here's an example of how to use this function to round trip a structure of\n  basis components:\n\n  ```clojure\n  (let [vb    (vf/coordinate-system->vector-basis coordsys)\n        basis (coordinate-system->oneform-basis coordsys)\n        components (down d:dx d:dy)]\n    (= components\n       (-> components\n           (basis-components->oneform-field basis)\n           (oneform-field->basis-components vb))))\n  ```\"\n  [w vector-basis]\n  (s/mapr w vector-basis))\n\n(defn function->oneform-field\n  \"One of the two incompatible definitions of differential.\n\n  This differential is a special case of exterior derivative. The other one\n  lives at [[map/differential]].\"\n  [f]\n  {:pre [(f/function? f)]}\n  (let [op (fn [vf-structure]\n             (s/mapr (fn [vf]\n                       {:pre [(vf/vector-field? vf)]}\n                       (fn [m] ((vf f) m)))\n                     vf-structure))\n        name `(~'d ~(v/freeze f))]\n    (procedure->oneform-field op name)))\n\n(def ^{:doc \"Alias for [[function->oneform-field]].\n  One of the two incompatible definitions of differential.\n\n  This differential is a special case of exterior derivative. The other one\n  lives at [[map/differential]].\"}\n  differential-of-function\n  function->oneform-field)\n\n;; ## Wedge Product (from Wedge.scm)\n;;\n;; Now we transition to wedge.\n;;\n;; Higher rank forms can be constructed from 1forms by wedging them together.\n;; This antisymmetric tensor product is computed as a determinant. The purpose\n;; of this is to allow us to use the construction dx^dy to compute the area\n;; described by the vectors that are given to it.\n\n(defn- wedge2\n  \"Binary and unary cases of the wedge product.\"\n  ([form1] form1)\n  ([form1 form2]\n   (let [n1 (get-rank form1)\n         n2 (get-rank form2)]\n     (if (or (zero? n1) (zero? n2))\n       (g/* form1 form2)\n       (let [n (+ n1 n2)\n             k (/ 1\n                  (* (factorial n1)\n                     (factorial n2)))\n             w (fn [& args]\n                 (assert (= (count args) n)\n                         (str \"Wrong number of args to wedge product: \"\n                              (count args) \" vs required \" n))\n                 ;; \"Error in Singer\" comment from GJS.\n                 (g/* k (apply\n                         g/+ (map (fn [permutation parity]\n                                    (let [[a1 a2] (split-at n1 permutation)]\n                                      (g/* parity\n                                           (apply form1 a1)\n                                           (apply form2 a2))))\n                                  (permute/permutation-sequence args)\n                                  (cycle [1 -1])))))\n             name `(~'wedge\n                    ~(v/freeze form1)\n                    ~(v/freeze form2))]\n         (procedure->nform-field w n name))))))\n\n(defn wedge\n  \"Computes the wedge product of the sequence `fs` of one-forms.\n\n  Higher rank forms can be constructed from one-forms by wedging them together.\n  This antisymmetric tensor product is computed as a determinant. The purpose of\n  this is to allow us to use the construction dx^dy to compute the area\n  described by the vectors that are given to it.\n\n  See Spivak p275 v1 of 'Differential Geometry' to see the correct definition.\n  The key is that the wedge of the coordinate basis forms had better be the\n  volume element.\"\n  ([] (constantly 1))\n  ([f] f)\n  ([f & fs]\n   (reduce (fn [r l]\n             (wedge2 l r))\n           (reverse (cons f fs)))))\n\n;; One-form fields multiply by [[wedge]].\n\n(defmethod g/mul [::form-field ::form-field] [a b]\n  (wedge2 a b))\n\n;; Alternative definition in terms of alternation.\n\n(defn Alt\n  \"Returns the alternation of the supplied differential `form`.\"\n  [form]\n  (let [n (get-rank form)]\n    (if (zero? n)\n      form\n      (letfn [(alternation [& args]\n                (assert (= (count args) n)\n                        \"Wrong number of args to alternation\")\n                (g/* (/ 1 (factorial n))\n                     (ua/generic-sum\n                      (map (fn [permutation parity]\n                             (g/* parity (apply form permutation)))\n                           (permute/permutation-sequence args)\n                           (cycle [1 -1])))))]\n        (procedure->nform-field\n         alternation n `(~'Alt ~(v/freeze form)))))))\n\n(defn- tensor-product2\n  ([t1] t1)\n  ([t1 t2]\n   (let [n1 (get-rank t1)\n         n2 (get-rank t2)]\n     (if (or (zero? n1) (zero? n2))\n       (g/* t1 t2)\n       (let [n  (+ n1 n2)\n             tp (fn [& args]\n                  (assert (= (count args) n)\n                          \"Wrong number of args to tensor product\")\n                  (let [[a1 a2] (split-at n1 args)]\n                    (g/* (apply t1 a1)\n                         (apply t2 a2))))]\n         (procedure->nform-field\n          tp n `(~'tensor-product\n                 ~(v/freeze t1)\n                 ~(v/freeze t2))))))))\n\n(defn- w2\n  ([form1] form1)\n  ([form1 form2]\n   (let [n1 (get-rank form1)\n         n2 (get-rank form2)]\n     (g/* (/ (factorial (+ n1 n2))\n             (* (factorial n1)\n                (factorial n2)))\n          (Alt (tensor-product2 form1 form2))))))\n\n(defn alt-wedge\n  \"Alternative definition of [[wedge]] in terms of alternation.\"\n  [& args]\n  (reduce w2 (constantly 1) args))\n\n;; ## Exterior Derivative\n;;\n;; A form field is a function of a place and a number of vector fields. The\n;; exterior derivative of this form field is a derivative of the form with\n;; respect to the place, removing any dependence on place of the vector fields.\n\n;; Consider w(v)(x), where b is the coefficient function for w in coordinates X:\n;;\n;; v1(w(v2))(x) - v2(w(v1))(x)\n;; = v1(b v2(X))(x) - v2(b v1(X))(x)\n;; = v1(b)(x) v2(X)(x) + b(x) v1(v2(X))(x)\n;; - v2(b)(x) v1(X)(x) - b(x) v2(v1(X))(x)\n;; = v1(b)(x) v2(X)(x) - v2(b)(x) v1(X)(x) + b(x)[v1, v2](X)(x)\n;; = v1(b)(x) v2(X)(x) - v2(b)(x) v1(X)(x) + w([v1, v2])(x)\n;;\n;;\n;; We define exterior derivative as follows:\n;;\n;; dw(v1, v2)(x)\n;; = v1(b)(x) v2(X)(x) - v2(b)(x) v1(X)(x)\n;; = v1(w(v2))(x) - v2(w(v1))(x) - w([v1, v2])(x)\n;;\n;; It is not obvious that this is equivalent to the standard definition. See\n;; page 91 in Spivak.\n;;\n;; Another way to think about this is that if we were able to define constant\n;; vector fields (v1_bar, v2_bar) that have constant coefficient functions equal\n;; to the value of the coefficient function at the point, then dw(v1, v2)(x)\n;; would be just v1_bar(w(v2_bar))(x) - v2_bar(w(v1_bar))(x).\n\n;; This definition is a generalization to k-forms, by recursion on the vector\n;; argument list.\n\n;; The test for k<n is best if the n is the dimension of the manifold under\n;; study. However, if the manifold is embedded in a higher dimensional manifold\n;; n will be the dimension of the bigger manifold, making this test less\n;; effective (cutting off fewer branches).\n\n;; Formula is from Spivak Vol. 1 p289.\n;;\n;; NOTE: This is an excessively complicated program. Another, more elementary\n;; program would, for a k-form, extract the cofficient functions relative to a\n;; literal basis, by applying it to the basis vectors, do the derivatives of the\n;; coefficients, to make one forms, and form the sum of the wedges of the new\n;; 1-forms with the wedges of the corresponding dual basis elements.\n\n(defn- exterior-derivative-procedure [kform]\n  (let [k (get-rank kform)]\n    (if (= k 0)\n      (differential-of-function kform)\n      (let [without #(concat (take %1 %2)\n                             (drop (inc %1) %2))\n            k+1form (fn [& vectors]\n                      (assert (= (count vectors) (inc k)))\n                      (fn [point]\n                        (let [n (:dimension\n                                 (m/point->manifold point))]\n                          (if (< k n)\n                            (ua/generic-sum\n                             (fn [i]\n                               (let [rest (without i vectors)]\n                                 (g/+ (g/* (if (even? i) 1 -1)\n                                           (((nth vectors i) (apply kform rest))\n                                            point))\n                                      (ua/generic-sum\n                                       (fn [j]\n                                         (g/* (if (even? (+ i j)) 1 -1)\n                                              ((apply kform\n                                                      (cons\n                                                       (o/commutator (nth vectors i)\n                                                                     (nth vectors j))\n                                                       ;; (dec j) because\n                                                       ;; already deleted i.\n                                                       (without (dec j) rest)))\n                                               point)))\n                                       (inc i)\n                                       (inc k)))))\n                             0 (inc k))\n                            0))))]\n        (procedure->nform-field\n         k+1form (inc k) `(~'d ~(v/freeze kform)))))))\n\n(def exterior-derivative\n  (o/make-operator\n   exterior-derivative-procedure 'd))\n\n(def d exterior-derivative)\n"]}
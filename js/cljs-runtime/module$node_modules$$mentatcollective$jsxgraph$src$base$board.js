shadow$provide.module$node_modules$$mentatcollective$jsxgraph$src$base$board=function(global,require,module,exports){function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}Object.defineProperty(exports,"__esModule",{value:!0});exports.default=void 0;var _jxg=_interopRequireDefault(require("module$node_modules$$mentatcollective$jsxgraph$src$jxg")),_constants=_interopRequireDefault(require("module$node_modules$$mentatcollective$jsxgraph$src$base$constants")),_coords=_interopRequireDefault(require("module$node_modules$$mentatcollective$jsxgraph$src$base$coords")),
_options=_interopRequireDefault(require("module$node_modules$$mentatcollective$jsxgraph$src$options")),_numerics=_interopRequireDefault(require("module$node_modules$$mentatcollective$jsxgraph$src$math$numerics")),_math=_interopRequireDefault(require("module$node_modules$$mentatcollective$jsxgraph$src$math$math")),_geometry=_interopRequireDefault(require("module$node_modules$$mentatcollective$jsxgraph$src$math$geometry")),_complex=_interopRequireDefault(require("module$node_modules$$mentatcollective$jsxgraph$src$math$complex")),
_statistics=_interopRequireDefault(require("module$node_modules$$mentatcollective$jsxgraph$src$math$statistics")),_jessiecode=_interopRequireDefault(require("module$node_modules$$mentatcollective$jsxgraph$src$parser$jessiecode")),_color=_interopRequireDefault(require("module$node_modules$$mentatcollective$jsxgraph$src$utils$color")),_type=_interopRequireDefault(require("module$node_modules$$mentatcollective$jsxgraph$src$utils$type")),_event=_interopRequireDefault(require("module$node_modules$$mentatcollective$jsxgraph$src$utils$event")),
_env=_interopRequireDefault(require("module$node_modules$$mentatcollective$jsxgraph$src$utils$env")),_composition=_interopRequireDefault(require("module$node_modules$$mentatcollective$jsxgraph$src$base$composition"));_jxg.default.Board=function(container,renderer,id,origin,zoomX,zoomY,unitX,unitY,canvasWidth,canvasHeight,attributes){this.BOARD_MODE_NONE=0;this.BOARD_MODE_DRAG=1;this.BOARD_MODE_MOVE_ORIGIN=2;this.BOARD_MODE_ZOOM=17;this.BOARD_QUALITY_LOW=1;this.BOARD_QUALITY_HIGH=2;_type.default.exists(attributes.document)&&
!1!==attributes.document?this.document=attributes.document:void 0!==document&&_type.default.isObject(document)&&(this.document=document);this.container=container;this.containerObj=_env.default.isBrowser?this.document.getElementById(this.container):null;if(_env.default.isBrowser&&"no"!==renderer.type&&null===this.containerObj)throw Error("\nJSXGraph: HTML container element '"+container+"' not found.");this.renderer=renderer;this.grids=[];this.options=_type.default.deepCopy(_options.default);this.attr=
attributes;this.dimension=2;this.jc=new _jessiecode.default;this.jc.use(this);this.origin={};this.origin.usrCoords=[1,0,0];this.origin.scrCoords=[1,origin[0],origin[1]];this.zoomX=zoomX;this.zoomY=zoomY;this.unitX=unitX*this.zoomX;this.unitY=unitY*this.zoomY;this.keepaspectratio=!1;this.canvasWidth=canvasWidth;this.canvasHeight=canvasHeight;_type.default.exists(id)&&""!==id&&_env.default.isBrowser&&!_type.default.exists(this.document.getElementById(id))?this.id=id:this.id=this.generateId();_event.default.eventify(this);
this.hooks=[];this.dependentBoards=[];this.inUpdate=!1;this.objects={};this.objectsList=[];this.groups={};this.animationObjects={};this.highlightedObjects={};this.numObjects=0;this.elementsByName={};this.mode=this.BOARD_MODE_NONE;this.updateQuality=this.BOARD_QUALITY_HIGH;this.isSuspendedRedraw=!1;this.calculateSnapSizes();this.drag_dy=this.drag_dx=0;this.drag_position=[0,0];this.mouse={};this.touches=[];this.xmlString="";this.cPos=[];this.touchMoveLast=0;this.touchMoveLastId=Infinity;this.positionAccessLast=
0;this.downObjects=[];this.attr.showcopyright&&this.renderer.displayCopyright(_constants.default.licenseText,parseInt(this.options.text.fontSize,10));this.reducedUpdate=this.needsFullUpdate=!1;this.currentCBDef="none";this.geonextCompatibilityMode=!1;this.options.text.useASCIIMathML&&translateASCIIMath?init():this.options.text.useASCIIMathML=!1;this.hasPointerUp=this.hasTouchEnd=this.hasMouseUp=this.hasPointerHandlers=this.hasTouchHandlers=this.hasMouseHandlers=!1;this._drag_offset=[0,0];this._inputDevice=
"mouse";this._board_touches=[];this._isResizing=this._isScrolling=this.isSelecting=this.selectingMode=!1;this.selectingBox=[[0,0],[0,0]];this.mathLib=Math;this.mathLibJXG=_jxg.default.Math;this.attr.registerevents&&this.addEventHandlers();this.methodMap={update:"update",fullUpdate:"fullUpdate",on:"on",off:"off",trigger:"trigger",setView:"setBoundingBox",setBoundingBox:"setBoundingBox",migratePoint:"migratePoint",colorblind:"emulateColorblindness",suspendUpdate:"suspendUpdate",unsuspendUpdate:"unsuspendUpdate",
clearTraces:"clearTraces",left:"clickLeftArrow",right:"clickRightArrow",up:"clickUpArrow",down:"clickDownArrow",zoomIn:"zoomIn",zoomOut:"zoomOut",zoom100:"zoom100",zoomElements:"zoomElements",remove:"removeObject",removeObject:"removeObject"}};_jxg.default.extend(_jxg.default.Board.prototype,{generateName:function(object){var maxNameLength=this.attr.maxnamelength,pre="",post="",indices=[];if(object.type===_constants.default.OBJECT_TYPE_TICKS)return"";var possibleNames=_type.default.isPoint(object)||
_type.default.isPoint3D(object)?" A B C D E F G H I J K L M N O P Q R S T U V W X Y Z".split(" "):object.type===_constants.default.OBJECT_TYPE_ANGLE?" \x26alpha; \x26beta; \x26gamma; \x26delta; \x26epsilon; \x26zeta; \x26eta; \x26theta; \x26iota; \x26kappa; \x26lambda; \x26mu; \x26nu; \x26xi; \x26omicron; \x26pi; \x26rho; \x26sigma; \x26tau; \x26upsilon; \x26phi; \x26chi; \x26psi; \x26omega;".split(" "):" a b c d e f g h i j k l m n o p q r s t u v w x y z".split(" ");_type.default.isPoint(object)||
object.elementClass===_constants.default.OBJECT_CLASS_LINE||object.type===_constants.default.OBJECT_TYPE_ANGLE||(pre=object.type===_constants.default.OBJECT_TYPE_POLYGON?"P_{":object.elementClass===_constants.default.OBJECT_CLASS_CIRCLE?"k_{":object.elementClass===_constants.default.OBJECT_CLASS_TEXT?"t_{":"s_{",post="}");for(object=0;object<maxNameLength;object++)indices[object]=0;for(;indices[maxNameLength-1]<possibleNames.length;){for(indices[0]=1;indices[0]<possibleNames.length;indices[0]++){var name=
pre;for(object=maxNameLength;0<object;object--)name+=possibleNames[indices[object-1]];if(!_type.default.exists(this.elementsByName[name+post]))return name+post}indices[0]=possibleNames.length;for(object=1;object<maxNameLength;object++)indices[object-1]===possibleNames.length&&(indices[object-1]=1,indices[object]+=1)}return""},generateId:function(){for(var r=1;_type.default.exists(_jxg.default.boards["jxgBoard"+r]);)r=Math.round(65535*Math.random());return"jxgBoard"+r},setId:function(obj,type){var num=
this.numObjects;var randomNumber=obj.id;this.numObjects+=1;if(""===randomNumber||!_type.default.exists(randomNumber))for(randomNumber=this.id+type+num;_type.default.exists(this.objects[randomNumber]);)randomNumber=Math.round(65535*Math.random()),randomNumber=this.id+type+num+"-"+randomNumber;obj.id=randomNumber;this.objects[randomNumber]=obj;obj._pos=this.objectsList.length;this.objectsList[this.objectsList.length]=obj;return randomNumber},finalizeAdding:function(obj){!1===_type.default.evaluate(obj.visProp.visible)&&
this.renderer.display(obj,!1)},finalizeLabel:function(obj){obj.hasLabel&&!_type.default.evaluate(obj.label.visProp.islabel)&&!1===_type.default.evaluate(obj.label.visProp.visible)&&this.renderer.display(obj.label,!1)},checkFrameRate:function(evt){var handleEvt=!1,time=(new Date).getTime();_type.default.exists(evt.pointerId)&&this.touchMoveLastId!==evt.pointerId&&(handleEvt=!0,this.touchMoveLastId=evt.pointerId);!handleEvt&&1E3<=(time-this.touchMoveLast)*this.attr.maxframerate&&(handleEvt=!0);handleEvt&&
(this.touchMoveLast=time);return handleEvt},getCoordsTopLeftCorner:function(){var doc,ownerDoc=this.document.ownerDocument||this.document;var crect=ownerDoc.documentElement||this.document.body.parentNode;var docBody=ownerDoc.body;ownerDoc=this.containerObj;if(0<this.cPos.length&&(this.mode===this.BOARD_MODE_DRAG||this.mode===this.BOARD_MODE_MOVE_ORIGIN||1E3>(new Date).getTime()-this.positionAccessLast))return this.cPos;this.positionAccessLast=(new Date).getTime();if(ownerDoc.getBoundingClientRect){crect=
ownerDoc.getBoundingClientRect();var cPos=1;for(doc=ownerDoc;doc&&_type.default.exists(doc.parentNode);)_type.default.exists(doc.style)&&_type.default.exists(doc.style.zoom)&&""!==doc.style.zoom&&(cPos*=parseFloat(doc.style.zoom)),doc=doc.parentNode;cPos=[crect.left*cPos,crect.top*cPos];cPos[0]+=_env.default.getProp(ownerDoc,"border-left-width");cPos[1]+=_env.default.getProp(ownerDoc,"border-top-width");"vml"!==this.renderer.type&&(cPos[0]+=_env.default.getProp(ownerDoc,"padding-left"),cPos[1]+=_env.default.getProp(ownerDoc,
"padding-top"));return this.cPos=cPos.slice()}cPos=_env.default.getOffset(ownerDoc);doc=this.document.documentElement.ownerDocument;!this.containerObj.currentStyle&&doc.defaultView&&(cPos[0]+=_env.default.getProp(crect,"margin-left"),cPos[1]+=_env.default.getProp(crect,"margin-top"),cPos[0]+=_env.default.getProp(crect,"border-left-width"),cPos[1]+=_env.default.getProp(crect,"border-top-width"),cPos[0]+=_env.default.getProp(crect,"padding-left"),cPos[1]+=_env.default.getProp(crect,"padding-top"));
docBody&&(cPos[0]+=_env.default.getProp(docBody,"left"),cPos[1]+=_env.default.getProp(docBody,"top"));"object"===typeof google&&google.translate&&(cPos[0]+=10,cPos[1]+=25);cPos[0]+=_env.default.getProp(ownerDoc,"border-left-width");cPos[1]+=_env.default.getProp(ownerDoc,"border-top-width");"vml"!==this.renderer.type&&(cPos[0]+=_env.default.getProp(ownerDoc,"padding-left"),cPos[1]+=_env.default.getProp(ownerDoc,"padding-top"));cPos[0]+=this.attr.offsetx;cPos[1]+=this.attr.offsety;return this.cPos=
cPos.slice()},getMousePosition:function(e,i){var cPos=this.getCoordsTopLeftCorner();e=_env.default.getPosition(e,i,this.document);_type.default.exists(this.cssTransMat)||this.updateCSSTransforms();cPos=[1,e[0]-cPos[0],e[1]-cPos[1]];cPos=_math.default.matVecMult(this.cssTransMat,cPos);cPos[1]/=cPos[0];cPos[2]/=cPos[0];return[cPos[1],cPos[2]]},initMoveOrigin:function(x,y){this.drag_dx=x-this.origin.scrCoords[1];this.drag_dy=y-this.origin.scrCoords[2];this.mode=this.BOARD_MODE_MOVE_ORIGIN;this.updateQuality=
this.BOARD_QUALITY_LOW},initMoveObject:function(x,y,evt,type){var el,collect=[],offset=[],len=this.objectsList.length,dragEl={visProp:{layer:-1E4}};for(el=0;el<len;el++){var pEl=this.objectsList[el];var haspoint=pEl.hasPoint&&pEl.hasPoint(x,y);pEl.visPropCalc.visible&&haspoint&&(pEl.triggerEventHandlers([type+"down","down"],[evt]),this.downObjects.push(pEl));!(haspoint&&pEl.isDraggable&&pEl.visPropCalc.visible)||(!this.geonextCompatibilityMode||!_type.default.isPoint(pEl)&&pEl.elementClass!==_constants.default.OBJECT_CLASS_TEXT)&&
this.geonextCompatibilityMode||_type.default.evaluate(pEl.visProp.fixed)||!(pEl.visProp.layer>dragEl.visProp.layer||pEl.visProp.layer===dragEl.visProp.layer&&pEl.lastDragTime.getTime()>=dragEl.lastDragTime.getTime())||this.attr.ignorelabels&&_type.default.exists(dragEl.label)&&pEl===dragEl.label||(dragEl=pEl,collect.push(dragEl),_type.default.exists(dragEl.coords)?offset.push(_statistics.default.subtract(dragEl.coords.scrCoords.slice(1),[x,y])):offset.push([0,0]))}this.attr.drag.enabled&&0<collect.length&&
(this.mode=this.BOARD_MODE_DRAG);this.attr.takefirst?(collect.length=1,this._drag_offset=offset[0]):(collect=collect.slice(-1),this._drag_offset=offset[offset.length-1]);this._drag_offset||(this._drag_offset=[0,0]);"svg"===this.renderer.type&&_type.default.exists(collect[0])&&_type.default.evaluate(collect[0].visProp.dragtotopoflayer)&&1===collect.length&&_type.default.exists(collect[0].rendNode)&&collect[0].rendNode.parentNode.appendChild(collect[0].rendNode);this.previousRotation=0;this.previousScale=
1;1<=collect.length&&(collect[0].highlight(!0),this.triggerEventHandlers(["mousehit","hit"],[evt,collect[0]]));return collect},moveObject:function(x,y,o,evt,type){x=new _coords.default(_constants.default.COORDS_BY_SCREEN,this.getScrCoordsOfMouse(x,y),this);var dragScrCoords;if(o&&o.obj){y=o.obj;y.coords&&(dragScrCoords=y.coords.scrCoords.slice());this.drag_position=[x.scrCoords[1],x.scrCoords[2]];this.drag_position=_statistics.default.add(this.drag_position,this._drag_offset);_type.default.exists(y.coords)?
y.setPositionDirectly(_constants.default.COORDS_BY_SCREEN,this.drag_position):(this.displayInfobox(!1),isNaN(o.targets[0].Xprev+o.targets[0].Yprev)||y.setPositionDirectly(_constants.default.COORDS_BY_SCREEN,[x.scrCoords[1],x.scrCoords[2]],[o.targets[0].Xprev,o.targets[0].Yprev]),o.targets[0].Xprev=x.scrCoords[1],o.targets[0].Yprev=x.scrCoords[2]);_type.default.exists(y.coords)&&(y.prepareUpdate().update(!1).updateRenderer(),this.updateInfobox(y),y.prepareUpdate().update(!0).updateRenderer());if(y.coords)var newDragScrCoords=
y.coords.scrCoords;y.coords&&dragScrCoords[1]===newDragScrCoords[1]&&dragScrCoords[2]===newDragScrCoords[2]||(y.triggerEventHandlers([type+"drag","drag"],[evt]),this.update());y.highlight(!0);this.triggerEventHandlers(["mousehit","hit"],[evt,y]);y.lastDragTime=new Date}},twoFingerMove:function(o,id,evt){if(_type.default.exists(o)&&_type.default.exists(o.obj)){var drag=o.obj;drag.elementClass===_constants.default.OBJECT_CLASS_LINE||drag.type===_constants.default.OBJECT_TYPE_POLYGON?this.twoFingerTouchObject(o.targets,
drag,id):drag.elementClass===_constants.default.OBJECT_CLASS_CIRCLE&&this.twoFingerTouchCircle(o.targets,drag,id);evt&&drag.triggerEventHandlers(["touchdrag","drag"],[evt])}},twoFingerTouchObject:function(tar,drag,id){var alpha=0;if(_type.default.exists(tar[0])&&_type.default.exists(tar[1])&&!isNaN(tar[0].Xprev+tar[0].Yprev+tar[1].Xprev+tar[1].Yprev)){if(id===tar[0].num){id=tar[1];var np=tar[0]}else id=tar[0],np=tar[1];tar=(new _coords.default(_constants.default.COORDS_BY_SCREEN,[id.Xprev,id.Yprev],
this)).usrCoords;id=(new _coords.default(_constants.default.COORDS_BY_SCREEN,[np.Xprev,np.Yprev],this)).usrCoords;np=(new _coords.default(_constants.default.COORDS_BY_SCREEN,[np.X,np.Y],this)).usrCoords;var od=_math.default.crossProduct(tar,id);var nd=_math.default.crossProduct(tar,np);nd=_math.default.crossProduct(od,nd);if(!(Math.abs(nd[0])<_math.default.eps)){_type.default.evaluate(drag.visProp.rotatable)&&(alpha=_geometry.default.rad(id.slice(1),tar.slice(1),np.slice(1)));alpha=this.create("transform",
[alpha,[tar[1],tar[2]]],{type:"rotate"});alpha.update();_type.default.evaluate(drag.visProp.scalable)&&(np=_geometry.default.distance(np,tar)/_geometry.default.distance(id,tar),id=this.create("transform",[-tar[1],-tar[2]],{type:"translate"}),np=this.create("transform",[np,np],{type:"scale"}),tar=this.create("transform",[tar[1],tar[2]],{type:"translate"}),alpha.melt(id).melt(np).melt(tar));if(drag.elementClass===_constants.default.OBJECT_CLASS_LINE)tar=[],drag.point1.draggable()&&tar.push(drag.point1),
drag.point2.draggable()&&tar.push(drag.point2),alpha.applyOnce(tar);else if(drag.type===_constants.default.OBJECT_TYPE_POLYGON){tar=[];np=drag.vertices.length-1;for(id=0;id<np;++id)drag.vertices[id].draggable()&&tar.push(drag.vertices[id]);alpha.applyOnce(tar)}this.update();drag.highlight(!0)}}},twoFingerTouchCircle:function(tar,drag,id){if("pointCircle"!==drag.method&&"pointLine"!==drag.method&&_type.default.exists(tar[0])&&_type.default.exists(tar[1])&&!isNaN(tar[0].Xprev+tar[0].Yprev+tar[1].Xprev+
tar[1].Yprev)){if(id===tar[0].num){var fixEl=tar[1];id=tar[0]}else fixEl=tar[0],id=tar[1];tar=(new _coords.default(_constants.default.COORDS_BY_SCREEN,[fixEl.Xprev,fixEl.Yprev],this)).usrCoords;fixEl=(new _coords.default(_constants.default.COORDS_BY_SCREEN,[id.Xprev,id.Yprev],this)).usrCoords;var np=(new _coords.default(_constants.default.COORDS_BY_SCREEN,[id.X,id.Y],this)).usrCoords;var alpha=_geometry.default.rad(fixEl.slice(1),tar.slice(1),np.slice(1));id=this.create("transform",[-tar[1],-tar[2]],
{type:"translate"});alpha=this.create("transform",[alpha],{type:"rotate"});id.melt(alpha);if(_type.default.evaluate(drag.visProp.scalable)){var d=_geometry.default.distance(tar,np)/_geometry.default.distance(tar,fixEl);fixEl=this.create("transform",[d,d],{type:"scale"});id.melt(fixEl)}tar=this.create("transform",[tar[1],tar[2]],{type:"translate"});id.melt(tar);drag.center.draggable()&&id.applyOnce([drag.center]);"twoPoints"===drag.method?drag.point2.draggable()&&id.applyOnce([drag.point2]):"pointRadius"===
drag.method&&_type.default.isNumber(drag.updateRadius.origin)&&drag.setRadius(drag.radius*d);this.update(drag.center);drag.highlight(!0)}},highlightElements:function(x,y,evt,target){var el,overObjects={},len=this.objectsList.length;for(el=0;el<len;el++){var pEl=this.objectsList[el];var pId=pEl.id;_type.default.exists(pEl.hasPoint)&&pEl.visPropCalc.visible&&pEl.hasPoint(x,y)&&(this.updateInfobox(pEl),_type.default.exists(this.highlightedObjects[pId])||(overObjects[pId]=pEl,pEl.highlight(),this.triggerEventHandlers(["mousehit",
"hit"],[evt,pEl,target])),pEl.mouseover?pEl.triggerEventHandlers(["mousemove","move"],[evt]):(pEl.triggerEventHandlers(["mouseover","over"],[evt]),pEl.mouseover=!0))}for(el=0;el<len;el++)pEl=this.objectsList[el],pId=pEl.id,pEl.mouseover&&!overObjects[pId]&&(pEl.triggerEventHandlers(["mouseout","out"],[evt]),pEl.mouseover=!1)},saveStartPos:function(obj,targets){var xy=[],i;if(obj.type===_constants.default.OBJECT_TYPE_TICKS)xy.push([1,NaN,NaN]);else if(obj.elementClass===_constants.default.OBJECT_CLASS_LINE)xy.push(obj.point1.coords.usrCoords),
xy.push(obj.point2.coords.usrCoords);else if(obj.elementClass===_constants.default.OBJECT_CLASS_CIRCLE)xy.push(obj.center.coords.usrCoords),"twoPoints"===obj.method&&xy.push(obj.point2.coords.usrCoords);else if(obj.type===_constants.default.OBJECT_TYPE_POLYGON){var len=obj.vertices.length-1;for(i=0;i<len;i++)xy.push(obj.vertices[i].coords.usrCoords)}else if(obj.type===_constants.default.OBJECT_TYPE_SECTOR)xy.push(obj.point1.coords.usrCoords),xy.push(obj.point2.coords.usrCoords),xy.push(obj.point3.coords.usrCoords);
else if(_type.default.isPoint(obj)||obj.type===_constants.default.OBJECT_TYPE_GLIDER)xy.push(obj.coords.usrCoords);else if(obj.elementClass===_constants.default.OBJECT_CLASS_CURVE)0<obj.points.length&&xy.push(obj.points[0].usrCoords);else try{xy.push(obj.coords.usrCoords)}catch(e){_jxg.default.debug("JSXGraph+ saveStartPos: obj.coords.usrCoords not available: "+e)}len=xy.length;for(i=0;i<len;i++)targets.Zstart.push(xy[i][0]),targets.Xstart.push(xy[i][1]),targets.Ystart.push(xy[i][2])},mouseOriginMoveStart:function(evt){var r;
if(r=this._isRequiredKeyPressed(evt,"pan"))evt=this.getMousePosition(evt),this.initMoveOrigin(evt[0],evt[1]);return r},mouseOriginMove:function(evt){var r=this.mode===this.BOARD_MODE_MOVE_ORIGIN;r&&(evt=this.getMousePosition(evt),this.moveOrigin(evt[0],evt[1],!0));return r},touchStartMoveOriginOneFinger:function(evt){var touches=evt[_jxg.default.touchProperty];if(touches=this.attr.pan.enabled&&!this.attr.pan.needtwofingers&&1===touches.length)evt=this.getMousePosition(evt,0),this.initMoveOrigin(evt[0],
evt[1]);return touches},touchOriginMove:function(evt){var r=this.mode===this.BOARD_MODE_MOVE_ORIGIN;r&&(evt=this.getMousePosition(evt,0),this.moveOrigin(evt[0],evt[1],!0));return r},originMoveEnd:function(){this.updateQuality=this.BOARD_QUALITY_HIGH;this.mode=this.BOARD_MODE_NONE},addEventHandlers:function(){_env.default.supportsPointerEvents()?this.addPointerEventHandlers():(this.addMouseEventHandlers(),this.addTouchEventHandlers());null!==this.containerObj&&(this.containerObj.oncontextmenu=function(e){_type.default.exists(e)&&
e.preventDefault();return!1});this.addFullscreenEventHandlers();this.addKeyboardEventHandlers();if(_env.default.isBrowser){try{this.startResizeObserver()}catch(err){_env.default.addEvent(window,"resize",this.resizeListener,this),this.startIntersectionObserver()}_env.default.addEvent(window,"scroll",this.scrollListener,this)}},removeEventHandlers:function(){this.removeMouseEventHandlers();this.removeTouchEventHandlers();this.removePointerEventHandlers();this.removeFullscreenEventHandlers();this.removeKeyboardEventHandlers();
_env.default.isBrowser&&(_type.default.exists(this.resizeObserver)?this.stopResizeObserver():(_env.default.removeEvent(window,"resize",this.resizeListener,this),this.stopIntersectionObserver()),_env.default.removeEvent(window,"scroll",this.scrollListener,this))},addPointerEventHandlers:function(){if(!this.hasPointerHandlers&&_env.default.isBrowser){var moveTarget=this.attr.movetarget||this.containerObj;window.navigator.msPointerEnabled?(_env.default.addEvent(this.containerObj,"MSPointerDown",this.pointerDownListener,
this),_env.default.addEvent(moveTarget,"MSPointerMove",this.pointerMoveListener,this)):(_env.default.addEvent(this.containerObj,"pointerdown",this.pointerDownListener,this),_env.default.addEvent(moveTarget,"pointermove",this.pointerMoveListener,this));_env.default.addEvent(this.containerObj,"mousewheel",this.mouseWheelListener,this);_env.default.addEvent(this.containerObj,"DOMMouseScroll",this.mouseWheelListener,this);null!==this.containerObj&&(this.containerObj.style.touchAction="none");this.hasPointerHandlers=
!0}},addMouseEventHandlers:function(){if(!this.hasMouseHandlers&&_env.default.isBrowser){var moveTarget=this.attr.movetarget||this.containerObj;_env.default.addEvent(this.containerObj,"mousedown",this.mouseDownListener,this);_env.default.addEvent(moveTarget,"mousemove",this.mouseMoveListener,this);_env.default.addEvent(this.containerObj,"mousewheel",this.mouseWheelListener,this);_env.default.addEvent(this.containerObj,"DOMMouseScroll",this.mouseWheelListener,this);this.hasMouseHandlers=!0}},addTouchEventHandlers:function(appleGestures){!this.hasTouchHandlers&&
_env.default.isBrowser&&(appleGestures=this.attr.movetarget||this.containerObj,_env.default.addEvent(this.containerObj,"touchstart",this.touchStartListener,this),_env.default.addEvent(appleGestures,"touchmove",this.touchMoveListener,this),this.hasTouchHandlers=!0)},addFullscreenEventHandlers:function(){var i,events=["fullscreenchange","mozfullscreenchange","webkitfullscreenchange","msfullscreenchange"],le=events.length;if(!this.hasFullsceenEventHandlers&&_env.default.isBrowser){for(i=0;i<le;i++)_env.default.addEvent(this.document,
events[i],this.fullscreenListener,this);this.hasFullsceenEventHandlers=!0}},addKeyboardEventHandlers:function(){this.attr.keyboard.enabled&&!this.hasKeyboardHandlers&&_env.default.isBrowser&&(_env.default.addEvent(this.containerObj,"keydown",this.keyDownListener,this),_env.default.addEvent(this.containerObj,"focusin",this.keyFocusInListener,this),_env.default.addEvent(this.containerObj,"focusout",this.keyFocusOutListener,this),this.hasKeyboardHandlers=!0)},removeKeyboardEventHandlers:function(){this.hasKeyboardHandlers&&
_env.default.isBrowser&&(_env.default.removeEvent(this.containerObj,"keydown",this.keyDownListener,this),_env.default.removeEvent(this.containerObj,"focusin",this.keyFocusInListener,this),_env.default.removeEvent(this.containerObj,"focusout",this.keyFocusOutListener,this),this.hasKeyboardHandlers=!1)},removeFullscreenEventHandlers:function(){var i,events=["fullscreenchange","mozfullscreenchange","webkitfullscreenchange","msfullscreenchange"],le=events.length;if(this.hasFullsceenEventHandlers&&_env.default.isBrowser){for(i=
0;i<le;i++)_env.default.removeEvent(this.document,events[i],this.fullscreenListener,this);this.hasFullsceenEventHandlers=!1}},removePointerEventHandlers:function(){if(this.hasPointerHandlers&&_env.default.isBrowser){var moveTarget=this.attr.movetarget||this.containerObj;window.navigator.msPointerEnabled?(_env.default.removeEvent(this.containerObj,"MSPointerDown",this.pointerDownListener,this),_env.default.removeEvent(moveTarget,"MSPointerMove",this.pointerMoveListener,this)):(_env.default.removeEvent(this.containerObj,
"pointerdown",this.pointerDownListener,this),_env.default.removeEvent(moveTarget,"pointermove",this.pointerMoveListener,this));_env.default.removeEvent(this.containerObj,"mousewheel",this.mouseWheelListener,this);_env.default.removeEvent(this.containerObj,"DOMMouseScroll",this.mouseWheelListener,this);this.hasPointerUp&&(window.navigator.msPointerEnabled?_env.default.removeEvent(this.document,"MSPointerUp",this.pointerUpListener,this):(_env.default.removeEvent(this.document,"pointerup",this.pointerUpListener,
this),_env.default.removeEvent(this.document,"pointercancel",this.pointerUpListener,this)),this.hasPointerUp=!1);this.hasPointerHandlers=!1}},removeMouseEventHandlers:function(){if(this.hasMouseHandlers&&_env.default.isBrowser){var moveTarget=this.attr.movetarget||this.containerObj;_env.default.removeEvent(this.containerObj,"mousedown",this.mouseDownListener,this);_env.default.removeEvent(moveTarget,"mousemove",this.mouseMoveListener,this);this.hasMouseUp&&(_env.default.removeEvent(this.document,
"mouseup",this.mouseUpListener,this),this.hasMouseUp=!1);_env.default.removeEvent(this.containerObj,"mousewheel",this.mouseWheelListener,this);_env.default.removeEvent(this.containerObj,"DOMMouseScroll",this.mouseWheelListener,this);this.hasMouseHandlers=!1}},removeTouchEventHandlers:function(){if(this.hasTouchHandlers&&_env.default.isBrowser){var moveTarget=this.attr.movetarget||this.containerObj;_env.default.removeEvent(this.containerObj,"touchstart",this.touchStartListener,this);_env.default.removeEvent(moveTarget,
"touchmove",this.touchMoveListener,this);this.hasTouchEnd&&(_env.default.removeEvent(this.document,"touchend",this.touchEndListener,this),this.hasTouchEnd=!1);this.hasTouchHandlers=!1}},clickLeftArrow:function(){this.moveOrigin(this.origin.scrCoords[1]+.1*this.canvasWidth,this.origin.scrCoords[2]);return this},clickRightArrow:function(){this.moveOrigin(this.origin.scrCoords[1]-.1*this.canvasWidth,this.origin.scrCoords[2]);return this},clickUpArrow:function(){this.moveOrigin(this.origin.scrCoords[1],
this.origin.scrCoords[2]-.1*this.canvasHeight);return this},clickDownArrow:function(){this.moveOrigin(this.origin.scrCoords[1],this.origin.scrCoords[2]+.1*this.canvasHeight);return this},gestureChangeListener:function(evt){var isPinch=!1,zx=this.attr.zoom.factorx,zy=this.attr.zoom.factory;if(this.mode!==this.BOARD_MODE_ZOOM)return!0;evt.preventDefault();var c=_geometry.default.distance([evt.touches[0].clientX,evt.touches[0].clientY],[evt.touches[1].clientX,evt.touches[1].clientY],2);void 0===evt.scale&&
(evt.scale=c/this.prevDist);if(!_type.default.exists(this.prevCoords))return!1;c=[evt.touches[0].clientX-this.prevCoords[0][0],evt.touches[0].clientY-this.prevCoords[0][1]];var dir2=[evt.touches[1].clientX-this.prevCoords[1][0],evt.touches[1].clientY-this.prevCoords[1][1]];if(100>c[0]*c[0]+c[1]*c[1]&&100>dir2[0]*dir2[0]+dir2[1]*dir2[1])return!1;c=_geometry.default.rad(c,[0,0],dir2);"pan"!==this.isPreviousGesture&&Math.abs(c)>.2*Math.PI&&Math.abs(c)<1.8*Math.PI&&(isPinch=!0);"pan"!==this.isPreviousGesture&&
!isPinch&&(.77>Math.abs(evt.scale)||1.3<Math.abs(evt.scale))&&(isPinch=!0);dir2=evt.scale/this.prevScale;this.prevScale=evt.scale;this.prevCoords=[[evt.touches[0].clientX,evt.touches[0].clientY],[evt.touches[1].clientX,evt.touches[1].clientY]];c=new _coords.default(_constants.default.COORDS_BY_SCREEN,this.getMousePosition(evt,0),this);if(this.attr.pan.enabled&&this.attr.pan.needtwofingers&&!isPinch)this.isPreviousGesture="pan",this.moveOrigin(c.scrCoords[1],c.scrCoords[2],!0);else if(this.attr.zoom.enabled&&
.5>Math.abs(dir2-1)){if(this.attr.zoom.pinchhorizontal||this.attr.zoom.pinchvertical){isPinch=Math.abs(evt.touches[0].clientX-evt.touches[1].clientX);evt=Math.abs(evt.touches[0].clientY-evt.touches[1].clientY);var theta=Math.abs(Math.atan2(evt,isPinch));var bound=Math.PI*this.attr.zoom.pinchsensitivity/90}this.attr.zoom.pinchhorizontal&&theta<bound?(this.attr.zoom.factorx=dir2,this.attr.zoom.factory=1,isPinch=evt=0):this.attr.zoom.pinchvertical&&Math.abs(theta-.5*Math.PI)<bound?(this.attr.zoom.factorx=
1,this.attr.zoom.factory=dir2,isPinch=evt=0):(this.attr.zoom.factorx=dir2,this.attr.zoom.factory=dir2,evt=c.usrCoords[1],isPinch=c.usrCoords[2]);this.zoomIn(evt,isPinch);this.attr.zoom.factorx=zx;this.attr.zoom.factory=zy}return!1},gestureStartListener:function(evt){evt.preventDefault();this.prevScale=1;this.prevDist=_geometry.default.distance([evt.touches[0].clientX,evt.touches[0].clientY],[evt.touches[1].clientX,evt.touches[1].clientY],2);this.prevCoords=[[evt.touches[0].clientX,evt.touches[0].clientY],
[evt.touches[1].clientX,evt.touches[1].clientY]];this.isPreviousGesture="none";evt=this.getMousePosition(evt,0);this.initMoveOrigin(evt[0],evt[1]);this.mode=this.BOARD_MODE_ZOOM;return!1},_isRequiredKeyPressed:function(evt,action){action=this.attr[action];return action.enabled?(action.needshift&&evt.shiftKey||!action.needshift&&!evt.shiftKey)&&(action.needctrl&&evt.ctrlKey||!action.needctrl&&!evt.ctrlKey)?!0:!1:!1},_isPointerRegistered:function(evt){var i,len=this._board_touches.length;for(i=0;i<
len;i++)if(this._board_touches[i].pointerId===evt.pointerId)return!0;return!1},_pointerStorePosition:function(evt){var found;var i=0;for(found=!1;i<this._board_touches.length;i++)if(this._board_touches[i].pointerId===evt.pointerId){this._board_touches[i].clientX=evt.clientX;this._board_touches[i].clientY=evt.clientY;found=!0;break}!found&&2>this._board_touches.length&&this._board_touches.push({pointerId:evt.pointerId,clientX:evt.clientX,clientY:evt.clientY});return this},_pointerRemoveTouches:function(evt){var i;
for(i=0;i<this._board_touches.length;i++)if(this._board_touches[i].pointerId===evt.pointerId){this._board_touches.splice(i,1);break}return this},_pointerClearTouches:function(){0<this._board_touches.length&&this.dehighlightAll();this.updateQuality=this.BOARD_QUALITY_HIGH;this.mode=this.BOARD_MODE_NONE;this._board_touches=[];this.touches=[]},_getPointerInputDevice:function(evt){if(_env.default.isBrowser){if("touch"===evt.pointerType||window.navigator.msMaxTouchPoints&&1<window.navigator.msMaxTouchPoints)return"touch";
if("mouse"===evt.pointerType)return"mouse";if("pen"===evt.pointerType)return"pen"}return"mouse"},pointerDownListener:function(evt,object){if(!object&&this._isPointerRegistered(evt))return!1;!object&&evt.isPrimary&&this._pointerClearTouches();this.hasPointerUp||(window.navigator.msPointerEnabled?_env.default.addEvent(this.document,"MSPointerUp",this.pointerUpListener,this):(_env.default.addEvent(this.document,"pointerup",this.pointerUpListener,this),_env.default.addEvent(this.document,"pointercancel",
this.pointerUpListener,this)),this.hasPointerUp=!0);this.hasMouseHandlers&&this.removeMouseEventHandlers();this.hasTouchHandlers&&this.removeTouchEventHandlers();if(this.document.selection&&_type.default.isFunction(this.document.selection.empty))this.document.selection.empty();else if(window.getSelection){var i=window.getSelection();if(i.removeAllRanges)try{i.removeAllRanges()}catch(e){}}var elements=this._inputDevice=this._getPointerInputDevice(evt);this.options.precision.hasPoint=this.options.precision[elements];
i=this.getMousePosition(evt);this._testForSelection(evt);if(this.selectingMode)this._startSelecting(i),this.triggerEventHandlers(["touchstartselecting","pointerstartselecting","startselecting"],[evt]);else{this.attr.drag.enabled&&object?(elements=[object],this.mode=this.BOARD_MODE_DRAG):elements=this.initMoveObject(i[0],i[1],evt,elements);object={num:evt.pointerId,X:i[0],Y:i[1],Xprev:NaN,Yprev:NaN,Xstart:[],Ystart:[],Zstart:[]};if(0<elements.length){var target=elements[elements.length-1];elements=
!1;for(i=0;i<this.touches.length;i++)if(this.touches[i].obj===target){var j=i;var k=this.touches[i].targets.push(object)-1;elements=!0;break}elements||(k=0,j=this.touches.push({obj:target,targets:[object]})-1);this.dehighlightAll();target.highlight(!0);this.saveStartPos(target,this.touches[j].targets[k]);evt&&evt.preventDefault?evt.preventDefault():window.event&&(window.event.returnValue=!1)}0<this.touches.length&&(evt.preventDefault(),evt.stopPropagation());if(!_env.default.isBrowser)return!1;"touch"!==
this._getPointerInputDevice(evt)?this.mode===this.BOARD_MODE_NONE&&this.mouseOriginMoveStart(evt):(this._pointerStorePosition(evt),evt.touches=this._board_touches,1===evt.touches.length&&this.mode===this.BOARD_MODE_NONE&&this.touchStartMoveOriginOneFinger(evt)||2!==evt.touches.length||this.mode!==this.BOARD_MODE_NONE&&this.mode!==this.BOARD_MODE_MOVE_ORIGIN||(this.mode===this.BOARD_MODE_MOVE_ORIGIN&&this.originMoveEnd(),this.gestureStartListener(evt)));this.triggerEventHandlers(["touchstart","down",
"pointerdown","MSPointerDown"],[evt]);return!1}},pointerMoveListener:function(evt){var i,j;if("touch"===this._getPointerInputDevice(evt)&&!this._isPointerRegistered(evt))return this.BOARD_MODE_NONE;if(!this.checkFrameRate(evt))return!1;this.mode!==this.BOARD_MODE_DRAG&&(this.dehighlightAll(),this.displayInfobox(!1));this.mode!==this.BOARD_MODE_NONE&&(evt.preventDefault(),evt.stopPropagation());this.updateQuality=this.BOARD_QUALITY_LOW;var type=this._inputDevice=this._getPointerInputDevice(evt);this.options.precision.hasPoint=
this.options.precision[type];if(this.selectingMode){var pos=this.getMousePosition(evt);this._moveSelecting(pos);this.triggerEventHandlers(["touchmoveselecting","moveselecting","pointermoveselecting"],[evt,this.mode])}else if(!this.mouseOriginMove(evt))if(this.mode===this.BOARD_MODE_DRAG)for(i=0;i<this.touches.length;i++){var touchTargets=this.touches[i].targets;for(j=0;j<touchTargets.length;j++)if(touchTargets[j].num===evt.pointerId){pos=this.getMousePosition(evt);touchTargets[j].X=pos[0];touchTargets[j].Y=
pos[1];1===touchTargets.length?this.moveObject(pos[0],pos[1],this.touches[i],evt,type):2===touchTargets.length&&(this.twoFingerMove(this.touches[i],evt.pointerId,evt),touchTargets[j].Xprev=pos[0],touchTargets[j].Yprev=pos[1]);break}}else"touch"===this._getPointerInputDevice(evt)&&(this._pointerStorePosition(evt),2===this._board_touches.length&&(evt.touches=this._board_touches,this.gestureChangeListener(evt))),pos=this.getMousePosition(evt),this.highlightElements(pos[0],pos[1],evt,-1);this.triggerEventHandlers(["touchmove",
"move","pointermove","MSPointerMove"],[evt,this.mode]);this.updateQuality=this.BOARD_QUALITY_HIGH;return this.mode===this.BOARD_MODE_NONE},pointerUpListener:function(evt){var i,j,updateNeeded=!1;this.triggerEventHandlers(["touchend","up","pointerup","MSPointerUp"],[evt]);this.displayInfobox(!1);if(evt)for(i=0;i<this.touches.length;i++){var found=this.touches[i].targets;for(j=0;j<found.length;j++)if(found[j].num===evt.pointerId){found.splice(j,1);0===found.length&&this.touches.splice(i,1);break}}this.originMoveEnd();
this.update();if(this.selectingMode)this._stopSelecting(evt),this.triggerEventHandlers(["touchstopselecting","pointerstopselecting","stopselecting"],[evt]),this.stopSelectionMode();else for(i=this.downObjects.length-1;-1<i;i--){found=!1;for(j=0;j<this.touches.length;j++)this.touches[j].obj.id===this.downObjects[i].id&&(found=!0);found||(this.downObjects[i].triggerEventHandlers(["touchend","up","pointerup","MSPointerUp"],[evt]),_type.default.exists(this.downObjects[i].coords)||(this.downObjects[i].snapToGrid(),
this.downObjects[i].snapToPoints(),updateNeeded=!0),this.downObjects.splice(i,1))}this.hasPointerUp&&(window.navigator.msPointerEnabled?_env.default.removeEvent(this.document,"MSPointerUp",this.pointerUpListener,this):(_env.default.removeEvent(this.document,"pointerup",this.pointerUpListener,this),_env.default.removeEvent(this.document,"pointercancel",this.pointerUpListener,this)),this.hasPointerUp=!1);updateNeeded&&this.update();this._pointerClearTouches();return!0},touchStartListener:function(evt){var i,
pos,k,evtTouches=evt[_jxg.default.touchProperty];this.hasTouchEnd||(_env.default.addEvent(this.document,"touchend",this.touchEndListener,this),this.hasTouchEnd=!0);this.document.selection&&_type.default.isFunction(this.document.selection.empty)?this.document.selection.empty():window.getSelection&&window.getSelection().removeAllRanges();this._inputDevice="touch";this.options.precision.hasPoint=this.options.precision.touch;for(i=0;i<evtTouches.length;i++)evtTouches[i].jxg_isused=!1;for(i=0;i<this.touches.length;i++){var target=
this.touches[i].targets;for(pos=0;pos<target.length;pos++){target[pos].num=-1;var eps=this.options.precision.touch;do{for(k=0;k<evtTouches.length;k++)if(Math.abs(Math.pow(evtTouches[k].screenX-target[pos].X,2)+Math.pow(evtTouches[k].screenY-target[pos].Y,2))<eps*eps){target[pos].num=k;target[pos].X=evtTouches[k].screenX;target[pos].Y=evtTouches[k].screenY;evtTouches[k].jxg_isused=!0;break}eps*=2}while(-1===target[pos].num&&eps<this.options.precision.touchMax);-1===target[pos].num&&(_jxg.default.debug("i couldn't find a targettouches for target no "+
pos+" on "+this.touches[i].obj.name+" ("+this.touches[i].obj.id+"). Removed the target."),_jxg.default.debug("eps \x3d "+eps+", touchMax \x3d "+_options.default.precision.touchMax),target.splice(i,1))}}for(i=0;i<evtTouches.length;i++)if(!evtTouches[i].jxg_isused){pos=this.getMousePosition(evt,i);if(this.selectingMode)return this._startSelecting(pos),this.triggerEventHandlers(["touchstartselecting","startselecting"],[evt]),evt.preventDefault(),evt.stopPropagation(),this.options.precision.hasPoint=
this.options.precision.mouse,0<this.touches.length;pos=this.initMoveObject(pos[0],pos[1],evt,"touch");if(0!==pos.length)if(k=pos[pos.length-1],target={num:i,X:evtTouches[i].screenX,Y:evtTouches[i].screenY,Xprev:NaN,Yprev:NaN,Xstart:[],Ystart:[],Zstart:[]},_type.default.isPoint(k)||k.elementClass===_constants.default.OBJECT_CLASS_TEXT||k.type===_constants.default.OBJECT_TYPE_TICKS||k.type===_constants.default.OBJECT_TYPE_IMAGE)pos=[target],this.saveStartPos(k,pos[0]),this.touches.push({obj:k,targets:pos}),
k.highlight(!0);else if(k.elementClass===_constants.default.OBJECT_CLASS_LINE||k.elementClass===_constants.default.OBJECT_CLASS_CIRCLE||k.elementClass===_constants.default.OBJECT_CLASS_CURVE||k.type===_constants.default.OBJECT_TYPE_POLYGON){eps=!1;for(pos=0;pos<this.touches.length;pos++)k.id===this.touches[pos].obj.id&&(eps=!0,1===this.touches[pos].targets.length&&(this.saveStartPos(k,target),this.touches[pos].targets.push(target)),evtTouches[i].jxg_isused=!0);eps||(pos=[target],this.saveStartPos(k,
pos[0]),this.touches.push({obj:k,targets:pos}),k.highlight(!0))}evtTouches[i].jxg_isused=!0}0<this.touches.length&&(evt.preventDefault(),evt.stopPropagation());1===evtTouches.length&&this.mode===this.BOARD_MODE_NONE&&this.touchStartMoveOriginOneFinger(evt)||2!==evtTouches.length||this.mode!==this.BOARD_MODE_NONE&&this.mode!==this.BOARD_MODE_MOVE_ORIGIN||(this.mode===this.BOARD_MODE_MOVE_ORIGIN&&this.originMoveEnd(),this.gestureStartListener(evt));this.options.precision.hasPoint=this.options.precision.mouse;
this.triggerEventHandlers(["touchstart","down"],[evt]);return!1},touchMoveListener:function(evt){var i,evtTouches=evt[_jxg.default.touchProperty];if(!this.checkFrameRate(evt))return!1;this.mode!==this.BOARD_MODE_NONE&&(evt.preventDefault(),evt.stopPropagation());this.mode!==this.BOARD_MODE_DRAG&&(this.dehighlightAll(),this.displayInfobox(!1));this._inputDevice="touch";this.options.precision.hasPoint=this.options.precision.touch;this.updateQuality=this.BOARD_QUALITY_LOW;if(this.selectingMode)for(i=
0;i<evtTouches.length;i++){if(!evtTouches[i].jxg_isused){var pos1=this.getMousePosition(evt,i);this._moveSelecting(pos1);this.triggerEventHandlers(["touchmoves","moveselecting"],[evt,this.mode]);break}}else if(!this.touchOriginMove(evt))if(this.mode===this.BOARD_MODE_DRAG)for(i=0;i<this.touches.length;i++){var touchTargets=this.touches[i].targets;if(1===touchTargets.length){if(evtTouches[touchTargets[0].num]){pos1=this.getMousePosition(evt,touchTargets[0].num);if(0>pos1[0]||pos1[0]>this.canvasWidth||
0>pos1[1]||pos1[1]>this.canvasHeight)return;touchTargets[0].X=pos1[0];touchTargets[0].Y=pos1[1];this.moveObject(pos1[0],pos1[1],this.touches[i],evt,"touch")}}else if(2===touchTargets.length&&-1<touchTargets[0].num&&-1<touchTargets[1].num&&evtTouches[touchTargets[0].num]&&evtTouches[touchTargets[1].num]){pos1=this.getMousePosition(evt,touchTargets[0].num);var pos2=this.getMousePosition(evt,touchTargets[1].num);if(0>pos1[0]||pos1[0]>this.canvasWidth||0>pos1[1]||pos1[1]>this.canvasHeight||0>pos2[0]||
pos2[0]>this.canvasWidth||0>pos2[1]||pos2[1]>this.canvasHeight)return;touchTargets[0].X=pos1[0];touchTargets[0].Y=pos1[1];touchTargets[1].X=pos2[0];touchTargets[1].Y=pos2[1];this.twoFingerMove(this.touches[i],touchTargets[0].num,evt);this.twoFingerMove(this.touches[i],touchTargets[1].num);touchTargets[0].Xprev=pos1[0];touchTargets[0].Yprev=pos1[1];touchTargets[1].Xprev=pos2[0];touchTargets[1].Yprev=pos2[1]}}else 2===evtTouches.length&&this.gestureChangeListener(evt),pos1=this.getMousePosition(evt,
0),this.highlightElements(pos1[0],pos1[1],evt,-1);this.mode!==this.BOARD_MODE_DRAG&&this.displayInfobox(!1);this.triggerEventHandlers(["touchmove","move"],[evt,this.mode]);this.options.precision.hasPoint=this.options.precision.mouse;this.updateQuality=this.BOARD_QUALITY_HIGH;return this.mode===this.BOARD_MODE_NONE},touchEndListener:function(evt){var i,j,k,eps=this.options.precision.touch,tmpTouches=[],evtTouches=evt&&evt[_jxg.default.touchProperty],updateNeeded=!1;this.triggerEventHandlers(["touchend",
"up"],[evt]);this.displayInfobox(!1);if(this.selectingMode)this._stopSelecting(evt),this.triggerEventHandlers(["touchstopselecting","stopselecting"],[evt]),this.stopSelectionMode();else if(evtTouches&&0<evtTouches.length){for(i=0;i<this.touches.length;i++)tmpTouches[i]=this.touches[i];for(i=this.touches.length=0;i<evtTouches.length;i++)evtTouches[i].jxg_isused=!1;for(i=0;i<tmpTouches.length;i++){var found=!1;var foundNumber=0;var touchTargets=tmpTouches[i].targets;for(j=0;j<touchTargets.length;j++)for(touchTargets[j].found=
!1,k=0;k<evtTouches.length;k++)if(Math.abs(Math.pow(evtTouches[k].screenX-touchTargets[j].X,2)+Math.pow(evtTouches[k].screenY-touchTargets[j].Y,2))<eps*eps){touchTargets[j].found=!0;touchTargets[j].num=k;touchTargets[j].X=evtTouches[k].screenX;touchTargets[j].Y=evtTouches[k].screenY;foundNumber+=1;break}_type.default.isPoint(tmpTouches[i].obj)?found=touchTargets[0]&&touchTargets[0].found:tmpTouches[i].obj.elementClass===_constants.default.OBJECT_CLASS_LINE?found=touchTargets[0]&&touchTargets[0].found||
touchTargets[1]&&touchTargets[1].found:tmpTouches[i].obj.elementClass===_constants.default.OBJECT_CLASS_CIRCLE&&(found=1===foundNumber||3===foundNumber);if(found)for(this.touches.push({obj:tmpTouches[i].obj,targets:[]}),j=0;j<touchTargets.length;j++)touchTargets[j].found&&this.touches[this.touches.length-1].targets.push({num:touchTargets[j].num,X:touchTargets[j].screenX,Y:touchTargets[j].screenY,Xprev:NaN,Yprev:NaN,Xstart:touchTargets[j].Xstart,Ystart:touchTargets[j].Ystart,Zstart:touchTargets[j].Zstart});
else tmpTouches[i].obj.noHighlight()}}else this.touches.length=0;for(i=this.downObjects.length-1;-1<i;i--){found=!1;for(j=0;j<this.touches.length;j++)this.touches[j].obj.id===this.downObjects[i].id&&(found=!0);found||(this.downObjects[i].triggerEventHandlers(["touchup","up"],[evt]),_type.default.exists(this.downObjects[i].coords)||(this.downObjects[i].snapToGrid(),this.downObjects[i].snapToPoints(),updateNeeded=!0),this.downObjects.splice(i,1))}evtTouches&&0!==evtTouches.length||(this.hasTouchEnd&&
(_env.default.removeEvent(this.document,"touchend",this.touchEndListener,this),this.hasTouchEnd=!1),this.dehighlightAll(),this.updateQuality=this.BOARD_QUALITY_HIGH,this.originMoveEnd(),updateNeeded&&this.update());return!0},mouseDownListener:function(evt){this.document.selection&&_type.default.isFunction(this.document.selection.empty)?this.document.selection.empty():window.getSelection&&window.getSelection().removeAllRanges();if(!this.hasMouseUp){_env.default.addEvent(this.document,"mouseup",this.mouseUpListener,
this);this.hasMouseUp=!0;this._inputDevice="mouse";this.options.precision.hasPoint=this.options.precision.mouse;var pos=this.getMousePosition(evt);this._testForSelection(evt);if(this.selectingMode)this._startSelecting(pos),this.triggerEventHandlers(["mousestartselecting","startselecting"],[evt]);else{var elements=this.initMoveObject(pos[0],pos[1],evt,"mouse");if(0===elements.length){this.mode=this.BOARD_MODE_NONE;var result=!0}else this.mouse={obj:null,targets:[{X:pos[0],Y:pos[1],Xprev:NaN,Yprev:NaN}]},
this.mouse.obj=elements[elements.length-1],this.dehighlightAll(),this.mouse.obj.highlight(!0),this.mouse.targets[0].Xstart=[],this.mouse.targets[0].Ystart=[],this.mouse.targets[0].Zstart=[],this.saveStartPos(this.mouse.obj,this.mouse.targets[0]),evt&&evt.preventDefault?evt.preventDefault():window.event&&(window.event.returnValue=!1);this.mode===this.BOARD_MODE_NONE&&(result=this.mouseOriginMoveStart(evt));this.triggerEventHandlers(["mousedown","down"],[evt]);return result}}},mouseMoveListener:function(evt){if(!this.checkFrameRate(evt))return!1;
var pos=this.getMousePosition(evt);this.updateQuality=this.BOARD_QUALITY_LOW;this.mode!==this.BOARD_MODE_DRAG&&(this.dehighlightAll(),this.displayInfobox(!1));this.selectingMode?(this._moveSelecting(pos),this.triggerEventHandlers(["mousemoveselecting","moveselecting"],[evt,this.mode])):this.mouseOriginMove(evt)||(this.mode===this.BOARD_MODE_DRAG?this.moveObject(pos[0],pos[1],this.mouse,evt,"mouse"):this.highlightElements(pos[0],pos[1],evt,-1),this.triggerEventHandlers(["mousemove","move"],[evt,this.mode]));
this.updateQuality=this.BOARD_QUALITY_HIGH},mouseUpListener:function(evt){var i;!1===this.selectingMode&&this.triggerEventHandlers(["mouseup","up"],[evt]);this.updateQuality=this.BOARD_QUALITY_HIGH;this.mouse&&this.mouse.obj&&!_type.default.exists(this.mouse.obj.coords)&&(this.mouse.obj.snapToGrid(this.mouse.targets[0]),this.mouse.obj.snapToPoints());this.originMoveEnd();this.dehighlightAll();this.update();if(this.selectingMode)this._stopSelecting(evt),this.triggerEventHandlers(["mousestopselecting",
"stopselecting"],[evt]),this.stopSelectionMode();else for(i=0;i<this.downObjects.length;i++)this.downObjects[i].triggerEventHandlers(["mouseup","up"],[evt]);this.downObjects.length=0;this.hasMouseUp&&(_env.default.removeEvent(this.document,"mouseup",this.mouseUpListener,this),this.hasMouseUp=!1);this.mouse=null},mouseWheelListener:function(evt){if(!this.attr.zoom.wheel||!this._isRequiredKeyPressed(evt,"zoom"))return!0;evt=evt||window.event;var wd=evt.detail?-evt.detail:evt.wheelDelta/40,pos=new _coords.default(_constants.default.COORDS_BY_SCREEN,
this.getMousePosition(evt),this);0<wd?this.zoomIn(pos.usrCoords[1],pos.usrCoords[2]):this.zoomOut(pos.usrCoords[1],pos.usrCoords[2]);this.triggerEventHandlers(["mousewheel"],[evt]);evt.preventDefault();return!1},keyDownListener:function(evt){var id_node=evt.target.id,dx=_type.default.evaluate(this.attr.keyboard.dx)/this.unitX,dy=_type.default.evaluate(this.attr.keyboard.dy)/this.unitY;var sX=!1;var done=!0,dir,actPos;if(!this.attr.keyboard.enabled||""===id_node)return!1;var id=this.containerObj.shadowRoot||
document;if(id.activeElement&&(id=id.activeElement,"INPUT"===id.tagName||"textarea"===id.tagName))return!1;id=id_node.replace(this.containerObj.id+"_","");id=this.select(id);_type.default.exists(id.coords)&&(actPos=id.coords.usrCoords.slice(1));_type.default.evaluate(this.attr.keyboard.panshift)&&evt.shiftKey||_type.default.evaluate(this.attr.keyboard.panctrl)&&evt.ctrlKey?(!0===_type.default.evaluate(this.attr.zoom.enabled)&&(sX=!0),38===evt.keyCode?this.clickUpArrow():40===evt.keyCode?this.clickDownArrow():
37===evt.keyCode?this.clickLeftArrow():39===evt.keyCode?this.clickRightArrow():sX&&171===evt.keyCode?this.zoomIn():sX&&173===evt.keyCode?this.zoomOut():sX&&79===evt.keyCode?this.zoom100():done=!1):(_type.default.exists(id.visProp)&&(_type.default.exists(id.visProp.snaptogrid)&&id.visProp.snaptogrid&&_type.default.evaluate(id.visProp.snapsizex)&&_type.default.evaluate(id.visProp.snapsizey)?(id_node=id.getSnapSizes(),sX=id_node[0],id_node=id_node[1],dx=Math.max(sX,dx),dy=Math.max(id_node,dy)):_type.default.exists(id.visProp.attracttogrid)&&
id.visProp.attracttogrid&&_type.default.evaluate(id.visProp.attractordistance)&&_type.default.evaluate(id.visProp.attractorunit)&&(id_node=sX=1.1*_type.default.evaluate(id.visProp.attractordistance),"screen"===_type.default.evaluate(id.visProp.attractorunit)&&(sX/=this.unitX,id_node/=this.unitX),dx=Math.max(sX,dx),dy=Math.max(id_node,dy))),38===evt.keyCode?dir=[0,dy]:40===evt.keyCode?dir=[0,-dy]:37===evt.keyCode?dir=[-dx,0]:39===evt.keyCode?dir=[dx,0]:done=!1,dir&&id.isDraggable&&id.visPropCalc.visible&&
(this.geonextCompatibilityMode&&(_type.default.isPoint(id)||id.elementClass===_constants.default.OBJECT_CLASS_TEXT)||!this.geonextCompatibilityMode)&&!_type.default.evaluate(id.visProp.fixed)&&(_type.default.exists(id.coords)&&(dir[0]+=actPos[0],dir[1]+=actPos[1]),id.setPosition(_jxg.default.COORDS_BY_USER,dir),_type.default.exists(id.coords)&&this.updateInfobox(id),this.triggerEventHandlers(["hit"],[evt,id])));this.update();done&&_type.default.exists(evt.preventDefault)&&evt.preventDefault();return done},
keyFocusInListener:function(evt){var id_node=evt.target.id;if(!this.attr.keyboard.enabled||""===id_node)return!1;id_node=id_node.replace(this.containerObj.id+"_","");id_node=this.select(id_node);_type.default.exists(id_node.highlight)&&id_node.highlight(!0);_type.default.exists(id_node.coords)&&this.updateInfobox(id_node);this.triggerEventHandlers(["hit"],[evt,id_node])},keyFocusOutListener:function(evt){if(!this.attr.keyboard.enabled)return!1;this.dehighlightAll();this.displayInfobox(!1)},updateContainerDims:function(){var h=
this.containerObj.getBoundingClientRect();var w=h.width;h=h.height;if(window&&window.getComputedStyle){var css=window.getComputedStyle(this.containerObj,null);w-=parseFloat(css.getPropertyValue("border-left-width"))+parseFloat(css.getPropertyValue("border-right-width"));h-=parseFloat(css.getPropertyValue("border-top-width"))+parseFloat(css.getPropertyValue("border-bottom-width"))}0>=w||0>=h||isNaN(w)||isNaN(h)||(isNaN(this.getBoundingBox()[0])&&this.setBoundingBox(this.attr.boundingbox,this.keepaspectratio,
"keep"),_type.default.exists(this._prevDim)&&this._prevDim.w===w&&this._prevDim.h===h||(this.resizeContainer(w,h,!0),this._prevDim={w,h}))},startResizeObserver:function(){var that=this;_env.default.isBrowser&&this.attr.resize&&this.attr.resize.enabled&&(this.resizeObserver=new ResizeObserver(function(entries){that._isResizing||(that._isResizing=!0,window.setTimeout(function(){try{that.updateContainerDims()}catch(err){that.stopResizeObserver()}finally{that._isResizing=!1}},that.attr.resize.throttle))}),
this.resizeObserver.observe(this.containerObj))},stopResizeObserver:function(){_env.default.isBrowser&&this.attr.resize&&this.attr.resize.enabled&&_type.default.exists(this.resizeObserver)&&this.resizeObserver.unobserve(this.containerObj)},resizeListener:function(){var that=this;_env.default.isBrowser&&this.attr.resize&&this.attr.resize.enabled&&!this._isScrolling&&!this._isResizing&&(this._isResizing=!0,window.setTimeout(function(){that.updateContainerDims();that._isResizing=!1},this.attr.resize.throttle))},
scrollListener:function(evt){var that=this;_env.default.isBrowser&&!this._isScrolling&&(this._isScrolling=!0,window.setTimeout(function(){that._isScrolling=!1},66))},startIntersectionObserver:function(){var that=this,options={root:null,rootMargin:"0px",threshold:.8};try{this.intersectionObserver=new IntersectionObserver(function(entries){isNaN(that.getBoundingBox()[0])&&that.updateContainerDims()},options),this.intersectionObserver.observe(that.containerObj)}catch(err){console.log("JSXGraph: IntersectionObserver not available in this browser.")}},
stopIntersectionObserver:function(){_type.default.exists(this.intersectionObserver)&&this.intersectionObserver.unobserve(this.containerObj)},initInfobox:function(){var attr=_type.default.copyAttributes({},this.options,"infobox");attr.id=this.id+"_infobox";this.infobox=this.create("text",[0,0,"0,0"],attr);this.infobox.distanceX=-20;this.infobox.distanceY=25;this.infobox.dump=!1;this.displayInfobox(!1);return this},updateInfobox:function(el){var x=_type.default.evaluate(el.visProp.showinfobox);if(!_type.default.evaluate(this.attr.showinfobox)&&
"inherit"===x||!x)return this;if(_type.default.isPoint(el)){x=el.coords.usrCoords[1];var y=el.coords.usrCoords[2];var vpinfoboxdigits=_type.default.evaluate(el.visProp.infoboxdigits);this.infobox.setCoords(x+this.infobox.distanceX/this.unitX,y+this.infobox.distanceY/this.unitY);"string"!==typeof el.infoboxText?("auto"===vpinfoboxdigits?(x=_type.default.autoDigits(x),y=_type.default.autoDigits(y)):_type.default.isNumber(vpinfoboxdigits)&&(x=_type.default.toFixed(x,vpinfoboxdigits),y=_type.default.toFixed(y,
vpinfoboxdigits)),this.highlightInfobox(x,y,el)):this.highlightCustomInfobox(el.infoboxText,el);this.displayInfobox(!0)}return this},displayInfobox:function(val){this.infobox.hiddenByParent===val&&(this.infobox.hiddenByParent=!val,this.infobox.prepareUpdate().updateVisibility(val).updateRenderer());return this},showInfobox:function(val){return this.displayInfobox(val)},highlightInfobox:function(x,y,el){this.highlightCustomInfobox("("+x+", "+y+")",el);return this},highlightCustomInfobox:function(text,
el){this.infobox.setText(text);return this},dehighlightAll:function(){var el;var pEl=!1;for(el in this.highlightedObjects)this.highlightedObjects.hasOwnProperty(el)&&(pEl=this.highlightedObjects[el],(this.hasMouseHandlers||this.hasPointerHandlers)&&pEl.noHighlight(),pEl=!0);this.highlightedObjects={};"canvas"===this.renderer.type&&pEl&&(this.prepareUpdate(),this.renderer.suspendRedraw(this),this.updateRenderer(),this.renderer.unsuspendRedraw());return this},getScrCoordsOfMouse:function(x,y){return[x,
y]},getUsrCoordsOfMouse:function(evt){var cPos=this.getCoordsTopLeftCorner();evt=_env.default.getPosition(evt,null,this.document);return(new _coords.default(_constants.default.COORDS_BY_SCREEN,[evt[0]-cPos[0],evt[1]-cPos[1]],this)).usrCoords.slice(1)},getAllUnderMouse:function(evt){var elList=this.getAllObjectsUnderMouse(evt);elList.push(this.getUsrCoordsOfMouse(evt));return elList},getAllObjectsUnderMouse:function(evt){var cPos=this.getCoordsTopLeftCorner(),absPos=_env.default.getPosition(evt,null,
this.document);evt=absPos[0]-cPos[0];cPos=absPos[1]-cPos[1];absPos=[];var el,len=this.objectsList.length;for(el=0;el<len;el++){var pEl=this.objectsList[el];pEl.visPropCalc.visible&&pEl.hasPoint&&pEl.hasPoint(evt,cPos)&&(absPos[absPos.length]=pEl)}return absPos},updateCoords:function(){var ob,len=this.objectsList.length;for(ob=0;ob<len;ob++){var el=this.objectsList[ob];_type.default.exists(el.coords)&&(_type.default.evaluate(el.visProp.frozen)?el.coords.screen2usr():el.coords.usr2screen())}return this},
moveOrigin:function(x,y,diff){if(_type.default.exists(x)&&_type.default.exists(y)){var ox=this.origin.scrCoords[1];var oy=this.origin.scrCoords[2];this.origin.scrCoords[1]=x;this.origin.scrCoords[2]=y;diff&&(this.origin.scrCoords[1]-=this.drag_dx,this.origin.scrCoords[2]-=this.drag_dy);x=(new _coords.default(_constants.default.COORDS_BY_SCREEN,[0,0],this)).usrCoords;y=(new _coords.default(_constants.default.COORDS_BY_SCREEN,[this.canvasWidth,this.canvasHeight],this)).usrCoords;if(x[1]<this.maxboundingbox[0]||
x[2]>this.maxboundingbox[1]||y[1]>this.maxboundingbox[2]||y[2]<this.maxboundingbox[3])this.origin.scrCoords[1]=ox,this.origin.scrCoords[2]=oy}this.updateCoords().clearTraces().fullUpdate();this.triggerEventHandlers(["boundingbox"]);return this},addConditions:function(str){var functions=[];var m=str.indexOf("\x3cdata\x3e");var j=str.indexOf("\x3c/data\x3e"),xyFun=function(board,el,f,what){return function(){var e=board.select(el.id);var t=e.coords.usrCoords[what];2===what?e.setPositionDirectly(_constants.default.COORDS_BY_USER,
[f(),t]):e.setPositionDirectly(_constants.default.COORDS_BY_USER,[t,f()]);e.prepareUpdate().update()}},visFun=function(board,el,f){return function(){var e=board.select(el.id);var v=f();e.setAttribute({visible:v})}},colFun=function(board,el,f,what){return function(){var e=board.select(el.id);var v=f();"strokewidth"===what?e.visProp.strokewidth=v:(v=_color.default.rgba2rgbo(v),e.visProp[what+"color"]=v[0],e.visProp[what+"opacity"]=v[1])}},posFun=function(board,el,f){return function(){board.select(el.id).position=
f()}},styleFun=function(board,el,f){return function(){board.select(el.id).setStyle(f())}};if(!(0>m)){for(;0<=m;){var term=str.slice(m+6,j);m=term.indexOf("\x3d");var left=term.slice(0,m);term=term.slice(m+1);m=left.indexOf(".");var name=left.slice(0,m);var el$jscomp$0=this.elementsByName[_type.default.unescapeHTML(name)];m=left.slice(m+1).replace(/\s+/g,"").toLowerCase();term=_type.default.createFunction(term,this,"",!0);if(_type.default.exists(this.elementsByName[name]))switch(m){case "x":functions.push(xyFun(this,
el$jscomp$0,term,2));break;case "y":functions.push(xyFun(this,el$jscomp$0,term,1));break;case "visible":functions.push(visFun(this,el$jscomp$0,term));break;case "position":functions.push(posFun(this,el$jscomp$0,term));break;case "stroke":functions.push(colFun(this,el$jscomp$0,term,"stroke"));break;case "style":functions.push(styleFun(this,el$jscomp$0,term));break;case "strokewidth":functions.push(colFun(this,el$jscomp$0,term,"strokewidth"));break;case "fill":functions.push(colFun(this,el$jscomp$0,
term,"fill"));break;case "label":break;default:_jxg.default.debug("property '"+m+"' in conditions not yet implemented:"+term)}else _jxg.default.debug("debug conditions: |"+name+"| undefined");str=str.slice(j+7);m=str.indexOf("\x3cdata\x3e");j=str.indexOf("\x3c/data\x3e")}this.updateConditions=function(){var i;for(i=0;i<functions.length;i++)functions[i]();this.prepareUpdate().updateElements();return!0};this.updateConditions()}},updateConditions:function(){return!1},calculateSnapSizes:function(){var p1=
new _coords.default(_constants.default.COORDS_BY_USER,[0,0],this),p2=new _coords.default(_constants.default.COORDS_BY_USER,[this.options.grid.gridX,this.options.grid.gridY],this),x=p1.scrCoords[1]-p2.scrCoords[1];p1=p1.scrCoords[2]-p2.scrCoords[2];for(this.options.grid.snapSizeX=this.options.grid.gridX;25<Math.abs(x);)this.options.grid.snapSizeX*=2,x/=2;for(this.options.grid.snapSizeY=this.options.grid.gridY;25<Math.abs(p1);)this.options.grid.snapSizeY*=2,p1/=2;return this},applyZoom:function(){this.updateCoords().calculateSnapSizes().clearTraces().fullUpdate();
return this},zoomIn:function(x,y){var bb=this.getBoundingBox(),zX=this.attr.zoom.factorx,zY=this.attr.zoom.factory,dX=(bb[2]-bb[0])*(1-1/zX),dY=(bb[1]-bb[3])*(1-1/zY),lr=.5,tr=.5,mi=this.attr.zoom.eps||this.attr.zoom.min||.001;if(this.zoomX>this.attr.zoom.max&&1<zX||this.zoomY>this.attr.zoom.max&&1<zY||this.zoomX<mi&&1>zX||this.zoomY<mi&&1>zY)return this;_type.default.isNumber(x)&&_type.default.isNumber(y)&&(lr=(x-bb[0])/(bb[2]-bb[0]),tr=(bb[1]-y)/(bb[1]-bb[3]));this.setBoundingBox([bb[0]+dX*lr,bb[1]-
dY*tr,bb[2]-dX*(1-lr),bb[3]+dY*(1-tr)],this.keepaspectratio,"update");return this.applyZoom()},zoomOut:function(x,y){var bb=this.getBoundingBox(),dX=(bb[2]-bb[0])*(1-this.attr.zoom.factorx),dY=(bb[1]-bb[3])*(1-this.attr.zoom.factory),lr=.5,tr=.5,mi=this.attr.zoom.eps||this.attr.zoom.min||.001;if(this.zoomX<mi||this.zoomY<mi)return this;_type.default.isNumber(x)&&_type.default.isNumber(y)&&(lr=(x-bb[0])/(bb[2]-bb[0]),tr=(bb[1]-y)/(bb[1]-bb[3]));this.setBoundingBox([bb[0]+dX*lr,bb[1]-dY*tr,bb[2]-dX*
(1-lr),bb[3]+dY*(1-tr)],this.keepaspectratio,"update");return this.applyZoom()},zoom100:function(){if(_type.default.exists(this.attr.boundingbox))this.setBoundingBox(this.attr.boundingbox,this.keepaspectratio,"reset");else{var bb=this.getBoundingBox();var dX=(bb[2]-bb[0])*(1-this.zoomX)*.5;var dY=(bb[1]-bb[3])*(1-this.zoomY)*.5;this.setBoundingBox([bb[0]+dX,bb[1]-dY,bb[2]-dX,bb[3]+dY],this.keepaspectratio,"reset")}return this.applyZoom()},zoomAllPoints:function(){var el,minX=0,maxX=0,minY=0,maxY=
0,len=this.objectsList.length;for(el=0;el<len;el++){var borderY=this.objectsList[el];_type.default.isPoint(borderY)&&borderY.visPropCalc.visible&&(borderY.coords.usrCoords[1]<minX?minX=borderY.coords.usrCoords[1]:borderY.coords.usrCoords[1]>maxX&&(maxX=borderY.coords.usrCoords[1]),borderY.coords.usrCoords[2]>maxY?maxY=borderY.coords.usrCoords[2]:borderY.coords.usrCoords[2]<minY&&(minY=borderY.coords.usrCoords[2]))}el=50/this.unitX;borderY=50/this.unitY;this.setBoundingBox([minX-el,maxY+borderY,maxX+
el,minY-borderY],this.keepaspectratio,"update");return this.applyZoom()},zoomElements:function(elements){var i,newBBox=[Infinity,-Infinity,-Infinity,Infinity];if(!_type.default.isArray(elements)||0===elements.length)return this;for(i=0;i<elements.length;i++){var e=this.select(elements[i]);e=e.bounds();_type.default.isArray(e)&&(e[0]<newBBox[0]&&(newBBox[0]=e[0]),e[1]>newBBox[1]&&(newBBox[1]=e[1]),e[2]>newBBox[2]&&(newBBox[2]=e[2]),e[3]<newBBox[3]&&(newBBox[3]=e[3]))}_type.default.isArray(newBBox)&&
(elements=.5*(newBBox[0]+newBBox[2]),i=.5*(newBBox[1]+newBBox[3]),e=.75*(newBBox[2]-newBBox[0]),newBBox=.75*(newBBox[1]-newBBox[3]),newBBox=Math.max(e,newBBox),this.setBoundingBox([elements-newBBox,i+newBBox,elements+newBBox,i-newBBox],this.keepaspectratio,"update"));return this},setZoom:function(fX,fY){var oX=this.attr.zoom.factorx,oY=this.attr.zoom.factory;this.attr.zoom.factorx=fX/this.zoomX;this.attr.zoom.factory=fY/this.zoomY;this.zoomIn();this.attr.zoom.factorx=oX;this.attr.zoom.factory=oY;
return this},removeObject:function(object,saveMethod){var el;if(_type.default.isArray(object)){for(saveMethod=0;saveMethod<object.length;saveMethod++)this.removeObject(object[saveMethod]);return this}object=this.select(object);if(!_type.default.exists(object)||_type.default.isString(object))return this;try{for(el in object.childElements)object.childElements.hasOwnProperty(el)&&object.childElements[el].board.removeObject(object.childElements[el]);for(el in object.objects)object.objects.hasOwnProperty(el)&&
object.objects[el].board.removeObject(object.objects[el]);if(saveMethod)for(el in this.objects)this.objects.hasOwnProperty(el)&&_type.default.exists(this.objects[el].childElements)&&_type.default.exists(this.objects[el].childElements.hasOwnProperty(object.id))&&(delete this.objects[el].childElements[object.id],delete this.objects[el].descendants[object.id]);else if(_type.default.exists(object.ancestors))for(el in object.ancestors)object.ancestors.hasOwnProperty(el)&&_type.default.exists(object.ancestors[el].childElements)&&
_type.default.exists(object.ancestors[el].childElements.hasOwnProperty(object.id))&&(delete object.ancestors[el].childElements[object.id],delete object.ancestors[el].descendants[object.id]);if(-1<object._pos)for(this.objectsList.splice(object._pos,1),el=object._pos;el<this.objectsList.length;el++)this.objectsList[el]._pos--;else object.type!==_constants.default.OBJECT_TYPE_TURTLE&&_jxg.default.debug("Board.removeObject: object "+object.id+" not found in list.");delete this.objects[object.id];delete this.elementsByName[object.name];
object.visProp&&_type.default.evaluate(object.visProp.trace)&&object.clearTrace();_type.default.exists(object.remove)&&object.remove()}catch(e){_jxg.default.debug(object.id+": Could not be removed: "+e)}this.update();return this},removeAncestors:function(object){for(var anc in object.ancestors)object.ancestors.hasOwnProperty(anc)&&this.removeAncestors(object.ancestors[anc]);this.removeObject(object);return this},initGeonextBoard:function(){var p1=this.create("point",[0,0],{id:this.id+"g00e0",name:"Ursprung",
withLabel:!1,visible:!1,fixed:!0});var p2=this.create("point",[1,0],{id:this.id+"gX0e0",name:"Punkt_1_0",withLabel:!1,visible:!1,fixed:!0});var p3=this.create("point",[0,1],{id:this.id+"gY0e0",name:"Punkt_0_1",withLabel:!1,visible:!1,fixed:!0});this.create("line",[p1,p2],{id:this.id+"gXLe0",name:"X-Achse",withLabel:!1,visible:!1});this.create("line",[p1,p3],{id:this.id+"gYLe0",name:"Y-Achse",withLabel:!1,visible:!1});return this},resizeContainer:function(canvasWidth,canvasHeight,dontset,dontSetBoundingBox){var box;
dontSetBoundingBox||(box=this.getBoundingBox());this.canvasWidth=parseFloat(canvasWidth);this.canvasHeight=parseFloat(canvasHeight);dontset||(this.containerObj.style.width=this.canvasWidth+"px",this.containerObj.style.height=this.canvasHeight+"px");this.renderer.resize(this.canvasWidth,this.canvasHeight);dontSetBoundingBox||this.setBoundingBox(box,this.keepaspectratio,"keep");return this},showDependencies:function(){var c;var t="\x3cp\x3e\n";for(el in this.objects)if(this.objects.hasOwnProperty(el)){var i=
0;for(c in this.objects[el].childElements)this.objects[el].childElements.hasOwnProperty(c)&&(i+=1);0<=i&&(t+="\x3cstrong\x3e"+this.objects[el].id+":\x3c/strong\x3e ");for(c in this.objects[el].childElements)this.objects[el].childElements.hasOwnProperty(c)&&(t+=this.objects[el].childElements[c].id+"("+this.objects[el].childElements[c].name+"), ");t+="\x3cp\x3e\n"}t+="\x3c/p\x3e\n";var el=window.open();el.document.open();el.document.write(t);el.document.close();return this},showXML:function(){var f=
window.open("");f.document.open();f.document.write("\x3cpre\x3e"+_type.default.escapeHTML(this.xmlString)+"\x3c/pre\x3e");f.document.close();return this},prepareUpdate:function(){var el,len=this.objectsList.length;for(el=0;el<len;el++){var pEl=this.objectsList[el];pEl.needsUpdate=pEl.needsRegularUpdate||this.needsFullUpdate}for(el in this.groups)this.groups.hasOwnProperty(el)&&(pEl=this.groups[el],pEl.needsUpdate=pEl.needsRegularUpdate||this.needsFullUpdate);return this},updateElements:function(drag){var el;
drag=this.select(drag);for(el=0;el<this.objectsList.length;el++){var pEl=this.objectsList[el];this.needsFullUpdate&&pEl.elementClass===_constants.default.OBJECT_CLASS_TEXT&&pEl.updateSize();pEl.update(!_type.default.exists(drag)||pEl.id!==drag.id).updateVisibility()}for(el in this.groups)this.groups.hasOwnProperty(el)&&this.groups[el].update(drag);return this},updateRenderer:function(){var el,len=this.objectsList.length;if("canvas"===this.renderer.type)this.updateRendererCanvas();else for(el=0;el<
len;el++)this.objectsList[el].updateRenderer();return this},updateRendererCanvas:function(){var el,i,la,olen=this.objectsList.length,layers=this.options.layer,len=this.options.layer.numlayers,last=Number.NEGATIVE_INFINITY;for(i=0;i<len;i++){var mini=Number.POSITIVE_INFINITY;for(la in layers)layers.hasOwnProperty(la)&&layers[la]>last&&layers[la]<mini&&(mini=layers[la]);last=mini;for(el=0;el<olen;el++){var pEl=this.objectsList[el];pEl.visProp.layer===mini&&pEl.prepareUpdate().updateRenderer()}}return this},
addHook:function(hook,m,context){_jxg.default.deprecated("Board.addHook()","Board.on()");m=_type.default.def(m,"update");context=_type.default.def(context,this);this.hooks.push([m,hook]);this.on(m,hook,context);return this.hooks.length-1},addEvent:_jxg.default.shortcut(_jxg.default.Board.prototype,"on"),removeHook:function(id){_jxg.default.deprecated("Board.removeHook()","Board.off()");this.hooks[id]&&(this.off(this.hooks[id][0],this.hooks[id][1]),this.hooks[id]=null);return this},removeEvent:_jxg.default.shortcut(_jxg.default.Board.prototype,
"off"),updateHooks:function(m){var arg=Array.prototype.slice.call(arguments,0);_jxg.default.deprecated("Board.updateHooks()","Board.triggerEventHandlers()");arg[0]=_type.default.def(arg[0],"update");this.triggerEventHandlers([arg[0]],arguments);return this},addChild:function(board){_type.default.exists(board)&&_type.default.exists(board.containerObj)&&(this.dependentBoards.push(board),this.update());return this},removeChild:function(board){var i;for(i=this.dependentBoards.length-1;0<=i;i--)this.dependentBoards[i]===
board&&this.dependentBoards.splice(i,1);return this},update:function(drag){if(this.inUpdate||this.isSuspendedUpdate)return this;this.inUpdate=!0;if("all"===this.attr.minimizereflow&&this.containerObj&&"vml"!==this.renderer.type){var b=this.document.activeElement;var len=this.renderer.removeToInsertLater(this.containerObj)}"svg"===this.attr.minimizereflow&&"svg"===this.renderer.type&&(b=this.document.activeElement,len=this.renderer.removeToInsertLater(this.renderer.svgRoot));this.prepareUpdate().updateElements(drag).updateConditions();
this.renderer.suspendRedraw(this);this.updateRenderer();this.renderer.unsuspendRedraw();this.triggerEventHandlers(["update"],[]);len&&(len(),b.focus());len=this.dependentBoards.length;for(drag=0;drag<len;drag++)b=this.dependentBoards[drag],_type.default.exists(b)&&b!==this&&(b.updateQuality=this.updateQuality,b.prepareUpdate().updateElements().updateConditions(),b.renderer.suspendRedraw(),b.updateRenderer(),b.renderer.unsuspendRedraw(),b.triggerEventHandlers(["update"],[]));this.inUpdate=!1;return this},
fullUpdate:function(){this.needsFullUpdate=!0;this.update();this.needsFullUpdate=!1;return this},addGrid:function(){this.create("grid",[]);return this},removeGrids:function(){var i;for(i=0;i<this.grids.length;i++)this.removeObject(this.grids[i]);this.grids.length=0;this.update();return this},create:function(elementType,parents,attributes){var i;elementType=elementType.toLowerCase();_type.default.exists(parents)||(parents=[]);_type.default.exists(attributes)||(attributes={});for(i=0;i<parents.length;i++)!_type.default.isString(parents[i])||
"text"===elementType&&2===i||"solidofrevolution3d"===elementType&&2===i||!("input"!==elementType&&"checkbox"!==elementType&&"button"!==elementType||2!==i&&3!==i)||"curve"===elementType&&0<i||(parents[i]=this.select(parents[i]));if(_type.default.isFunction(_jxg.default.elements[elementType]))parents=_jxg.default.elements[elementType](this,parents,attributes);else throw Error("JSXGraph: create: Unknown element type given: "+elementType);if(!_type.default.exists(parents))return _jxg.default.debug("JSXGraph: create: failure creating "+
elementType),parents;parents.prepareUpdate&&parents.update&&parents.updateRenderer&&parents.fullUpdate();return parents},createElement:function(){_jxg.default.deprecated("Board.createElement()","Board.create()");return this.create.apply(this,arguments)},clearTraces:function(){var el;for(el=0;el<this.objectsList.length;el++)this.objectsList[el].clearTrace();this.numTraces=0;return this},suspendUpdate:function(){this.inUpdate||(this.isSuspendedUpdate=!0);return this},unsuspendUpdate:function(){this.isSuspendedUpdate&&
(this.isSuspendedUpdate=!1,this.fullUpdate());return this},setBoundingBox:function(bbox,keepaspectratio,setZoom){var offX=0,offY=0;var h=_env.default.getDimensions(this.container,this.document);if(!_type.default.isArray(bbox)||bbox[0]<this.maxboundingbox[0]||bbox[1]>this.maxboundingbox[1]||bbox[2]>this.maxboundingbox[2]||bbox[3]<this.maxboundingbox[3])return this;_type.default.exists(setZoom)||(setZoom="reset");var ux=this.unitX;var uy=this.unitY;this.canvasWidth=parseInt(h.width,10);this.canvasHeight=
parseInt(h.height,10);var w=this.canvasWidth;h=this.canvasHeight;keepaspectratio?(this.unitX=w/(bbox[2]-bbox[0]),this.unitY=h/(bbox[1]-bbox[3]),Math.abs(this.unitX)<Math.abs(this.unitY)?(this.unitY=Math.abs(this.unitX)*this.unitY/Math.abs(this.unitY),offY=.5*(h/this.unitY-(bbox[1]-bbox[3]))):(this.unitX=Math.abs(this.unitY)*this.unitX/Math.abs(this.unitX),offX=.5*(w/this.unitX-(bbox[2]-bbox[0]))),this.keepaspectratio=!0):(this.unitX=w/(bbox[2]-bbox[0]),this.unitY=h/(bbox[1]-bbox[3]),this.keepaspectratio=
!1);this.moveOrigin(-this.unitX*(bbox[0]-offX),this.unitY*(bbox[1]+offY));"update"===setZoom?(this.zoomX*=this.unitX/ux,this.zoomY*=this.unitY/uy):"reset"===setZoom&&(this.zoomX=_type.default.exists(this.attr.zoomx)?this.attr.zoomx:1,this.zoomY=_type.default.exists(this.attr.zoomy)?this.attr.zoomy:1);return this},getBoundingBox:function(){var ul=(new _coords.default(_constants.default.COORDS_BY_SCREEN,[0,0],this)).usrCoords,lr=(new _coords.default(_constants.default.COORDS_BY_SCREEN,[this.canvasWidth,
this.canvasHeight],this)).usrCoords;return[ul[1],ul[2],lr[1],lr[2]]},addAnimation:function(element){var that=this;this.animationObjects[element.id]=element;this.animationIntervalCode||(this.animationIntervalCode=window.setInterval(function(){that.animate()},element.board.attr.animationdelay));return this},stopAllAnimation:function(){for(var el in this.animationObjects)this.animationObjects.hasOwnProperty(el)&&_type.default.exists(this.animationObjects[el])&&(this.animationObjects[el]=null,delete this.animationObjects[el]);
window.clearInterval(this.animationIntervalCode);delete this.animationIntervalCode;return this},animate:function(){var el,r,count=0,obj=null;for(el in this.animationObjects)if(this.animationObjects.hasOwnProperty(el)&&_type.default.exists(this.animationObjects[el])){count+=1;var o=this.animationObjects[el];if(o.animationPath){var props=_type.default.isFunction(o.animationPath)?o.animationPath((new Date).getTime()-o.animationStart):o.animationPath.pop();!_type.default.exists(props)||!_type.default.isArray(props)&&
isNaN(props)?delete o.animationPath:(o.setPositionDirectly(_constants.default.COORDS_BY_USER,props),o.fullUpdate(),obj=o)}if(o.animationData){var c=0;for(r in o.animationData)if(o.animationData.hasOwnProperty(r)){var p=o.animationData[r].pop();_type.default.exists(p)?(c+=1,props={},props[r]=p,o.setAttribute(props)):delete o.animationData[p]}0===c&&delete o.animationData}_type.default.exists(o.animationData)||_type.default.exists(o.animationPath)||(this.animationObjects[el]=null,delete this.animationObjects[el],
_type.default.exists(o.animationCallback)&&(props=o.animationCallback,o.animationCallback=null,props()))}0===count?(window.clearInterval(this.animationIntervalCode),delete this.animationIntervalCode):this.update(obj);return this},migratePoint:function(src,dest,copyName){var childId,prop,srcHasLabel=!1;src=this.select(src);dest=this.select(dest);if(_type.default.exists(src.label)){var srcLabelId=src.label.id;srcHasLabel=!0;this.removeObject(src.label)}for(childId in src.childElements)if(src.childElements.hasOwnProperty(childId)){var child=
src.childElements[childId];var found=!1;for(prop in child)child.hasOwnProperty(prop)&&child[prop]===src&&(child[prop]=dest,found=!0);found&&delete src.childElements[childId];for(found=0;found<child.parents.length;found++)child.parents[found]===src.id&&(child.parents[found]=dest.id);dest.addChild(child)}copyName&&(srcHasLabel&&(delete dest.childElements[srcLabelId],delete dest.descendants[srcLabelId]),dest.label&&this.removeObject(dest.label),delete this.elementsByName[dest.name],dest.name=src.name,
srcHasLabel&&dest.createLabel());this.removeObject(src);_type.default.exists(dest.name)&&""!==dest.name&&(this.elementsByName[dest.name]=dest);this.fullUpdate();return this},emulateColorblindness:function(deficiency){var e;_type.default.exists(deficiency)||(deficiency="none");if(this.currentCBDef===deficiency)return this;for(e in this.objects)if(this.objects.hasOwnProperty(e)){var o=this.objects[e];"none"!==deficiency?("none"===this.currentCBDef&&(o.visPropOriginal={strokecolor:o.visProp.strokecolor,
fillcolor:o.visProp.fillcolor,highlightstrokecolor:o.visProp.highlightstrokecolor,highlightfillcolor:o.visProp.highlightfillcolor}),o.setAttribute({strokecolor:_color.default.rgb2cb(_type.default.evaluate(o.visPropOriginal.strokecolor),deficiency),fillcolor:_color.default.rgb2cb(_type.default.evaluate(o.visPropOriginal.fillcolor),deficiency),highlightstrokecolor:_color.default.rgb2cb(_type.default.evaluate(o.visPropOriginal.highlightstrokecolor),deficiency),highlightfillcolor:_color.default.rgb2cb(_type.default.evaluate(o.visPropOriginal.highlightfillcolor),
deficiency)})):_type.default.exists(o.visPropOriginal)&&_jxg.default.extend(o.visProp,o.visPropOriginal)}this.currentCBDef=deficiency;this.update();return this},select:function(str,onlyByIdOrName){var i;if(null===str)return str;if(_type.default.isString(str)&&""!==str)_type.default.exists(this.objects[str])?str=this.objects[str]:_type.default.exists(this.elementsByName[str])?str=this.elementsByName[str]:_type.default.exists(this.groups[str])&&(str=this.groups[str]);else if(!onlyByIdOrName&&(_type.default.isFunction(str)||
_type.default.isObject(str)&&!_type.default.isFunction(str.setAttribute))){onlyByIdOrName=_type.default.filterElements(this.objectsList,str);str={};var l=onlyByIdOrName.length;for(i=0;i<l;i++)str[onlyByIdOrName[i].id]=onlyByIdOrName[i];str=new _composition.default(str)}else _type.default.isObject(str)&&_type.default.exists(str.id)&&!_type.default.exists(this.objects[str.id])&&(str=null);return str},hasPoint:function(x,y){var px=x,bbox=this.getBoundingBox();_type.default.exists(x)&&_type.default.isArray(x.usrCoords)&&
(px=x.usrCoords[1],y=x.usrCoords[2]);return!!(_type.default.isNumber(px)&&_type.default.isNumber(y)&&bbox[0]<px&&px<bbox[2]&&bbox[1]>y&&y>bbox[3])},updateCSSTransforms:function(){var o=this.containerObj;this.cssTransMat=_env.default.getCSSTransformMatrix(o);for(o=o.parentNode===o.getRootNode()?o.parentNode.host:o.parentNode;o;)this.cssTransMat=_math.default.matMatMult(_env.default.getCSSTransformMatrix(o),this.cssTransMat),o=o.parentNode===o.getRootNode()?o.parentNode.host:o.parentNode;this.cssTransMat=
_math.default.inverse(this.cssTransMat);return this},startSelectionMode:function(){this.selectingMode=!0;this.selectionPolygon.setAttribute({visible:!0});this.selectingBox=[[0,0],[0,0]];this._setSelectionPolygonFromBox();this.selectionPolygon.fullUpdate()},stopSelectionMode:function(){this.selectingMode=!1;this.selectionPolygon.setAttribute({visible:!1});return[this.selectionPolygon.vertices[0].coords,this.selectionPolygon.vertices[2].coords]},_startSelecting:function(pos){this.isSelecting=!0;this.selectingBox=
[[pos[0],pos[1]],[pos[0],pos[1]]];this._setSelectionPolygonFromBox()},_moveSelecting:function(pos){this.isSelecting&&(this.selectingBox[1]=[pos[0],pos[1]],this._setSelectionPolygonFromBox(),this.selectionPolygon.fullUpdate())},_stopSelecting:function(evt){evt=this.getMousePosition(evt);this.isSelecting=!1;this.selectingBox[1]=[evt[0],evt[1]];this._setSelectionPolygonFromBox()},_setSelectionPolygonFromBox:function(){var A=this.selectingBox[0],B=this.selectingBox[1];this.selectionPolygon.vertices[0].setPositionDirectly(_jxg.default.COORDS_BY_SCREEN,
[A[0],A[1]]);this.selectionPolygon.vertices[1].setPositionDirectly(_jxg.default.COORDS_BY_SCREEN,[A[0],B[1]]);this.selectionPolygon.vertices[2].setPositionDirectly(_jxg.default.COORDS_BY_SCREEN,[B[0],B[1]]);this.selectionPolygon.vertices[3].setPositionDirectly(_jxg.default.COORDS_BY_SCREEN,[B[0],A[1]])},_testForSelection:function(evt){this._isRequiredKeyPressed(evt,"selection")&&(_type.default.exists(this.selectionPolygon)||this._createSelectionPolygon(this.attr),this.startSelectionMode())},_createSelectionPolygon:function(attr){_type.default.exists(this.selectionPolygon)||
(attr=_type.default.copyAttributes(attr,_options.default,"board","selection"),!0===attr.enabled&&(this.selectionPolygon=this.create("polygon",[[0,0],[0,0],[0,0],[0,0]],attr)));return this},__evt__down:function(e){},__evt__mousedown:function(e){},__evt__pendown:function(e){},__evt__pointerdown:function(e){},__evt__touchstart:function(e){},__evt__up:function(e){},__evt__mouseup:function(e){},__evt__pointerup:function(e){},__evt__touchend:function(e){},__evt__move:function(e,mode){},__evt__mousemove:function(e,
mode){},__evt__penmove:function(e,mode){},__evt__pointermove:function(e,mode){},__evt__touchmove:function(e,mode){},__evt__hit:function(e,el,target){},__evt__mousehit:function(e,el,target){},__evt__update:function(){},__evt__boundingbox:function(){},__evt__startselecting:function(){},__evt__mousestartselecting:function(){},__evt__pointerstartselecting:function(){},__evt__touchstartselecting:function(){},__evt__stopselecting:function(){},__evt__mousestopselecting:function(){},__evt__pointerstopselecting:function(){},
__evt__touchstopselecting:function(){},__evt__moveselecting:function(){},__evt__mousemoveselecting:function(){},__evt__pointermoveselecting:function(){},__evt__touchmoveselecting:function(){},__evt:function(){},toFullscreen:function(id){var doc=this.document;this._fullscreen_inner_id=id=id||this.container;var inner_node=doc.getElementById(id);id="fullscreenwrap_"+id;if(doc.getElementById(id))var wrap_node=doc.getElementById(id);else wrap_node=document.createElement("div"),wrap_node.classList.add("JXG_wrap_private"),
wrap_node.setAttribute("id",id),inner_node.parentNode.insertBefore(wrap_node,inner_node),wrap_node.appendChild(inner_node);wrap_node.requestFullscreen=wrap_node.requestFullscreen||wrap_node.webkitRequestFullscreen||wrap_node.mozRequestFullScreen||wrap_node.msRequestFullscreen;null===(void 0!==doc.fullscreenElement?doc.fullscreenElement:void 0!==doc.webkitFullscreenElement?doc.webkitFullscreenElement:doc.msFullscreenElement)?wrap_node.requestFullscreen&&wrap_node.requestFullscreen():_type.default.exists(document.exitFullscreen)?
document.exitFullscreen():_type.default.exists(document.webkitExitFullscreen)&&document.webkitExitFullscreen();return this},fullscreenListener:function(evt){var doc=this.document;evt=this._fullscreen_inner_id;if(_type.default.exists(evt)){var fullscreenElement=void 0!==doc.fullscreenElement?doc.fullscreenElement:void 0!==doc.webkitFullscreenElement?doc.webkitFullscreenElement:doc.msFullscreenElement;var inner_node=doc.getElementById(evt);if(fullscreenElement)inner_node._cssFullscreenStore={id:fullscreenElement.id,
isFullscreen:!0,margin:inner_node.style.margin},inner_node.style.margin="",_env.default.scaleJSXGraphDiv(fullscreenElement.id,evt,doc);else if(_type.default.exists(inner_node._cssFullscreenStore)){try{doc.styleSheets[doc.styleSheets.length-1].deleteRule(0)}catch(err){console.log("JSXGraph: Could not remove CSS rules for full screen mode")}inner_node._cssFullscreenStore.isFullscreen=!1;inner_node.style.margin=inner_node._cssFullscreenStore.margin}this.updateCSSTransforms()}},createRoulette:function(c1,
c2,start_c1,stepsize,direction,time,pointlist){var brd=this;return new function(){var alpha=0,Tx=0,Ty=0,t1=start_c1,t2=_numerics.default.root(function(t){var c1x=c1.X(t1),c1y=c1.Y(t1),c2x=c2.X(t);t=c2.Y(t);return(c1x-c2x)*(c1x-c2x)+(c1y-t)*(c1y-t)},[0,2*Math.PI]),t1_new=0,t2_new=0,c1dist,rotation=brd.create("transform",[function(){return alpha}],{type:"rotate"}),rotationLocal=brd.create("transform",[function(){return alpha},function(){return c1.X(t1)},function(){return c1.Y(t1)}],{type:"rotate"}),
translate=brd.create("transform",[function(){return Tx},function(){return Ty}],{type:"translate"}),arclen=function(c,a,b){var cpxa=_numerics.default.D(c.X)(a),cpya=_numerics.default.D(c.Y)(a),cpxb=_numerics.default.D(c.X)(b),cpyb=_numerics.default.D(c.Y)(b),cpxab=_numerics.default.D(c.X)(.5*(a+b));c=_numerics.default.D(c.Y)(.5*(a+b));return(Math.sqrt(cpxa*cpxa+cpya*cpya)+4*Math.sqrt(cpxab*cpxab+c*c)+Math.sqrt(cpxb*cpxb+cpyb*cpyb))*(b-a)/6},exactDist=function(t){return c1dist-arclen(c2,t2,t)},beta=
Math.PI/18,beta9=9*beta,interval=null;this.rolling=function(){t1_new=t1+direction*stepsize;c1dist=arclen(c1,t1,t1_new);t2_new=_numerics.default.root(exactDist,t2);var h=new _complex.default(c1.X(t1_new),c1.Y(t1_new));var g=new _complex.default(c2.X(t2_new),c2.Y(t2_new));var hp=new _complex.default(_numerics.default.D(c1.X)(t1_new),_numerics.default.D(c1.Y)(t1_new));var gp=new _complex.default(_numerics.default.D(c2.X)(t2_new),_numerics.default.D(c2.Y)(t2_new));hp=_complex.default.C.div(hp,gp);alpha=
Math.atan2(hp.imaginary,hp.real);hp.div(_complex.default.C.abs(hp));hp.mult(g);Tx=h.real-hp.real;Ty=h.imaginary-hp.imaginary;alpha<-beta&&alpha>-beta9?(alpha=-beta,rotationLocal.applyOnce(pointlist)):alpha>beta&&alpha<beta9?(alpha=beta,rotationLocal.applyOnce(pointlist)):(rotation.applyOnce(pointlist),translate.applyOnce(pointlist),t1=t1_new,t2=t2_new);brd.update()};this.start=function(){0<time&&(interval=window.setInterval(this.rolling,time));return this};this.stop=function(){window.clearInterval(interval);
return this};return this}}});exports.default=_jxg.default.Board}
//# sourceMappingURL=module$node_modules$$mentatcollective$jsxgraph$src$base$board.js.map

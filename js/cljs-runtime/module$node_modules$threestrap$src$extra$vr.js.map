{
"version":3,
"file":"module$node_modules$threestrap$src$extra$vr.js",
"lineCount":7,
"mappings":"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",
"sources":["node_modules/threestrap/src/extra/vr.js"],
"sourcesContent":["shadow$provide[\"module$node_modules$threestrap$src$extra$vr\"] = function(global,require,module,exports) {\n\"use strict\";\n\nvar _bootstrap = require(\"../bootstrap.js\");\n\nvar _VRRenderer = require(\"../renderers/VRRenderer.js\");\n\n/*\nVR sensor / HMD hookup.\n*/\n_bootstrap.Bootstrap.registerPlugin(\"vr\", {\n  defaults: {\n    mode: \"auto\",\n    // 'auto', '2d'\n    device: null,\n    fov: 80 // emulated FOV for fallback\n\n  },\n  listen: [\"window.load\", \"pre\", \"render\", \"resize\", \"this.change\"],\n  install: function (three) {\n    three.VR = this.api({\n      active: false,\n      devices: [],\n      hmd: null,\n      sensor: null,\n      renderer: null,\n      state: null\n    }, three);\n  },\n  uninstall: function (three) {\n    delete three.VR;\n  },\n  mocks: function (three, fov, def) {\n    // Fake VR device for cardboard / desktop\n    // Interpuppilary distance\n    const ipd = 0.03; // Symmetric eye FOVs (Cardboard style)\n\n    const getEyeTranslation = function (key) {\n      return {\n        left: {\n          x: -ipd,\n          y: 0,\n          z: 0\n        },\n        right: {\n          x: ipd,\n          y: 0,\n          z: 0\n        }\n      }[key];\n    };\n\n    const getRecommendedEyeFieldOfView = function (key) {\n      const camera = three.camera;\n      const aspect = camera && camera.aspect || 16 / 9;\n      const fov2 = (fov || camera && camera.fov || def) / 2;\n      const fovX = Math.atan(Math.tan(fov2 * Math.PI / 180) * aspect / 2) * 180 / Math.PI;\n      const fovY = fov2;\n      return {\n        left: {\n          rightDegrees: fovX,\n          leftDegrees: fovX,\n          downDegrees: fovY,\n          upDegrees: fovY\n        },\n        right: {\n          rightDegrees: fovX,\n          leftDegrees: fovX,\n          downDegrees: fovY,\n          upDegrees: fovY\n        }\n      }[key];\n    }; // Will be replaced with orbit controls or device orientation controls by VRControls\n\n\n    const getState = function () {\n      return {};\n    };\n\n    return [{\n      fake: true,\n      force: 1,\n      deviceId: \"emu\",\n      deviceName: \"Emulated\",\n      getEyeTranslation: getEyeTranslation,\n      getRecommendedEyeFieldOfView: getRecommendedEyeFieldOfView\n    }, {\n      force: 2,\n      getState: getState\n    }];\n  },\n  load: function (event, three) {\n    const callback = function (devs) {\n      this.callback(devs, three);\n    }.bind(this);\n\n    if (navigator.getVRDevices) {\n      navigator.getVRDevices().then(callback);\n    } else if (navigator.mozGetVRDevices) {\n      navigator.mozGetVRDevices(callback);\n    } else {\n      console.warn(\"No native VR support detected.\");\n      callback(this.mocks(three, this.options.fov, this.defaults.fov), three);\n    }\n  },\n  callback: function (vrdevs, three) {\n    let hmd, sensor;\n\n    const HMD = window.HMDVRDevice || function () {};\n\n    const SENSOR = window.PositionSensorVRDevice || function () {}; // Export list of devices\n\n\n    vrdevs = three.VR.devices = vrdevs || three.VR.devices; // Get HMD device\n\n    const deviceId = this.options.device;\n    let dev;\n\n    for (let i = 0; i < vrdevs.length; ++i) {\n      dev = vrdevs[i];\n\n      if (dev.force == 1 || dev instanceof HMD) {\n        if (deviceId && deviceId != dev.deviceId) continue;\n        hmd = dev;\n        break;\n      }\n    }\n\n    if (hmd) {\n      // Get sensor device\n      let dev;\n\n      for (let i = 0; i < vrdevs.length; ++i) {\n        dev = vrdevs[i];\n\n        if (dev.force == 2 || dev instanceof SENSOR && dev.hardwareUnitId == hmd.hardwareUnitId) {\n          sensor = dev;\n          break;\n        }\n      }\n\n      this.hookup(hmd, sensor, three);\n    }\n  },\n  hookup: function (hmd, sensor, three) {\n    if (!_VRRenderer.VRRenderer) console.log(\"VRRenderer not found\");\n\n    const klass = _VRRenderer.VRRenderer || function () {};\n\n    this.renderer = new klass(three.renderer, hmd);\n    this.hmd = hmd;\n    this.sensor = sensor;\n    three.VR.renderer = this.renderer;\n    three.VR.hmd = hmd;\n    three.VR.sensor = sensor;\n    console.log(\"VRRenderer\", hmd.deviceName);\n  },\n  change: function (event, three) {\n    if (event.changes.device) {\n      this.callback(null, three);\n    }\n\n    this.pre(event, three);\n  },\n  pre: function (event, three) {\n    const last = this.active; // Global active flag\n\n    const active = this.active = this.renderer && this.options.mode != \"2d\";\n    three.VR.active = active; // Load sensor state\n\n    if (active && this.sensor) {\n      const state = this.sensor.getState();\n      three.VR.state = state;\n    } else {\n      three.VR.state = null;\n    } // Notify if VR state changed\n\n\n    if (last != this.active) {\n      three.trigger({\n        type: \"vr\",\n        active: active,\n        hmd: this.hmd,\n        sensor: this.sensor\n      });\n    }\n  },\n  resize: function (_event, _three) {\n    if (this.active) {\n      // Reinit HMD projection\n      this.renderer.initialize();\n    }\n  },\n  render: function (event, three) {\n    if (three.scene && three.camera) {\n      const renderer = this.active ? this.renderer : three.renderer;\n\n      if (this.last != renderer) {\n        if (renderer == three.renderer) {\n          // Cleanup leftover renderer state when swapping back to normal\n          const dpr = renderer.getPixelRatio();\n          const width = renderer.domElement.width / dpr;\n          const height = renderer.domElement.height / dpr;\n          renderer.setScissorTest(false);\n          renderer.setViewport(0, 0, width, height);\n        }\n      }\n\n      this.last = renderer;\n      renderer.render(three.scene, three.camera);\n    }\n  }\n});\n};"],
"names":["shadow$provide","global","require","module","exports","_bootstrap","_VRRenderer","Bootstrap","registerPlugin","defaults","mode","device","fov","listen","install","three","VR","api","active","devices","hmd","sensor","renderer","state","uninstall","mocks","def","fake","force","deviceId","deviceName","getEyeTranslation","key","left","x","ipd","y","z","right","getRecommendedEyeFieldOfView","camera","fov2","fovX","Math","atan","tan","PI","aspect","rightDegrees","leftDegrees","downDegrees","upDegrees","getState","load","event","callback","devs","bind","navigator","getVRDevices","then","mozGetVRDevices","console","warn","options","vrdevs","HMD","window","HMDVRDevice","SENSOR","PositionSensorVRDevice","dev","i","length","hardwareUnitId","hookup","VRRenderer","log","change","changes","pre","last","trigger","type","resize","_event","_three","initialize","render","scene","dpr","getPixelRatio","width","domElement","height","setScissorTest","setViewport"]
}

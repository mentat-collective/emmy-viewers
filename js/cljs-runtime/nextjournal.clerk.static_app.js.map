{"version":3,"sources":["nextjournal/clerk/static_app.cljs"],"mappings":"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","names":["p__95338","map__95339","cljs.core/--destructure-map","cljs.core.get","nextjournal.clerk.static-app/doc-url","path->url","current-path","bundle?","path","url","G__95340","js/document","cljs.core._EQ_","clojure.string/ends-with?","dir-depth","cljs.core/frequencies","relative-root","clojure.string.join","cljs.core.repeat","nextjournal.clerk.static-app/hiccup","hiccup","nextjournal.clerk.sci-viewer/html-render","p__95341","map__95342","nextjournal.clerk.static-app/show","view-data","sha","doc","url->path","header","cljs.core.not_EQ_","and__4251__auto__","cljs.core/contains?","cljs.core.subs","nextjournal.clerk.sci-viewer/set-state","G__95343","cljs.core/vector?","cljs.core.get_in","cljs.core.update_in","cljs.core.partial","cljs.core/into","nextjournal.clerk.sci-viewer/root","nextjournal.devcards/register-devcard*","cljs.core.assoc","p__95345","map__95346","nextjournal.clerk.static-app/index","paths","with-let95347","reagent.ratom/with-let-values","temp__5757__auto__","reagent.ratom/*ratom-context*","c__85826__auto__","reagent.debug/has-console","reagent.debug/tracking","reagent.debug/track-console","js/console","init95348","cljs.core/not","p1__95344#","res95349","!state","reagent.core.atom","nextjournal.ui.components.localstorage/get-item","nextjournal.clerk.sci-viewer/local-storage-dark-mode-key","ref-fn","nextjournal.clerk.sci-viewer/setup-dark-mode!","nextjournal.clerk.sci-viewer/dark-mode-toggle","cljs.core.into","cljs.core.map","cljs.core.sort","nextjournal.clerk.static-app/get-routes","docs","index?","js/nextjournal","js/nextjournal.clerk","js/nextjournal.clerk.static-app","js/nextjournal.clerk.static-app.!match","nextjournal.clerk.static-app/!match","js/nextjournal.clerk.static-app.!state","nextjournal.clerk.static-app/!state","nextjournal.clerk.static-app/root","map__95351","cljs.core/deref","map__95352","data","path-params","match","view","cljs.core.merge","cljs.core.pr_str","nextjournal.clerk.static-app/mount","temp__5753__auto__","el","js/document.getElementById","reagent.dom.render","p__95354","map__95355","nextjournal.clerk.static-app/init","state","path->doc","url->doc","clojure.set/rename-keys","cljs.core/reset!","clojure.set/map-invert","js/console.log","sci.core.alter_var_root","nextjournal.clerk.sci-viewer/doc-url","cljs.core/constantly","router","reitit.frontend.router","p1__95353#","reitit.frontend.easy/start!","clojure.string/blank?","nextjournal.clerk.static-app/ssr","state-str","nextjournal.clerk.sci-viewer/read-string","reagent.dom.server.render_to_string"],"sourcesContent":["(ns nextjournal.clerk.static-app\n  (:require [clojure.set :as set]\n            [clojure.string :as str]\n            [nextjournal.clerk.sci-viewer :as sci-viewer]\n            [nextjournal.clerk.viewer :as v]\n            [nextjournal.devcards :as dc]\n            [nextjournal.ui.components.localstorage :as ls]\n            [reagent.core :as r]\n            [reagent.dom :as rdom]\n            [reagent.dom.server :as dom-server]\n            [reitit.frontend :as rf]\n            [reitit.frontend.easy :as rfe]\n            [sci.core :as sci]))\n\n(defn doc-url [{:keys [path->url current-path bundle?]} path]\n  (let [url (path->url path)]\n    (if bundle?\n      (str \"#/\" url)\n      (let [url (cond-> url\n                  (and (exists? js/document)\n                       (= (.. js/document -location -protocol) \"file:\")\n                       (or (nil? url)\n                           (str/ends-with? url \"/\")))\n                  (str \"index.html\"))\n            dir-depth (get (frequencies current-path) \\/ 0)\n            relative-root (str/join (repeat dir-depth \"../\"))]\n        (str relative-root url)))))\n\n(defn hiccup [hiccup]\n  {:nextjournal/viewer sci-viewer/html-render\n   :nextjournal/value hiccup})\n\n(defn show [{:as view-data :git/keys [sha url] :keys [doc path url->path]}]\n  (let [header [:div.mb-8.text-xs.sans-serif.text-gray-400.not-prose\n                (when (not= \"\" path)\n                  [:<>\n                   [:a.hover:text-indigo-500.dark:hover:text-white.font-medium.border-b.border-dotted.border-gray-300\n                    {:href (doc-url view-data \"\")} \"Back to index\"]\n                   [:span.mx-1 \"/\"]])\n                [:span\n                 \"Generated with \"\n                 [:a.hover:text-indigo-500.dark:hover:text-white.font-medium.border-b.border-dotted.border-gray-300\n                  {:href \"https://github.com/nextjournal/clerk\"} \"Clerk\"]\n                 (when (and url sha (contains? url->path path))\n                   [:<>\n                    \" from \"\n                    [:a.hover:text-indigo-500.dark:hover:text-white.font-medium.border-b.border-dotted.border-gray-300\n                     {:href (str url \"/blob/\" sha \"/\" (url->path path))} (url->path path) \"@\" [:span.tabular-nums (subs sha 0 7)]]])]]]\n    (sci-viewer/set-state {:doc (cond-> doc\n                                  (vector? (get-in doc [:nextjournal/value :blocks]))\n                                  (update-in [:nextjournal/value :blocks] (partial into [(hiccup header)])))})\n    [sci-viewer/root]))\n\n(dc/defcard show []\n  [show {:git/url \"https://github.com/nextjournal/clerk\"\n         :git/sha \"1026e6199f723e0f6ea92301b9678c9cf7024ba0\"\n         :path \"notebooks/hello.clj\"\n         :paths [\"notebooks/hello.clj\"],\n         :bundle? true,\n         :live-js? true,\n         :doc {:nextjournal/value {:blocks [#:nextjournal{:value \" # Hello, Clerk \ud83d\udc4b\\n\", :viewer :markdown}\n                                            #:nextjournal{:value \"(+ 39 3)\", :viewer :code}\n                                            {:nextjournal/viewer :clerk/result,\n                                             :nextjournal/value #:nextjournal{:edn \"{:path [], :nextjournal/value 42, :nextjournal/viewer {:render-fn #viewer-fn (fn [x] (v/html [:span.cmt-number.inspected-value (if (js/Number.isNaN x) \\\"NaN\\\" (str x))]))}}\"},\n                                             :path []}],\n                                   :title \"Hello, Clerk \ud83d\udc4b\"},\n               :nextjournal/viewer :clerk/notebook,\n               :scope {:namespace :nextjournal.clerk}},\n         :path->url {\"notebooks/hello.clj\" \"notebooks/hello.clj\"}\n         :url->path {\"notebooks/hello.clj\" \"notebooks/hello.clj\"}}])\n\n(defn index [{:as view-data :keys [paths]}]\n  (when (exists? js/document)\n    (set! (.-title js/document) \"Clerk\"))\n  (r/with-let [!state (r/atom {:dark-mode? (ls/get-item sci-viewer/local-storage-dark-mode-key)})\n               ref-fn #(when % (sci-viewer/setup-dark-mode! !state))]\n    [:div.bg-gray-100.dark:bg-gray-900.flex.justify-center.overflow-y-auto.w-screen.h-screen.p-4.md:p-0\n     {:ref ref-fn}\n     [:div.fixed.top-2.left-2.md:left-auto.md:right-2.z-10\n      [sci-viewer/dark-mode-toggle !state]]\n     [:div.md:my-12.w-full.md:max-w-lg\n      [:div.bg-white.dark:bg-gray-800.shadow-lg.rounded-lg.border.dark:border-gray-800.dark:text-white\n       [:div.px-4.md:px-8.py-3\n        [:h1.text-xl \"Clerk\"]]\n       (into [:ul]\n             (map (fn [path]\n                    [:li.border-t.dark:border-gray-900\n                     [:a.pl-4.md:pl-8.pr-4.py-2.flex.w-full.items-center.justify-between.hover:bg-indigo-50.dark:hover:bg-gray-700\n                      {:href (doc-url view-data path)}\n                      [:span.text-sm.md:text-md.monospace.flex-auto.block.truncate path]\n                      [:svg.h-4.w-4.flex-shrink-0 {:xmlns \"http://www.w3.org/2000/svg\" :fill \"none\" :viewBox \"0 0 24 24\" :stroke \"currentColor\"}\n                       [:path {:stroke-linecap \"round\" :stroke-linejoin \"round\" :stroke-width \"2\" :d \"M9 5l7 7-7 7\"}]]]]))\n             (sort paths))]\n      [:div.my-4.md:mb-0.text-xs.text-gray-400.sans-serif.px-4.md:px-8\n       [:a.hover:text-indigo-600.dark:hover:text-white\n        {:href \"https://github.com/nextjournal/clerk\"}\n        \"Generated with Clerk.\"]]]]))\n\n(dc/defcard index []\n  [index {:git/url \"https://github.com/nextjournal/clerk\"\n          :git/sha \"1026e6199f723e0f6ea92301b9678c9cf7024ba0\"\n          :paths [\"notebooks/hello.clj\"],\n          :bundle? true,\n          :live-js? true,\n          :path->url {\"notebooks/hello.clj\" \"notebooks/hello.clj\"}\n          :url->path {\"notebooks/hello.clj\" \"notebooks/hello.clj\"}}])\n\n(defn get-routes [docs]\n  (let [index? (contains? docs \"\")]\n    [[\"/*path\" {:name ::show :view show}]\n     [\"/\" {:name ::index :view (if index? show index)}]]))\n\n\n(defonce !match (r/atom nil))\n(defonce !state (r/atom {}))\n\n(defn root []\n  (let [{:keys [data path-params] :as match} @!match\n        {:keys [view]} data\n        view-data (merge @!state data path-params {:doc (get-in @!state [:path->doc (:path path-params \"\")])})]\n    [:div.flex.h-screen.bg-white.dark:bg-gray-900\n     [:div.h-screen.overflow-y-auto.flex-auto.scroll-container\n      (if view\n        [view view-data]\n        [:pre (pr-str match)])]]))\n\n(defn ^:dev/after-load mount []\n  (when-let [el (and (exists? js/document) (js/document.getElementById \"clerk-static-app\"))]\n    (rdom/render [root] el)))\n\n;; next up\n;; - jit compiling css\n;; - support viewing source clojure/markdown file (opt-in)\n\n(defn ^:export init [{:as state :keys [bundle? path->doc path->url current-path]}]\n  (let [url->doc (set/rename-keys path->doc path->url)]\n    (reset! !state (assoc state\n                          :path->doc url->doc\n                          :url->path (set/map-invert path->url)))\n    (js/console.log :init state)\n    (sci/alter-var-root sci-viewer/doc-url (constantly (partial doc-url @!state)))\n    (if bundle?\n      (let [router (rf/router (get-routes url->doc))]\n        (rfe/start! router #(reset! !match %1) {:use-fragment true}))\n      (reset! !match {:data {:view (if (str/blank? current-path) index show)} :path-params {:path (path->url current-path)}}))\n    (mount)))\n\n(defn ^:export ssr [state-str]\n  (init (sci-viewer/read-string state-str))\n  (dom-server/render-to-string [root]))\n"]}
{
"version":3,
"file":"module$node_modules$mathbox$build$esm$primitives$types$operator$readback.js",
"lineCount":5,
"mappings":"AAAAA,cAAA,CAAA,wEAAA,CAA6F,QAAQ,CAACC,MAAD,CAAQC,OAAR,CAAgBC,MAAhB,CAAuBC,OAAvB,CAAgC,CAGrIC,MAAOC,CAAAA,cAAP,CAAsBF,OAAtB,CAA+B,YAA/B,CAA6C,CAC3CG,MAAO,CAAA,CADoC,CAA7C,CAGAH,QAAQI,CAAAA,QAAR,CAAmB,IAAK,EAEpBC,OAAAA,CAAaP,OAAA,CAAQ,4DAAR,CAYjB,MAAMM,SAAN,QAAuBC,OAAWC,CAAAA,SAAlC,CACSC,gBAAS,EAAG,CACjB,IAAKC,CAAAA,MAAL,CAAc,2CAAA,CAAA,KAAA,CAAA,GAAA,CACd,KAAKC,CAAAA,MAAL,CAAc,CACZC,SAAU,CADE,CAFG,CAOnBC,IAAI,EAAG,CACL,IAAKC,CAAAA,OAAL,CAAe,IAAKC,CAAAA,IAApB,CAA2B,IAC3B,OAAO,KAAKC,CAAAA,MAAZ,CAAqB,EAFhB,CAKPC,IAAI,EAAG,CACL,KAAMA,CAAAA,IAAN,EAEA;IAAKC,CAAAA,QAAL,CAAc,eAAd,CAA+B,EAAA,EAAuB,IAAjB,EAAA,IAAKC,CAAAA,QAAL,CAAwB,IAAKA,CAAAA,QAASC,CAAAA,IAAtC,CAA6CC,IAAAA,EAAlF,CAEA,KAAKH,CAAAA,QAAL,CAAc,gBAAd,CAAgC,EAAA,EAAuB,IAAjB,EAAA,IAAKC,CAAAA,QAAL,CAAwB,IAAKA,CAAAA,QAASG,CAAAA,KAAtC,CAA8CD,IAAAA,EAApF,CAEA,KAAKH,CAAAA,QAAL,CAAc,gBAAd,CAAgC,EAAA,EAAuB,IAAjB,EAAA,IAAKC,CAAAA,QAAL,CAAwB,IAAKA,CAAAA,QAASI,CAAAA,KAAtC,CAA8CF,IAAAA,EAApF,CAEA,KAAKH,CAAAA,QAAL,CAAc,iBAAd,CAAiC,EAAA,EAAuB,IAAjB,EAAA,IAAKC,CAAAA,QAAL,CAAwB,IAAKA,CAAAA,QAASK,CAAAA,MAAtC,CAA+CH,IAAAA,EAAtF,CAEA,KAAKH,CAAAA,QAAL,CAAc,gBAAd,CAAgC,EAAA,EAAuB,IAAjB,EAAA,IAAKC,CAAAA,QAAL,CAAwB,IAAKA,CAAAA,QAASM,CAAAA,KAAtC,CAA8CJ,IAAAA,EAApF,CAGA,KAAKK,CAAAA,QAASC,CAAAA,IAAKV,CAAAA,IAAnB,CAAwB,CAAC,CACvBW,GAAI,iBADmB,CAEvBC,MAAO,QAFgB,CAAD,CAAxB,CAKA,IAAwB,IAAxB,EAAI,IAAKF,CAAAA,IAAKG,CAAAA,MAAd,CAAA,CAKA,IAAM,CACJC,IADI;AAEJnB,QAFI,CAGJoB,IAHI,CAAA,CAIF,IAAKC,CAAAA,KAET,KAAKlB,CAAAA,IAAL,CAAY,IAAKmB,CAAAA,QAAL,CAAc,MAAd,CAEZ,KAAKC,CAAAA,OAAL,CAAa,MAAb,CAAqB,aAArB,CAAoC,IAAKC,CAAAA,MAAzC,CAGA,KAAM,CACJd,KADI,CAEJC,KAFI,CAGJC,MAHI,CAIJC,KAJI,CAAA,CAKF,IAAKE,CAAAA,IAAKG,CAAAA,MAAOO,CAAAA,aAAjB,EALJ,CAOMC,QAAU,IAAKX,CAAAA,IAAKG,CAAAA,MAAOS,CAAAA,YAAjB,CAA8B,IAAKC,CAAAA,QAASC,CAAAA,MAAd,EAA9B,CAEhB,KAAKtB,CAAAA,QAAL,CAAgB,IAAKuB,CAAAA,YAAazB,CAAAA,IAAlB,CAAuB,UAAvB,CAAmC,CACjD0B,IAAKL,OAD4C,CAEjDhB,KAFiD,CAGjDC,KAHiD,CAIjDC,MAJiD,CAKjDC,KALiD,CAMjDb,QANiD,CAOjDmB,IAPiD,CAAnC,CAUJ,KAAZ,EAAIC,IAAJ,EACE,IAAKb,CAAAA,QAASyB,CAAAA,WAAd,CAA0BZ,IAA1B,CAGF,KAAKN,CAAAA,QAASV,CAAAA,MAAOC,CAAAA,IAArB,EAvCA,CAnBK,CA6DP4B,MAAM,EAAG,CACc,IAArB,EAAI,IAAK1B,CAAAA,QAAT,GACE,IAAKA,CAAAA,QAAS2B,CAAAA,OAAd,EAIA,CADA,IAAKhC,CAAAA,OACL,CAFA,IAAKC,CAAAA,IAEL,CAHA,IAAKI,CAAAA,QAGL,CAHgB,IAGhB;AAAA,IAAKH,CAAAA,MAAL,CAAc,EALhB,CAQA,KAAKU,CAAAA,QAASV,CAAAA,MAAO6B,CAAAA,MAArB,EAEA,OAAO,KAAKnB,CAAAA,QAASC,CAAAA,IAAKkB,CAAAA,MAAnB,EAXA,CAcTT,MAAM,EAAG,CACc,IAArB,EAAI,IAAKjB,CAAAA,QAAT,EAII,IAAK4B,CAAAA,QAJT,GAKE,IAAK5B,CAAAA,QAASiB,CAAAA,MAAd,CAAkC,IAAb,EAAA,IAAKrB,CAAAA,IAAL,CAAoB,IAAKA,CAAAA,IAAKiC,CAAAA,SAAV,EAApB,CAA4C3B,IAAAA,EAAjE,CAGA,CAFA,IAAKF,CAAAA,QAAS8B,CAAAA,IAAd,EAEA,CAAuB,IAAvB,EAAI,IAAKhB,CAAAA,KAAMD,CAAAA,IAAf,EACE,IAAKb,CAAAA,QAAS+B,CAAAA,OAAd,EATJ,CADO,CAeTC,MAAM,EAAG,CACP,IAAQC,EAER,IAAqB,IAArB,EAAI,IAAKjC,CAAAA,QAAT,CAAA,CAKA,IAAM,CACJG,KADI,CAEJC,KAFI,CAGJC,MAHI,CAIJC,KAJI,CAAA,CAKF,IAAKE,CAAAA,IAAKG,CAAAA,MAAOuB,CAAAA,mBAAjB,EAEJ,KAAKlC,CAAAA,QAASmC,CAAAA,SAAd,CAAwBhC,KAAxB,CAA+BC,KAA/B,CAAsCC,MAAtC,CAA8CC,KAA9C,CAEA,KAAK8B,CAAAA,OAAL,CAAoBjC,KACpB,KAAKkC,CAAAA,OAAL,CAAeJ,EAAf,CADoB9B,KACpB,CAAyBC,KACzB,OAAO,KAAKkC,CAAAA,OAAZ,CAAsBL,EAAtB,CAA2B5B,MAhB3B,CAHO,CAsBTkC,MAAM,CAACC,OAAD;AAAUC,QAAV,CAAoBC,KAApB,CAA2B,CAC/B,GAAIF,OAAA,CAAQ,eAAR,CAAJ,CACE,MAAO,KAAKG,CAAAA,OAAL,EAGT,IAAIH,OAAA,CAAQ,eAAR,CAAJ,EAAgC,IAAKxC,CAAAA,QAArC,CACE,MAAO,KAAKA,CAAAA,QAASyB,CAAAA,WAAd,CAA0B,IAAKX,CAAAA,KAAMD,CAAAA,IAArC,CANsB,CA7HnC,CAyIA9B,OAAQI,CAAAA,QAAR,CAAmBA,QACnBA,SAASG,CAAAA,SAAT,EA9JqI;",
"sources":["node_modules/mathbox/build/esm/primitives/types/operator/readback.js"],
"sourcesContent":["shadow$provide[\"module$node_modules$mathbox$build$esm$primitives$types$operator$readback\"] = function(global,require,module,exports) {\n\"use strict\";\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.Readback = void 0;\n\nvar _primitive = require(\"../../primitive.js\");\n\n// TODO: This file was created by bulk-decaffeinate.\n// Sanity-check the conversion and remove this comment.\n\n/*\n * decaffeinate suggestions:\n * DS102: Remove unnecessary code created because of implicit returns\n * DS206: Consider reworking classes to avoid initClass\n * DS207: Consider shorter variations of null checks\n * Full docs: https://github.com/decaffeinate/decaffeinate/blob/master/docs/suggestions.md\n */\nclass Readback extends _primitive.Primitive {\n  static initClass() {\n    this.traits = [\"node\", \"bind\", \"operator\", \"readback\", \"entity\", \"active\"];\n    this.finals = {\n      channels: 4\n    };\n  }\n\n  init() {\n    this.emitter = this.root = null;\n    return this.active = {};\n  }\n\n  make() {\n    super.make();\n\n    this._compute(\"readback.data\", () => this.readback != null ? this.readback.data : undefined);\n\n    this._compute(\"readback.items\", () => this.readback != null ? this.readback.items : undefined);\n\n    this._compute(\"readback.width\", () => this.readback != null ? this.readback.width : undefined);\n\n    this._compute(\"readback.height\", () => this.readback != null ? this.readback.height : undefined);\n\n    this._compute(\"readback.depth\", () => this.readback != null ? this.readback.depth : undefined); // Bind to attached objects\n\n\n    this._helpers.bind.make([{\n      to: \"operator.source\",\n      trait: \"source\"\n    }]);\n\n    if (this.bind.source == null) {\n      return;\n    } // Sampler props\n\n\n    const {\n      type,\n      channels,\n      expr\n    } = this.props; // Listen for updates\n\n    this.root = this._inherit(\"root\");\n\n    this._listen(\"root\", \"root.update\", this.update); // Fetch source dimensions\n\n\n    const {\n      items,\n      width,\n      height,\n      depth\n    } = this.bind.source.getDimensions(); // Build shader to sample source data\n\n    const sampler = this.bind.source.sourceShader(this._shaders.shader()); // Prepare readback/memo RTT\n\n    this.readback = this._renderables.make(\"readback\", {\n      map: sampler,\n      items,\n      width,\n      height,\n      depth,\n      channels,\n      type\n    }); // Prepare readback consumer\n\n    if (expr != null) {\n      this.readback.setCallback(expr);\n    }\n\n    this._helpers.active.make();\n  }\n\n  unmake() {\n    if (this.readback != null) {\n      this.readback.dispose();\n      this.readback = null;\n      this.root = null;\n      this.emitter = null;\n      this.active = {};\n    }\n\n    this._helpers.active.unmake();\n\n    return this._helpers.bind.unmake();\n  }\n\n  update() {\n    if (this.readback == null) {\n      return;\n    }\n\n    if (this.isActive) {\n      this.readback.update(this.root != null ? this.root.getCamera() : undefined);\n      this.readback.post();\n\n      if (this.props.expr != null) {\n        this.readback.iterate();\n      }\n    }\n  }\n\n  resize() {\n    let sI, sJ;\n\n    if (this.readback == null) {\n      return;\n    } // Fetch geometry/html dimensions\n\n\n    const {\n      items,\n      width,\n      height,\n      depth\n    } = this.bind.source.getActiveDimensions(); // Limit readback to active area\n\n    this.readback.setActive(items, width, height, depth); // Recalculate iteration strides\n\n    this.strideI = sI = items;\n    this.strideJ = sJ = sI * width;\n    return this.strideK = sJ * height;\n  }\n\n  change(changed, _touched, _init) {\n    if (changed[\"readback.type\"]) {\n      return this.rebuild();\n    }\n\n    if (changed[\"readback.expr\"] && this.readback) {\n      return this.readback.setCallback(this.props.expr);\n    }\n  }\n\n}\n\nexports.Readback = Readback;\nReadback.initClass();\n};"],
"names":["shadow$provide","global","require","module","exports","Object","defineProperty","value","Readback","_primitive","Primitive","initClass","traits","finals","channels","init","emitter","root","active","make","_compute","readback","data","undefined","items","width","height","depth","_helpers","bind","to","trait","source","type","expr","props","_inherit","_listen","update","getDimensions","sampler","sourceShader","_shaders","shader","_renderables","map","setCallback","unmake","dispose","isActive","getCamera","post","iterate","resize","sJ","getActiveDimensions","setActive","strideI","strideJ","strideK","change","changed","_touched","_init","rebuild"]
}

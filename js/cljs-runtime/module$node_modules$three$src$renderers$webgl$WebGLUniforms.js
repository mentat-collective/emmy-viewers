shadow$provide.module$node_modules$three$src$renderers$webgl$WebGLUniforms=function(global,require,module,exports){function flatten(array,nBlocks,blockSize){const firstElem=array[0];if(0>=firstElem||0<firstElem)return array;const n=nBlocks*blockSize;let r=arrayCacheF32[n];void 0===r&&(r=new Float32Array(n),arrayCacheF32[n]=r);if(0!==nBlocks){firstElem.toArray(r,0);for(let i=1,offset=0;i!==nBlocks;++i)offset+=blockSize,array[i].toArray(r,offset)}return r}function arraysEqual(a,b){if(a.length!==b.length)return!1;
for(let i=0,l=a.length;i<l;i++)if(a[i]!==b[i])return!1;return!0}function copyArray(a,b){for(let i=0,l=b.length;i<l;i++)a[i]=b[i]}function allocTexUnits(textures,n){let r=arrayCacheI32[n];void 0===r&&(r=new Int32Array(n),arrayCacheI32[n]=r);for(let i=0;i!==n;++i)r[i]=textures.allocateTextureUnit();return r}function setValueV1f(gl,v){const cache=this.cache;cache[0]!==v&&(gl.uniform1f(this.addr,v),cache[0]=v)}function setValueV2f(gl,v){const cache=this.cache;if(void 0!==v.x){if(cache[0]!==v.x||cache[1]!==
v.y)gl.uniform2f(this.addr,v.x,v.y),cache[0]=v.x,cache[1]=v.y}else arraysEqual(cache,v)||(gl.uniform2fv(this.addr,v),copyArray(cache,v))}function setValueV3f(gl,v){const cache=this.cache;if(void 0!==v.x){if(cache[0]!==v.x||cache[1]!==v.y||cache[2]!==v.z)gl.uniform3f(this.addr,v.x,v.y,v.z),cache[0]=v.x,cache[1]=v.y,cache[2]=v.z}else if(void 0!==v.r){if(cache[0]!==v.r||cache[1]!==v.g||cache[2]!==v.b)gl.uniform3f(this.addr,v.r,v.g,v.b),cache[0]=v.r,cache[1]=v.g,cache[2]=v.b}else arraysEqual(cache,v)||
(gl.uniform3fv(this.addr,v),copyArray(cache,v))}function setValueV4f(gl,v){const cache=this.cache;if(void 0!==v.x){if(cache[0]!==v.x||cache[1]!==v.y||cache[2]!==v.z||cache[3]!==v.w)gl.uniform4f(this.addr,v.x,v.y,v.z,v.w),cache[0]=v.x,cache[1]=v.y,cache[2]=v.z,cache[3]=v.w}else arraysEqual(cache,v)||(gl.uniform4fv(this.addr,v),copyArray(cache,v))}function setValueM2(gl,v){const cache=this.cache,elements=v.elements;void 0===elements?arraysEqual(cache,v)||(gl.uniformMatrix2fv(this.addr,!1,v),copyArray(cache,
v)):arraysEqual(cache,elements)||(mat2array.set(elements),gl.uniformMatrix2fv(this.addr,!1,mat2array),copyArray(cache,elements))}function setValueM3(gl,v){const cache=this.cache,elements=v.elements;void 0===elements?arraysEqual(cache,v)||(gl.uniformMatrix3fv(this.addr,!1,v),copyArray(cache,v)):arraysEqual(cache,elements)||(mat3array.set(elements),gl.uniformMatrix3fv(this.addr,!1,mat3array),copyArray(cache,elements))}function setValueM4(gl,v){const cache=this.cache,elements=v.elements;void 0===elements?
arraysEqual(cache,v)||(gl.uniformMatrix4fv(this.addr,!1,v),copyArray(cache,v)):arraysEqual(cache,elements)||(mat4array.set(elements),gl.uniformMatrix4fv(this.addr,!1,mat4array),copyArray(cache,elements))}function setValueV1i(gl,v){const cache=this.cache;cache[0]!==v&&(gl.uniform1i(this.addr,v),cache[0]=v)}function setValueV2i(gl,v){const cache=this.cache;arraysEqual(cache,v)||(gl.uniform2iv(this.addr,v),copyArray(cache,v))}function setValueV3i(gl,v){const cache=this.cache;arraysEqual(cache,v)||(gl.uniform3iv(this.addr,
v),copyArray(cache,v))}function setValueV4i(gl,v){const cache=this.cache;arraysEqual(cache,v)||(gl.uniform4iv(this.addr,v),copyArray(cache,v))}function setValueV1ui(gl,v){const cache=this.cache;cache[0]!==v&&(gl.uniform1ui(this.addr,v),cache[0]=v)}function setValueV2ui(gl,v){const cache=this.cache;arraysEqual(cache,v)||(gl.uniform2uiv(this.addr,v),copyArray(cache,v))}function setValueV3ui(gl,v){const cache=this.cache;arraysEqual(cache,v)||(gl.uniform3uiv(this.addr,v),copyArray(cache,v))}function setValueV4ui(gl,
v){const cache=this.cache;arraysEqual(cache,v)||(gl.uniform4uiv(this.addr,v),copyArray(cache,v))}function setValueT1(gl,v,textures){const cache=this.cache,unit=textures.allocateTextureUnit();cache[0]!==unit&&(gl.uniform1i(this.addr,unit),cache[0]=unit);textures.safeSetTexture2D(v||emptyTexture,unit)}function setValueT3D1(gl,v,textures){const cache=this.cache,unit=textures.allocateTextureUnit();cache[0]!==unit&&(gl.uniform1i(this.addr,unit),cache[0]=unit);textures.setTexture3D(v||emptyTexture3d,unit)}
function setValueT6(gl,v,textures){const cache=this.cache,unit=textures.allocateTextureUnit();cache[0]!==unit&&(gl.uniform1i(this.addr,unit),cache[0]=unit);textures.safeSetTextureCube(v||emptyCubeTexture,unit)}function setValueT2DArray1(gl,v,textures){const cache=this.cache,unit=textures.allocateTextureUnit();cache[0]!==unit&&(gl.uniform1i(this.addr,unit),cache[0]=unit);textures.setTexture2DArray(v||emptyTexture2dArray,unit)}function getSingularSetter(type){switch(type){case 5126:return setValueV1f;
case 35664:return setValueV2f;case 35665:return setValueV3f;case 35666:return setValueV4f;case 35674:return setValueM2;case 35675:return setValueM3;case 35676:return setValueM4;case 5124:case 35670:return setValueV1i;case 35667:case 35671:return setValueV2i;case 35668:case 35672:return setValueV3i;case 35669:case 35673:return setValueV4i;case 5125:return setValueV1ui;case 36294:return setValueV2ui;case 36295:return setValueV3ui;case 36296:return setValueV4ui;case 35678:case 36198:case 36298:case 36306:case 35682:return setValueT1;
case 35679:case 36299:case 36307:return setValueT3D1;case 35680:case 36300:case 36308:case 36293:return setValueT6;case 36289:case 36303:case 36311:case 36292:return setValueT2DArray1}}function setValueV1fArray(gl,v){gl.uniform1fv(this.addr,v)}function setValueV2fArray(gl,v){v=flatten(v,this.size,2);gl.uniform2fv(this.addr,v)}function setValueV3fArray(gl,v){v=flatten(v,this.size,3);gl.uniform3fv(this.addr,v)}function setValueV4fArray(gl,v){v=flatten(v,this.size,4);gl.uniform4fv(this.addr,v)}function setValueM2Array(gl,
v){v=flatten(v,this.size,4);gl.uniformMatrix2fv(this.addr,!1,v)}function setValueM3Array(gl,v){v=flatten(v,this.size,9);gl.uniformMatrix3fv(this.addr,!1,v)}function setValueM4Array(gl,v){v=flatten(v,this.size,16);gl.uniformMatrix4fv(this.addr,!1,v)}function setValueV1iArray(gl,v){gl.uniform1iv(this.addr,v)}function setValueV2iArray(gl,v){gl.uniform2iv(this.addr,v)}function setValueV3iArray(gl,v){gl.uniform3iv(this.addr,v)}function setValueV4iArray(gl,v){gl.uniform4iv(this.addr,v)}function setValueV1uiArray(gl,
v){gl.uniform1uiv(this.addr,v)}function setValueV2uiArray(gl,v){gl.uniform2uiv(this.addr,v)}function setValueV3uiArray(gl,v){gl.uniform3uiv(this.addr,v)}function setValueV4uiArray(gl,v){gl.uniform4uiv(this.addr,v)}function setValueT1Array(gl,v,textures){const n=v.length,units=allocTexUnits(textures,n);gl.uniform1iv(this.addr,units);for(gl=0;gl!==n;++gl)textures.safeSetTexture2D(v[gl]||emptyTexture,units[gl])}function setValueT3DArray(gl,v,textures){const n=v.length,units=allocTexUnits(textures,n);
gl.uniform1iv(this.addr,units);for(gl=0;gl!==n;++gl)textures.setTexture3D(v[gl]||emptyTexture3d,units[gl])}function setValueT6Array(gl,v,textures){const n=v.length,units=allocTexUnits(textures,n);gl.uniform1iv(this.addr,units);for(gl=0;gl!==n;++gl)textures.safeSetTextureCube(v[gl]||emptyCubeTexture,units[gl])}function setValueT2DArrayArray(gl,v,textures){const n=v.length,units=allocTexUnits(textures,n);gl.uniform1iv(this.addr,units);for(gl=0;gl!==n;++gl)textures.setTexture2DArray(v[gl]||emptyTexture2dArray,
units[gl])}function getPureArraySetter(type){switch(type){case 5126:return setValueV1fArray;case 35664:return setValueV2fArray;case 35665:return setValueV3fArray;case 35666:return setValueV4fArray;case 35674:return setValueM2Array;case 35675:return setValueM3Array;case 35676:return setValueM4Array;case 5124:case 35670:return setValueV1iArray;case 35667:case 35671:return setValueV2iArray;case 35668:case 35672:return setValueV3iArray;case 35669:case 35673:return setValueV4iArray;case 5125:return setValueV1uiArray;
case 36294:return setValueV2uiArray;case 36295:return setValueV3uiArray;case 36296:return setValueV4uiArray;case 35678:case 36198:case 36298:case 36306:case 35682:return setValueT1Array;case 35679:case 36299:case 36307:return setValueT3DArray;case 35680:case 36300:case 36308:case 36293:return setValueT6Array;case 36289:case 36303:case 36311:case 36292:return setValueT2DArrayArray}}function SingleUniform(id,activeInfo,addr){this.id=id;this.addr=addr;this.cache=[];this.setValue=getSingularSetter(activeInfo.type)}
function PureArrayUniform(id,activeInfo,addr){this.id=id;this.addr=addr;this.cache=[];this.size=activeInfo.size;this.setValue=getPureArraySetter(activeInfo.type)}function StructuredUniform(id){this.id=id;this.seq=[];this.map={}}function WebGLUniforms(gl,program){this.seq=[];this.map={};const n=gl.getProgramParameter(program,gl.ACTIVE_UNIFORMS);for(let i=0;i<n;++i){var info=gl.getActiveUniform(program,i),addr=gl.getUniformLocation(program,info.name),container=this,path=info.name;const pathLength=path.length;
for(RePathPart.lastIndex=0;;){const match=RePathPart.exec(path),matchEnd=RePathPart.lastIndex;var id=match[1],subscript=match[3];"]"===match[2]&&(id|=0);if(void 0===subscript||"["===subscript&&matchEnd+2===pathLength){path=container;info=void 0===subscript?new SingleUniform(id,info,addr):new PureArrayUniform(id,info,addr);path.seq.push(info);path.map[info.id]=info;break}else subscript=container.map[id],void 0===subscript&&(subscript=new StructuredUniform(id),id=container,container=subscript,id.seq.push(container),
id.map[container.id]=container),container=subscript}}}Object.defineProperty(exports,"__esModule",{value:!0});exports.WebGLUniforms=WebGLUniforms;global=require("module$node_modules$three$src$textures$CubeTexture");module=require("module$node_modules$three$src$textures$Texture");exports=require("module$node_modules$three$src$textures$DataTexture2DArray");require=require("module$node_modules$three$src$textures$DataTexture3D");const emptyTexture=new module.Texture,emptyTexture2dArray=new exports.DataTexture2DArray,
emptyTexture3d=new require.DataTexture3D,emptyCubeTexture=new global.CubeTexture,arrayCacheF32=[],arrayCacheI32=[],mat4array=new Float32Array(16),mat3array=new Float32Array(9),mat2array=new Float32Array(4);PureArrayUniform.prototype.updateCache=function(data){const cache=this.cache;data instanceof Float32Array&&cache.length!==data.length&&(this.cache=new Float32Array(data.length));copyArray(cache,data)};StructuredUniform.prototype.setValue=function(gl,value,textures){const seq=this.seq;for(let i=
0,n=seq.length;i!==n;++i){const u=seq[i];u.setValue(gl,value[u.id],textures)}};const RePathPart=/(\w+)(\])?(\[|\.)?/g;WebGLUniforms.prototype.setValue=function(gl,name,value,textures){name=this.map[name];void 0!==name&&name.setValue(gl,value,textures)};WebGLUniforms.prototype.setOptional=function(gl,object,name){object=object[name];void 0!==object&&this.setValue(gl,name,object)};WebGLUniforms.upload=function(gl,seq,values,textures){for(let i=0,n=seq.length;i!==n;++i){const u=seq[i],v=values[u.id];
!1!==v.needsUpdate&&u.setValue(gl,v.value,textures)}};WebGLUniforms.seqWithValue=function(seq,values){const r=[];for(let i=0,n=seq.length;i!==n;++i){const u=seq[i];u.id in values&&r.push(u)}return r}}
//# sourceMappingURL=module$node_modules$three$src$renderers$webgl$WebGLUniforms.js.map

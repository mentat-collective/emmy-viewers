{"version":3,"sources":["sicmutils/numerical/unimin/bracket.cljc"],"mappings":"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","names":["sicmutils.numerical.unimin.bracket/epsilon","sicmutils.numerical.unimin.bracket/ascending-by","f","a","b","fa","fb","p__102143","p__102144","p__102145","vec__102146","cljs.core.nth","vec__102149","vec__102152","%","p1__102138#","js/Error","sicmutils.numerical.unimin.bracket/parabolic-pieces","xa","xb","xc","fc","cljs.core/second","tmp1","tmp2","v","p","q","sicmutils.generic/negate","sicmutils.generic/abs","p__102161","vec__102163","sicmutils.numerical.unimin.bracket/parabolic-step","c","vec__102166","two-eps","p__102183","map__102184","cljs.core/--destructure-map","cljs.core.get","sicmutils.numerical.unimin.bracket/bracket-step-fn","grow-limit","p__102192","p__102193","vec__102194","vec__102197","wlim","w","fw","new-c","sicmutils.numerical.unimin.golden/extend-pt","var_args","G__102209","sicmutils.numerical.unimin.bracket/bracket-min","p__102210","map__102211","sicmutils.numerical.unimin.bracket.bracket_min","maxiter","maxfun","opts","vec__102216","vec__102219","vec__102222","vec__102225","f-counter","sicmutils.util.counted","step","stop-fn","p__102228","p__102229","vec__102230","vec__102233","_","iteration","cljs.core/deref","complete","p__102238","p__102239","vec__102240","vec__102243","iterations","m","cljs.core.assoc","G__102250","vec__102251","vec__102257","G__102261","sicmutils.numerical.unimin.bracket/bracket-max","sicmutils.numerical.unimin.bracket.bracket_max","-f","cljs.core.comp","G__102266","sicmutils.numerical.unimin.bracket/bracket-min-scmutils","p__102267","map__102268","sicmutils.numerical.unimin.bracket.bracket_min_scmutils","start","vec__102269","vec__102272","vec__102275","vec__102278","p__102281","p__102282","p__102283","vec__102284","vec__102287","vec__102290","x__4339__auto__","y__4340__auto__","p__102294","p__102295","vec__102297","vec__102300","run","p__102307","p__102308","vec__102309","vec__102312","iter","xd","G__102317","sicmutils.numerical.unimin.bracket/bracket-max-scmutils","sicmutils.numerical.unimin.bracket.bracket_max_scmutils"],"sourcesContent":["#_\"SPDX-License-Identifier: GPL-3.0\"\n\n(ns sicmutils.numerical.unimin.bracket\n  (:require [sicmutils.generic :as g]\n            [sicmutils.numerical.unimin.golden :as ug]\n            [sicmutils.util :as u]))\n\n(def ^:private epsilon 1e-21)\n\n(defn ascending-by\n  \"Returns the points ordered as f(a) < f(b)\"\n  [f a b]\n  (let [fa (f a) fb (f b)]\n    (if (< fa fb)\n      [[a fa] [b fb]]\n      [[b fb] [a fa]])))\n\n(defn parabolic-pieces\n  \"Accepts three pairs of `[x, (f x)]`, fits a quadratic function to all three\n  points and returns the step from `xb` (the coordinate of the second argument)\n  to the minimum of the fitted quadratic.\n\n  Returns the numerator and denominator `p` and `q` of the required step. If `q`\n  is 0, then the supplied points were colinear.\n\n  `q` is guaranteed to be `>= 0`, while `p` might be negative.\n\n  See these notes for the derivation of this method:\n  http://fourier.eng.hmc.edu/e176/lectures/NM/node25.html\"\n  [[xa fa] [xb fb] [xc fc]]\n  {:post [#(>= (second %) 0)]}\n  (let [tmp1  (* (- xb xa) (- fb fc))\n        tmp2  (* (- xb xc) (- fb fa))\n        v     (- tmp2 tmp1)\n        p (- (* (- xb xc) tmp2)\n             (* (- xb xa) tmp1))\n        q (* 2.0 v)]\n    (if (pos? q)\n      [(g/negate p) q]\n      [p (g/abs q)])))\n\n(defn parabolic-step\n  \"Fits a parabola through all three points, and returns the coordinate of the\n  minimum of the parabola.\n\n  If the supplied points are colinear, returns a point that takes a large jump\n  in the direction of the downward slope of the line.\"\n  [a [xb :as b] c]\n  (let [two-eps (* 2.0 epsilon)\n        [p q] (parabolic-pieces a b c)\n        q (if (< q two-eps)\n            two-eps\n            q)]\n    (+ xb (/ p q))))\n\n(defn bracket-step-fn\n  \"Returns a function that performs steps of bracket extension.\n\n  :grow-limit is the maximum factor that the parabolic interpolation can jump\n  the function.\"\n  [f {:keys [grow-limit] :or {grow-limit 110.0}}]\n  (fn [a\n      [xb fb :as b]\n      [xc fc :as c]]\n    (let [;; If f(c) is < f(b) the minimum of the parabola will be far\n          ;; outside the bounds. This is a bound on how far we're allowed to\n          ;; jump in a single step.\n          wlim (+ xb (* grow-limit (- xc xb)))\n          w (parabolic-step a b c)]\n      (cond\n        ;; If the minimum is between b and c, we know that either b or w are\n        ;; suitable minima, since f(b) < f(a).\n        (<= xb w xc)\n        (let [fw (f w)]\n          (cond\n            ;; if the parabolic minimum w evaluates to < f(c), shift the interval\n            ;; to (b, w, c):\n            (< fw fc) [b [w fw] c]\n\n            ;; If f(b) < f(w) >= f(c), tighten the interval to (a, b, w):\n            (> fw fb) [a b [w fw]]\n\n            ;; If the points are in descending order - f(a) > f(b) >= f(w) >=\n            ;; f(c) - stretch beyond `c` to attempt to find an increasing\n            ;; region.\n            :else (let [new-c (ug/extend-pt xc xb)]\n                    [b c [new-c (f new-c)]])))\n\n        ;; This is the case where the parabolic minimum stretched beyond c but\n        ;; hasn't reached its limit.\n        (<= xc w wlim)\n        (let [fw (f w)]\n          (if (< fw fc)\n            ;; If we're still descending, shift the interval fully right to (c,\n            ;; w, stretched-c)\n            (let [new-c (ug/extend-pt w xc)]\n              [c [w fw] [new-c (f new-c)]])\n            ;; if the fn value starts to rise, tighten to (b, c, w).\n            [b c [w fw]]))\n\n        ;; If the parabolic interpolation jumps beyond the stretch limit, adjust\n        ;; the range to the limit only.\n        (<= xc wlim w) [b c [wlim (f wlim)]]\n\n        ;; I don't this this branch can ever actually be reached.\n        :else (let [new-c (ug/extend-pt xc xb)]\n                [b c [new-c (f new-c)]])))))\n\n(defn bracket-min\n  \"Generates an interval `[lo, hi]` that is guaranteed to contain a minimum of the\n  function `f`, along with a candidate point `[mid, (f mid)]` that the user can\n  use to start a minimum search.\n\n  Returns a dictionary of the form:\n\n  {:lo `lower end of the bracket`\n   :mid `candidate point`\n   :hi `upper end of the bracket`\n   :fncalls `# of fn evaluations so far`\n   :iterations `total iterations`}\n\n  `:lo`, `:mid` and `:hi` are each pairs of the form `[x, (f x)]`.\n\n  The implementation works by growing the bounds using either:\n\n  - a step outside the bounds that places one bound at the golden-ratio cut\n  point between the new bounds, or\n  - a parabola with a minimum interpolated outside the current bounds, bounded b\n  a max.\n\n  This implementation was ported from `scipy.optimize.optimize.bracket`:\n  https://github.com/scipy/scipy/blob/v1.5.2/scipy/optimize/optimize.py#L2450\n\n  `bracket-min` supports the following optional keyword arguments:\n\n  `:xa` the initial guess for the lower end of the bracket. Defaults to 0.0.\n\n  `:xb` the initial guess for the upper end of the bracket. Defaults to 1.0. (If\n  these points aren't supplied in sorted order they'll be switched.)\n\n  `:grow-limit` The maximum factor that the parabolic interpolation can jump the\n  function. Defaults to 110.0.\n\n  `:maxiter` Maximum number of iterations allowed for the minimizer. Defaults to\n  1000.\n\n  `:maxfun` Maximum number of times the function can be evaluated before exiting.\n  Defaults to 1000.\n  \"\n  ([f] (bracket-min f {}))\n  ([f {:keys [xa xb maxiter maxfun]\n       :or {xa 0.0\n            xb 1.0\n            maxiter 1000\n            maxfun 1000}\n       :as opts}]\n   (let [[f-counter f] (u/counted f)\n         step (bracket-step-fn f opts)\n         stop-fn (fn [_ [_ fb] [_ fc] iteration]\n                   (or (> iteration maxiter)\n                       (> @f-counter maxfun)\n                       (<= fb fc)))\n         complete (fn [[xa :as a] b [xc :as c] iterations]\n                    (let [m {:lo a\n                             :mid b\n                             :hi c\n                             :fncalls @f-counter\n                             :iterations iterations}]\n                      (if (< xc xa)\n                        (assoc m :lo c :hi a)\n                        m)))\n         ;; Massage starting values into descending order by f; f(b) < f(a).\n         [[xb :as b] [xa :as a]] (ascending-by f xa xb)\n\n         ;; Generate the first value of c by stretching b away from a with\n         ;; golden-ratio amount, so that b ends up at the golden ratio\n         ;; point (with short segment leading to `a`).\n         xc (ug/extend-pt xb xa)\n         fc (f xc)]\n     (loop [[a b c] [a b [xc fc]]\n            iteration 0]\n       (if (stop-fn a b c iteration)\n         (complete a b c iteration)\n         (recur (step a b c)\n                (inc iteration)))))))\n\n(defn bracket-max\n  \"Identical to bracket-min, except brackets a maximum of the supplied fn.\"\n  ([f] (bracket-max f {}))\n  ([f opts]\n   (let [-f (comp g/negate f)]\n     (bracket-min -f opts))))\n\n(defn bracket-min-scmutils\n  \" Given a function f, a starting point and a step size, try to bracket a local\n  extremum for f.\n\n  Return a list (retcode a b c fa fb fc iter-count) where a < b < c, and fa, fb,\n  fc are the function values at these points. In the case of a minimum, fb\n  <= (min fa fc); the opposite inequality holds in the case of a maximum.\n\n  iter-count is the number of function evaluations required. retcode is 'okay if\n  the search succeeded, or 'maxcount if it was abandoned.\n  \"\n  ([f] (bracket-min-scmutils f {}))\n  ([f {:keys [start step maxiter]\n       :or {start 0\n            step 10\n            maxiter 1000}}]\n   (let [[f-counter f] (u/counted f)\n         stop-fn (fn [[_ fa] [_ fb] [_ fc] iteration]\n                   (or (> iteration maxiter)\n                       (<= fb (min fa fc))))\n         complete (fn [[xa :as a] b [xc :as c] iterations]\n                    (let [m {:lo a\n                             :mid b\n                             :hi c\n                             :fncalls @f-counter\n                             :converged? (<= iterations maxiter)\n                             :iterations iterations}]\n                      (if (< xc xa)\n                        (assoc m :lo c :hi a)\n                        m)))\n         run (fn [[xa :as a] b [xc :as c] iter]\n               (if (stop-fn a b c iter)\n                 (complete a b c iter)\n                 (let [xd (+ xc (- xc xa))]\n                   (recur b c [xd (f xd)] (inc iter)))))\n         [[xb :as b] [xa :as a]] (ascending-by f start (+ start step))\n         xc (+ xb (- xb xa))]\n     (run a b [xc (f xc)] 0))))\n\n(defn bracket-max-scmutils\n  \"Identical to bracket-min-scmutils, except brackets a maximum of the supplied\n  fn.\"\n  ([f] (bracket-max-scmutils f {}))\n  ([f opts]\n   (let [-f (comp g/negate f)]\n     (bracket-min -f opts))))\n"]}
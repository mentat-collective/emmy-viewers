shadow$provide.module$node_modules$mathbox$build$esm$stage$animator=function(global,require,module,exports){function _getRequireWildcardCache(nodeInterop$jscomp$0){if("function"!==typeof WeakMap)return null;var cacheBabelInterop=new WeakMap,cacheNodeInterop=new WeakMap;return(_getRequireWildcardCache=function(nodeInterop){return nodeInterop?cacheNodeInterop:cacheBabelInterop})(nodeInterop$jscomp$0)}Object.defineProperty(exports,"__esModule",{value:!0});exports.Animator=void 0;var Ease=function(obj,
nodeInterop){if(!nodeInterop&&obj&&obj.__esModule)return obj;if(null===obj||"object"!==typeof obj&&"function"!==typeof obj)return{default:obj};if((nodeInterop=_getRequireWildcardCache(nodeInterop))&&nodeInterop.has(obj))return nodeInterop.get(obj);var newObj={},hasPropertyDescriptor=Object.defineProperty&&Object.getOwnPropertyDescriptor,key;for(key in obj)if("default"!==key&&Object.prototype.hasOwnProperty.call(obj,key)){var desc=hasPropertyDescriptor?Object.getOwnPropertyDescriptor(obj,key):null;
desc&&(desc.get||desc.set)?Object.defineProperty(newObj,key,desc):newObj[key]=obj[key]}newObj.default=obj;nodeInterop&&nodeInterop.set(obj,newObj);return newObj}(require("module$node_modules$mathbox$build$esm$util$ease"));class Animator{constructor(context){this.context=context;this.anims=[]}make(type,options){type=new Animation(this,this.context.time,type,options);this.anims.push(type);return type}unmake(anim){return this.anims=Array.from(this.anims).filter(a=>a!==anim)}update(){const {time}=this.context;
return this.anims=(()=>{const result=[];for(const anim of Array.from(this.anims))!1!==anim.update(time)&&result.push(anim);return result})()}lerp(type,from,to,f,value){null==value&&(value=type.make());if(type.lerp)value=type.lerp(from,to,value,f);else{if(type.emitter){value=from.emitterFrom;const toE=to.emitterTo;if(null!=value&&null!=toE&&value===toE)return value.lerp(f),value;type=type.emitter(from,to);from.emitterFrom=type;to.emitterTo=type;type.lerp(f);return type}value=type.op?type.op(from,to,
value,function(a,b){return a===+a&&b===+b?a+(b-a)*f:.5<f?b:a}):.5<f?to:from}return value}}exports.Animator=Animator;class Animation{constructor(animator,time,type,options){this.animator=animator;this.time=time;this.type=type;this.options=options;this.value=this.type.make();this.target=this.type.make();this.queue=[]}dispose(){return this.animator.unmake(this)}set(){let {target}=this,value=1<arguments.length?[].slice.call(arguments):arguments[0],invalid=!1;value=this.type.validate(value,target,()=>
invalid=!0);invalid||(target=value);this.cancel();this.target=this.value;this.value=target;return this.notify()}getTime(){var {clock}=this.options;clock=clock?clock.getTime():this.time;return this.options.realtime?clock.time:clock.clock}cancel(from){let stage;null==from&&(from=this.getTime());const {queue}=this,cancelled=(()=>{const result=[];for(stage of Array.from(queue))stage.end>=from&&result.push(stage);return result})();this.queue=(()=>{const result1=[];for(stage of Array.from(queue))stage.end<
from&&result1.push(stage);return result1})();for(stage of Array.from(cancelled))"function"===typeof stage.complete&&stage.complete(!1);"function"===typeof this.options.complete&&this.options.complete(!1)}notify(){return"function"===typeof this.options.step?this.options.step(this.value):void 0}immediate(value,options){const {duration,delay,ease,step,complete}=options;options=this.getTime()+delay;const end=options+duration;let invalid=!1,target=this.type.make();value=this.type.validate(value,target,
function(){invalid=!0;return null});void 0===value||invalid||(target=value);this.cancel(options);return this.queue.push({from:null,to:target,start:options,end,ease,step,complete})}update(time){this.time=time;if(0===this.queue.length)return!0;time=this.getTime();let {value}=this;const {queue}=this;for(var active=!1;!active;){var stage=queue[0];let {from}=stage;const {to,start,end,step,complete,ease}=stage;null==from&&(from=stage.from=this.type.clone(this.value));stage=Ease.clamp((time-start)/Math.max(1E-5,
end-start)||0,0,1);if(0===stage)return;active=(()=>{switch(ease){case "linear":case 0:return null;case "cosine":case 1:return Ease.cosine;case "binary":case 2:return Ease.binary;case "hold":case 3:return Ease.hold;default:return Ease.cosine}})();null!=active&&(stage=active(stage));value=(active=1>stage)?this.animator.lerp(this.type,from,to,stage,value):to;"function"===typeof step&&step(value);if(!active&&("function"===typeof complete&&complete(!0),"function"===typeof this.options.complete&&this.options.complete(!0),
queue.shift(),0===queue.length))break}this.value=value;return this.notify()}}}
//# sourceMappingURL=module$node_modules$mathbox$build$esm$stage$animator.js.map

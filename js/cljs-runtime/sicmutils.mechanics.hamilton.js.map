{"version":3,"sources":["sicmutils/mechanics/hamilton.cljc"],"mappings":"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","names":["sicmutils.mechanics.hamilton/Hamiltonian","n","r__20948__auto__","cljs.core/seq","or__4253__auto__","pattern.consequence/succeed","sicmutils.mechanics.hamilton/->H-state","t","q","p","sicmutils.structure.up","sicmutils.mechanics.hamilton/H-state?","s","and__4251__auto__","sicmutils.structure/up?","cljs.core._EQ_","cljs.core/count","vec__103274","cljs.core.nth","v","sicmutils.value/numerical?","sicmutils.structure/down?","sicmutils.structure/dimension","sicmutils.mechanics.hamilton/compatible-H-state?","sicmutils.structure/transpose","js/Error","sicmutils.mechanics.hamilton/momentum","H-state","sicmutils.mechanics.hamilton/state->p","sicmutils.mechanics.hamilton/momenta","sicmutils.mechanics.hamilton/P","sicmutils.mechanics.hamilton/state->qp","sicmutils.mechanics.lagrange/coordinate","sicmutils.mechanics.hamilton/qp->H-state-path","sicmutils.mechanics.hamilton/literal-Hamiltonian-state","n-dof","cljs.core.gensym","sicmutils.structure/literal-up","sicmutils.structure/literal-down","sicmutils.mechanics.hamilton/L-state->H-state","L","Ls","sicmutils.mechanics.lagrange/time","fexpr__103283","fexpr__103284","sicmutils.calculus.derivative.partial","sicmutils.mechanics.hamilton/H-state->L-state","H","Hs","sicmutils.mechanics.lagrange/->L-state","fexpr__103286","fexpr__103287","sicmutils.mechanics.hamilton/H-state->matrix","sicmutils.matrix.s__GT_m","sicmutils.structure/compatible-shape","sicmutils.mechanics.hamilton/matrix->H-state","m","sicmutils.matrix/num-cols","cljs.core/odd?","sicmutils.matrix/num-rows","sicmutils.matrix/m->s","sicmutils.mechanics.hamilton/make-Hamiltonian","kinetic-energy","potential-energy","sicmutils.generic._PLUS_","sicmutils.mechanics.hamilton/Hamiltonian->state-derivative","fexpr__103289","fexpr__103290","sicmutils.generic._","fexpr__103292","fexpr__103293","sicmutils.mechanics.hamilton/phase-space-derivative","sicmutils.mechanics.hamilton/Hamilton-equations","Hamiltonian","H-state-path","dH","sicmutils.calculus.derivative/D","sicmutils.function$.compose","sicmutils.mechanics.hamilton/D-phase-space","fexpr__103295","fexpr__103296","fexpr__103298","fexpr__103299","sicmutils.mechanics.hamilton/H-rectangular","V","p__103300","vec__103301","_","sicmutils.generic._SLASH_","sicmutils.generic/square","sicmutils.generic._STAR_","cljs.core.apply","sicmutils.mechanics.hamilton/H-central","p__103304","vec__103305","G__103308","sicmutils.generic/abs","sicmutils.mechanics.hamilton/H-central-polar","p__103314","vec__103315","vec__103318","vec__103321","r","p_r","p_phi","sicmutils.mechanics.hamilton/H-harmonic","k","p__103324","vec__103325","sicmutils.mechanics.hamilton/*validate-Legendre-transform?*","sicmutils.mechanics.hamilton/Legendre-transform-procedure","F","w-of-v","Dw-of-v","w","z","sicmutils.structure/compatible-zero","M","b","sicmutils.value/zero?","sicmutils.generic/simplify","sicmutils.generic/determinant","cljs.core.ex_info","sicmutils.generic/solve-linear-left","Dpg","putative-G","thing","sicmutils.structure/typical-object","cljs.core/not","sicmutils.value/=","G__103333","sicmutils.mechanics.hamilton/Legendre-transform","sicmutils.operator.make_operator","sicmutils.mechanics.hamilton/Lagrangian->Hamiltonian-procedure","Lagrangian","p__103335","vec__103336","p1__103334#","G__103339","fexpr__103340","sicmutils.mechanics.hamilton/Lagrangian->Hamiltonian","sicmutils.mechanics.hamilton/Hamiltonian->Lagrangian-procedure","p__103341","vec__103342","qdot","G__103346","fexpr__103347","sicmutils.mechanics.hamilton/Hamiltonian->Lagrangian","sicmutils.mechanics.hamilton/Poisson-bracket","f","g","x","fx","gx","sicmutils.structure/structure?","sicmutils.structure.mapr","af","ag","fexpr__103350","G__103351","G__103352","cljs.core.comp","sicmutils.structure/component","sicmutils.structure/structure->access-chains","fexpr__103363","fexpr__103364","fexpr__103365","fexpr__103366","fexpr__103367","sicmutils.mechanics.hamilton/Lie-derivative","cljs.core/List","sicmutils.mechanics.hamilton/flow-derivative","fexpr__103373","sicmutils.generic/Lie-derivative","sicmutils.mechanics.hamilton/Lie-transform","sicmutils.generic/exp","cljs.core.sequence","cljs.core.concat","sicmutils.mechanics.hamilton/flow-transform","delta-t","sicmutils.mechanics.hamilton/standard-map","K","pv","sicmutils.value/principal-value","sicmutils.value/twopi","theta","I","cont","_fail","nI","Math/sin","G__103374","G__103375","sicmutils.mechanics.hamilton/standard-map-inverse","ntheta","G__103376","G__103377","sicmutils.mechanics.hamilton/iterated-map","lulz","cljs.core/constantly","y","continue","fail","i","temp__5751__auto__","vec__103381","x'","y'","cljs.core/vector","sicmutils.mechanics.hamilton/F->CH","p__103384","vec__103385","sicmutils.generic/solve-linear-right","fexpr__103389","fexpr__103390","sicmutils.mechanics.hamilton/F->CT","sicmutils.mechanics.hamilton/F->K","fexpr__103392","fexpr__103393","fexpr__103395","fexpr__103396","sicmutils.mechanics.hamilton/canonical?","C","Hprime","sicmutils.mechanics.hamilton/compositional-canonical?","sicmutils.mechanics.hamilton/J-func","DHs","sicmutils.mechanics.hamilton/T-func","sicmutils.value/zero-like","sicmutils.mechanics.lagrange/coordinates","sicmutils.mechanics.hamilton/canonical-H?","sicmutils.mechanics.hamilton/canonical-K?","sicmutils.mechanics.hamilton/linear-function->multiplier","argument","fexpr__103397","sicmutils.mechanics.hamilton/Phi","A","sicmutils.mechanics.hamilton/Phi*","sicmutils.mechanics.hamilton/time-independent-canonical?","G__103405","fexpr__103404","fexpr__103406","fexpr__103407","sicmutils.mechanics.hamilton/qp-canonical?","G__103409","fexpr__103408","fexpr__103410","fexpr__103412","G__103413","sicmutils.mechanics.hamilton/polar-canonical","alpha","p__103414","vec__103415","sicmutils.generic/sqrt","sicmutils.generic/sin","p_x","sicmutils.generic/cos","sicmutils.mechanics.hamilton/polar-canonical-inverse","p__103424","vec__103425","sicmutils.generic/atan","sicmutils.mechanics.hamilton/two-particle-center-of-mass","m0","m1","p__103431","vec__103432","vec__103435","x0","x1","G__103438","G__103439","sicmutils.mechanics.lagrange/coordinate-tuple","sicmutils.mechanics.hamilton/two-particle-center-of-mass-canonical","p__103440","vec__103441","vec__103444","vec__103447","p0","p1","G__103450","G__103451","G__103452","G__103453","sicmutils.mechanics.lagrange/momentum-tuple","sicmutils.mechanics.hamilton/transpose-function","sicmutils.mechanics.hamilton/multiplicative-transpose","sicmutils.mechanics.hamilton/symplectic-two-form","zeta1","zeta2","sicmutils.mechanics.hamilton/canonical-transform?","J","G__103467","fexpr__103466","DCs","fexpr__103468","DCsT","sicmutils.matrix.s_COLON_transpose","sicmutils.mechanics.hamilton/J-matrix","twon+1","sicmutils.matrix.generate","a","sicmutils.mechanics.hamilton/symplectic?","sicmutils.mechanics.lagrange/state->n-dof","DC","sicmutils.calculus.derivative/D-as-matrix","sicmutils.generic/transpose","sicmutils.mechanics.hamilton/symplectic-unit","twoN","sicmutils.mechanics.hamilton/symplectic-matrix?","two-n","sicmutils.matrix/dimension","cljs.core/even?","cljs.core/quot","sicmutils.mechanics.hamilton/qp-submatrix","sicmutils.matrix/without","sicmutils.mechanics.hamilton/symplectic-transform?"],"sourcesContent":["#_\"SPDX-License-Identifier: GPL-3.0\"\n\n(ns sicmutils.mechanics.hamilton\n  (:refer-clojure :exclude [+ - * /  partial])\n  (:require [clojure.core :as core]\n            [pattern.rule :as r :include-macros true]\n            [sicmutils.calculus.derivative :refer [D D-as-matrix partial]]\n            [sicmutils.function :as f]\n            [sicmutils.generic :as g :refer [sin cos + - * /]]\n            [sicmutils.matrix :as matrix]\n            [sicmutils.mechanics.lagrange :as l]\n            [sicmutils.operator :as o]\n            [sicmutils.structure :as s :refer [up]]\n            [sicmutils.value :as v]))\n\n;; Hamiltonian mechanics requires a phase space QxP, and a function H:RxQxP -->\n;; R\n;;\n;; A system has a dynamic state, which has the time, the configuration, and the\n;; momenta. Hamiltonian mechanics is formulated in terms of the dynamic state.\n\n(defn Hamiltonian\n  \"Returns function signature for a Hamiltonian with n degrees of freedom (or an\n  unrestricted number if n is not given).\n\n  Useful for constructing Hamiltonian literal functions.\"\n  [n]\n  (r/template\n   (-> (UP Real (UP* Real ~n) (DOWN* Real ~n)) Real)))\n\n(defn ->H-state\n  \"Given a time `t`, coordinate tuple (or scalar) `q` and momentum tuple (or\n  scalar) `p`, returns a 'Hamiltonian state tuple', ie, the state expected by a\n  Hamiltonian.\"\n  [t q p]\n  (up t q p))\n\n(defn H-state?\n  \"Returns true if the supplied state is\n\n  - of type [[sicmutils.structure/up]]\n\n  - contains three elements of `time`, `coordinate` and `momentum` of either of\n    the following type shapes:\n\n  ```\n  (up <number> <number> <number>)\n  (up <number> (up <number>*) (down <number>*))\n  ```\n\n  If structural, the dimension of the coordinate and momentum tuples must match.\"\n  [s]\n  (and (s/up? s)\n       (= (count s) 3)\n       (let [[t q v] s]\n         (and (v/numerical? t)\n              (or (and (v/numerical? q)\n                       (v/numerical? v))\n                  (and (s/up? q)\n                       (s/down? v)\n                       (= (s/dimension q)\n                          (s/dimension v))))))))\n\n(defn compatible-H-state?\n  \"Returns true if `s` is compatible for contraction with a proper H-state, false\n  otherwise.\"\n  [s]\n  (H-state?\n   (s/transpose s)))\n\n(defn momentum\n  \"Returns the momentum element of a local Hamiltonian state tuple (by convention,\n  the third element).\"\n  [H-state]\n  {:pre [(s/up? H-state) (> (count H-state) 2)]}\n  (nth H-state 2))\n\n(def ^{:doc \"Alias for [[momentum]].\"}\n  state->p momentum)\n\n(def ^{:doc \"Alias for [[momentum]].\"}\n  momenta momentum)\n\n(def ^{:doc \"Alias for [[momentum]].\"}\n  P momentum)\n\n(defn state->qp\n  \"Given a hamiltonian state, returns a [[sicmutils.structure/up]] containing the\n  coordinate and momentum components. \"\n  [s]\n  {:pre [(H-state? s)]}\n  (up (l/coordinate s)\n      (momentum s)))\n\n(defn qp->H-state-path [q p]\n  (fn [t]\n    (->H-state t (q t) (p t))))\n\n(defn literal-Hamiltonian-state [n-dof]\n  (->H-state\n   (gensym 't)\n   (s/literal-up (gensym 'x) n-dof)\n   (s/literal-down (gensym 'p) n-dof)))\n\n(defn L-state->H-state [L]\n  (fn [Ls]\n    (->H-state\n     (l/time Ls)\n     (l/coordinate Ls)\n     (((partial 2) L) Ls))))\n\n(defn H-state->L-state [H]\n  (fn [Hs]\n    (l/->L-state\n     (l/time Hs)\n     (l/coordinate Hs)\n     (((partial 2) H) Hs))))\n\n(defn H-state->matrix [s]\n  (matrix/s->m\n   (s/compatible-shape s) s 1))\n\n(defn matrix->H-state [m s]\n  {:pre [(= (matrix/num-cols m) 1)\n         (odd? (matrix/num-rows m))\n         (> (matrix/num-rows m) 2)]}\n  (matrix/m->s\n   (s/compatible-shape s) m 1))\n\n(defn make-Hamiltonian [kinetic-energy potential-energy]\n  (+ kinetic-energy potential-energy))\n\n(defn Hamiltonian->state-derivative [H]\n  (fn [H-state]\n    (->H-state 1\n               (((partial 2) H) H-state)\n               (- (((partial 1) H) H-state)))))\n\n(def ^{:doc \"Alias for [[Hamiltonian->state-derivative]], for compatibility with\n  1st edition of SICM.\"}\n  phase-space-derivative\n  Hamiltonian->state-derivative)\n\n(defn Hamilton-equations [Hamiltonian]\n  (fn [q p]\n    (let [H-state-path (qp->H-state-path q p)\n          dH (Hamiltonian->state-derivative Hamiltonian)]\n      (- (D H-state-path)\n         (f/compose dH H-state-path)))))\n\n(defn D-phase-space [H]\n  (fn [s]\n    (up 0\n        (((partial 2) H) s)\n        (- (((partial 1) H) s)))))\n\n;; If we express the energy in terms of t,Q,P we have the Hamiltonian. A\n;; Hamiltonian is an example of an H-function: an H-function takes 2 vector\n;; arguments and a scalar argument (t, Q, P). It produces a scalar result.\n\n(defn H-rectangular [m V]\n  (fn [[_ q p]]\n    (make-Hamiltonian\n     (/ (g/square p) (* 2 m))\n     (apply V q))))\n\n(defn H-central [m V]\n  (fn [[_ q p]]\n    (make-Hamiltonian\n     (/ (g/square p) (* 2 m))\n     (V (g/abs q)))))\n\n(defn H-central-polar [m V]\n  (fn [[_ [r _] [p_r p_phi]]]\n    (make-Hamiltonian\n     (/ (+ (g/square p_r)\n           (g/square (/ p_phi r)))\n        (* 2 m))\n     (V r))))\n\n(defn H-harmonic [m k]\n  (fn [[_ q p]]\n    (+ (/ (g/square p) (* 2 m))\n       (* (/ 1 2) k (g/square q)))))\n\n;; If we express the energy in terms of t,Q,P we have the Hamiltonian\n;;\n;;        H(t,Q,P) = P*Qdot - L(t, Q, Qdot(t, Q, P))\n;;\n;; To do this we need to invert P(t, Q, Qdot) to get Qdot(t, Q, P). This is easy\n;; when L is a quadratic form in Qdot:\n;;\n;;        L(t, Q, Qdot) = 1/2*Qdot*M*Qdot + B*Qdot - V\n;;\n;; Fortunately this is the case in almost all of Newtonian mechanics, otherwise\n;; the P(t,Q,Qdot) function would be much more difficult to invert to obtain\n;; Qdot(t,Q,P).\n\n;; Assume that F is quadratic in its arguments\n;;  F(u) = 1/2 A u u + b u + c\n;;  then v = A u + b, so u = A^(-1) (v - b)\n\n(def ^{:dynamic true\n       :doc \"If true, the state passed to the fn returned\n       by [[Legendre-transform]] is checked for correctness. If `false` errors\n       may occur. See the code body for more detail.\n\n       Defaults to `false`.\"}\n  *validate-Legendre-transform?*\n  false)\n\n(defn ^:no-doc Legendre-transform-procedure\n  \"Note from GJS: This ugly version tests for correctness of the result.\"\n  [F]\n  (let [w-of-v  (D F)\n        Dw-of-v (D w-of-v)]\n    (letfn [(putative-G [w]\n              (let [z (s/compatible-zero w)\n                    M (Dw-of-v z)\n                    b (w-of-v z)]\n                (if (and *validate-Legendre-transform?*\n                         (v/zero?\n                          (g/simplify\n                           (g/determinant M))))\n                  (throw\n                   (ex-info \"Legendre Transform Failure: determinant = 0\"\n                            {:F F :w w}))\n                  (let [v (g/solve-linear-left M (- w b))]\n                    (- (* w v) (F v))))))]\n      (let [Dpg (D putative-G)]\n        (fn G [w]\n          (if (and *validate-Legendre-transform?*\n                   (let [thing (s/typical-object w)]\n                     (not (v/= thing\n                               (g/simplify\n                                (w-of-v (Dpg thing)))))))\n            (throw\n             (ex-info \"Legendre Transform Failure: not quadratic\"\n                      {:F F :w w}))\n            (putative-G w)))))))\n\n(def Legendre-transform\n  (o/make-operator Legendre-transform-procedure\n                   'Legendre-transform))\n\n;; Notice that Lagrangians and Hamiltonians are symmetrical with\n;; respect to the Legendre transform.\n\n(defn ^:no-doc Lagrangian->Hamiltonian-procedure\n  [Lagrangian]\n  (fn [[t q p]]  ;; H-state\n    (let [L #(Lagrangian (up t q %))]\n      ((Legendre-transform L) p))))\n\n(def Lagrangian->Hamiltonian\n  (o/make-operator Lagrangian->Hamiltonian-procedure\n                   'Lagrangian->Hamiltonian))\n\n(defn ^:no-doc Hamiltonian->Lagrangian-procedure [Hamiltonian]\n  (fn [[t q qdot]]\n    (letfn [(H [p]\n              (Hamiltonian\n               (->H-state t q p)))]\n      ((Legendre-transform-procedure H) qdot))))\n\n(def Hamiltonian->Lagrangian\n  (o/make-operator Hamiltonian->Lagrangian-procedure\n                   'Hamiltonian->Lagrangian))\n\n(defn Poisson-bracket [f g]\n  (fn [x]\n    (let [fx (f x)\n          gx (g x)]\n      (if (or (s/structure? fx) (s/structure? gx))\n        (s/mapr (fn [af]\n                  (s/mapr (fn [ag]\n                            ((Poisson-bracket\n                              (comp (apply s/component af) f)\n                              (comp (apply s/component ag) g))\n                             x))\n                          (s/structure->access-chains gx)))\n                (s/structure->access-chains fx))\n        ((- (* ((partial 1) f) ((partial 2) g))\n            (* ((partial 2) f) ((partial 1) g)))\n         x)))))\n\n(defn ^:no-doc Lie-derivative\n  \"p. 428\n\n  We define the Lie derivative of F, as a derivative-like operator, relative to\n  the given Hamiltonian-like function, H. Generalization and redefinition in\n  calculus/Lie.scm\n  \"\n  [H]\n  (o/make-operator\n   (fn [F] (Poisson-bracket F H))\n   (list 'Lie-derivative H)))\n\n(defn flow-derivative\n  \"the flow derivative generalizes the Lie derivative to allow for time dependent\n  H and F --- computes the 'time' derivative of F along the flow specified by H\"\n  [H]\n  (-> (fn [F]\n        (+ ((partial 0) F)\n           (Poisson-bracket F H)))\n      (o/make-operator\n       (list 'flow-derivative H))))\n\n(defmethod g/Lie-derivative [::v/function] [f]\n  (Lie-derivative f))\n\n(defn Lie-transform\n  \"p. 428, the Lie transform is just the time-advance operator using the Lie\n  derivative (see Hamiltonian.scm).\"\n  [H t]\n  (-> (g/exp (* t (g/Lie-derivative H)))\n      (o/make-operator\n       `(~'Lie-transform ~H ~t))))\n\n(defn flow-transform\n  \"The generalization of Lie-transform to include time dependence.\"\n  [H delta-t]\n  (-> (g/exp (* delta-t (flow-derivative H)))\n      (o/make-operator\n       `(~'flow-transform ~H ~delta-t))))\n\n(defn standard-map [K]\n  (let [pv (v/principal-value v/twopi)]\n    (fn [theta I cont _fail]\n      (let [nI (pv (core/+ I (core/* K (Math/sin theta))))]\n        (cont\n         (pv (core/+ theta nI))\n         nI)))))\n\n(defn standard-map-inverse [K]\n  (let [pv (v/principal-value v/twopi)]\n    (fn [theta I cont _fail]\n      (let [ntheta (pv (core/- theta I))]\n        (cont ntheta\n              (pv (core/- I (core/*\n                             K (Math/sin ntheta)))))))))\n\n(defn iterated-map\n  \"f is a function of (x y continue fail), which calls continue with the values of\n  x' y' that follow x y in the mapping.\n\n  Returns a map of the same shape that iterates the iterated map n times before\n  invoking the continuation, or invokes the fail continuation if the inner map\n  fails.\"\n  [f n]\n  {:pre [(not (neg? n))]}\n  (let [lulz (constantly nil)]\n    (fn [x y continue fail]\n      (loop [x x\n             y y\n             i n]\n        (if (= i 0)\n          (continue x y)\n          (if-let [[x' y'] (f x y vector lulz)]\n            (recur x' y' (dec i))\n            (fail)))))))\n\n;; ## Point Transformations\n;;\n;; Makes a canonical point transformation from a time-invariant coordinate\n;; transformation T(q)\n\n(defn F->CH\n  \"A transformation of configuration coordinates F to a procedure implementing a\n  transformation of phase-space coordinates (p. 320)\"\n  [F]\n  (fn [[t _ p :as H-state]]\n    (up t\n        (F H-state)\n        (g/solve-linear-right\n         p\n         (((partial 1) F) H-state)))))\n\n(def ^{:doc \"Alias for [[F->CH]].\"}\n  F->CT F->CH)\n\n;; This is used in conjunction with a symplectic test for the C to establish\n;; that a time-dependent transformation is canonical.\n\n;; To compute the K (addition to the Hamiltonian) from a time-dependent\n;; coordinate transformation F.\n\n(defn F->K [F]\n  (fn [H-state]\n    (- (* (g/solve-linear-right\n           (momentum H-state)\n           (((partial 1) F) H-state))\n          (((partial 0) F) H-state)))))\n\n;; ## Canonical Transformations\n\n(defn canonical?\n  \"p.324\"\n  [C H Hprime]\n  (- (f/compose (Hamiltonian->state-derivative H) C)\n     (* (D C) (Hamiltonian->state-derivative Hprime))))\n\n(defn compositional-canonical?\n  \"p.324\"\n  [C H]\n  (canonical? C H (f/compose H C)))\n\n(defn J-func [DHs]\n  (up 0 (nth DHs 2) (- (nth DHs 1))))\n\n(defn T-func [s]\n  (up 1\n      (v/zero-like (l/coordinates s))\n      (v/zero-like (momenta s))))\n\n(defn canonical-H? [C H]\n  (- (f/compose (D-phase-space H) C)\n     (* (D C)\n        (D-phase-space (f/compose H C)))))\n\n(defn canonical-K? [C K]\n  (- (f/compose T-func C)\n     (* (D C)\n        (+ T-func (D-phase-space K)))))\n\n(defn linear-function->multiplier [F argument]\n  ((D F) argument))\n\n(defn Phi [A]\n  (fn [v]\n    (* A v)))\n\n(defn Phi* [A]\n  (fn [w]\n    (* w A)))\n\n(defn time-independent-canonical?\n  \"p.326\"\n  [C]\n  (fn [s]\n    ((- J-func\n        (f/compose (Phi ((D C) s))\n                   J-func\n                   (Phi* ((D C) s))))\n     (s/compatible-shape s))))\n\n;; Time-Varying code\n;;\n;; Originally from time-varying.scm.\n\n(defn qp-canonical?\n  \"Tests that K yields a canonical transformation if the C is symplectic. (The\n  qp-canonical? code is really a symplectic test without factoring out the\n  Hamiltonian.)\"\n  [C H]\n  (fn [s]\n    (- (J-func ((D H) (C s)))\n       (* ((D C) s)\n          (J-func\n           ((D (f/compose H C)) s))))))\n\n;; One particularly useful canonical transform is the Poincare transform, which\n;; is good for simplifying oscillators.\n\n(defn polar-canonical\n  \"p.327\"\n  [alpha]\n  (fn [[t theta I]]\n    (let [x (* (g/sqrt (/ (* 2 I) alpha)) (sin theta))\n          p_x (* (g/sqrt (* 2 alpha I)) (cos theta))]\n      (up t x p_x))))\n\n(defn polar-canonical-inverse [alpha]\n  (fn [[t x p]]\n    (let [I (/ (+ (* alpha (g/square x))\n                  (/ (g/square p) alpha))\n               2)\n          theta (g/atan (/ x (g/sqrt (/ (* 2 I) alpha)))\n                        (/ p (g/sqrt (* 2 I alpha))))]\n      (up t theta I))))\n\n(defn two-particle-center-of-mass [m0 m1]\n  (fn [[_ [x0 x1]]]\n    (l/coordinate-tuple\n     (/ (+ (* m0 x0) (* m1 x1)) (+ m0 m1))\n     (- x1 x0))))\n\n(defn two-particle-center-of-mass-canonical [m0 m1]\n  (fn [[t [x0 x1] [p0 p1]]]\n    (up t\n        (l/coordinate-tuple\n         (/ (+ (* m0 x0) (* m1 x1)) (+ m0 m1))\n         (- x1 x0))\n        (l/momentum-tuple\n         (+ p0 p1)\n         (/ (- (* m0 p1) (* m1 p0))\n            (+ m0 m1))))))\n\n(defn transpose-function [A]\n  (fn [p]\n    (* p A)))\n\n(defn multiplicative-transpose [s]\n  (fn [A]\n    (linear-function->multiplier\n     (transpose-function A) s)))\n\n;; Symplectic\n;;\n;; Originally from symplectic.scm.\n\n(defn symplectic-two-form [zeta1 zeta2]\n  (- (* (momenta zeta2) (l/coordinates zeta1))\n     (* (momenta zeta1) (l/coordinates zeta2))))\n\n;; Without matrices\n\n(defn canonical-transform? [C]\n  (fn [s]\n    (let [J ((D J-func) (s/compatible-shape s))\n          DCs ((D C) s)\n          DCsT (matrix/s:transpose DCs s)]\n      (- J (* DCs J DCsT)))))\n\n(defn J-matrix\n  \"n == degrees of freedom\"\n  [n]\n  (let [twon+1 (inc (* 2 n))]\n    (matrix/generate twon+1 twon+1\n                     (fn [a b]\n                       (cond (zero? a) 0\n                             (zero? b) 0\n                             (= (core/+ a n) b)  1\n                             (= (core/+ b n) a) -1\n                             :else 0)))))\n\n(defn symplectic?\n  \"Symplectic test in terms of matrices\"\n  [C]\n  (fn [s]\n    (let [J (J-matrix (l/state->n-dof s))\n          DC ((D-as-matrix C) s)]\n      (- J (* DC J (g/transpose DC))))))\n\n(defn symplectic-unit\n  \"p. 334 (used, but not defined there)\"\n  [n]\n  (let [twoN (* 2 n)]\n    (matrix/generate twoN twoN\n                     (fn [a b]\n                       (cond (= (+ a n) b) 1\n                             (= (+ b n) a) -1\n                             :else 0)))))\n\n(defn symplectic-matrix?\n  \"p. 334\"\n  [M]\n  (let [two-n (matrix/dimension M)]\n    (when-not (even? two-n)\n      (throw\n       (ex-info \"Wrong type -- symplectic-matrix?\"\n                {:M M})))\n    (let [J (symplectic-unit (quot two-n 2))]\n      (- J (* M J (g/transpose M))))))\n\n(defn qp-submatrix [m]\n  (matrix/without m 0 0))\n\n(defn symplectic-transform?\n  \"p. 334\"\n  [C]\n  (fn [s]\n    (symplectic-matrix?\n     (qp-submatrix\n      ((D-as-matrix C) s)))))\n"]}
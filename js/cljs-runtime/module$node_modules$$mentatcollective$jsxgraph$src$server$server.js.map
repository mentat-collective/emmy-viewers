{
"version":3,
"file":"module$node_modules$$mentatcollective$jsxgraph$src$server$server.js",
"lineCount":8,
"mappings":"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",
"sources":["node_modules/@mentatcollective/jsxgraph/src/server/server.js"],
"sourcesContent":["shadow$provide[\"module$node_modules$$mentatcollective$jsxgraph$src$server$server\"] = function(global,require,module,exports) {\n\"use strict\";\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.default = void 0;\n\nvar _jxg = _interopRequireDefault(require(\"../jxg\"));\n\nvar _zip = _interopRequireDefault(require(\"../utils/zip\"));\n\nvar _base = _interopRequireDefault(require(\"../utils/base64\"));\n\nvar _type = _interopRequireDefault(require(\"../utils/type\"));\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\n/*\n    Copyright 2008-2022\n        Matthias Ehmann,\n        Michael Gerhaeuser,\n        Carsten Miller,\n        Bianca Valentin,\n        Alfred Wassermann,\n        Peter Wilfahrt\n\n    This file is part of JSXGraph.\n\n    JSXGraph is free software dual licensed under the GNU LGPL or MIT License.\n\n    You can redistribute it and/or modify it under the terms of the\n\n      * GNU Lesser General Public License as published by\n        the Free Software Foundation, either version 3 of the License, or\n        (at your option) any later version\n      OR\n      * MIT License: https://github.com/jsxgraph/jsxgraph/blob/master/LICENSE.MIT\n\n    JSXGraph is distributed in the hope that it will be useful,\n    but WITHOUT ANY WARRANTY; without even the implied warranty of\n    MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n    GNU Lesser General Public License for more details.\n\n    You should have received a copy of the GNU Lesser General Public License and\n    the MIT License along with JSXGraph. If not, see <http://www.gnu.org/licenses/>\n    and <http://opensource.org/licenses/MIT/>.\n */\n\n/*global JXG: true, define: true, escape:true, window:true, ActiveXObject:true, XMLHttpRequest:true*/\n\n/*jslint nomen: true, plusplus: true*/\n\n/**\n * @fileoverview The JXG.Server is a wrapper for a smoother integration of server side calculations. on the\n * server side a python plugin system is used.\n */\n\n/**\n * @namespace\n * JXG.Server namespace holding functions to load JXG server modules.\n */\n_jxg.default.Server = {\n  /**\n   * This is where all of a module's handlers are accessed from. If you're loading a module named JXGModule which\n   * provides a handler called ImaHandler, then this handler can be called by invoking JXG.Server.modules.JXGModule.ImaHandler().\n   * @namespace\n   */\n  modules: {},\n\n  /**\n   * Stores all asynchronous calls to server which aren't finished yet.\n   * @private\n   */\n  runningCalls: {},\n\n  /**\n   * Handles errors, just a default implementation, can be overwritten by you, if you want to handle errors by yourself.\n   * @param {object} data An object holding a field of type string named message handling the error described in the message string.\n   */\n  handleError: function (data) {\n    _jxg.default.debug(\"error occured, server says: \" + data.message);\n  },\n\n  /**\n   * The main method of JXG.Server. Actually makes the calls to the server and parses the feedback.\n   * @param {String} action Can be 'load' or 'exec'.\n   * @param {function} callback Function pointer or anonymous function which takes as it's only argument an\n   * object containing the data from the server. The fields of this object depend on the reply of the server\n   * module. See the correspondings server module readme.\n   * @param {Object} data What is to be sent to the server.\n   * @param {Boolean} sync If the call should be synchronous or not.\n   */\n  callServer: function (action, callback, data, sync) {\n    var fileurl, passdata, AJAX, params, id, dataJSONStr, k;\n    sync = sync || false;\n    params = \"\";\n\n    for (k in data) {\n      if (data.hasOwnProperty(k)) {\n        params += \"&\" + escape(k) + \"=\" + escape(data[k]);\n      }\n    }\n\n    dataJSONStr = _type.default.toJSON(data); // generate id\n\n    do {\n      id = action + Math.floor(Math.random() * 4096);\n    } while (_type.default.exists(this.runningCalls[id])); // store information about the calls\n\n\n    this.runningCalls[id] = {\n      action: action\n    };\n\n    if (_type.default.exists(data.module)) {\n      this.runningCalls[id].module = data.module;\n    }\n\n    fileurl = _jxg.default.serverBase + \"JXGServer.py\";\n    passdata = \"action=\" + escape(action) + \"&id=\" + id + \"&dataJSON=\" + escape(_base.default.encode(dataJSONStr));\n\n    this.cbp = function (d) {\n      /*jslint evil:true*/\n      var str, data, tmp, inject, paramlist, id, i, j;\n      str = new _zip.default.Unzip(_base.default.decodeAsArray(d)).unzip();\n\n      if (_type.default.isArray(str) && str.length > 0) {\n        str = str[0][0];\n      }\n\n      if (!_type.default.exists(str)) {\n        return;\n      }\n\n      data = window.JSON && window.JSON.parse ? window.JSON.parse(str) : new Function(\"return \" + str)();\n\n      if (data.type === \"error\") {\n        this.handleError(data);\n      } else if (data.type === \"response\") {\n        id = data.id; // inject fields\n\n        for (i = 0; i < data.fields.length; i++) {\n          tmp = data.fields[i];\n          inject = tmp.namespace + (typeof new Function(\"return \" + tmp.namespace)() === \"object\" ? \".\" : \".prototype.\") + tmp.name + \" = \" + tmp.value;\n          new Function(inject)();\n        } // inject handlers\n\n\n        for (i = 0; i < data.handler.length; i++) {\n          tmp = data.handler[i];\n          paramlist = [];\n\n          for (j = 0; j < tmp.parameters.length; j++) {\n            paramlist[j] = '\"' + tmp.parameters[j] + '\": ' + tmp.parameters[j];\n          } // insert subnamespace named after module.\n\n\n          inject = \"if(typeof JXG.Server.modules.\" + this.runningCalls[id].module + ' == \"undefined\")' + \"JXG.Server.modules.\" + this.runningCalls[id].module + \" = {};\"; // insert callback method which fetches and uses the server's data for calculation in JavaScript\n\n          inject += \"JXG.Server.modules.\" + this.runningCalls[id].module + \".\" + tmp.name + \"_cb = \" + tmp.callback + \";\"; // insert handler as JXG.Server.modules.<module name>.<handler name>\n\n          inject += \"JXG.Server.modules.\" + this.runningCalls[id].module + \".\" + tmp.name + \" = function (\" + tmp.parameters.join(\",\") + \", __JXGSERVER_CB__, __JXGSERVER_SYNC) {\" + 'if(typeof __JXGSERVER_CB__ == \"undefined\") __JXGSERVER_CB__ = JXG.Server.modules.' + this.runningCalls[id].module + \".\" + tmp.name + \"_cb;\" + \"var __JXGSERVER_PAR__ = {\" + paramlist.join(\",\") + ', \"module\": \"' + this.runningCalls[id].module + '\", \"handler\": \"' + tmp.name + '\" };' + 'JXG.Server.callServer(\"exec\", __JXGSERVER_CB__, __JXGSERVER_PAR__, __JXGSERVER_SYNC);' + \"};\";\n          new Function(inject)();\n        }\n\n        delete this.runningCalls[id]; // handle data\n\n        callback(data.data);\n      }\n    }; // bind cbp callback method to JXG.Server to get access to JXG.Server fields from within cpb\n\n\n    this.cb = _jxg.default.bind(this.cbp, this); // We are using our own XMLHttpRequest object in here because of a/sync and POST\n\n    if (window.XMLHttpRequest) {\n      AJAX = new XMLHttpRequest();\n      AJAX.overrideMimeType(\"text/plain; charset=iso-8859-1\");\n    } else {\n      AJAX = new ActiveXObject(\"Microsoft.XMLHTTP\");\n    }\n\n    if (AJAX) {\n      // POST is required if data sent to server is too long for a url.\n      // some browsers/http servers don't accept long urls.\n      AJAX.open(\"POST\", fileurl, !sync);\n      AJAX.setRequestHeader(\"Content-type\", \"application/x-www-form-urlencoded\");\n\n      if (!sync) {\n        // Define function to fetch data received from server\n        // that function returning a function is required to make this.cb known to the function.\n        AJAX.onreadystatechange = function (cb) {\n          return function () {\n            if (AJAX.readyState === 4 && AJAX.status === 200) {\n              cb(AJAX.responseText);\n              return true;\n            }\n\n            return false;\n          };\n        }(this.cb);\n      } // send the data\n\n\n      AJAX.send(passdata);\n\n      if (sync) {\n        this.cb(AJAX.responseText);\n        return true;\n      }\n    }\n\n    return false;\n  },\n\n  /**\n   * Callback for the default action 'load'.\n   */\n  loadModule_cb: function (data) {\n    var i;\n\n    for (i = 0; i < data.length; i++) {\n      _jxg.default.debug(data[i].name + \": \" + data[i].value);\n    }\n  },\n\n  /**\n   * Loads a module from the server.\n   * @param {string} module A string containing the module. Has to match the filename of the Python module on the server exactly including\n   * lower and upper case letters without the file ending .py.\n   */\n  loadModule: function (module) {\n    return _jxg.default.Server.callServer(\"load\", _jxg.default.Server.loadModule_cb, {\n      module: module\n    }, true);\n  }\n};\n_jxg.default.Server.load = _jxg.default.Server.loadModule;\nvar _default = _jxg.default.Server;\nexports.default = _default;\n};"],
"names":["shadow$provide","global","require","module","exports","_interopRequireDefault","obj","__esModule","default","Object","defineProperty","value","_jxg","_zip","_base","_type","Server","modules","runningCalls","handleError","data","debug","message","callServer","action","callback","sync","params","k","hasOwnProperty","escape","dataJSONStr","toJSON","id","Math","floor","random","exists","fileurl","serverBase","passdata","encode","cbp","this.cbp","d","i","str","unzip","Unzip","decodeAsArray","isArray","length","window","JSON","parse","Function","type","fields","tmp","inject","namespace","name","handler","paramlist","j","parameters","join","cb","bind","XMLHttpRequest","AJAX","overrideMimeType","ActiveXObject","open","setRequestHeader","onreadystatechange","readyState","status","responseText","send","loadModule_cb","loadModule","load"]
}

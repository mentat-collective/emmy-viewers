{
"version":3,
"file":"module$node_modules$mathbox$build$esm$primitives$types$shader$shader.js",
"lineCount":7,
"mappings":"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",
"sources":["node_modules/mathbox/build/esm/primitives/types/shader/shader.js"],
"sourcesContent":["shadow$provide[\"module$node_modules$mathbox$build$esm$primitives$types$shader$shader\"] = function(global,require,module,exports) {\n\"use strict\";\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.Shader = void 0;\n\nvar UGLSL = _interopRequireWildcard(require(\"../../../util/glsl.js\"));\n\nvar _primitive = require(\"../../primitive.js\");\n\nfunction _getRequireWildcardCache(nodeInterop) { if (typeof WeakMap !== \"function\") return null; var cacheBabelInterop = new WeakMap(); var cacheNodeInterop = new WeakMap(); return (_getRequireWildcardCache = function (nodeInterop) { return nodeInterop ? cacheNodeInterop : cacheBabelInterop; })(nodeInterop); }\n\nfunction _interopRequireWildcard(obj, nodeInterop) { if (!nodeInterop && obj && obj.__esModule) { return obj; } if (obj === null || typeof obj !== \"object\" && typeof obj !== \"function\") { return { default: obj }; } var cache = _getRequireWildcardCache(nodeInterop); if (cache && cache.has(obj)) { return cache.get(obj); } var newObj = {}; var hasPropertyDescriptor = Object.defineProperty && Object.getOwnPropertyDescriptor; for (var key in obj) { if (key !== \"default\" && Object.prototype.hasOwnProperty.call(obj, key)) { var desc = hasPropertyDescriptor ? Object.getOwnPropertyDescriptor(obj, key) : null; if (desc && (desc.get || desc.set)) { Object.defineProperty(newObj, key, desc); } else { newObj[key] = obj[key]; } } } newObj.default = obj; if (cache) { cache.set(obj, newObj); } return newObj; }\n\n// TODO: This file was created by bulk-decaffeinate.\n// Sanity-check the conversion and remove this comment.\n\n/*\n * decaffeinate suggestions:\n * DS101: Remove unnecessary use of Array.from\n * DS102: Remove unnecessary code created because of implicit returns\n * DS206: Consider reworking classes to avoid initClass\n * DS207: Consider shorter variations of null checks\n * Full docs: https://github.com/decaffeinate/decaffeinate/blob/master/docs/suggestions.md\n */\nclass Shader extends _primitive.Primitive {\n  static initClass() {\n    this.traits = [\"node\", \"bind\", \"shader\"];\n    this.freeform = true;\n  }\n\n  init() {\n    return this.shader = null;\n  }\n\n  make() {\n    const {\n      language,\n      code\n    } = this.props;\n\n    if (language !== \"glsl\") {\n      throw new Error(\"GLSL required\");\n    } // Bind to attached data sources\n\n\n    this._helpers.bind.make([{\n      to: \"shader.sources\",\n      trait: \"source\",\n      multiple: true\n    }]); // Parse snippet w/ shadergraph (will do implicit DOM script tag by ID\n    // lookup if simple selector or ID given)\n\n\n    const snippet = this._shaders.fetch(code); // Convert uniforms to attributes\n\n\n    const types = this._types;\n    const uniforms = {};\n\n    const make = type => {\n      let t;\n\n      switch (type) {\n        case \"i\":\n          return types.int();\n\n        case \"f\":\n          return types.number();\n\n        case \"v2\":\n          return types.vec2();\n\n        case \"v3\":\n          return types.vec3();\n\n        case \"v4\":\n          return types.vec4();\n\n        case \"m3\":\n          return types.mat3();\n\n        case \"m4\":\n          return types.mat4();\n\n        case \"t\":\n          return types.object();\n\n        default:\n          t = type.split(\"\");\n\n          if (t.pop() === \"v\") {\n            return types.array(make(t.join(\"\")));\n          } else {\n            return null;\n          }\n\n      }\n    };\n\n    for (const def of Array.from(snippet._signatures.uniform)) {\n      let type;\n\n      if (type = make(def.type)) {\n        uniforms[def.name] = type;\n      }\n    } // Reconfigure node model\n\n\n    return this.reconfigure({\n      props: {\n        uniform: uniforms\n      }\n    });\n  }\n\n  made() {\n    // Notify of shader reallocation\n    return this.trigger({\n      type: \"source.rebuild\"\n    });\n  }\n\n  unmake() {\n    return this.shader = null;\n  }\n\n  change(changed, _touched, _init) {\n    if (changed[\"shader.uniforms\"] || changed[\"shader.code\"] || changed[\"shader.language\"]) {\n      return this.rebuild();\n    }\n  }\n\n  shaderBind(uniforms) {\n    let k, u, v;\n\n    if (uniforms == null) {\n      uniforms = {};\n    }\n\n    const {\n      code,\n      indices,\n      channels\n    } = this.props; // Merge in prop attributes as uniforms\n\n    for (k in this.node.attributes) {\n      v = this.node.attributes[k];\n\n      if (v.type != null && v.short != null && v.ns === \"uniform\") {\n        if (uniforms[v.short] == null) {\n          uniforms[v.short] = v;\n        }\n      }\n    } // Merge in explicit uniform object if set\n\n\n    if ((u = this.props.uniforms) != null) {\n      for (k in u) {\n        v = u[k];\n        uniforms[k] = v;\n      }\n    } // New shader\n\n\n    const s = this._shaders.shader(); // Require sources\n\n\n    if (this.bind.sources != null) {\n      for (const source of Array.from(this.bind.sources)) {\n        s.callback();\n\n        if (indices != 4) {\n          s.pipe(UGLSL.extendVec(indices, 4));\n        }\n\n        s.pipe(source.sourceShader(this._shaders.shader()));\n\n        if (channels != 4) {\n          s.pipe(UGLSL.truncateVec(4, channels));\n        }\n\n        s.join();\n      }\n    } // Build bound shader\n\n\n    return s.pipe(code, uniforms);\n  }\n\n}\n\nexports.Shader = Shader;\nShader.initClass();\n};"],
"names":["shadow$provide","global","require","module","exports","_getRequireWildcardCache","nodeInterop","WeakMap","cacheBabelInterop","cacheNodeInterop","Object","defineProperty","value","Shader","UGLSL","_interopRequireWildcard","obj","__esModule","default","cache","has","get","newObj","hasPropertyDescriptor","getOwnPropertyDescriptor","key","prototype","hasOwnProperty","call","desc","set","_primitive","Primitive","initClass","traits","freeform","init","shader","make","language","code","props","Error","_helpers","bind","to","trait","multiple","snippet","_shaders","fetch","types","_types","uniforms","type","int","number","vec2","vec3","vec4","mat3","mat4","object","t","split","pop","array","join","def","Array","from","_signatures","uniform","name","reconfigure","made","trigger","unmake","change","changed","_touched","_init","rebuild","shaderBind","u","v","indices","channels","k","node","attributes","short","ns","s","sources","source","callback","pipe","extendVec","sourceShader","truncateVec"]
}

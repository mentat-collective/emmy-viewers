{"version":3,"sources":["nextjournal/viewer/code.cljs"],"mappings":"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","names":["nextjournal.viewer.code/cm6-theme","js/module$node_modules$$codemirror$view$dist$index_cjs.EditorView","nextjournal.viewer.code/highlight-style","js/module$node_modules$$codemirror$language$dist$index_cjs.HighlightStyle","cljs.core/clj->js","js/module$node_modules$$lezer$highlight$dist$index_cjs.tags","nextjournal.viewer.code/ext","nextjournal.clojure-mode/default-extensions","js/module$node_modules$$codemirror$language$dist$index_cjs.syntaxHighlighting","p1__89739#","nextjournal.viewer.code/viewer*","value","prev-view","obj89740","js/undefined","cljs.core.not_EQ_","parent__84053__auto__","f__84054__auto__","G__89741","obj__84046__auto__","f__84047__auto__","obj89742","obj89743","js/module$node_modules$$codemirror$state$dist$index_cjs.EditorState","nextjournal.viewer.code/viewer"],"sourcesContent":["(ns nextjournal.viewer.code\n  (:require [\"@codemirror/language\" :refer [syntaxHighlighting HighlightStyle]]\n            [\"@codemirror/state\" :refer [EditorState]]\n            [\"@codemirror/view\" :refer [EditorView]]\n            [\"@lezer/highlight\" :refer [tags]]\n            [nextjournal.clojure-mode :as cm-clj]\n            [applied-science.js-interop :as j]))\n\n(def cm6-theme\n  (.theme EditorView\n          (j/lit {\"&.cm-focused\" {:outline \"none\"}\n                  \".cm-line\" {:padding \"0\"\n                              :line-height \"1.6\"\n                              :font-size \"15px\"\n                              :font-family \"\\\"Fira Mono\\\", monospace\"}\n                  \".cm-matchingBracket\" {:border-bottom \"1px solid var(--teal-color)\"\n                                         :color \"inherit\"}\n\n                  ;; only show cursor when focused\n                  \".cm-cursor\" {:visibility \"hidden\"}\n                  \"&.cm-focused .cm-cursor\" {:visibility \"visible\"\n                                             :animation \"steps(1) cm-blink 1.2s infinite\"}\n                  \"&.cm-focused .cm-selectionBackground\" {:background-color \"Highlight\"}\n                  \".cm-tooltip\" {:border \"1px solid rgba(0,0,0,.1)\"\n                                 :border-radius \"3px\"\n                                 :overflow \"hidden\"}\n                  \".cm-tooltip > ul > li\" {:padding \"3px 10px 3px 0 !important\"}\n                  \".cm-tooltip > ul > li:first-child\" {:border-top-left-radius \"3px\"\n                                                       :border-top-right-radius \"3px\"}})))\n\n(def highlight-style\n  (.define HighlightStyle\n    (clj->js [{:tag (.-meta tags) :class \"cmt-meta\"}\n              {:tag (.-link tags) :class \"cmt-link\"}\n              {:tag (.-heading tags) :class \"cmt-heading\"}\n              {:tag (.-emphasis tags) :class \"cmt-italic\"}\n              {:tag (.-strong tags) :class \"cmt-strong\"}\n              {:tag (.-strikethrough tags) :class \"cmt-strikethrough\"}\n              {:tag (.-keyword tags) :class \"cmt-keyword\"}\n              {:tag (.-atom tags) :class \"cmt-atom\"}\n              {:tag (.-bool tags) :class \"cmt-bool\"}\n              {:tag (.-url tags) :class \"cmt-url\"}\n              {:tag (.-contentSeparator tags) :class \"cmt-contentSeparator\"}\n              {:tag (.-labelName tags) :class \"cmt-labelName\"}\n              {:tag (.-literal tags) :class \"cmt-literal\"}\n              {:tag (.-inserted tags) :class \"cmt-inserted\"}\n              {:tag (.-string tags) :class \"cmt-string\"}\n              {:tag (.-deleted tags) :class \"cmt-deleted\"}\n              {:tag (.-regexp tags) :class \"cmt-regexp\"}\n              {:tag (.-escape tags) :class \"cmt-escape\"}\n              {:tag (.. tags (special (.-string tags))) :class \"cmt-string\"}\n              {:tag (.. tags (definition (.-variableName tags))) :class \"cmt-variableName\"}\n              {:tag (.. tags (local (.-variableName tags))) :class \"cmt-variableName\"}\n              {:tag (.-typeName tags) :class \"cmt-typeName\"}\n              {:tag (.-namespace tags) :class \"cmt-namespace\"}\n              {:tag (.-className tags) :class \"cmt-className\"}\n              {:tag (.. tags (special (.-variableName tags))) :class \"cmt-variableName\"}\n              {:tag (.-macroName tags) :class \"cmt-macroName\"}\n              {:tag (.. tags (definition (.-propertyName tags))) :class \"cmt-propertyName\"}\n              {:tag (.-comment tags) :class \"cmt-comment\"}\n              {:tag (.-invalid tags) :class \"cmt-invalid\"}])))\n\n(def ext #js [cm-clj/default-extensions\n              (syntaxHighlighting highlight-style)\n              (.. EditorView -editable (of false))\n              cm6-theme])\n\n(defn viewer* [value]\n  ^{:key value}\n  [:div {:ref #(when %\n                 (let [prev-view (j/get % :editorView)]\n                   (when (or (nil? prev-view)\n                             (not= value (j/call-in prev-view [:state :doc :toString])))\n                     (some-> prev-view (j/call :destroy))\n                     (j/assoc! % :editorView\n                               (EditorView. #js {:state (.create EditorState #js {:doc value :extensions ext})\n                                                 :parent %})))))}])\n\n(defn viewer [value]\n  ^{:nextjournal/viewer :reagent} [viewer* value])\n"]}
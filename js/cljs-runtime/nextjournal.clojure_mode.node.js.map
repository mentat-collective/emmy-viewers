{"version":3,"sources":["nextjournal/clojure_mode/node.cljs"],"mappings":"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","names":["nextjournal.clojure-mode.node/coll-prop","js/module$node_modules$lezer_clojure$dist$index_cjs.props","nextjournal.clojure-mode.node/prefix-coll-prop","nextjournal.clojure-mode.node/prefix-edge-prop","nextjournal.clojure-mode.node/prefix-container-prop","nextjournal.clojure-mode.node/start-edge-prop","js/module$node_modules$$lezer$common$dist$index_cjs.NodeProp","nextjournal.clojure-mode.node/end-edge-prop","nextjournal.clojure-mode.node/same-edge-prop","nextjournal.clojure-mode.node/node-prop","prop-name","G__66408","js/Error","nextjournal.clojure-mode.node/type","node","nextjournal.clojure-mode.node/start","nextjournal.clojure-mode.node/end","nextjournal.clojure-mode.node/up","nextjournal.clojure-mode.node/down","cljs.core/fn?","nextjournal.clojure-mode.node/down-last","nextjournal.clojure-mode.node/depth","i","temp__5755__auto__","parent","nextjournal.clojure-mode.node/left","nextjournal.clojure-mode.node/lefts","cljs.core.take_while","cljs.core/identity","cljs.core/iterate","nextjournal.clojure-mode.node/right","nextjournal.clojure-mode.node/rights","nextjournal.clojure-mode.node/coll-type?","node-type","nextjournal.clojure-mode.node/prefix-type?","nextjournal.clojure-mode.node/prefix-edge-type?","nextjournal.clojure-mode.node/prefix-container-type?","nextjournal.clojure-mode.node/same-edge-type?","nextjournal.clojure-mode.node/start-edge-type?","nextjournal.clojure-mode.node/end-edge-type?","nextjournal.clojure-mode.node/top-type?","nextjournal.clojure-mode.node/error-type?","nextjournal.clojure-mode.node/prefix?","n","nextjournal.clojure-mode.node/prefix-edge?","nextjournal.clojure-mode.node/prefix-container?","nextjournal.clojure-mode.node/same-edge?","nextjournal.clojure-mode.node/start-edge?","nextjournal.clojure-mode.node/end-edge?","nextjournal.clojure-mode.node/left-edge-type?","t","nextjournal.clojure-mode.node/left-edge?","nextjournal.clojure-mode.node/right-edge-type?","nextjournal.clojure-mode.node/right-edge?","nextjournal.clojure-mode.node/edge?","nextjournal.clojure-mode.node/closed-by","G__66460","nextjournal.clojure-mode.node/opened-by","G__66461","nextjournal.clojure-mode.node/name","nextjournal.clojure-mode.node/error?","nextjournal.clojure-mode.node/top?","nextjournal.clojure-mode.node/string?","nextjournal.clojure-mode.node/regexp?","nextjournal.clojure-mode.node/line-comment?","nextjournal.clojure-mode.node/discard?","nextjournal.clojure-mode.node/coll?","nextjournal.clojure-mode.node/terminal-type?","p__66486","map__66491","cljs.core/PROTOCOL_SENTINEL","cljs.core.apply","cljs.core/hash-map","obj66494","js/undefined","obj66495","nextjournal.clojure-mode.node/balanced?","firstChild","lastChild","temp__5751__auto__","closing","cljs.core._EQ_","cljs.core.not_EQ_","nextjournal.clojure-mode.node/ancestors","temp__5757__auto__","cljs.core/cons","cljs.core/LazySeq","nextjournal.clojure-mode.node/closest","pred","cljs.core.reduce","_","x","cljs.core/reduced","nextjournal.clojure-mode.node/highest","found","var_args","G__66497","nextjournal.clojure-mode.node/children","from","dir","child","G__66498","nextjournal.clojure_mode.node.children","G__66499","subtree","nextjournal.clojure-mode.node/eq?","y","nextjournal.clojure-mode.node/empty?","type-name","G__66508","nextjournal.clojure-mode.node/from-to","to","nextjournal.clojure_mode.node.from_to","nextjournal.clojure-mode.node/range","nextjournal.clojure_mode.selections.range","G__66512","nextjournal.clojure-mode.node/string","state","nextjournal.clojure_mode.node.string","nextjournal.clojure-mode.node/ancestor?","cljs.core/boolean","nextjournal.clojure-mode.node/move-toward","to-node","G__66527","cljs.core/compare","or__4253__auto__","nextjournal.clojure-mode.node/nodes-between","p1__66532#","nextjournal.clojure-mode.node/require-balance?","G__66537","nextjournal.clojure-mode.node/tree","js/module$node_modules$$codemirror$language$dist$index_cjs.syntaxTree","pos","G__66542","nextjournal.clojure-mode.node/cursor","tree","nextjournal.clojure-mode.node/terminal-cursor","c","nextjournal.clojure_mode.node.cursor","type","nextjournal.clojure-mode.node/up-here","p1__66549#","nextjournal.clojure-mode.node/topmost-cursor","nextjournal.clojure-mode.node/terminal-nodes","cursor","cljs.core.conj","G__66557","nextjournal.clojure-mode.node/balanced-range","nextjournal.clojure_mode.node.balanced_range","vec__66558","cljs.core.nth","vec__66561","cljs.core.sort","from-node","nextjournal.clojure_mode.node.tree","left","right","p1__66555#","cljs.core.map","G__66568","p__66564","vec__66565","node-between","p__66571","map__66572","obj66578","obj66579","nextjournal.clojure-mode.node/inner-span","nextjournal.clojure-mode.node/within?<","c1","c2","nextjournal.clojure-mode.node/within?","nextjournal.clojure-mode.node/follow-edges","nextjournal.clojure-mode.node/prefix","nextjournal.clojure-mode.util/guard","nextjournal.clojure-mode.node/left-edge-with-prefix","G__66593","nextjournal.clojure-mode.node/with-prefix","G__66596","nextjournal.clojure-mode.node/node|","G__66598","p1__66597#","nextjournal.clojure-mode.node/|node","G__66601","p1__66600#","nextjournal.clojure-mode.node/nearest-touching","L","G__66617","p__66618","map__66619","obj66621","R","G__66622","p__66623","map__66624","obj66626","mid","G__66627","p1__66602#","cljs.core.every_pred","cljs.core/some?","p1__66615#"],"sourcesContent":["(ns nextjournal.clojure-mode.node\n  (:refer-clojure :exclude [coll? ancestors string? empty? regexp? name range resolve type])\n  (:require [\"@lezer/common\" :as lz-tree]\n            [\"lezer-clojure\" :as lezer-clj]\n            [\"@codemirror/language\" :as language]\n            [applied-science.js-interop :as j]\n            [nextjournal.clojure-mode.util :as u]\n            [nextjournal.clojure-mode.selections :as sel]))\n\n;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;\n;; Node props are marked in the grammar and distinguish categories of nodes\n\n;; primitive collection\n(def coll-prop (.-coll lezer-clj/props))\n;; prefix collection - a prefix token that wraps the next element\n(def prefix-coll-prop (.-prefixColl lezer-clj/props))\n;; the prefix edge itself\n(def prefix-edge-prop (.-prefixEdge lezer-clj/props))\n;; prefix form - pair of [metadata, target]\n(def prefix-container-prop (.-prefixContainer lezer-clj/props))\n;; edges at the beginning/end of collections, + \"same\" edges (string quotes)\n(def start-edge-prop (.-closedBy lz-tree/NodeProp))\n(def end-edge-prop (.-openedBy lz-tree/NodeProp))\n(def same-edge-prop (.-sameEdge lezer-clj/props ))\n\n;; used when instantiating the parser\n(defn node-prop [prop-name]\n  (case prop-name \"prefixColl\" prefix-coll-prop\n                  \"coll\" coll-prop\n                  \"prefixEdge\" prefix-edge-prop\n                  \"prefixContainer\" prefix-container-prop\n                  \"sameEdge\" same-edge-prop))\n\n;; these wrapping functions exist mainly to avoid type hints\n;; & are mostly compiled away\n\n(defn ^lz-tree/NodeType type [^js node] (.-type node))\n\n(defn ^number start [^js node]\n  {:pre [(.-from node)]}\n  (.-from node))\n\n(defn ^number end [^js node]\n  {:pre [(.-to node)]}\n  (.-to node))\n\n;; a more zipper-like interface\n(defn ^js up [node] (.-parent ^js node))\n\n(defn ^js down [node]\n  {:pre [(not (fn? (.-lastChild ^js node)))]}\n  (.-firstChild ^js node))\n\n(defn ^js down-last [node]\n  {:pre [(not (fn? (.-lastChild ^js node)))]}\n  (.-lastChild ^js node))\n\n(defn ^number depth [^js node]\n  (loop [node node\n         i 0]\n    (if-some [parent (up node)]\n      (recur parent (inc i))\n      i)))\n\n(defn ^js left [^js node]\n  (.childBefore (up node) (start node))\n  #_(.-prevSibling node))\n\n(defn lefts [node]\n  (take-while identity (iterate left (left node))))\n\n(defn ^js right [node]\n  (.childAfter (up node) (end node))\n  #_(.-nextSibling node))\n\n(defn rights [node]\n  (take-while identity (iterate right (right node))))\n\n;; category predicates\n\n(defn coll-type? [^js node-type]\n  (or (.prop node-type coll-prop)\n      #_(.prop node-type prefix-coll-prop)))\n\n(defn ^boolean prefix-type? [node-type] (.prop ^js node-type prefix-coll-prop))\n(defn ^boolean prefix-edge-type? [node-type] (.prop ^js node-type prefix-edge-prop))\n(defn ^boolean prefix-container-type? [node-type] (.prop ^js node-type prefix-container-prop))\n(defn ^boolean same-edge-type? [node-type] (.prop ^js node-type same-edge-prop))\n(defn ^boolean start-edge-type? [node-type] (.prop ^js node-type start-edge-prop))\n(defn ^boolean end-edge-type? [node-type] (.prop ^js node-type end-edge-prop))\n(defn ^boolean top-type? [node-type] (.-isTop ^js node-type))\n(defn ^boolean error-type? [node-type]  (.-isError ^js node-type))\n\n(defn ^boolean prefix? [n] (prefix-type? (type n)))\n(defn ^boolean prefix-edge? [n] (prefix-edge-type? (type n)))\n(defn ^boolean prefix-container? [n] (prefix-container-type? (type n)))\n(defn ^boolean same-edge? [n] (same-edge-type? (type n)))\n(defn ^boolean start-edge? [n]\n  (start-edge-type? (type n)))\n(defn ^boolean end-edge? [n] (end-edge-type? (type n)))\n\n(defn ^boolean left-edge-type? [t]\n  (or (start-edge-type? t)\n      (same-edge-type? t)\n      (prefix-edge-type? t)))\n\n(defn ^boolean left-edge? [n]\n  (left-edge-type? (type  n)))\n\n(defn ^boolean right-edge-type? [t]\n  (or (end-edge-type? t)\n      (same-edge-type? t)))\n\n(defn ^boolean right-edge? [n]\n  (right-edge-type? (type n)))\n\n(defn ^boolean edge? [n]\n  (let [t (type n)]\n    (or (start-edge-type? t)\n        (end-edge-type? t)\n        (same-edge-type? t)\n        (prefix-type? t))))\n\n(defn closed-by [n]\n  (some-> (.prop (type n) (.-closedBy lz-tree/NodeProp))\n          (aget 0)))\n(defn opened-by [n]\n  (some-> (.prop (type n) (.-openedBy lz-tree/NodeProp))\n          (aget 0)))\n\n(defn ^string name [^js node] (.-name node))\n\n;; specific node types\n\n(defn error? [^js node] (error-type? node))\n(defn top? [node] (top-type? (type node)))\n(defn string? [node] (identical? \"String\" (name node)))\n(defn regexp? [node] (identical? \"RegExp\" (name node)))\n(defn line-comment? [node] (identical? \"LineComment\" (name node)))\n(defn discard? [node] (identical? \"Discard\" (name node)))\n\n(defn coll? [node]\n  (coll-type? (type node)))\n\n(defn terminal-type? [^js node-type]\n  (cond (top-type? node-type) false\n        (.prop node-type prefix-coll-prop) false\n        (.prop node-type coll-prop) false\n        (identical? \"Meta\" (name node-type)) false\n        (identical? \"TaggedLiteral\" (name node-type)) false\n        (identical? \"ConstructorCall\" (name node-type)) false\n        :else true))\n\n(j/defn balanced? [^:js {:as node :keys [^js firstChild ^js lastChild]}]\n  (if-let [closing (closed-by firstChild)]\n    (and (= closing (name lastChild))\n         (not= (end firstChild) (end lastChild)))\n    true))\n\n(defn ancestors [^js node]\n  (when-some [parent (up node)]\n    (cons parent\n          (lazy-seq (ancestors parent)))))\n\n(defn ^js closest [node pred]\n  (if (pred node)\n    node\n    (reduce (fn [_ x]\n              (if (pred x) (reduced x) nil)) nil (ancestors node))))\n\n(defn ^js highest [node pred]\n  (reduce (fn [found x]\n            (if (pred x) x (reduced found))) nil (cons node (ancestors node))))\n\n(defn children\n  ([^js parent from dir]\n   (when-some [^js child (case dir 1 (.childAfter parent from)\n                                   -1 (.childBefore parent from))]\n     (cons child (lazy-seq\n                  (children parent (case dir 1 (end child)\n                                             -1 (start child)) dir)))))\n  ([^js subtree]\n   (children subtree (start subtree) 1)))\n\n(defn eq? [^js x ^js y]\n  (and (== (start x) (start y))\n       (== (end x) (end y))\n       (== (depth x) (depth y))))\n\n(defn empty?\n  \"Node only contains whitespace\"\n  [^js node]\n  (let [type-name (name node)]\n    (cond (coll? node)\n          (eq? (-> node down right) (-> node down-last))\n\n          (= \"String\" type-name)\n          (== (-> node down end) (-> node down-last start))\n          :else false)))\n\n(defn from-to\n  ([from to] #js{:from from :to to})\n  ([node]\n   (from-to (start node) (end node))))\n\n(defn range [node]\n  (sel/range (start node) (end node)))\n\n(defn string\n  ([^js state node]\n   (string state (start node) (end node)))\n  ([^js state from to]\n   (.sliceString (.-doc state) from to \\newline)))\n\n(defn ancestor? [parent child]\n  (boolean\n   (and (<= (start parent) (start child))\n        (>= (end parent) (end child))\n        (< (depth parent) (depth child)))))\n\n(defn move-toward\n  \"Returns next loc moving toward `to-path`, skipping children\"\n  [node to-node]\n  (when-not (eq? node to-node)\n    (case (compare (start to-node) (start node))\n      0 (cond (ancestor? to-node node) (up node)\n              (ancestor? node to-node) (down node))\n      -1 (if (ancestor? node to-node)\n           (down-last node)\n           (or (left node)\n               (up node)))\n      1 (if (ancestor? node to-node)\n          (down node)\n          (or (right node)\n              (up node))))))\n\n(defn nodes-between [node to-node]\n  (take-while identity (iterate #(move-toward % to-node) node)))\n\n(defn- require-balance? [node]\n  (or (coll? node)\n      (string? node)\n      (regexp? node)))\n\n(defn ^js tree\n  ([^js state] (language/syntaxTree state))\n  ([^js state pos] (-> state language/syntaxTree (.resolve pos)))\n  ([^js state pos dir] (-> state language/syntaxTree (.resolve pos dir))))\n\n(defn ^js cursor\n  ([^js tree] (.cursor tree))\n  ([^js tree pos] (.cursorAt tree pos))\n  ([^js tree pos dir] (.cursorAt tree pos dir)))\n\n(defn ^js terminal-cursor\n  [^js tree pos dir]\n  (loop [i pos]\n    (let [^js c (cursor tree i dir)\n          type (.-type c)]\n      (cond (top-type? type) nil\n            (terminal-type? (.-type c)) c\n            :else (recur (+ dir i))))))\n\n(defn ^js up-here\n  \"Returns topmost node at same starting position\"\n  [node]\n  (let [from (start node)]\n    (or (highest node #(= from (start %)))\n        node)))\n\n(defn topmost-cursor [state from]\n  (-> (cursor state from 1) .-node up-here .cursor))\n\n(defn terminal-nodes [state from to]\n  (let [^js cursor (topmost-cursor state from)]\n    (loop [found []]\n      (let [node-type (type cursor)]\n        (cond (> (start cursor) to) found\n              (or (terminal-type? node-type)\n                  (error? node-type))\n              (let [found (conj found #js{:type node-type\n                                          :from (start cursor)\n                                          :to  (end cursor)})]\n                (.lastChild cursor)\n                (if (.next cursor)\n                  (recur found)\n                  found))\n              :else (if (.next cursor)\n                      (recur found)\n                      found))))))\n\n(j/defn balanced-range\n  ([state ^js node] (balanced-range state (start node) (end node)))\n  ([state from to]\n   (let [[from to] (sort [from to])\n         from-node (tree state from 1)\n         to-node (tree state to -1)\n         from (if (require-balance? from-node)\n                (start from-node)\n                from)\n         to (if (require-balance? to-node)\n              (end to-node)\n              to)\n         [left right] (->> (nodes-between from-node to-node)\n                           (map #(cond-> % (edge? %) up))\n                           (reduce (fn [[left right] ^js node-between]\n                                     [(if (ancestor? node-between from-node) (start node-between) left)\n                                      (if (ancestor? node-between to-node) (end node-between) right)])\n                                   [from to]))]\n     (sel/range left right))))\n\n(j/defn inner-span\n  \"Span of collection not including edges\"\n  [^:js {:as node :keys [firstChild lastChild]}]\n  #js{:from (if (left-edge? firstChild)\n              (end firstChild)\n              (start node))\n      :to (if (right-edge? lastChild)\n            (start lastChild)\n            (end node))})\n\n(defn within?< \"within (exclusive of edges)\"\n  [parent child]\n  (let [c1 (compare (start parent) (start child))\n        c2 (compare (end parent) (end child))]\n    (and (or (pos? c1) (neg? c2))\n         (not (neg? c1))\n         (not (pos? c2)))))\n\n(defn within? \"within (inclusive of edges)\"\n  [parent child]\n  (and (not (neg? (compare (start parent) (start child))))\n       (not (pos? (compare (end parent) (end child))))))\n\n(defn follow-edges [node]\n  (if (edge? node)\n    (up node)\n    node))\n\n(defn prefix [node]\n  (when-some [parent (up node)]\n    (or (u/guard parent prefix-container?)\n        (u/guard (down parent) prefix-edge?))))\n\n(defn left-edge-with-prefix [state node]\n  (str (some->> (prefix node) (string state))\n       (name (down node))))\n\n(defn with-prefix [node]\n  (cond-> node\n    (prefix node) up))\n\n(defn node|\n  \"Node ending immediately to the left of pos\"\n  [state pos]\n  (some-> (tree state pos -1)\n          (u/guard #(= pos (end %)))))\n\n(defn |node\n  \"Node starting immediately to the right of pos\"\n  [state pos]\n  (some-> (tree state pos 1)\n          (u/guard #(= pos (start %)))))\n\n(defn nearest-touching [^js state pos dir]\n  (let [L (some-> (tree state pos -1)\n                  (u/guard (j/fn [^:js {:keys [to]}] (= pos to))))\n        R (some-> (tree state pos 1)\n                  (u/guard (j/fn [^:js {:keys [from]}]\n                             (= pos from))))\n        mid (tree state pos)]\n    (case dir 1 (or (u/guard R (every-pred some? #(or (same-edge? %) (not (right-edge? %)))))\n                    L\n                    R\n                    mid)\n          -1 (or (u/guard L (every-pred some? #(or (same-edge? %) (not (left-edge? %)))))\n                 R\n                 L\n                 mid))))\n"]}
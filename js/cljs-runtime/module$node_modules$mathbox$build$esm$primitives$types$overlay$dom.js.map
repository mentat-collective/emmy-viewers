{
"version":3,
"file":"module$node_modules$mathbox$build$esm$primitives$types$overlay$dom.js",
"lineCount":9,
"mappings":"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",
"sources":["node_modules/mathbox/build/esm/primitives/types/overlay/dom.js"],
"sourcesContent":["shadow$provide[\"module$node_modules$mathbox$build$esm$primitives$types$overlay$dom\"] = function(global,require,module,exports) {\n\"use strict\";\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.DOM = void 0;\n\nvar _primitive = require(\"../../primitive.js\");\n\n// TODO: This file was created by bulk-decaffeinate.\n// Sanity-check the conversion and remove this comment.\n\n/*\n * decaffeinate suggestions:\n * DS101: Remove unnecessary use of Array.from\n * DS102: Remove unnecessary code created because of implicit returns\n * DS206: Consider reworking classes to avoid initClass\n * DS207: Consider shorter variations of null checks\n * Full docs: https://github.com/decaffeinate/decaffeinate/blob/master/docs/suggestions.md\n */\nclass DOM extends _primitive.Primitive {\n  static initClass() {\n    this.traits = [\"node\", \"bind\", \"object\", \"visible\", \"overlay\", \"dom\", \"attach\", \"position\"];\n  }\n\n  init() {\n    this.emitter = this.root = null;\n    this.active = {};\n  }\n\n  make() {\n    super.make(); // Bind to attached objects\n\n    this._helpers.bind.make([{\n      to: \"dom.html\",\n      trait: \"html\"\n    }, {\n      to: \"dom.points\",\n      trait: \"source\"\n    }]);\n\n    if (this.bind.points == null || this.bind.html == null) {\n      return;\n    } // Listen for updates\n\n\n    this.root = this._inherit(\"root\");\n\n    this._listen(\"root\", \"root.update\", this.update);\n\n    this._listen(\"root\", \"root.post\", this.post); // Fetch geometry dimensions\n\n\n    const pointDims = this.bind.points.getDimensions();\n    const htmlDims = this.bind.html.getDimensions();\n    const items = Math.min(pointDims.items, htmlDims.items);\n    const width = Math.min(pointDims.width, htmlDims.width);\n    const height = Math.min(pointDims.height, htmlDims.height);\n    const depth = Math.min(pointDims.depth, htmlDims.depth); // Build shader to sample position data\n\n    let position = this.bind.points.sourceShader(this._shaders.shader()); // Transform data into screen space\n\n    position = this._helpers.position.pipeline(position); // Apply global projection\n\n    const projection = this._shaders.shader({\n      globals: [\"projectionMatrix\"]\n    });\n\n    projection.pipe(\"project.readback\");\n    position.pipe(projection); // Build nop index shader\n\n    const indexer = this._shaders.shader(); // Prepare readback/memo RTT\n\n\n    this.readback = this._renderables.make(\"readback\", {\n      map: position,\n      indexer,\n      items,\n      width,\n      height,\n      depth,\n      channels: 4,\n      stpq: true\n    }); // Prepare overlay container VDOM\n\n    this.dom = this._overlays.make(\"dom\");\n    this.dom.hint(items * width * height * depth * 2); // Make sure we have enough for wrapping each given element once\n    // Prepare readback consumer\n\n    this.emitter = this.callback(this.bind.html.nodes());\n    this.readback.setCallback(this.emitter);\n\n    this._helpers.visible.make();\n  }\n\n  unmake() {\n    if (this.readback != null) {\n      this.readback.dispose();\n      this.dom.dispose();\n      this.readback = this.dom = null;\n      this.root = null;\n      this.emitter = null;\n      this.active = {};\n    }\n\n    this._helpers.bind.unmake();\n\n    this._helpers.visible.unmake();\n  }\n\n  update() {\n    if (this.readback == null) {\n      return;\n    }\n\n    if (this.props.visible) {\n      this.readback.update(this.root != null ? this.root.getCamera() : undefined);\n      this.readback.post();\n      this.readback.iterate();\n    }\n  }\n\n  post() {\n    if (this.readback == null) {\n      return;\n    }\n\n    this.dom.render(this.isVisible ? this.emitter.nodes() : null);\n  }\n\n  callback(data) {\n    // Create static consumer for the readback\n    let strideJ, strideK;\n\n    const uniforms = this._inherit(\"unit\").getUnitUniforms();\n\n    const width = uniforms.viewWidth;\n    const height = uniforms.viewHeight;\n    const attr = this.node.attributes[\"dom.attributes\"];\n    const size = this.node.attributes[\"dom.size\"];\n    const zoom = this.node.attributes[\"dom.zoom\"];\n    const color = this.node.attributes[\"dom.color\"];\n    const outline = this.node.attributes[\"dom.outline\"];\n    const pointer = this.node.attributes[\"dom.pointerEvents\"];\n    const opacity = this.node.attributes[\"overlay.opacity\"];\n    const zIndex = this.node.attributes[\"overlay.zIndex\"];\n    const offset = this.node.attributes[\"attach.offset\"];\n    const depth = this.node.attributes[\"attach.depth\"];\n    const snap = this.node.attributes[\"attach.snap\"];\n    const {\n      el\n    } = this.dom;\n    let nodes = [];\n    let styles = null;\n    let className = null;\n    let strideI = strideJ = strideK = 0;\n    let colorString = \"\";\n\n    const f = function (x, y, z, w, i, j, k, l) {\n      // Get HTML item by offset\n      let v;\n      const index = l + strideI * i + strideJ * j + strideK * k;\n      const children = data[index]; // Clip behind camera or when invisible\n\n      const clip = w < 0; // Depth blending\n\n      const iw = 1 / w;\n      const flatZ = 1 + (iw - 1) * depth.value;\n      const scale = clip ? 0 : flatZ; // GL to CSS coordinate transform\n\n      const ox = +offset.value.x * scale;\n      const oy = +offset.value.y * scale;\n      let xx = (x + 1) * width.value * 0.5 + ox;\n      let yy = (y - 1) * height.value * 0.5 + oy; // Handle zoom/scale\n\n      xx /= zoom.value;\n      yy /= zoom.value; // Snap to pixel\n\n      if (snap.value) {\n        xx = Math.round(xx);\n        yy = Math.round(yy);\n      } // Clip and apply opacity\n\n\n      const alpha = Math.min(0.999, clip ? 0 : opacity.value); // Generate div\n\n      const props = {\n        className,\n        style: {\n          transform: `translate3d(${xx}px, ${-yy}px, ${1 - w}px) translate(-50%, -50%) scale(${scale},${scale})`,\n          opacity: alpha\n        }\n      };\n\n      for (k in styles) {\n        v = styles[k];\n        props.style[k] = v;\n      } // Merge in external attributes\n\n\n      const a = attr.value;\n\n      if (a != null) {\n        const s = a.style;\n\n        for (k in a) {\n          v = a[k];\n\n          if (![\"style\", \"className\"].includes(k)) {\n            props[k] = v;\n          }\n        }\n\n        if (s != null) {\n          for (k in s) {\n            v = s[k];\n            props.style[k] = v;\n          }\n        }\n      }\n\n      props.className += \" \" + ((a != null ? a.className : undefined) != null ? a != null ? a.className : undefined : \"mathbox-label\"); // Push node onto list\n\n      return nodes.push(el(\"div\", props, children));\n    };\n\n    f.reset = () => {\n      nodes = [];\n      [strideI, strideJ, strideK] = Array.from([this.strideI, this.strideJ, this.strideK]);\n      const c = color.value;\n\n      const m = x => Math.floor(x * 255);\n\n      colorString = c ? `rgb(${[m(c.x), m(c.y), m(c.z)]})` : \"\";\n      className = `mathbox-outline-${Math.round(outline.value)}`;\n      styles = {};\n\n      if (c) {\n        styles.color = colorString;\n      }\n\n      styles.fontSize = `${size.value}px`;\n\n      if (zoom.value !== 1) {\n        styles.zoom = zoom.value;\n      }\n\n      if (zIndex.value > 0) {\n        styles.zIndex = zIndex.value;\n      }\n\n      if (pointer.value) {\n        return styles.pointerEvents = \"auto\";\n      }\n    };\n\n    f.nodes = () => nodes;\n\n    return f;\n  }\n\n  resize() {\n    let sI, sJ;\n\n    if (this.readback == null) {\n      return;\n    } // Fetch geometry/html dimensions\n\n\n    const pointDims = this.bind.points.getActiveDimensions();\n    const htmlDims = this.bind.html.getActiveDimensions();\n    const items = Math.min(pointDims.items, htmlDims.items);\n    const width = Math.min(pointDims.width, htmlDims.width);\n    const height = Math.min(pointDims.height, htmlDims.height);\n    const depth = Math.min(pointDims.depth, htmlDims.depth); // Limit readback to active area\n\n    this.readback.setActive(items, width, height, depth); // Recalculate iteration strides\n\n    this.strideI = sI = htmlDims.items;\n    this.strideJ = sJ = sI * htmlDims.width;\n    this.strideK = sJ * htmlDims.height;\n  }\n\n  change(changed, _touched, _init) {\n    if (changed[\"dom.html\"] || changed[\"dom.points\"]) {\n      return this.rebuild();\n    }\n  }\n\n}\n\nexports.DOM = DOM;\nDOM.initClass();\n};"],
"names":["shadow$provide","global","require","module","exports","Object","defineProperty","value","DOM","_primitive","Primitive","initClass","traits","init","emitter","root","active","make","_helpers","bind","to","trait","points","html","_inherit","_listen","update","post","pointDims","getDimensions","htmlDims","items","Math","min","width","height","depth","position","sourceShader","_shaders","shader","pipeline","projection","globals","pipe","indexer","readback","_renderables","map","channels","stpq","dom","_overlays","hint","callback","nodes","setCallback","visible","unmake","dispose","props","getCamera","undefined","iterate","render","isVisible","data","strideJ","strideK","uniforms","getUnitUniforms","viewWidth","viewHeight","attr","node","attributes","size","zoom","color","outline","pointer","opacity","zIndex","offset","snap","el","styles","className","strideI","colorString","f","x","y","z","w","i","j","k","l","children","clip","flatZ","scale","xx","yy","round","style","transform","alpha","v","a","s","includes","push","reset","f.reset","Array","from","c","floor","fontSize","pointerEvents","f.nodes","resize","getActiveDimensions","setActive","sI","sJ","change","changed","_touched","_init","rebuild"]
}

{"version":3,"sources":["devtools/async.cljs"],"mappings":";;;;;AAMA,kCAAA,lCAAgBA;AAAhB,AACE,eAAAC;;AAEF,gDAAA,hDAAeC;AAEf,+BAAA,/BAAgBC;AAAhB,AACE,OAACC,cAAI,iBAAAC,oBAAK,AAACC;AAAN,AAAA,oBAAAD;AAAmB,OAACE,yEAAqBL;;AAAzCG;;;;AAEP,wCAAA,xCAAgBG;AAAhB,AACE,QAAA,iKAAA,KAAA,pDAA2EN;;AAG7E,uCAAA,vCAAeO;AACf,oDAAA,pDAAeC;AAGf,yCAAA,zCAAMC,0FAAyBC;AAA/B,AACE,kBAAA,XAACC;AAAD,AAAgB,MAAOD;GAAvB;;AAEF,6CAAA,7CAAME,kGAA6BC;AAAnC,uEACM,iBAAAC,yBAAOf,pFACP,iBAAAe,9CACA,IAAAA;AAFA,AAAA,OAAA,CAAAA,uBAAA,iBAAAA;;AACA,AAAA,OAAA,CAAAA,uBAAA,cAAAA,uBAAcD;;AACd,AAAA,AAAA,CAAAC,uBAAA,eAAAA,uBAAeL;;AAHrB;;AAMA,mDAAA,nDAAMM;AAAN,AACE,CAAMP,oDAAyBQ;;AAC/B,QAAMA,oCAAqCJ;;AAE7C,qDAAA,rDAAMK;AAAN,AACE,QAAMD,oCAAqCR;;AAI7C,kCAAA,lCAAMU;AAAN,AACEX;;AAEF,+BAAA,/BAAMY;AAAN,AACE,oBAAUZ;AAAV;;AAAA,AACE,wCAAA,vCAAMA;;AACN,IAAAa,iBAAME;IAAND,8BAAAD;AAAA,AAAA,oBAAAC;AAAA;AAAA,AAAA,MAAA,KAAAC,MAAA,CAAA,kBAAA,CAAA,gCAAA,KAAA,mDAAAF,0BAAA,KAAA;;;AAAA,CAAAC,4BAAA,qBAAmCE;;AAAnCH;AACA,AAACL;;AACD,GAAU,AAACd;AAAX;AAAA,AACE,AAAO,AAACuB,6CAAqB,AAAClB;;;AALlC;;;AAQF,iCAAA,jCAAMmB;AAAN,AACE,oBAAMlB;AAAN,AACE,wCAAA,vCAAMA;;AACN,OAACU;;AAFH","names":["devtools.async/available?","js/Promise","devtools.async/fixed-chrome-version-for-async","devtools.async/needed?","cljs.core/not","and__5043__auto__","devtools.async.goog$module$goog$labs$userAgent$browser.isChrome","devtools.async.goog$module$goog$labs$userAgent$browser.isVersionOrHigher","devtools.async/get-not-needed-message","devtools.async/*installed*","devtools.async/*original-set-immediate*","devtools.async/rethrow-outside-promise","e","js/setTimeout","devtools.async/promise-based-set-immediate","callback","o__62373__auto__","devtools.async/install-async-set-immediate!","js/goog.async.nextTick.setImmediate_","devtools.async/uninstall-async-set-immediate!","devtools.async/installed?","devtools.async/install!","G__65289","target__62389__auto__","js/Error","js/Infinity","devtools.context/get-console","devtools.async/uninstall!"],"sourcesContent":["(ns devtools.async\n  (:require-macros [devtools.oops :refer [oset ocall]])\n  (:require [goog.async.nextTick]\n            [goog.labs.userAgent.browser :as ua]\n            [devtools.context :as context]))\n\n(defn ^:dynamic available? []\n  (exists? js/Promise))\n\n(def ^:dynamic fixed-chrome-version-for-async \"65.0.3321\")\n\n(defn ^:dynamic needed? []\n  (not (and (ua/isChrome) (ua/isVersionOrHigher fixed-chrome-version-for-async))))\n\n(defn ^:dynamic get-not-needed-message []\n  (str \"cljs-devtools: the :async feature is no longer needed since Chrome \" fixed-chrome-version-for-async \", \"\n       \"see https://github.com/binaryage/cljs-devtools/issues/20\"))\n\n(def ^:dynamic *installed* false)\n(def ^:dynamic *original-set-immediate* nil)\n\n; see http://stackoverflow.com/a/30741722/84283\n(defn rethrow-outside-promise [e]\n  (js/setTimeout #(throw e) 0))\n\n(defn promise-based-set-immediate [callback]\n  (-> (ocall js/Promise \"resolve\")\n      (ocall \"then\" callback)\n      (ocall \"catch\" rethrow-outside-promise))\n  nil)\n\n(defn install-async-set-immediate! []\n  (set! *original-set-immediate* js/goog.async.nextTick.setImmediate_)\n  (set! js/goog.async.nextTick.setImmediate_ promise-based-set-immediate))\n\n(defn uninstall-async-set-immediate! []\n  (set! js/goog.async.nextTick.setImmediate_ *original-set-immediate*))\n\n; -- installation -----------------------------------------------------------------------------------------------------------\n\n(defn installed? []\n  *installed*)\n\n(defn install! []\n  (when-not *installed*\n    (set! *installed* true)\n    (oset js/Error [\"stackTraceLimit\"] js/Infinity)\n    (install-async-set-immediate!)\n    (when-not (needed?)\n      (.info (context/get-console) (get-not-needed-message)))\n    true))\n\n(defn uninstall! []\n  (when *installed*\n    (set! *installed* false)\n    (uninstall-async-set-immediate!)))\n"]}
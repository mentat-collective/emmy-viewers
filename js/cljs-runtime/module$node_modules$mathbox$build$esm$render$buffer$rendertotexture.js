shadow$provide.module$node_modules$mathbox$build$esm$render$buffer$rendertotexture=function(global,require,module,exports){function _getRequireWildcardCache(nodeInterop$jscomp$0){if("function"!==typeof WeakMap)return null;var cacheBabelInterop=new WeakMap,cacheNodeInterop=new WeakMap;return(_getRequireWildcardCache=function(nodeInterop){return nodeInterop?cacheNodeInterop:cacheBabelInterop})(nodeInterop$jscomp$0)}Object.defineProperty(exports,"__esModule",{value:!0});exports.RenderToTexture=void 0;
var UGLSL=function(obj,nodeInterop){if(!nodeInterop&&obj&&obj.__esModule)return obj;if(null===obj||"object"!==typeof obj&&"function"!==typeof obj)return{default:obj};if((nodeInterop=_getRequireWildcardCache(nodeInterop))&&nodeInterop.has(obj))return nodeInterop.get(obj);var newObj={},hasPropertyDescriptor=Object.defineProperty&&Object.getOwnPropertyDescriptor,key;for(key in obj)if("default"!==key&&Object.prototype.hasOwnProperty.call(obj,key)){var desc=hasPropertyDescriptor?Object.getOwnPropertyDescriptor(obj,
key):null;desc&&(desc.get||desc.set)?Object.defineProperty(newObj,key,desc):newObj[key]=obj[key]}newObj.default=obj;nodeInterop&&nodeInterop.set(obj,newObj);return newObj}(require("module$node_modules$mathbox$build$esm$util$glsl")),_PerspectiveCamera=require("module$node_modules$three$src$cameras$PerspectiveCamera"),_rendertarget=require("module$node_modules$mathbox$build$esm$render$buffer$texture$rendertarget");global=require("module$node_modules$mathbox$build$esm$render$renderable");var _Scene=
require("module$node_modules$three$src$scenes$Scene"),_Vector=require("module$node_modules$three$src$math$Vector2"),_Vector2=require("module$node_modules$three$src$math$Vector3");class RenderToTexture extends global.Renderable{constructor(renderer,shaders,options){super(renderer,shaders);this.scene=null!=options.scene?options.scene:new _Scene.Scene;this.camera=options.camera;this.build(options)}shaderRelative(shader){null==shader&&(shader=this.shaders.shader());return shader.pipe("sample.2d",this.uniforms)}shaderAbsolute(shader,
frames,indices){null==frames&&(frames=1);null==indices&&(indices=4);null==shader&&(shader=this.shaders.shader());if(1>=frames)return 2<indices&&shader.pipe(UGLSL.truncateVec(indices,2)),shader.pipe("map.2d.data",this.uniforms),shader.pipe("sample.2d",this.uniforms);frames=UGLSL.sample2DArray(Math.min(frames,this.target.frames));4>indices&&shader.pipe(UGLSL.extendVec(indices,4));shader.pipe("map.xyzw.2dv");shader.split();shader.pipe("map.2d.data",this.uniforms);shader.pass();return shader.pipe(frames,
this.uniforms)}build(options){this.camera||(this.camera=new _PerspectiveCamera.PerspectiveCamera,this.camera.position.set(0,0,3),this.camera.lookAt(new _Vector2.Vector3));"function"===typeof this.scene.inject&&this.scene.inject();this.target=new _rendertarget.RenderTarget(this.gl,options.width,options.height,options.frames,options);this.target.warmup(target=>this.renderer.setRenderTarget(target));this.renderer.setRenderTarget(null);this._adopt(this.target.uniforms);this._adopt({dataPointer:{type:"v2",
value:new _Vector.Vector2(.5,.5)}});return this.filled=0}adopt(renderable){return Array.from(renderable.renders).map(object=>this.scene.add(object))}unadopt(renderable){return Array.from(renderable.renders).map(object=>this.scene.remove(object))}render(camera){null==camera&&({camera}=this);const currentTarget=this.renderer.getRenderTarget();this.renderer.setRenderTarget(this.target.write);this.renderer.render(null!=this.scene.scene?this.scene.scene:this.scene,camera);this.renderer.setRenderTarget(currentTarget);
this.target.cycle();if(this.filled<this.target.frames)return this.filled++}read(frame){null==frame&&(frame=0);return this.target.reads[Math.abs(frame)]}getFrames(){return this.target.frames}getFilled(){return this.filled}dispose(){"function"===typeof this.scene.unject&&this.scene.unject();this.scene=this.camera=null;this.target.dispose();return super.dispose()}}exports.RenderToTexture=RenderToTexture}
//# sourceMappingURL=module$node_modules$mathbox$build$esm$render$buffer$rendertotexture.js.map

shadow$provide.module$node_modules$mathbox$build$esm$primitives$types$present$step=function(global,require,module,exports){function __range__(left,right,inclusive){const range=[],ascending=left<right;for(right=inclusive?ascending?right+1:right-1:right;ascending?left<right:left>right;ascending?left++:left--)range.push(left);return range}Object.defineProperty(exports,"__esModule",{value:!0});exports.Step=void 0;global=require("module$node_modules$mathbox$build$esm$primitives$types$present$track");class Step extends global.Track{static initClass(){this.traits=
["node","track","step","trigger","bind"]}make(){super.make();const clock=this._inherit("clock");null==this.actualIndex&&(this.actualIndex=null);this.animateIndex=this._animator.make(this._types.number(0),{clock,realtime:this.props.realtime,step:value=>this.actualIndex=value});null==this.lastIndex&&(this.lastIndex=null);this.animateStep=this._animator.make(this._types.number(0),{clock,realtime:this.props.realtime,step:value=>{this.playhead=value;return this.update()}});this.stops=null!=this.props.stops?
this.props.stops:__range__(0,this.script.length,!1);this._listen("slide","slide.reset",_e=>this.lastIndex=null);return this._listen("slide","slide.step",e=>{var left;let {duration}=this.props;const {delay,pace,speed,playback,rewind,skip,trigger}=this.props,i=Math.max(0,Math.min(this.stops.length-1,e.index-trigger)),from=this.playhead,to=this.stops[i];if(null==this.lastIndex&&trigger)this.lastIndex=i,this.animateStep.set(to),this.animateIndex.set(i);else{var last=null!=(left=null!=this.actualIndex?
this.actualIndex:this.lastIndex)?left:0;left=i-last;var skips=this.stops.slice(Math.min(last,i),Math.max(last,i)),free=0;last=skips.shift();for(const stop of Array.from(skips))last===stop&&free++,last=stop;this.lastIndex=i;e=speed*(0<=e.step?1:rewind);e*=skip?Math.max(1,Math.abs(left)-free):1;duration+=Math.abs(to-from)*pace/e;if(from!==to)return this.animateIndex.immediate(i,{delay,duration,ease:playback}),this.animateStep.immediate(to,{delay,duration,ease:playback})}})}made(){return this.update()}unmake(){this.animateIndex.dispose();
this.animateStep.dispose();this.animateIndex=this.animateStep=null;return super.unmake()}change(changed,touched,init){return changed["step.stops"]||changed["step.realtime"]?this.rebuild():super.change(changed,touched,init)}}exports.Step=Step;Step.initClass()}
//# sourceMappingURL=module$node_modules$mathbox$build$esm$primitives$types$present$step.js.map

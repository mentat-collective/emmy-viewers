{
"version":3,
"file":"module$node_modules$mathbox$build$esm$render$buffer$databuffer.js",
"lineCount":8,
"mappings":"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",
"sources":["node_modules/mathbox/build/esm/render/buffer/databuffer.js"],
"sourcesContent":["shadow$provide[\"module$node_modules$mathbox$build$esm$render$buffer$databuffer\"] = function(global,require,module,exports) {\n\"use strict\";\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.DataBuffer = void 0;\n\nvar UData = _interopRequireWildcard(require(\"../../util/data.js\"));\n\nvar UGLSL = _interopRequireWildcard(require(\"../../util/glsl.js\"));\n\nvar _buffer = require(\"./buffer.js\");\n\nvar _datatexture = require(\"./texture/datatexture.js\");\n\nvar _Vector = require(\"three/src/math/Vector2.js\");\n\nfunction _getRequireWildcardCache(nodeInterop) { if (typeof WeakMap !== \"function\") return null; var cacheBabelInterop = new WeakMap(); var cacheNodeInterop = new WeakMap(); return (_getRequireWildcardCache = function (nodeInterop) { return nodeInterop ? cacheNodeInterop : cacheBabelInterop; })(nodeInterop); }\n\nfunction _interopRequireWildcard(obj, nodeInterop) { if (!nodeInterop && obj && obj.__esModule) { return obj; } if (obj === null || typeof obj !== \"object\" && typeof obj !== \"function\") { return { default: obj }; } var cache = _getRequireWildcardCache(nodeInterop); if (cache && cache.has(obj)) { return cache.get(obj); } var newObj = {}; var hasPropertyDescriptor = Object.defineProperty && Object.getOwnPropertyDescriptor; for (var key in obj) { if (key !== \"default\" && Object.prototype.hasOwnProperty.call(obj, key)) { var desc = hasPropertyDescriptor ? Object.getOwnPropertyDescriptor(obj, key) : null; if (desc && (desc.get || desc.set)) { Object.defineProperty(newObj, key, desc); } else { newObj[key] = obj[key]; } } } newObj.default = obj; if (cache) { cache.set(obj, newObj); } return newObj; }\n\n// TODO: This file was created by bulk-decaffeinate.\n// Sanity-check the conversion and remove this comment.\n\n/*\n * decaffeinate suggestions:\n * DS102: Remove unnecessary code created because of implicit returns\n * DS202: Simplify dynamic range loops\n * DS207: Consider shorter variations of null checks\n * Full docs: https://github.com/decaffeinate/decaffeinate/blob/master/docs/suggestions.md\n */\n\n/*\n * Data buffer on the GPU\n * - Stores samples (1-n) x items (1-n) x channels (1-4)\n * - Provides generic sampler shader\n * - Provides generic copy/write handler\n * => specialized into Array/Matrix/VoxelBuffer\n */\nclass DataBuffer extends _buffer.Buffer {\n  constructor(renderer, shaders, options, build) {\n    if (build == null) {\n      build = true;\n    }\n\n    const width = options.width || 1;\n    const height = options.height || 1;\n    const depth = options.depth || 1;\n    const samples = width * height * depth;\n\n    if (!options.samples) {\n      options.samples = samples;\n    }\n\n    super(renderer, shaders, options);\n    this.width = width;\n    this.height = height;\n    this.depth = depth;\n\n    if (this.samples == null) {\n      this.samples = samples;\n    }\n\n    if (build) {\n      this.build(options);\n    }\n  }\n\n  shader(shader, indices) {\n    if (indices == null) {\n      indices = 4;\n    }\n\n    if (this.items > 1 || this.depth > 1) {\n      if (indices !== 4) {\n        shader.pipe(UGLSL.extendVec(indices, 4));\n      }\n\n      shader.pipe(\"map.xyzw.texture\", this.uniforms);\n    } else {\n      if (indices !== 2) {\n        shader.pipe(UGLSL.truncateVec(indices, 2));\n      }\n    }\n\n    const wrap = this.wrap ? \".wrap\" : \"\";\n    shader.pipe(`map.2d.data${wrap}`, this.uniforms);\n    shader.pipe(\"sample.2d\", this.uniforms);\n\n    if (this.channels < 4) {\n      shader.pipe(UGLSL.swizzleVec4([\"0000\", \"x000\", \"xw00\", \"xyz0\"][this.channels]));\n    }\n\n    return shader;\n  }\n\n  build(options) {\n    this.data = new Float32Array(this.samples * this.channels * this.items);\n    this.texture = new _datatexture.DataTexture(this.renderer, this.items * this.width, this.height * this.depth, this.channels, options);\n    this.filled = 0;\n    this.used = 0;\n\n    this._adopt(this.texture.uniforms);\n\n    this._adopt({\n      dataPointer: {\n        type: \"v2\",\n        value: new _Vector.Vector2()\n      },\n      textureItems: {\n        type: \"f\",\n        value: this.items\n      },\n      textureHeight: {\n        type: \"f\",\n        value: this.height\n      }\n    });\n\n    this.dataPointer = this.uniforms.dataPointer.value;\n    this.streamer = this.generate(this.data);\n  }\n\n  dispose() {\n    this.data = null;\n    this.texture.dispose();\n    return super.dispose();\n  }\n\n  getFilled() {\n    return this.filled;\n  }\n\n  setCallback(callback) {\n    this.callback = callback;\n    return this.filled = 0;\n  }\n\n  copy(data) {\n    const n = Math.min(data.length, this.samples * this.channels * this.items);\n    const d = this.data;\n\n    for (let i = 0, end = n, asc = 0 <= end; asc ? i < end : i > end; asc ? i++ : i--) {\n      d[i] = data[i];\n    }\n\n    this.write(Math.ceil(n / this.channels / this.items));\n  }\n\n  write(n) {\n    if (n == null) {\n      n = this.samples;\n    }\n\n    let height = n / this.width;\n    n *= this.items;\n    const width = height < 1 ? n : this.items * this.width;\n    height = Math.ceil(height);\n    this.texture.write(this.data, 0, 0, width, height);\n    this.dataPointer.set(0.5, 0.5);\n    this.filled = 1;\n    this.used = n;\n  }\n\n  through(callback, target) {\n    let dst, src;\n    const {\n      consume,\n      done\n    } = src = this.streamer;\n    const {\n      emit\n    } = dst = target.streamer;\n    let i = 0;\n\n    let pipe = () => consume((x, y, z, w) => callback(emit, x, y, z, w, i));\n\n    pipe = UData.repeatCall(pipe, this.items);\n    return () => {\n      src.reset();\n      dst.reset();\n      const limit = this.used;\n      i = 0;\n\n      while (!done() && i < limit) {\n        pipe();\n        i++;\n      }\n\n      return src.count();\n    };\n  }\n\n}\n\nexports.DataBuffer = DataBuffer;\n};"],
"names":["shadow$provide","global","require","module","exports","_getRequireWildcardCache","nodeInterop","WeakMap","cacheBabelInterop","cacheNodeInterop","_interopRequireWildcard","obj","__esModule","default","cache","has","get","newObj","hasPropertyDescriptor","Object","defineProperty","getOwnPropertyDescriptor","key","prototype","hasOwnProperty","call","desc","set","value","DataBuffer","UData","UGLSL","_buffer","_datatexture","_Vector","Buffer","constructor","renderer","shaders","options","build","width","height","depth","samples","shader","indices","items","pipe","extendVec","uniforms","truncateVec","wrap","channels","swizzleVec4","data","Float32Array","texture","DataTexture","used","filled","_adopt","dataPointer","type","Vector2","textureItems","textureHeight","streamer","generate","dispose","getFilled","setCallback","callback","copy","n","Math","min","length","d","i","end","asc","write","ceil","through","target","dst","src","consume","done","emit","x","y","z","w","repeatCall","reset","limit","count"]
}

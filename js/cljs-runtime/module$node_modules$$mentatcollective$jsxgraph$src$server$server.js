shadow$provide.module$node_modules$$mentatcollective$jsxgraph$src$server$server=function(global,require,module$jscomp$0,exports){function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}Object.defineProperty(exports,"__esModule",{value:!0});exports.default=void 0;var _jxg=_interopRequireDefault(require("module$node_modules$$mentatcollective$jsxgraph$src$jxg")),_zip=_interopRequireDefault(require("module$node_modules$$mentatcollective$jsxgraph$src$utils$zip")),_base=_interopRequireDefault(require("module$node_modules$$mentatcollective$jsxgraph$src$utils$base64")),
_type=_interopRequireDefault(require("module$node_modules$$mentatcollective$jsxgraph$src$utils$type"));_jxg.default.Server={modules:{},runningCalls:{},handleError:function(data){_jxg.default.debug("error occured, server says: "+data.message)},callServer:function(action,callback,data,sync){sync=sync||!1;var params="";for(dataJSONStr in data)data.hasOwnProperty(dataJSONStr)&&(params+="\x26"+escape(dataJSONStr)+"\x3d"+escape(data[dataJSONStr]));var dataJSONStr=_type.default.toJSON(data);do params=action+
Math.floor(4096*Math.random());while(_type.default.exists(this.runningCalls[params]));this.runningCalls[params]={action};_type.default.exists(data.module)&&(this.runningCalls[params].module=data.module);data=_jxg.default.serverBase+"JXGServer.py";action="action\x3d"+escape(action)+"\x26id\x3d"+params+"\x26dataJSON\x3d"+escape(_base.default.encode(dataJSONStr));this.cbp=function(d){var i;d=(new _zip.default.Unzip(_base.default.decodeAsArray(d))).unzip();_type.default.isArray(d)&&0<d.length&&(d=d[0][0]);
if(_type.default.exists(d))if(d=window.JSON&&window.JSON.parse?window.JSON.parse(d):(new Function("return "+d))(),"error"===d.type)this.handleError(d);else if("response"===d.type){var id=d.id;for(i=0;i<d.fields.length;i++){var tmp=d.fields[i];var inject=tmp.namespace+("object"===typeof(new Function("return "+tmp.namespace))()?".":".prototype.")+tmp.name+" \x3d "+tmp.value;(new Function(inject))()}for(i=0;i<d.handler.length;i++){tmp=d.handler[i];var paramlist=[];for(inject=0;inject<tmp.parameters.length;inject++)paramlist[inject]=
'"'+tmp.parameters[inject]+'": '+tmp.parameters[inject];inject="if(typeof JXG.Server.modules."+this.runningCalls[id].module+' \x3d\x3d "undefined")JXG.Server.modules.'+this.runningCalls[id].module+" \x3d {};";inject+="JXG.Server.modules."+this.runningCalls[id].module+"."+tmp.name+"_cb \x3d "+tmp.callback+";";inject+="JXG.Server.modules."+this.runningCalls[id].module+"."+tmp.name+" \x3d function ("+tmp.parameters.join(",")+', __JXGSERVER_CB__, __JXGSERVER_SYNC) {if(typeof __JXGSERVER_CB__ \x3d\x3d "undefined") __JXGSERVER_CB__ \x3d JXG.Server.modules.'+
this.runningCalls[id].module+"."+tmp.name+"_cb;var __JXGSERVER_PAR__ \x3d {"+paramlist.join(",")+', "module": "'+this.runningCalls[id].module+'", "handler": "'+tmp.name+'" };JXG.Server.callServer("exec", __JXGSERVER_CB__, __JXGSERVER_PAR__, __JXGSERVER_SYNC);};';(new Function(inject))()}delete this.runningCalls[id];callback(d.data)}};this.cb=_jxg.default.bind(this.cbp,this);if(window.XMLHttpRequest){var AJAX=new XMLHttpRequest;AJAX.overrideMimeType("text/plain; charset\x3diso-8859-1")}else AJAX=new ActiveXObject("Microsoft.XMLHTTP");
return AJAX&&(AJAX.open("POST",data,!sync),AJAX.setRequestHeader("Content-type","application/x-www-form-urlencoded"),sync||(AJAX.onreadystatechange=function(cb){return function(){return 4===AJAX.readyState&&200===AJAX.status?(cb(AJAX.responseText),!0):!1}}(this.cb)),AJAX.send(action),sync)?(this.cb(AJAX.responseText),!0):!1},loadModule_cb:function(data){var i;for(i=0;i<data.length;i++)_jxg.default.debug(data[i].name+": "+data[i].value)},loadModule:function(module){return _jxg.default.Server.callServer("load",
_jxg.default.Server.loadModule_cb,{module},!0)}};_jxg.default.Server.load=_jxg.default.Server.loadModule;exports.default=_jxg.default.Server}
//# sourceMappingURL=module$node_modules$$mentatcollective$jsxgraph$src$server$server.js.map

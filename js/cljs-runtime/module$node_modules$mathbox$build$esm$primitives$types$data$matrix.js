shadow$provide.module$node_modules$mathbox$build$esm$primitives$types$data$matrix=function(global,require,module,exports){function _getRequireWildcardCache(nodeInterop$jscomp$0){if("function"!==typeof WeakMap)return null;var cacheBabelInterop=new WeakMap,cacheNodeInterop=new WeakMap;return(_getRequireWildcardCache=function(nodeInterop){return nodeInterop?cacheNodeInterop:cacheBabelInterop})(nodeInterop$jscomp$0)}Object.defineProperty(exports,"__esModule",{value:!0});exports.Matrix=void 0;var UData=
function(obj,nodeInterop){if(!nodeInterop&&obj&&obj.__esModule)return obj;if(null===obj||"object"!==typeof obj&&"function"!==typeof obj)return{default:obj};if((nodeInterop=_getRequireWildcardCache(nodeInterop))&&nodeInterop.has(obj))return nodeInterop.get(obj);var newObj={},hasPropertyDescriptor=Object.defineProperty&&Object.getOwnPropertyDescriptor,key;for(key in obj)if("default"!==key&&Object.prototype.hasOwnProperty.call(obj,key)){var desc=hasPropertyDescriptor?Object.getOwnPropertyDescriptor(obj,
key):null;desc&&(desc.get||desc.set)?Object.defineProperty(newObj,key,desc):newObj[key]=obj[key]}newObj.default=obj;nodeInterop&&nodeInterop.set(obj,newObj);return newObj}(require("module$node_modules$mathbox$build$esm$util$data"));global=require("module$node_modules$mathbox$build$esm$primitives$types$data$buffer");class Matrix extends global.Buffer{static initClass(){this.traits="node buffer active data source index texture matrix raw".split(" ")}init(){this.buffer=this.spec=null;this.space={width:0,
height:0,history:0};this.used={width:0,height:0};this.storage="matrixBuffer";this.passthrough=(emit,x,y)=>emit(x,y,0,0);return super.init()}sourceShader(shader){const dims=this.getDimensions();this.alignShader(dims,shader);return this.buffer.shader(shader)}getDimensions(){return{items:this.items,width:this.space.width,height:this.space.height,depth:this.space.history}}getActiveDimensions(){return{items:this.items,width:this.used.width,height:this.used.height,depth:this.buffer.getFilled()}}getFutureDimensions(){return{items:this.items,
width:this.used.width,height:this.used.height,depth:this.space.history}}getRawDimensions(){return{items:this.items,width:this.space.width,height:this.space.height,depth:1}}make(){super.make();const minFilter=null!=this.minFilter?this.minFilter:this.props.minFilter,magFilter=null!=this.magFilter?this.magFilter:this.props.magFilter,type=null!=this.type?this.type:this.props.type;var {width}=this.props,{height}=this.props;const {history}=this.props,reserveX=this.props.bufferWidth,reserveY=this.props.bufferHeight,
{channels}=this.props,{items}=this.props;width=this.spec={channels,items,width,height};this.items=width.items;this.channels=width.channels;({data:height}=this.props);width=UData.getDimensions(height,width);({space:height}=this);height.width=Math.max(reserveX,width.width||1);height.height=Math.max(reserveY,width.height||1);height.history=history;return this.buffer=this._renderables.make(this.storage,{width:height.width,height:height.height,history:height.history,channels,items,minFilter,magFilter,
type})}unmake(){super.unmake();if(this.buffer)return this.buffer.dispose(),this.buffer=this.spec=null}change(changed,touched,init){if(touched.texture||changed["matrix.history"]||changed["buffer.channels"]||changed["buffer.items"]||changed["matrix.bufferWidth"]||changed["matrix.bufferHeight"])return this.rebuild();if(this.buffer){if(changed["matrix.width"]){const {width,bufferWidth}=this.props;this.spec.width=width;if(width>bufferWidth)return this.rebuild()}if(changed["matrix.height"]){const {height,
bufferHeight}=this.props;this.spec.height=height;if(height>bufferHeight)return this.rebuild()}if(changed["data.map"]||changed["data.data"]||changed["data.resolve"]||changed["data.expr"]||init)return this.buffer.setCallback(this.emitter())}}callback(callback){return 3>=callback.length?callback:(emit,i,j)=>callback(emit,i,j,this.bufferClock,this.bufferStep)}update(){if(this.buffer){var {data}=this.props,{space,used}=this,w=used.width,h=used.height,filled=this.buffer.getFilled();this.syncBuffer(abort=>
{if(null!=data){var dims=UData.getDimensions(data,this.spec);if(dims.width>space.width||dims.height>space.height)return abort(),this.rebuild();used.width=dims.width;used.height=dims.height;this.buffer.setActive(used.width,used.height);"function"===typeof this.buffer.callback.rebind&&this.buffer.callback.rebind(data);return this.buffer.update()}abort=this.spec.width||1;dims=this.spec.height||1;this.buffer.setActive(abort,dims);const length=this.buffer.update();used.width=abort;used.height=Math.min(dims,
Math.ceil(length/abort));1===used.height&&(used.width=Math.min(abort,length))});if(used.width!==w||used.height!==h||filled!==this.buffer.getFilled())return this.trigger({type:"source.resize"})}}}exports.Matrix=Matrix;Matrix.initClass()}
//# sourceMappingURL=module$node_modules$mathbox$build$esm$primitives$types$data$matrix.js.map

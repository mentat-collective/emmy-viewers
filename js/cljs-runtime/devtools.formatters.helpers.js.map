{"version":3,"sources":["devtools/formatters/helpers.cljs"],"mappings":"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","names":["devtools.formatters.helpers/pref","v","cljs.core/Keyword","devtools.prefs/pref","devtools.formatters.helpers/get-prototype","o","devtools.formatters.helpers/get-constructor","devtools.formatters.helpers/is-prototype?","devtools.formatters.helpers/is-js-symbol?","cljs.core._EQ_","goog/typeOf","devtools.formatters.helpers/cljs-function?","value","and__5043__auto__","cljs.core/not","cljs.core/var?","devtools.munging/cljs-fn?","devtools.formatters.helpers/has-formatting-protocol?","or__5045__auto__","cljs.core/PROTOCOL_SENTINEL","cljs.core/native-satisfies?","_e__62393__auto__","e63939","cljs.core/IPrintWithWriter","e63941","devtools.format/IDevtoolsFormat","e63945","devtools.protocols/IFormat","devtools.formatters.helpers/cljs-type?","f","goog/isObject","devtools.formatters.helpers/cljs-instance?","devtools.formatters.helpers/cljs-land-value?","devtools.formatters.helpers/cljs-value?","devtools.formatters.helpers/bool?","devtools.formatters.helpers/instance-of-a-well-known-type?","vec__63957","cljs.core.nth","well-known-types","constructor-fn","ns","name","devtools.munging/parse-constructor-info","fully-qualified-type-name","cljs.core/contains?","devtools.formatters.helpers/should-render-instance?","devtools.formatters.helpers/directly-printable?","devtools.formatters.helpers/abbreviated?","template","p1__63966#","cljs.core/some","devtools.formatters.helpers/abbreviate-long-string","string","marker","prefix-limit","postfix-limit","prefix","postfix","devtools.formatters.helpers/get-more-marker","more-count","devtools.formatters.helpers/wrap-arity","arity","args-open-symbol","args-close-symbol","devtools.formatters.helpers/fetch-field-value","obj","field","cljs.core/munge","devtools.formatters.helpers/fetch-fields-values","fields","cljs.core.map","cljs.core.partial","devtools.formatters.helpers/expandable?","cljs.core/ISeqable","temp__5751__auto__","min-count","cljs.core/empty?","actual-count","cljs.core/bounded-count","devtools.formatters.helpers/should-render?","pref-key","default-check","render-pref","cljs.core/fn?"],"sourcesContent":["(ns devtools.formatters.helpers\n  (:require-macros [devtools.oops :refer [oget safe-call]])\n  (:require [devtools.prefs :as prefs]\n            [devtools.munging :as munging]\n            [devtools.format :refer [IDevtoolsFormat]]\n            [devtools.protocols :refer [ITemplate IGroup ISurrogate IFormat]]))\n\n(defn pref [v]\n  (if (keyword? v)\n    (recur (prefs/pref v))\n    v))\n\n(defn get-prototype [o]\n  (.-prototype o))\n\n(defn get-constructor [o]\n  (.-constructor o))\n\n; ---------------------------------------------------------------------------------------------------------------------------\n\n(defn is-prototype? [o]\n  (identical? (get-prototype (get-constructor o)) o))\n\n(defn is-js-symbol? [o]\n  (= (goog/typeOf o) \"symbol\"))\n\n(defn cljs-function? [value]\n  (and (not (pref :disable-cljs-fn-formatting))                                                                               ; TODO: this should be deprecated\n       (not (var? value))                                                                                                     ; HACK: vars have IFn protocol and would act as functions TODO: implement custom rendering for vars\n       (munging/cljs-fn? value)))\n\n(defn has-formatting-protocol? [value]\n  (or (safe-call satisfies? false IPrintWithWriter value)\n      (safe-call satisfies? false IDevtoolsFormat value)                                                                      ; legacy\n      (safe-call satisfies? false IFormat value)))\n\n; IRC #clojurescript @ freenode.net on 2015-01-27:\n; [13:40:09] darwin_: Hi, what is the best way to test if I'm handled ClojureScript data value or plain javascript object?\n; [14:04:34] dnolen: there is a very low level thing you can check\n; [14:04:36] dnolen: https://github.com/clojure/clojurescript/blob/c2550c4fdc94178a7957497e2bfde54e5600c457/src/clj/cljs/core.clj#L901\n; [14:05:00] dnolen: this property is unlikely to change - still it's probably not something anything anyone should use w/o a really good reason\n(defn cljs-type? [f]\n  (and (goog/isObject f)                                                                                                      ; see http://stackoverflow.com/a/22482737/84283\n       (not (is-prototype? f))\n       (.-cljs$lang$type f)))\n\n(defn cljs-instance? [value]\n  (and (goog/isObject value)                                                                                                  ; see http://stackoverflow.com/a/22482737/84283\n       (cljs-type? (get-constructor value))))\n\n(defn cljs-land-value? [value]\n  (or (cljs-instance? value)\n      (has-formatting-protocol? value)))                                                                                      ; some raw js types can be extend-protocol to support cljs printing, see issue #21\n\n(defn cljs-value? [value]\n  (and\n    (or (cljs-land-value? value)\n        (cljs-function? value))\n    (not (is-prototype? value))\n    (not (is-js-symbol? value))))\n\n(defn bool? [value]\n  (or (true? value) (false? value)))\n\n(defn instance-of-a-well-known-type? [value]\n  (let [well-known-types (pref :well-known-types)\n        constructor-fn (get-constructor value)\n        [ns name] (munging/parse-constructor-info constructor-fn)\n        fully-qualified-type-name (str ns \"/\" name)]\n    (contains? well-known-types fully-qualified-type-name)))\n\n(defn should-render-instance? [value]\n  (and (cljs-instance? value)\n       (not (instance-of-a-well-known-type? value))))\n\n(defn directly-printable? [value]\n  (or (string? value)\n      (number? value)\n      (bool? value)))\n\n; ---------------------------------------------------------------------------------------------------------------------------\n\n(defn abbreviated? [template]\n  (some #(= (pref :more-marker) %) template))\n\n(defn abbreviate-long-string [string marker prefix-limit postfix-limit]\n  (let [prefix (.slice string 0 prefix-limit)\n        postfix (.slice string (- (.-length string) postfix-limit))]\n    (str prefix marker postfix)))\n\n(defn get-more-marker [more-count]\n  (str (pref :plus-symbol) more-count (pref :more-symbol)))\n\n(defn wrap-arity [arity]\n  (let [args-open-symbol (pref :args-open-symbol)\n        args-close-symbol (pref :args-close-symbol)]\n    (str args-open-symbol arity args-close-symbol)))\n\n(defn fetch-field-value [obj field]\n  [field (oget obj (munge field))])\n\n(defn fetch-fields-values [obj fields]\n  (map (partial fetch-field-value obj) fields))\n\n(defn expandable? [obj]\n  (if (satisfies? ISeqable obj)\n    (if-let [min-count (pref (if (instance-of-a-well-known-type? obj)\n                               :min-expandable-sequable-count-for-well-known-types\n                               :min-expandable-sequable-count))]\n      (if-not (empty? obj)\n        (let [actual-count (bounded-count min-count obj)]\n          (>= actual-count min-count))))))\n\n(defn should-render? [pref-key value default-check]\n  (if-let [render-pref (pref pref-key)]\n    (cond\n      (true? render-pref) (default-check value)\n      (fn? render-pref) (render-pref value))))\n"]}